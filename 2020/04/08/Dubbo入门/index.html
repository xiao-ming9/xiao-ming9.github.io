<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222"><meta name="generator" content="Hexo 6.3.0">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.0/css/all.min.css" integrity="sha256-AbA177XfpSnFEvgpYu1jMygiLabzPCJCRIBtR5jGc0k=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"yoursite.com","root":"/","images":"/images","scheme":"Mist","darkmode":false,"version":"8.13.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":{"enable":false,"style":null},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"},"path":"/search.xml","localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":true}}</script><script src="/js/config.js"></script>

    <meta name="description" content="Dubbo架构Apache Dubbo 是一款高性能、轻量级的开源 Java RPC 框架，它提供了三大核心能力：面向接口的远程方法调用，智能容错和负载均衡，以及服务自动注册和发现。   async表示异步，sync表示同步">
<meta property="og:type" content="article">
<meta property="og:title" content="Dubbo入门">
<meta property="og:url" content="http://yoursite.com/2020/04/08/Dubbo%E5%85%A5%E9%97%A8/index.html">
<meta property="og:site_name" content="Silverming">
<meta property="og:description" content="Dubbo架构Apache Dubbo 是一款高性能、轻量级的开源 Java RPC 框架，它提供了三大核心能力：面向接口的远程方法调用，智能容错和负载均衡，以及服务自动注册和发现。   async表示异步，sync表示同步">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://qiniu.xiaoming.net.cn/Dubbo%E6%9E%B6%E6%9E%84">
<meta property="og:image" content="http://qiniu.xiaoming.net.cn/Dubbo%E9%85%8D%E7%BD%AE%E5%85%B3%E7%B3%BB%E4%BC%98%E5%85%88%E7%BA%A7.jpg">
<meta property="og:image" content="http://qiniu.xiaoming.net.cn/dubbo%E4%B8%8D%E5%90%8C%E7%B2%92%E5%BA%A6%E9%85%8D%E7%BD%AE%E7%9A%84%E8%A6%86%E7%9B%96%E5%85%B3%E7%B3%BB.jpg">
<meta property="og:image" content="http://qiniu.xiaoming.net.cn/Dubbo%E6%9C%AC%E5%9C%B0%E5%AD%98%E6%A0%B9.jpg">
<meta property="article:published_time" content="2020-04-08T09:28:20.000Z">
<meta property="article:modified_time" content="2020-12-01T10:36:29.716Z">
<meta property="article:author" content="Silverming">
<meta property="article:tag" content="Dubbo">
<meta property="article:tag" content="分布式">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://qiniu.xiaoming.net.cn/Dubbo%E6%9E%B6%E6%9E%84">


<link rel="canonical" href="http://yoursite.com/2020/04/08/Dubbo%E5%85%A5%E9%97%A8/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"zh-CN","comments":true,"permalink":"http://yoursite.com/2020/04/08/Dubbo%E5%85%A5%E9%97%A8/","path":"2020/04/08/Dubbo入门/","title":"Dubbo入门"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>Dubbo入门 | Silverming</title>
  






  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title">Silverming</p>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">Stay hungry,stay foolish</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a></li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup"><div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off" maxlength="80"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close" role="button">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div class="search-result-container no-result">
  <div class="search-result-icon">
    <i class="fa fa-spinner fa-pulse fa-5x"></i>
  </div>
</div>

    </div>
  </div>

</div>
        
  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>

  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#Dubbo%E6%9E%B6%E6%9E%84"><span class="nav-number">1.</span> <span class="nav-text">Dubbo架构</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%8A%82%E7%82%B9%E8%A7%92%E8%89%B2%E8%AF%B4%E6%98%8E"><span class="nav-number">1.1.</span> <span class="nav-text">节点角色说明</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%B0%83%E7%94%A8%E5%85%B3%E7%B3%BB%E8%AF%B4%E6%98%8E"><span class="nav-number">1.2.</span> <span class="nav-text">调用关系说明</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Dubbo-%E6%9E%B6%E6%9E%84%E7%9A%84%E7%89%B9%E7%82%B9"><span class="nav-number">1.3.</span> <span class="nav-text">Dubbo 架构的特点</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%BF%9E%E9%80%9A%E6%80%A7"><span class="nav-number">1.3.1.</span> <span class="nav-text">连通性</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%81%A5%E5%A3%AE%E6%80%A7"><span class="nav-number">1.3.2.</span> <span class="nav-text">健壮性</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BC%B8%E7%BC%A9%E6%80%A7"><span class="nav-number">1.3.3.</span> <span class="nav-text">伸缩性</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%8D%87%E7%BA%A7%E6%80%A7"><span class="nav-number">1.3.4.</span> <span class="nav-text">升级性</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Dubbo-%E8%A7%A3%E5%86%B3%E7%9A%84%E5%8A%9F%E8%83%BD%E9%9C%80%E6%B1%82"><span class="nav-number">2.</span> <span class="nav-text">Dubbo 解决的功能需求</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Dubbo-%E5%85%A5%E9%97%A8%E6%9E%84%E5%BB%BA"><span class="nav-number">3.</span> <span class="nav-text">Dubbo 入门构建</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%9E%84%E5%BB%BA%E6%8E%A5%E5%8F%A3%E4%B8%AD%E5%BF%83-Dubbo-common"><span class="nav-number">3.1.</span> <span class="nav-text">构建接口中心 Dubbo-common</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%88%9B%E5%BB%BA%E4%B8%80%E4%B8%AA%E5%AE%9E%E4%BD%93%E7%B1%BB"><span class="nav-number">3.1.1.</span> <span class="nav-text">创建一个实体类</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%88%9B%E5%BB%BA%E8%B0%83%E7%94%A8%E6%9C%8D%E5%8A%A1%E7%BB%9F%E4%B8%80%E6%8E%A5%E5%8F%A3"><span class="nav-number">3.1.2.</span> <span class="nav-text">创建调用服务统一接口</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%BF%99%E4%B8%AA%E7%B1%BB%E7%9A%84-pom-xml-%E5%A6%82%E4%B8%8B"><span class="nav-number">3.1.3.</span> <span class="nav-text">这个类的 pom.xml  如下</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%9E%84%E5%BB%BA%E6%9C%8D%E5%8A%A1%E6%8F%90%E4%BE%9B%E4%B8%AD%E5%BF%83-Dubbo-provider"><span class="nav-number">3.2.</span> <span class="nav-text">构建服务提供中心 Dubbo-provider</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#pom-xml-%E6%96%87%E4%BB%B6%E5%A6%82%E4%B8%8B"><span class="nav-number">3.2.1.</span> <span class="nav-text">pom.xml 文件如下</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%88%9B%E5%BB%BA%E6%8E%A5%E5%8F%A3%E5%AE%9E%E7%8E%B0%E7%B1%BB%E5%A6%82%E4%B8%8B"><span class="nav-number">3.2.2.</span> <span class="nav-text">创建接口实现类如下</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%94%A8-Spring-%E9%85%8D%E7%BD%AE%E5%A3%B0%E6%98%8E%E6%9A%B4%E9%9C%B2%E6%9C%8D%E5%8A%A1"><span class="nav-number">3.2.3.</span> <span class="nav-text">用 Spring 配置声明暴露服务</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%8A%A0%E8%BD%BD-Spring-%E9%85%8D%E7%BD%AE%EF%BC%8C%E5%90%AF%E5%8A%A8%E6%9C%8D%E5%8A%A1%E6%8F%90%E4%BE%9B%E4%B8%AD%E5%BF%83"><span class="nav-number">3.2.4.</span> <span class="nav-text">加载 Spring 配置，启动服务提供中心</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%9E%84%E5%BB%BA%E6%9C%8D%E5%8A%A1%E6%B6%88%E8%B4%B9%E8%80%85-Dubbo-consumer"><span class="nav-number">3.3.</span> <span class="nav-text">构建服务消费者 Dubbo-consumer</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#pom-xml-%E4%BE%9D%E8%B5%96%E5%A6%82%E4%B8%8B"><span class="nav-number">3.3.1.</span> <span class="nav-text">pom.xml 依赖如下</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%80%9A%E8%BF%87-Spring-%E9%85%8D%E7%BD%AE%E5%BC%95%E7%94%A8%E8%BF%9C%E7%A8%8B%E6%9C%8D%E5%8A%A1"><span class="nav-number">3.3.2.</span> <span class="nav-text">通过 Spring 配置引用远程服务</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%8A%A0%E8%BD%BDSpring%E9%85%8D%E7%BD%AE%EF%BC%8C%E5%B9%B6%E8%B0%83%E7%94%A8%E8%BF%9C%E7%A8%8B%E6%9C%8D%E5%8A%A1"><span class="nav-number">3.3.3.</span> <span class="nav-text">加载Spring配置，并调用远程服务</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8SpringBoot-%E6%95%B4%E5%90%88-Dubbo"><span class="nav-number">4.</span> <span class="nav-text">使用SpringBoot 整合 Dubbo</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8%E6%B3%A8%E8%A7%A3%E7%9A%84%E6%96%B9%E5%BC%8F"><span class="nav-number">4.1.</span> <span class="nav-text">使用注解的方式</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%88%9B%E5%BB%BA%E7%BB%9F%E4%B8%80%E6%8E%A5%E5%8F%A3%E4%B8%AD%E5%BF%83"><span class="nav-number">4.1.1.</span> <span class="nav-text">创建统一接口中心</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%88%9B%E5%BB%BA%E5%AE%9E%E4%BD%93%E7%B1%BB"><span class="nav-number">4.1.1.1.</span> <span class="nav-text">创建实体类</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%88%9B%E5%BB%BA%E4%B8%A4%E4%B8%AA%E6%9C%8D%E5%8A%A1%E6%8E%A5%E5%8F%A3"><span class="nav-number">4.1.1.2.</span> <span class="nav-text">创建两个服务接口</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%88%9B%E5%BB%BA%E6%9C%8D%E5%8A%A1%E6%8F%90%E4%BE%9B%E8%80%85"><span class="nav-number">4.1.2.</span> <span class="nav-text">创建服务提供者</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%9C%8D%E5%8A%A1%E6%8E%A5%E5%8F%A3%E5%AE%9E%E7%8E%B0"><span class="nav-number">4.1.2.1.</span> <span class="nav-text">服务接口实现</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%9C%8D%E5%8A%A1%E6%8F%90%E4%BE%9B%E8%80%85%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6"><span class="nav-number">4.1.2.2.</span> <span class="nav-text">服务提供者配置文件</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%88%9B%E5%BB%BA%E5%90%AF%E5%8A%A8%E7%B1%BB"><span class="nav-number">4.1.2.3.</span> <span class="nav-text">创建启动类</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%88%9B%E5%BB%BA%E6%9C%8D%E5%8A%A1%E6%B6%88%E8%B4%B9%E6%96%B9"><span class="nav-number">4.1.3.</span> <span class="nav-text">创建服务消费方</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%AE%9E%E7%8E%B0%E8%AE%A2%E5%8D%95%E6%9C%8D%E5%8A%A1%E6%8E%A5%E5%8F%A3"><span class="nav-number">4.1.3.1.</span> <span class="nav-text">实现订单服务接口</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%88%9B%E5%BB%BA%E6%8E%A7%E5%88%B6%E5%99%A8"><span class="nav-number">4.1.3.2.</span> <span class="nav-text">创建控制器</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6"><span class="nav-number">4.1.3.3.</span> <span class="nav-text">配置文件</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%88%9B%E5%BB%BA%E5%90%AF%E5%8A%A8%E7%B1%BB-1"><span class="nav-number">4.1.3.4.</span> <span class="nav-text">创建启动类</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8-XML-%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E7%9A%84%E6%96%B9%E5%BC%8F"><span class="nav-number">4.2.</span> <span class="nav-text">使用 XML 配置文件的方式</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8%E6%B3%A8%E8%A7%A3-API-%E7%9A%84%E6%96%B9%E5%BC%8F"><span class="nav-number">4.3.</span> <span class="nav-text">使用注解 API 的方式</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Dubbo-%E9%85%8D%E7%BD%AE"><span class="nav-number">5.</span> <span class="nav-text">Dubbo 配置</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%9B%B8%E5%85%B3%E5%B8%B8%E7%94%A8%E9%85%8D%E7%BD%AE%E6%A0%87%E7%AD%BE"><span class="nav-number">5.1.</span> <span class="nav-text">相关常用配置标签</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%B8%8D%E5%90%8C%E7%B2%92%E5%BA%A6%E9%85%8D%E7%BD%AE%E7%9A%84%E8%A6%86%E7%9B%96%E5%85%B3%E7%B3%BB"><span class="nav-number">5.2.</span> <span class="nav-text">不同粒度配置的覆盖关系</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%85%8D%E7%BD%AE%E7%9B%B8%E5%85%B3%E6%9C%BA%E5%88%B6"><span class="nav-number">5.3.</span> <span class="nav-text">配置相关机制</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%90%AF%E5%8A%A8%E6%97%B6%E6%A3%80%E6%9F%A5"><span class="nav-number">5.3.1.</span> <span class="nav-text">启动时检查</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%80%9A%E8%BF%87-spring-%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E5%85%B3%E9%97%AD"><span class="nav-number">5.3.1.1.</span> <span class="nav-text">通过 spring 配置文件关闭</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%85%8D%E7%BD%AE%E7%9A%84%E5%90%AB%E4%B9%89"><span class="nav-number">5.3.1.2.</span> <span class="nav-text">配置的含义</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%85%8D%E7%BD%AE%E7%9A%84%E7%9B%B8%E5%85%B3%E5%8F%82%E6%95%B0"><span class="nav-number">5.4.</span> <span class="nav-text">配置的相关参数</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#timeout-%E8%B6%85%E6%97%B6%E6%97%B6%E9%97%B4"><span class="nav-number">5.4.1.</span> <span class="nav-text">timeout 超时时间</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#retries-%E9%87%8D%E8%AF%95%E6%AC%A1%E6%95%B0"><span class="nav-number">5.4.2.</span> <span class="nav-text">retries 重试次数</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#version-%E5%A4%9A%E7%89%88%E6%9C%AC"><span class="nav-number">5.4.3.</span> <span class="nav-text">version 多版本</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#stub-%E6%9C%AC%E5%9C%B0%E5%AD%98%E6%A0%B9"><span class="nav-number">5.4.4.</span> <span class="nav-text">stub 本地存根</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Dubbo-%E9%AB%98%E5%8F%AF%E7%94%A8%E9%85%8D%E7%BD%AE"><span class="nav-number">6.</span> <span class="nav-text">Dubbo 高可用配置</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Zookeeper-%E5%AE%95%E6%9C%BA%E4%B8%8E-Dubbo-%E7%9B%B4%E8%BF%9E"><span class="nav-number">6.1.</span> <span class="nav-text">Zookeeper 宕机与 Dubbo 直连</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1"><span class="nav-number">6.2.</span> <span class="nav-text">负载均衡</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1%E7%AD%96%E7%95%A5"><span class="nav-number">6.2.1.</span> <span class="nav-text">负载均衡策略</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Random-LoadBalance"><span class="nav-number">6.2.1.1.</span> <span class="nav-text">Random LoadBalance</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#RoundRobin-LoadBalance"><span class="nav-number">6.2.1.2.</span> <span class="nav-text">RoundRobin LoadBalance</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#LeastActive-LoadBalance"><span class="nav-number">6.2.1.3.</span> <span class="nav-text">LeastActive LoadBalance</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#ConsistentHash-LoadBalance"><span class="nav-number">6.2.1.4.</span> <span class="nav-text">ConsistentHash LoadBalance</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1%E9%85%8D%E7%BD%AE%E6%96%B9%E5%BC%8F"><span class="nav-number">6.2.2.</span> <span class="nav-text">负载均衡配置方式</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%9C%8D%E5%8A%A1%E7%AB%AF%E6%9C%8D%E5%8A%A1%E7%BA%A7%E5%88%AB"><span class="nav-number">6.2.2.1.</span> <span class="nav-text">服务端服务级别</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%AE%A2%E6%88%B7%E7%AB%AF%E6%9C%8D%E5%8A%A1%E7%BA%A7%E5%88%AB"><span class="nav-number">6.2.2.2.</span> <span class="nav-text">客户端服务级别</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%9C%8D%E5%8A%A1%E7%AB%AF%E6%96%B9%E6%B3%95%E7%BA%A7%E5%88%AB"><span class="nav-number">6.2.2.3.</span> <span class="nav-text">服务端方法级别</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%AE%A2%E6%88%B7%E7%AB%AF%E6%96%B9%E6%B3%95%E7%BA%A7%E5%88%AB"><span class="nav-number">6.2.2.4.</span> <span class="nav-text">客户端方法级别</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%9C%8D%E5%8A%A1%E9%99%8D%E7%BA%A7"><span class="nav-number">6.3.</span> <span class="nav-text">服务降级</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%9C%8D%E5%8A%A1%E5%AE%B9%E9%94%99"><span class="nav-number">6.4.</span> <span class="nav-text">服务容错</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Failover-Cluster"><span class="nav-number">6.4.1.</span> <span class="nav-text">Failover Cluster</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Failfast-Cluster"><span class="nav-number">6.4.2.</span> <span class="nav-text">Failfast Cluster</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Failsafe-Cluster"><span class="nav-number">6.4.3.</span> <span class="nav-text">Failsafe Cluster</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Failback-Cluster"><span class="nav-number">6.4.4.</span> <span class="nav-text">Failback Cluster</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Forking-Cluster"><span class="nav-number">6.4.5.</span> <span class="nav-text">Forking Cluster</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Broadcast-Cluster"><span class="nav-number">6.4.6.</span> <span class="nav-text">Broadcast Cluster</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%9B%86%E7%BE%A4%E6%A8%A1%E5%BC%8F%E9%85%8D%E7%BD%AE"><span class="nav-number">6.4.7.</span> <span class="nav-text">集群模式配置</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%9C%8D%E5%8A%A1%E5%AE%B9%E9%94%99%E5%BA%94%E7%94%A8%EF%BC%88%E6%95%B4%E5%90%88-Hystrix%EF%BC%89"><span class="nav-number">6.4.8.</span> <span class="nav-text">服务容错应用（整合 Hystrix）</span></a></li></ol></li></ol></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author site-overview-item animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">Silverming</p>
  <div class="site-description" itemprop="description">Wechat:934933088</div>
</div>
<div class="site-state-wrap site-overview-item animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">142</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">51</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>



        </div>
      </div>
    </div>
  </aside>
  <div class="sidebar-dimmer"></div>


    </header>

    
  <div class="back-to-top" role="button" aria-label="返回顶部">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/04/08/Dubbo%E5%85%A5%E9%97%A8/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Silverming">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Silverming">
      <meta itemprop="description" content="Wechat:934933088">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="Dubbo入门 | Silverming">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          Dubbo入门
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2020-04-08 17:28:20" itemprop="dateCreated datePublished" datetime="2020-04-08T17:28:20+08:00">2020-04-08</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2020-12-01 18:36:29" itemprop="dateModified" datetime="2020-12-01T18:36:29+08:00">2020-12-01</time>
    </span>

  
    <span class="post-meta-item" title="阅读次数" id="busuanzi_container_page_pv">
      <span class="post-meta-item-icon">
        <i class="far fa-eye"></i>
      </span>
      <span class="post-meta-item-text">阅读次数：</span>
      <span id="busuanzi_value_page_pv"></span>
    </span>
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>24k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>22 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
        <h1 id="Dubbo架构"><a href="#Dubbo架构" class="headerlink" title="Dubbo架构"></a>Dubbo架构</h1><p>Apache Dubbo 是一款高性能、轻量级的开源 Java RPC 框架，它提供了三大核心能力：面向接口的远程方法调用，智能容错和负载均衡，以及服务自动注册和发现。</p>
<p><img src="http://qiniu.xiaoming.net.cn/Dubbo%E6%9E%B6%E6%9E%84" alt="Dubbo架构"></p>
<blockquote>
<p><code>async</code>表示异步，<code>sync</code>表示同步</p>
</blockquote>
<span id="more"></span>

<h2 id="节点角色说明"><a href="#节点角色说明" class="headerlink" title="节点角色说明"></a>节点角色说明</h2><table>
<thead>
<tr>
<th>节点</th>
<th>角色说明</th>
</tr>
</thead>
<tbody><tr>
<td>Provider</td>
<td>暴露服务的服务提供方</td>
</tr>
<tr>
<td>Consumer</td>
<td>调用远程服务的服务消费方</td>
</tr>
<tr>
<td>Registry</td>
<td>服务注册与发现的注册中心</td>
</tr>
<tr>
<td>Monitor</td>
<td>统计服务的调用次数和调用时间的监控中心</td>
</tr>
<tr>
<td>Container</td>
<td>服务运行容器</td>
</tr>
</tbody></table>
<h2 id="调用关系说明"><a href="#调用关系说明" class="headerlink" title="调用关系说明"></a>调用关系说明</h2><ol start="0">
<li>服务容器负责启动，加载，运行服务提供者。</li>
<li>服务提供者在启动时，向注册中心注册自己提供的服务。</li>
<li>服务消费者在启动时，向注册中心订阅自己所需的服务。</li>
<li>注册中心返回服务提供者地址列表给消费者，如果有变更，注册中心将基于长连接推送变更数据给消费者。</li>
<li>服务消费者，从提供者地址列表中，基于软负载均衡算法，选一台提供者进行调用，如果调用失败，再选另一台调用。</li>
<li>服务消费者和提供者，在内存中累计调用次数和调用时间，定时每分钟发送一次统计数据到监控中心。</li>
</ol>
<h2 id="Dubbo-架构的特点"><a href="#Dubbo-架构的特点" class="headerlink" title="Dubbo 架构的特点"></a>Dubbo 架构的特点</h2><p>Dubbo 架构具有以下几个特点，分别是连通性、健壮性、伸缩性、以及向未来架构的升级性。</p>
<h3 id="连通性"><a href="#连通性" class="headerlink" title="连通性"></a>连通性</h3><p>注册中心负责服务地址的注册与查找，相当于目录服务，服务提供者和消费者只在启动时与注册中心交互，注册中心不转发请求，压力较小</p>
<p>监控中心负责统计各服务调用次数，调用时间等，统计先在内存汇总后每分钟一次发送到监控中心服务器，并以报表展示</p>
<p>服务提供者向注册中心注册其提供的服务，并汇报调用时间到监控中心，此时间不包含网络开销</p>
<p>服务消费者向注册中心获取服务提供者地址列表，并根据负载算法直接调用提供者，同时汇报调用时间到监控中心，此时间包含网络开销</p>
<p>注册中心，服务提供者，服务消费者三者之间均为长连接，监控中心除外</p>
<p>注册中心通过长连接感知服务提供者的存在，服务提供者宕机，注册中心将立即推送事件通知消费者</p>
<p>注册中心和监控中心全部宕机，不影响已运行的提供者和消费者，消费者在本地缓存了提供者列表</p>
<p>注册中心和监控中心都是可选的，服务消费者可以直连服务提供者</p>
<h3 id="健壮性"><a href="#健壮性" class="headerlink" title="健壮性"></a>健壮性</h3><p>监控中心宕掉不影响使用，只是丢失部分采样数据</p>
<p>数据库宕掉后，注册中心仍能通过缓存提供服务列表查询，但不能注册新服务</p>
<p>注册中心对等集群，任意一台宕掉后，将自动切换到另一台</p>
<p>注册中心全部宕掉后，服务提供者和服务消费者仍能通过本地缓存通讯</p>
<p>服务提供者无状态，任意一台宕掉后，不影响使用</p>
<p>服务提供者全部宕掉后，服务消费者应用将无法使用，并无限次重连等待服务提供者恢复</p>
<h3 id="伸缩性"><a href="#伸缩性" class="headerlink" title="伸缩性"></a>伸缩性</h3><p>注册中心为对等集群，可动态增加机器部署实例，所有客户端将自动发现新的注册中心</p>
<p>服务提供者无状态，可动态增加机器部署实例，注册中心将推送新的服务提供者信息给消费者</p>
<h3 id="升级性"><a href="#升级性" class="headerlink" title="升级性"></a>升级性</h3><p>官方文档上有对未来扩展的设想和架构图。</p>
<h1 id="Dubbo-解决的功能需求"><a href="#Dubbo-解决的功能需求" class="headerlink" title="Dubbo 解决的功能需求"></a>Dubbo 解决的功能需求</h1><p><strong>当服务越来越多时，服务 URL 配置管理变得非常困难，F5 硬件负载均衡器的单点压力也越来越大</strong>。 此时需要一个服务注册中心，动态地注册和发现服务，使服务的位置透明。并通过在消费方获取服务提供方地址列表，实现软负载均衡和 Failover，降低对 F5 硬件负载均衡器的依赖，也能减少部分成本。</p>
<p><strong>当进一步发展，服务间依赖关系变得错踪复杂，甚至分不清哪个应用要在哪个应用之前启动，架构师都不能完整的描述应用的架构关系</strong>。 这时，需要自动画出应用间的依赖关系图，以帮助架构师理清关系。</p>
<p><strong>接着，服务的调用量越来越大，服务的容量问题就暴露出来，这个服务需要多少机器支撑？什么时候该加机器？</strong> 为了解决这些问题，第一步，要将服务现在每天的调用量，响应时间，都统计出来，作为容量规划的参考指标。其次，要可以动态调整权重，在线上，将某台机器的权重一直加大，并在加大的过程中记录响应时间的变化，直到响应时间到达阈值，记录此时的访问量，再以此访问量乘以机器数反推总容量。</p>
<h1 id="Dubbo-入门构建"><a href="#Dubbo-入门构建" class="headerlink" title="Dubbo 入门构建"></a>Dubbo 入门构建</h1><h2 id="构建接口中心-Dubbo-common"><a href="#构建接口中心-Dubbo-common" class="headerlink" title="构建接口中心 Dubbo-common"></a>构建接口中心 Dubbo-common</h2><p>根据 Dubbo 服务化最佳实践：</p>
<blockquote>
<p>建议将服务接口、服务模型、服务异常等均放在 API 包中，因为服务模型和异常也是 API 的一部分，这样做也符合分包原则：重用发布等价原则(REP)，共同重用原则(CRP)。</p>
<p>如果需要，也可以考虑在 API 包中放置一份 Spring 的引用配置，这样使用方只需在 Spring 加载过程中引用此配置即可。配置建议放在模块的包目录下，以免冲突，如：<code>com/alibaba/china/xxx/dubbo-reference.xml</code>。</p>
</blockquote>
<h3 id="创建一个实体类"><a href="#创建一个实体类" class="headerlink" title="创建一个实体类"></a>创建一个实体类</h3><pre><code class="java">import java.io.Serializable;

/**
 * 因为需要在网络中传输，需要支持序列化，实现 Serializable 接口
 */
public class Employee implements Serializable &#123;

    private static final long serialVersionUID = -8290432070775741887L;
    /**
     * 雇员ID
     */
    private Integer empId;
    /**
     * 雇员名称
     */
    private String empName;
    /**
     * 雇员工资
     */
    private Double salary;

    //省略构造方法和 getter 和 setter 方法
&#125;
</code></pre>
<h3 id="创建调用服务统一接口"><a href="#创建调用服务统一接口" class="headerlink" title="创建调用服务统一接口"></a>创建调用服务统一接口</h3><pre><code class="java">import com.xm.dubbo.entity.Employee;

import java.util.List;

public interface EmployeeRemoteService &#123;

    List&lt;Employee&gt; getEmployeeByConditionRemote(Employee employee);
&#125;
</code></pre>
<h3 id="这个类的-pom-xml-如下"><a href="#这个类的-pom-xml-如下" class="headerlink" title="这个类的 pom.xml  如下"></a>这个类的 <code>pom.xml </code> 如下</h3><p>主要用于在服务提供中心和消费方引入：</p>
<pre><code class="xml">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;project xmlns=&quot;http://maven.apache.org/POM/4.0.0&quot;
         xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;
         xsi:schemaLocation=&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;&gt;
    &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;

    &lt;groupId&gt;com.xm.dubbo&lt;/groupId&gt;
    &lt;artifactId&gt;dubbo-common&lt;/artifactId&gt;
    &lt;version&gt;1.0-SNAPSHOT&lt;/version&gt;


&lt;/project&gt;
</code></pre>
<h2 id="构建服务提供中心-Dubbo-provider"><a href="#构建服务提供中心-Dubbo-provider" class="headerlink" title="构建服务提供中心 Dubbo-provider"></a>构建服务提供中心 Dubbo-provider</h2><h3 id="pom-xml-文件如下"><a href="#pom-xml-文件如下" class="headerlink" title="pom.xml 文件如下"></a><code>pom.xml</code> 文件如下</h3><pre><code class="xml">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;project xmlns=&quot;http://maven.apache.org/POM/4.0.0&quot;
         xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;
         xsi:schemaLocation=&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;&gt;
    &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;

    &lt;groupId&gt;com.xm.dubbo&lt;/groupId&gt;
    &lt;artifactId&gt;dubbo-provider&lt;/artifactId&gt;
    &lt;version&gt;1.0-SNAPSHOT&lt;/version&gt;

    &lt;dependencies&gt;
        &lt;!-- https://mvnrepository.com/artifact/com.alibaba/dubbo --&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;com.alibaba&lt;/groupId&gt;
            &lt;artifactId&gt;dubbo&lt;/artifactId&gt;
            &lt;version&gt;2.6.8&lt;/version&gt;
        &lt;/dependency&gt;

        &lt;dependency&gt;
            &lt;groupId&gt;org.apache.curator&lt;/groupId&gt;
            &lt;artifactId&gt;curator-framework&lt;/artifactId&gt;
            &lt;version&gt;4.3.0&lt;/version&gt;
        &lt;/dependency&gt;

        &lt;dependency&gt;
            &lt;groupId&gt;com.xm.dubbo&lt;/groupId&gt;
            &lt;artifactId&gt;dubbo-common&lt;/artifactId&gt;
            &lt;version&gt;1.0-SNAPSHOT&lt;/version&gt;
        &lt;/dependency&gt;
    &lt;/dependencies&gt;
&lt;/project&gt;
</code></pre>
<h3 id="创建接口实现类如下"><a href="#创建接口实现类如下" class="headerlink" title="创建接口实现类如下"></a>创建接口实现类如下</h3><pre><code class="java">//这里需要导入接口和实体类
import com.xm.dubbo.api.EmployeeRemoteService;
import com.xm.dubbo.entity.Employee;

import java.util.ArrayList;
import java.util.List;

public class EmployeeServiceImpl implements EmployeeRemoteService &#123;
    @Override
    public List&lt;Employee&gt; getEmployeeByConditionRemote(Employee employee) &#123;
        System.out.println(employee);

        List&lt;Employee&gt; empList = new ArrayList&lt;&gt;();

        empList.add(new Employee(111, &quot;empName111&quot;, 111.11));
        empList.add(new Employee(222, &quot;empName222&quot;, 222.22));
        empList.add(new Employee(333, &quot;empName333&quot;, 333.33));

        return empList;
    &#125;
&#125;
</code></pre>
<h3 id="用-Spring-配置声明暴露服务"><a href="#用-Spring-配置声明暴露服务" class="headerlink" title="用 Spring 配置声明暴露服务"></a>用 Spring 配置声明暴露服务</h3><pre><code class="xml">&lt;beans xmlns=&quot;http://www.springframework.org/schema/beans&quot;
       xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;
       xmlns:dubbo=&quot;http://dubbo.apache.org/schema/dubbo&quot;
       xsi:schemaLocation=&quot;http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-4.3.xsd
            http://dubbo.apache.org/schema/dubbo http://dubbo.apache.org/schema/dubbo/dubbo.xsd&quot;&gt;

    &lt;!--1. 配置 Dubbo 提供方应用名称--&gt;
    &lt;dubbo:application name=&quot;xm-dubbo-provider&quot;/&gt;
    &lt;!--2. 指定注册中心位置 --&gt;
    &lt;dubbo:registry protocol=&quot;zookeeper&quot; address=&quot;127.0.0.1:2181,127.0.0.1:2182,127.0.0.1:2183&quot;/&gt;
    &lt;!--3. 用dubbo协议在20880端口暴露服务--&gt;
    &lt;dubbo:protocol name=&quot;dubbo&quot; port=&quot;20880&quot;/&gt;
    &lt;!--4. 声明需要暴露的服务接口 --&gt;
    &lt;dubbo:service interface=&quot;com.xm.dubbo.api.EmployeeRemoteService&quot; ref=&quot;employeeServiceImpl&quot;/&gt;
    &lt;!--5. 将实现类关联到接口 --&gt;
    &lt;bean id=&quot;employeeServiceImpl&quot; class=&quot;com.xm.dubbo.service.impl.EmployeeServiceImpl&quot;/&gt;
&lt;/beans&gt;
</code></pre>
<h3 id="加载-Spring-配置，启动服务提供中心"><a href="#加载-Spring-配置，启动服务提供中心" class="headerlink" title="加载 Spring 配置，启动服务提供中心"></a>加载 Spring 配置，启动服务提供中心</h3><blockquote>
<p>需要注意应该提前启动 Zookeeper，这里 Zookeeper 已集群启动</p>
</blockquote>
<pre><code class="java">import org.springframework.context.support.ClassPathXmlApplicationContext;

import java.io.IOException;

public class Provider &#123;
    public static void main(String[] args) throws IOException &#123;
        ClassPathXmlApplicationContext context = new ClassPathXmlApplicationContext(&quot;provider.xml&quot;);
        context.start();
        System.in.read();
    &#125;
&#125;
</code></pre>
<p>启动之后可以发现 Zookpper 中多了一个 <code>dubbo</code> 节点。</p>
<h2 id="构建服务消费者-Dubbo-consumer"><a href="#构建服务消费者-Dubbo-consumer" class="headerlink" title="构建服务消费者 Dubbo-consumer"></a>构建服务消费者 Dubbo-consumer</h2><h3 id="pom-xml-依赖如下"><a href="#pom-xml-依赖如下" class="headerlink" title="pom.xml 依赖如下"></a><code>pom.xml</code> 依赖如下</h3><pre><code class="xml">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;project xmlns=&quot;http://maven.apache.org/POM/4.0.0&quot;
         xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;
         xsi:schemaLocation=&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;&gt;
    &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;

    &lt;groupId&gt;com.xm&lt;/groupId&gt;
    &lt;artifactId&gt;dubbo-consumer&lt;/artifactId&gt;
    &lt;version&gt;1.0-SNAPSHOT&lt;/version&gt;

    &lt;dependencies&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;com.xm.dubbo&lt;/groupId&gt;
            &lt;artifactId&gt;dubbo-common&lt;/artifactId&gt;
            &lt;version&gt;1.0-SNAPSHOT&lt;/version&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;com.alibaba&lt;/groupId&gt;
            &lt;artifactId&gt;dubbo&lt;/artifactId&gt;
            &lt;version&gt;2.6.8&lt;/version&gt;
        &lt;/dependency&gt;

        &lt;dependency&gt;
            &lt;groupId&gt;org.apache.curator&lt;/groupId&gt;
            &lt;artifactId&gt;curator-framework&lt;/artifactId&gt;
            &lt;version&gt;4.3.0&lt;/version&gt;
        &lt;/dependency&gt;

&lt;/dependencies&gt;

&lt;/project&gt;
</code></pre>
<h3 id="通过-Spring-配置引用远程服务"><a href="#通过-Spring-配置引用远程服务" class="headerlink" title="通过 Spring 配置引用远程服务"></a>通过 Spring 配置引用远程服务</h3><pre><code class="xml">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;beans xmlns=&quot;http://www.springframework.org/schema/beans&quot;
       xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;
       xmlns:dubbo=&quot;http://dubbo.apache.org/schema/dubbo&quot;
       xsi:schemaLocation=&quot;http://www.springframework.org/schema/beans        http://www.springframework.org/schema/beans/spring-beans-4.3.xsd        http://dubbo.apache.org/schema/dubbo        http://dubbo.apache.org/schema/dubbo/dubbo.xsd&quot;&gt;

    &lt;!--Dubbo配置：消费方应用名 --&gt;
    &lt;dubbo:application name=&quot;xm-dubbo-consumer&quot;  /&gt;

    &lt;!--Dubbo配置：指定Dubbo注册中心  --&gt;
    &lt;dubbo:registry protocol=&quot;zookeeper&quot; address=&quot;127.0.0.1:2181,127.0.0.1:2182,127.0.0.1:2183&quot; /&gt;

    &lt;!--Dubbo配置：引用接口代表的服务,生成远程服务代理 --&gt;
    &lt;dubbo:reference id=&quot;employeeRemoteService&quot; interface=&quot;com.xm.dubbo.api.EmployeeRemoteService&quot; /&gt;
&lt;/beans&gt;
</code></pre>
<h3 id="加载Spring配置，并调用远程服务"><a href="#加载Spring配置，并调用远程服务" class="headerlink" title="加载Spring配置，并调用远程服务"></a>加载Spring配置，并调用远程服务</h3><pre><code class="java">import com.xm.dubbo.api.EmployeeRemoteService;
import com.xm.dubbo.entity.Employee;
import org.springframework.context.support.ClassPathXmlApplicationContext;

import java.util.List;

public class Consumer &#123;
    public static void main(String[] args) &#123;
        ClassPathXmlApplicationContext context = new ClassPathXmlApplicationContext(&quot;consumer.xml&quot;);
        context.start();
          //获取远程代理服务
        EmployeeRemoteService service = (EmployeeRemoteService) context.getBean(&quot;employeeRemoteService&quot;);
          //执行远程调用
        List&lt;Employee&gt; results = service.getEmployeeByConditionRemote(new Employee(1, &quot;silverming&quot;, 10000.0));
        for ( Employee employ:results) &#123;
            System.out.println(employ);
        &#125;
    &#125;
&#125;
</code></pre>
<p>运行之后可以看到调用实现类的方法执行。</p>
<h1 id="使用SpringBoot-整合-Dubbo"><a href="#使用SpringBoot-整合-Dubbo" class="headerlink" title="使用SpringBoot 整合 Dubbo"></a>使用SpringBoot 整合 Dubbo</h1><h2 id="使用注解的方式"><a href="#使用注解的方式" class="headerlink" title="使用注解的方式"></a>使用注解的方式</h2><ol>
<li>导入 dubbo-starter</li>
<li>在 application 配置文件中配置属性</li>
<li>使用 <code>@EnableDubbo</code> 开启 Dubbo 注解功能，使用 <code>@Service</code> 暴露服务，使用 <code>@Reference</code> 调用服务</li>
</ol>
<h3 id="创建统一接口中心"><a href="#创建统一接口中心" class="headerlink" title="创建统一接口中心"></a>创建统一接口中心</h3><h4 id="创建实体类"><a href="#创建实体类" class="headerlink" title="创建实体类"></a>创建实体类</h4><pre><code class="java">public class UserAddress implements Serializable &#123;
    private Integer id;
    private String userAddress; // 用户地址
    private String userId; // 用户id
    private String consignee; // 收货人
    private String phoneNum; // 电话号码
    private String isDefault; // 是否为默认地址 yes / no
  
      //省略构造方法和getter、setter方法
&#125;
</code></pre>
<h4 id="创建两个服务接口"><a href="#创建两个服务接口" class="headerlink" title="创建两个服务接口"></a>创建两个服务接口</h4><p><code>OrderService</code>:</p>
<pre><code class="java">public interface OrderService &#123;
    /**
     *  初始化订单
     **/
    List&lt;UserAddress&gt; initOrder(String userId);
&#125;
</code></pre>
<p><code>UserService</code>:</p>
<pre><code class="java">public interface UserService &#123;

      /**
       * 获取用户信息列表
       **/
    List&lt;UserAddress&gt; getUserAddressList(String userId);
&#125;
</code></pre>
<p><code>pom.xml</code> 依赖如下：</p>
<pre><code class="xml">                &lt;dependency&gt;
            &lt;groupId&gt;org.projectlombok&lt;/groupId&gt;
            &lt;artifactId&gt;lombok&lt;/artifactId&gt;
            &lt;version&gt;1.18.8&lt;/version&gt;
        &lt;/dependency&gt;

        &lt;dependency&gt;
            &lt;groupId&gt;org.apache.curator&lt;/groupId&gt;
            &lt;artifactId&gt;curator-framework&lt;/artifactId&gt;
            &lt;version&gt;2.8.0&lt;/version&gt;
        &lt;/dependency&gt;

        &lt;dependency&gt;
            &lt;groupId&gt;com.alibaba&lt;/groupId&gt;
            &lt;artifactId&gt;dubbo&lt;/artifactId&gt;
            &lt;version&gt;2.6.2&lt;/version&gt;
        &lt;/dependency&gt;
</code></pre>
<h3 id="创建服务提供者"><a href="#创建服务提供者" class="headerlink" title="创建服务提供者"></a>创建服务提供者</h3><p><code>pom.xml</code> 如下：</p>
<pre><code class="xml">         &lt;parent&gt;
        &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
        &lt;artifactId&gt;spring-boot-starter-parent&lt;/artifactId&gt;
        &lt;version&gt;2.1.6.RELEASE&lt;/version&gt;
        &lt;relativePath/&gt; &lt;!-- lookup parent from repository --&gt;
    &lt;/parent&gt;

    &lt;groupId&gt;com.silverming.dubbo&lt;/groupId&gt;
    &lt;artifactId&gt;dubbo-boot-user-service-provider&lt;/artifactId&gt;
    &lt;version&gt;1.0-SNAPSHOT&lt;/version&gt;

    &lt;dependencies&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
            &lt;artifactId&gt;spring-boot-starter&lt;/artifactId&gt;
        &lt;/dependency&gt;

        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
            &lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt;
            &lt;scope&gt;test&lt;/scope&gt;
        &lt;/dependency&gt;

        &lt;dependency&gt;
            &lt;groupId&gt;com.silverming.dubbo&lt;/groupId&gt;
            &lt;artifactId&gt;dubbo-interface&lt;/artifactId&gt;
            &lt;version&gt;1.0-SNAPSHOT&lt;/version&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;com.alibaba.boot&lt;/groupId&gt;
            &lt;artifactId&gt;dubbo-spring-boot-starter&lt;/artifactId&gt;
            &lt;version&gt;0.2.0&lt;/version&gt;
        &lt;/dependency&gt;
    &lt;/dependencies&gt;
</code></pre>
<h4 id="服务接口实现"><a href="#服务接口实现" class="headerlink" title="服务接口实现"></a>服务接口实现</h4><pre><code class="java">//注意导入的是 zookeeper 的 service
import com.alibaba.dubbo.config.annotation.Service;

@Component
@Service
public class UserServiceImpl implements UserService &#123;
    @Override
    public List&lt;UserAddress&gt; getUserAddressList(String userId) &#123;

        UserAddress address1 = new UserAddress(1, &quot;河北省衡水市&quot;, &quot;1&quot;, &quot;carson&quot;,&quot;12345678911&quot;,&quot;Y&quot;);
        UserAddress address2 = new UserAddress(1, &quot;山东省德州市&quot;, &quot;2&quot;, &quot;eason&quot;, &quot;4562144&quot;, &quot;Y&quot;);

        return Arrays.asList(address1,address2);
    &#125;
&#125;
</code></pre>
<blockquote>
<p><strong>服务提供方使用 <code>@Service</code> 注解暴露服务</strong></p>
</blockquote>
<h4 id="服务提供者配置文件"><a href="#服务提供者配置文件" class="headerlink" title="服务提供者配置文件"></a>服务提供者配置文件</h4><pre><code class="yaml">dubbo:
  application:
    name: boot-order-service-provider
  registry:
    protocol: zookeeper
    address: 127.0.0.1:2181,127.0.0.1:2182,127.0.0.1:2183
server:
  port: 8080
</code></pre>
<h4 id="创建启动类"><a href="#创建启动类" class="headerlink" title="创建启动类"></a>创建启动类</h4><pre><code class="javaj">@SpringBootApplication
@EnableDubbo //开启 Dubbo 注解功能
public class BootUserServiceProviderApplication &#123;

    public static void main(String[] args) &#123;
        SpringApplication.run(BootUserServiceProviderApplication.class,args);
    &#125;
&#125;
</code></pre>
<h3 id="创建服务消费方"><a href="#创建服务消费方" class="headerlink" title="创建服务消费方"></a>创建服务消费方</h3><p><code>pom.xml</code> 文件如下：与服务提供方一样</p>
<pre><code class="xml">    &lt;parent&gt;
        &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
        &lt;artifactId&gt;spring-boot-starter-parent&lt;/artifactId&gt;
        &lt;version&gt;2.1.6.RELEASE&lt;/version&gt;
        &lt;relativePath/&gt; &lt;!-- lookup parent from repository --&gt;
    &lt;/parent&gt;

    &lt;dependencies&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;com.silverming.dubbo&lt;/groupId&gt;
            &lt;artifactId&gt;dubbo-interface&lt;/artifactId&gt;
            &lt;version&gt;1.0-SNAPSHOT&lt;/version&gt;
        &lt;/dependency&gt;

        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
            &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt;
        &lt;/dependency&gt;

        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
            &lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt;
            &lt;scope&gt;test&lt;/scope&gt;
        &lt;/dependency&gt;

        &lt;dependency&gt;
            &lt;groupId&gt;com.alibaba.boot&lt;/groupId&gt;
            &lt;artifactId&gt;dubbo-spring-boot-starter&lt;/artifactId&gt;
            &lt;version&gt;0.2.0&lt;/version&gt;
        &lt;/dependency&gt;
    &lt;/dependencies&gt;
</code></pre>
<h4 id="实现订单服务接口"><a href="#实现订单服务接口" class="headerlink" title="实现订单服务接口"></a>实现订单服务接口</h4><p>订单服务接口会调用到用户服务接口，代码如下：</p>
<pre><code class="java">@Service //暴露服务
public class OrderServiceImpl  implements OrderService &#123;

    /**
     * @Reference: 远程调用 UserService, 自己会去注册中心去发现
     **/
    @Reference
    UserService userService;


    @Override
    public List&lt;UserAddress&gt; initOrder(String userId) &#123;
        System.out.println(&quot;用户id:&quot;+userId);
        // 查询用户的收货地址
        List&lt;UserAddress&gt; userAddressList = userService.getUserAddressList(userId);
        return userAddressList;
    &#125;
&#125;
</code></pre>
<blockquote>
<p><strong><code>@Reference</code> 注解用于引用服务</strong></p>
</blockquote>
<h4 id="创建控制器"><a href="#创建控制器" class="headerlink" title="创建控制器"></a>创建控制器</h4><pre><code class="java">@Controller
public class OrderController &#123;
    @Autowired
    private OrderService orderService;

    @ResponseBody
    @RequestMapping(&quot;/initOrder&quot;)
    public List&lt;UserAddress&gt; initOrder(@RequestParam(&quot;uid&quot;) String userId) &#123;
        return orderService.initOrder(userId);
    &#125;
&#125;
</code></pre>
<h4 id="配置文件"><a href="#配置文件" class="headerlink" title="配置文件"></a>配置文件</h4><pre><code class="yaml">dubbo:
  application:
    name: boot-order-service-consumer
  registry:
    protocol: zookeeper
    address: 127.0.0.1:2181,127.0.0.1:2182,127.0.0.1:2183
  protocol:
    name: dubbo
    port: 20881
server:
  port: 8081
</code></pre>
<h4 id="创建启动类-1"><a href="#创建启动类-1" class="headerlink" title="创建启动类"></a>创建启动类</h4><pre><code class="java">@EnableDubbo // 开启基于注解的dubbo功能
@SpringBootApplication
public class BootOrderServiceConsumerApplication &#123;
    public static void main(String[] args) &#123;
        SpringApplication.run(BootOrderServiceConsumerApplication.class, args);
    &#125;
&#125;
</code></pre>
<h2 id="使用-XML-配置文件的方式"><a href="#使用-XML-配置文件的方式" class="headerlink" title="使用 XML 配置文件的方式"></a>使用 XML 配置文件的方式</h2><p>按照上面原始的方式创建 XML 配置文件，然后在启动类使用 <code>@ImportResouorce</code> 注解导入配置文件</p>
<h2 id="使用注解-API-的方式"><a href="#使用注解-API-的方式" class="headerlink" title="使用注解 API 的方式"></a>使用注解 API 的方式</h2><p>将每一个组件手动创建到容器中。API 属性与配置项一对一，比如：<code>ApplicationConfig.setName(&quot;xxx&quot;)</code> 对应 <code>&lt;dubbo:application name=&quot;xxx&quot;/&gt;</code></p>
<p>示例如下，同时还有服务消费端相应的配置。</p>
<pre><code class="java">@Configuration
public class DubboCongig &#123;

    @Bean
    // 当前应用配置
    public ApplicationConfig applicationConfig() &#123;
        ApplicationConfig applicationConfig = new ApplicationConfig();
        //对应dubbo.application.name
        applicationConfig.setName(&quot;application.yml&quot;);
        return applicationConfig;
    &#125;

    @Bean
    // 连接注册中心配置
    public RegistryConfig registryConfig() &#123;
        RegistryConfig registry = new RegistryConfig();
        registry.setProtocol(&quot;zookeeper&quot;);
        registry.setAddress(&quot;127.0.0.1:2181&quot;);
        return registry;
    &#125;

    @Bean
    // 服务提供者暴露服务配置
    public ServiceConfig&lt;UserService&gt; serviceConfig(UserService userService) &#123;
        ServiceConfig&lt;UserService&gt; service = new ServiceConfig&lt;UserService&gt;(); // 此实例很重，封装了与注册中心的连接，请自行缓存，否则可能造成内存和连接泄漏
        service.setInterface(UserService.class);
        service.setRef(userService);
        service.setVersion(&quot;1.0.0&quot;);

        MethodConfig methodConfig = new MethodConfig();
        methodConfig.setName(&quot;getUserAddressList&quot;);
        methodConfig.setTimeout(1000);

        //将 Method 设置保存的 Service 配置中
        List&lt;MethodConfig&gt; methodConfigList = new ArrayList&lt;&gt;();
        methodConfigList.add(methodConfig);
        service.setMethods(methodConfigList);
        // 暴露及注册服务
        service.export();
        return service;
    &#125;
&#125;
</code></pre>
<p>配置完之后，在启动类使用 <code>@DubboComponentScan</code> 或者 <code>@EnableDubbo(scanBasePackages = &quot;com.silverming.config&quot;)</code>  注解。</p>
<h1 id="Dubbo-配置"><a href="#Dubbo-配置" class="headerlink" title="Dubbo 配置"></a>Dubbo 配置</h1><p>Dubbo 提供了 XML 、属性、API、注解等多种配置方式，可以通过官方文档查看配置属性有哪些。配置的优先级由高到低如下：</p>
<p><img src="http://qiniu.xiaoming.net.cn/Dubbo%E9%85%8D%E7%BD%AE%E5%85%B3%E7%B3%BB%E4%BC%98%E5%85%88%E7%BA%A7.jpg" alt="Dubbo 配置优先级"></p>
<p>既虚拟机启动参数配置、外部化配置、Spring&#x2F;API 配置、配置文件配置优先级依次降低。</p>
<h2 id="相关常用配置标签"><a href="#相关常用配置标签" class="headerlink" title="相关常用配置标签"></a>相关常用配置标签</h2><table>
<thead>
<tr>
<th>标签</th>
<th>用途</th>
<th>解释</th>
</tr>
</thead>
<tbody><tr>
<td><code>&lt;dubbo:service&gt;</code></td>
<td>服务配置</td>
<td>用于暴露一个服务，定义服务的元信息，一个服务可以用多个协议暴露，一个服务也可以注册到多个注册中心</td>
</tr>
<tr>
<td><code>&lt;dubbo:reference/&gt;</code></td>
<td>引用配置</td>
<td>用于创建一个远程服务代理，一个引用可以指向多个注册中心</td>
</tr>
<tr>
<td><code>&lt;dubbo:protocol/&gt;</code></td>
<td>协议配置</td>
<td>用于配置提供服务的协议信息，协议由提供方指定，消费方被动接受</td>
</tr>
<tr>
<td><code>&lt;dubbo:application/&gt;</code></td>
<td>应用配置</td>
<td>用于配置当前应用信息，不管该应用是提供者还是消费者</td>
</tr>
<tr>
<td><code>&lt;dubbo:module/</code></td>
<td>模块配置</td>
<td>用于配置当前模块信息，可选</td>
</tr>
<tr>
<td><code>&lt;dubbo:registry/&gt;</code></td>
<td>注册中心配置</td>
<td>用于配置连接注册中心相关信息</td>
</tr>
<tr>
<td><code>&lt;dubbo:monitor/&gt;</code></td>
<td>监控中心配置</td>
<td>用于配置连接监控中心相关信息，可选</td>
</tr>
<tr>
<td><code>&lt;dubbo:provider/&gt;</code></td>
<td>提供方配置</td>
<td>当 ProtocolConfig 和 ServiceConfig 某属性没有配置时，采用此缺省值，可选</td>
</tr>
<tr>
<td><code>&lt;dubbo:consumer/&gt;</code></td>
<td>消费方配置</td>
<td>当 ReferenceConfig 某属性没有配置时，采用此缺省值，可选</td>
</tr>
<tr>
<td><code>&lt;dubbo:method/&gt;</code></td>
<td>方法配置</td>
<td>用于 ServiceConfig 和 ReferenceConfig 指定方法级的配置信息</td>
</tr>
<tr>
<td><code>&lt;dubbo:argument/&gt;</code></td>
<td>参数配置</td>
<td>用于指定方法参数配置</td>
</tr>
</tbody></table>
<h2 id="不同粒度配置的覆盖关系"><a href="#不同粒度配置的覆盖关系" class="headerlink" title="不同粒度配置的覆盖关系"></a>不同粒度配置的覆盖关系</h2><p>以 <code>timeout</code> 为例，下图显示了配置的查找顺序，其它 <code>retries</code>,<code> loadbalance</code>,<code> actives</code> 等类似：</p>
<ul>
<li>方法级优先，接口级次之，全局配置再次之。</li>
<li>如果级别一样，则消费方优先，提供方次之。</li>
</ul>
<p>其中，服务提供方配置，通过 URL 经由注册中心传递给消费方。</p>
<p><img src="http://qiniu.xiaoming.net.cn/dubbo%E4%B8%8D%E5%90%8C%E7%B2%92%E5%BA%A6%E9%85%8D%E7%BD%AE%E7%9A%84%E8%A6%86%E7%9B%96%E5%85%B3%E7%B3%BB.jpg" alt="Dubbo不同粒度配置的覆盖关系"></p>
<blockquote>
<p>建议由服务提供方设置超时，因为一个方法需要执行多长时间，服务提供方更清楚，如果一个消费方同时引用多个服务，就不需要关心每个服务的超时设置）。</p>
<p>理论上 ReferenceConfig 中除了<code>interface</code>这一项，其他所有配置项都可以缺省不配置，框架会自动使用ConsumerConfig，ServiceConfig, ProviderConfig 等提供的缺省配置。</p>
</blockquote>
<h2 id="配置相关机制"><a href="#配置相关机制" class="headerlink" title="配置相关机制"></a>配置相关机制</h2><h3 id="启动时检查"><a href="#启动时检查" class="headerlink" title="启动时检查"></a>启动时检查</h3><p>Dubbo 默认会在启动时检查依赖的服务是否可用，不可用时会抛出异常，阻止 Spring 初始化完成，以便上线时，能及早发现问题，默认 <code>check=&quot;true&quot;</code>。</p>
<p>可以通过 <code>check=&quot;false&quot;</code> 关闭检查，比如，测试时，有些服务不关心，或者出现了循环依赖，必须有一方先启动。</p>
<p>另外，如果 Spring 容器是懒加载的，或者通过 API 编程延迟引用服务，请关闭 check，否则服务临时不可用时，会抛出异常，拿到 null 引用，如果 <code>check=&quot;false&quot;</code>，总是会返回引用，当服务恢复时，能自动连上。</p>
<h4 id="通过-spring-配置文件关闭"><a href="#通过-spring-配置文件关闭" class="headerlink" title="通过 spring 配置文件关闭"></a>通过 spring 配置文件关闭</h4><p>关闭某个服务的启动时检查 (没有提供者时报错)：</p>
<pre><code class="xml">&lt;dubbo:reference interface=&quot;com.foo.BarService&quot; check=&quot;false&quot; /&gt;
</code></pre>
<p>关闭所有服务的启动时检查 (没有提供者时报错)：</p>
<pre><code class="xml">&lt;dubbo:consumer check=&quot;false&quot; /&gt;
</code></pre>
<p>关闭注册中心启动时检查 (注册订阅失败时报错)：</p>
<pre><code class="xml">&lt;dubbo:registry check=&quot;false&quot; /&gt;
</code></pre>
<p>此外还可以通过 <code>dubbo.properties</code> ,虚拟机 <code>-D</code> 参数关闭。</p>
<h4 id="配置的含义"><a href="#配置的含义" class="headerlink" title="配置的含义"></a>配置的含义</h4><p><code>dubbo.reference.check=false</code>，强制改变所有 <code>reference</code> 的 check 值，就算配置中有声明，也会被覆盖。</p>
<p><code>dubbo.consumer.check=false</code>，是设置 <code>check</code> 的缺省值，如果配置中有显式的声明，如：<code>&lt;dubbo:reference check=&quot;true&quot;/&gt;</code>，不会受影响。</p>
<p><code>dubbo.registry.check=false</code>，前面两个都是指订阅成功，但提供者列表是否为空是否报错，如果注册订阅失败时，也允许启动，需使用此选项，将在后台定时重试。</p>
<h2 id="配置的相关参数"><a href="#配置的相关参数" class="headerlink" title="配置的相关参数"></a>配置的相关参数</h2><h3 id="timeout-超时时间"><a href="#timeout-超时时间" class="headerlink" title="timeout 超时时间"></a>timeout 超时时间</h3><p>远程服务调用超时时间(毫秒)，大多数配置默认情况下是 1000 毫秒。</p>
<h3 id="retries-重试次数"><a href="#retries-重试次数" class="headerlink" title="retries 重试次数"></a>retries 重试次数</h3><p>可以通过 retries 参数配置重试次数，<strong>不包含第一次调用</strong>，0 代表不重试。</p>
<p>对于幂等的操作，可以设置重试次数（如查询、删除、修改），对于非幂等的操作，不能设置重试（如增加）。</p>
<h3 id="version-多版本"><a href="#version-多版本" class="headerlink" title="version 多版本"></a>version 多版本</h3><p>当一个接口实现，出现不兼容升级时，可以用版本号过渡，版本号不同的服务相互间不引用。</p>
<p>可以按照以下的步骤进行版本迁移：</p>
<ol>
<li>在低压力时间段，先升级一半提供者为新版本</li>
<li>再将所有消费者升级为新版本</li>
<li>然后将剩下的一半提供者升级为新版本</li>
</ol>
<p>老版本服务提供者配置：</p>
<pre><code class="xml">&lt;dubbo:service interface=&quot;com.foo.BarService&quot; version=&quot;1.0.0&quot; /&gt;
</code></pre>
<p>新版本服务提供者配置：</p>
<pre><code class="xml">&lt;dubbo:service interface=&quot;com.foo.BarService&quot; version=&quot;2.0.0&quot; /&gt;
</code></pre>
<p>老版本服务消费者配置：</p>
<pre><code class="xml">&lt;dubbo:reference id=&quot;barService&quot; interface=&quot;com.foo.BarService&quot; version=&quot;1.0.0&quot; /&gt;
</code></pre>
<p>新版本服务消费者配置：</p>
<pre><code class="xml">&lt;dubbo:reference id=&quot;barService&quot; interface=&quot;com.foo.BarService&quot; version=&quot;2.0.0&quot; /&gt;
</code></pre>
<p>如果不需要区分版本，可以按照以下的方式配置：</p>
<pre><code class="xml">&lt;dubbo:reference id=&quot;barService&quot; interface=&quot;com.foo.BarService&quot; version=&quot;*&quot; /&gt;
</code></pre>
<h3 id="stub-本地存根"><a href="#stub-本地存根" class="headerlink" title="stub 本地存根"></a>stub 本地存根</h3><p>远程服务后，客户端通常只剩下接口，而实现全在服务器端，但提供方有些时候想在客户端也执行部分逻辑，比如：做 ThreadLocal 缓存，提前验证参数，调用失败后伪造容错数据等等，此时就需要在 API 中带上 Stub，客户端生成 Proxy 实例，会把 Proxy 通过构造函数传给 Stub，然后把 Stub 暴露给用户，Stub 可以决定要不要去调 Proxy。</p>
<p><img src="http://qiniu.xiaoming.net.cn/Dubbo%E6%9C%AC%E5%9C%B0%E5%AD%98%E6%A0%B9.jpg" alt="Dubbo本地存根"></p>
<p>在 spring 配置文件中按以下方式配置：对应注解 <code>@Service(stub = &quot;com.silverming.service.stub.UserServiceStub&quot;)</code></p>
<pre><code class="xml">&lt;dubbo:service interface=&quot;com.silverming.service.UserService&quot; stub=&quot;true&quot; /&gt;
</code></pre>
<p>或</p>
<pre><code class="xml">&lt;dubbo:service interface=&quot;com.silverming.service.UserService&quot; stub=&quot;com.silverming.service.stub.UserServiceStub&quot; /&gt;
</code></pre>
<p>同时，还需要提供相应的 Stub 实现：</p>
<pre><code class="java">package com.silverming.service.stub;

import java.util.List;

public class UserServiceStub implements UserService &#123;

    private final UserService userService;

    //构造函数传入真正的远程代理对象
    public UserServiceStub(UserService userService) &#123;
        this.userService = userService;
    &#125;

    @Override
    public List&lt;UserAddress&gt; getUserAddressList(String userId) &#123;
        // 此代码在客户端执行, 可以在客户端做 ThreadLocal 本地缓存，或预先验证参数是否合法，等等
        System.out.println(&quot;本地存根调用&quot;);
        try &#123;
            return userService.getUserAddressList(userId);
        &#125; catch (Exception e) &#123;
            // 可以容错，可以做任何AOP拦截事项
            return null;
        &#125;
    &#125;
&#125;
</code></pre>
<h1 id="Dubbo-高可用配置"><a href="#Dubbo-高可用配置" class="headerlink" title="Dubbo 高可用配置"></a>Dubbo 高可用配置</h1><h2 id="Zookeeper-宕机与-Dubbo-直连"><a href="#Zookeeper-宕机与-Dubbo-直连" class="headerlink" title="Zookeeper 宕机与 Dubbo 直连"></a>Zookeeper 宕机与 Dubbo 直连</h2><p>主要与 Dubbo 的健壮性挂钩，Zookeeper 注册中心宕机后，服务提供者和服务消费者仍能够通过本地缓存进行通讯。</p>
<p>Dubbo 健壮性包括以下几点：</p>
<ul>
<li><p>监控中心宕掉不影响使用，只是丢失部分采样数据</p>
</li>
<li><p>数据库宕掉后，注册中心仍能通过缓存提供服务列表查询，但不能注册新服务</p>
</li>
<li><p>注册中心对等集群，任意一台宕掉后，将自动切换到另一台</p>
</li>
<li><p>注册中心全部宕掉后，服务提供者和服务消费者仍能通过本地缓存通讯</p>
</li>
<li><p>服务提供者无状态，任意一台宕掉后，不影响使用</p>
</li>
<li><p>服务提供者全部宕掉后，服务消费者应用将无法使用，并无限次重连等待服务提供者恢复</p>
</li>
</ul>
<p>另外，在开发及测试环境下，经常需要绕过注册中心，只测试指定服务提供者，这时候可能需要点对点直连，点对点直连方式，将以服务接口为单位，忽略注册中心的提供者列表，A 接口配置点对点，不影响 B 接口从注册中心获取列表。</p>
<p>如果是线上需求需要点对点，可在 <code>&lt;dubbo:reference&gt;</code> 中配置 url 指向提供者，将绕过注册中心，多个地址用分号隔开，配置如下 :</p>
<pre><code class="xml">&lt;dubbo:reference id=&quot;xxxService&quot; interface=&quot;com.alibaba.xxx.XxxService&quot; url=&quot;dubbo://localhost:20890&quot; /&gt;
</code></pre>
<p>也可以通过 JVM 参数指定，在 JVM 启动参数中加入 <code>-D</code> 参数映射服务地址：</p>
<pre><code class="sh">java -Dcom.alibaba.xxx.XxxService=dubbo://localhost:20890
</code></pre>
<h2 id="负载均衡"><a href="#负载均衡" class="headerlink" title="负载均衡"></a>负载均衡</h2><p>在集群负载均衡时，Dubbo 提供了多种均衡策略，缺省为 <code>random</code> 随机调用。</p>
<p>当有多个服务提供者时，默认情况下使用 <code>random</code> 并且权重相等随机调用。</p>
<h3 id="负载均衡策略"><a href="#负载均衡策略" class="headerlink" title="负载均衡策略"></a>负载均衡策略</h3><h4 id="Random-LoadBalance"><a href="#Random-LoadBalance" class="headerlink" title="Random LoadBalance"></a>Random LoadBalance</h4><ul>
<li><strong>随机</strong>，按权重设置随机概率。</li>
<li>在一个截面上碰撞的概率高，但调用量越大分布越均匀，而且按概率使用权重后也比较均匀，有利于动态调整提供者权重。</li>
</ul>
<h4 id="RoundRobin-LoadBalance"><a href="#RoundRobin-LoadBalance" class="headerlink" title="RoundRobin LoadBalance"></a>RoundRobin LoadBalance</h4><ul>
<li><strong>轮询</strong>，按公约后的权重设置轮询比率。</li>
<li>存在慢的提供者累积请求的问题，比如：第二台机器很慢，但没挂，当请求调到第二台时就卡在那，久而久之，所有请求都卡在调到第二台上。</li>
</ul>
<h4 id="LeastActive-LoadBalance"><a href="#LeastActive-LoadBalance" class="headerlink" title="LeastActive LoadBalance"></a>LeastActive LoadBalance</h4><ul>
<li><strong>最少活跃调用数</strong>，相同活跃数的随机，活跃数指调用前后计数差。</li>
<li>使慢的提供者收到更少请求，因为越慢的提供者的调用前后计数差会越大。</li>
</ul>
<h4 id="ConsistentHash-LoadBalance"><a href="#ConsistentHash-LoadBalance" class="headerlink" title="ConsistentHash LoadBalance"></a>ConsistentHash LoadBalance</h4><ul>
<li><strong>一致性 Hash</strong>，相同参数的请求总是发到同一提供者。</li>
<li>当某一台提供者挂时，原本发往该提供者的请求，基于虚拟节点，平摊到其它提供者，不会引起剧烈变动。</li>
<li>缺省只对第一个参数 Hash，如果要修改，请配置 <code>&lt;dubbo:parameter key=&quot;hash.arguments&quot; value=&quot;0,1&quot; /&gt;</code></li>
<li>缺省用 160 份虚拟节点，如果要修改，请配置 <code>&lt;dubbo:parameter key=&quot;hash.nodes&quot; value=&quot;320&quot; /&gt;</code></li>
</ul>
<h3 id="负载均衡配置方式"><a href="#负载均衡配置方式" class="headerlink" title="负载均衡配置方式"></a>负载均衡配置方式</h3><h4 id="服务端服务级别"><a href="#服务端服务级别" class="headerlink" title="服务端服务级别"></a>服务端服务级别</h4><pre><code class="xml">&lt;dubbo:service interface=&quot;...&quot; loadbalance=&quot;roundrobin&quot; /&gt;
</code></pre>
<h4 id="客户端服务级别"><a href="#客户端服务级别" class="headerlink" title="客户端服务级别"></a>客户端服务级别</h4><pre><code class="xml">&lt;dubbo:reference interface=&quot;...&quot; loadbalance=&quot;roundrobin&quot; /&gt;
</code></pre>
<h4 id="服务端方法级别"><a href="#服务端方法级别" class="headerlink" title="服务端方法级别"></a>服务端方法级别</h4><pre><code class="xml">&lt;dubbo:service interface=&quot;...&quot;&gt;
    &lt;dubbo:method name=&quot;...&quot; loadbalance=&quot;roundrobin&quot;/&gt;
&lt;/dubbo:service&gt;
</code></pre>
<h4 id="客户端方法级别"><a href="#客户端方法级别" class="headerlink" title="客户端方法级别"></a>客户端方法级别</h4><pre><code class="xml">&lt;dubbo:reference interface=&quot;...&quot;&gt;
    &lt;dubbo:method name=&quot;...&quot; loadbalance=&quot;roundrobin&quot;/&gt;
&lt;/dubbo:reference&gt;
</code></pre>
<h2 id="服务降级"><a href="#服务降级" class="headerlink" title="服务降级"></a>服务降级</h2><p>当服务器压力剧增的情况下，根据实际业务流量及情况，对一些服务和页面有策略的不处理或换种简单的方式处理，从而释放服务器资源以保证核心业务正常运作或高效运作。</p>
<p>可以通过 <code>mock</code> 参数设置服务降级，与 stub 相似，设为true，表示使用缺省 Mock 类名，即：接口名 + Mock 后缀，服务接口调用失败 Mock 实现类，该 Mock 类必须有一个无参构造函数，与 Stub 的区别在于，Stub 总是被执行，而 Mock 只在出现非业务异常(比如超时，网络异常等)时执行，Stub 在远程调用之前执行，Mock 在远程调用后执行。</p>
<h2 id="服务容错"><a href="#服务容错" class="headerlink" title="服务容错"></a>服务容错</h2><p>在集群调用失败时，Dubbo 提供了多种容错方案，缺省为 failover 重试。Dubbo 提供了以下几种容错模式：</p>
<h3 id="Failover-Cluster"><a href="#Failover-Cluster" class="headerlink" title="Failover Cluster"></a>Failover Cluster</h3><p>失败自动切换，当出现失败，重试其它服务器。通常用于读操作，但重试会带来更长延迟。可通过 <code>retries=&quot;2&quot;</code> 来设置重试次数(不含第一次)。</p>
<p>重试次数配置如下：</p>
<pre><code class="xml">&lt;dubbo:service retries=&quot;2&quot; /&gt;
</code></pre>
<p>或</p>
<pre><code class="xml">&lt;dubbo:reference retries=&quot;2&quot; /&gt;
</code></pre>
<p>或</p>
<pre><code class="xml">&lt;dubbo:reference&gt;
    &lt;dubbo:method name=&quot;findFoo&quot; retries=&quot;2&quot; /&gt;
&lt;/dubbo:reference&gt;
</code></pre>
<h3 id="Failfast-Cluster"><a href="#Failfast-Cluster" class="headerlink" title="Failfast Cluster"></a>Failfast Cluster</h3><p>快速失败，只发起一次调用，失败立即报错。通常用于非幂等性的写操作，比如新增记录。</p>
<h3 id="Failsafe-Cluster"><a href="#Failsafe-Cluster" class="headerlink" title="Failsafe Cluster"></a>Failsafe Cluster</h3><p>失败安全，出现异常时，直接忽略。通常用于写入审计日志等操作。</p>
<h3 id="Failback-Cluster"><a href="#Failback-Cluster" class="headerlink" title="Failback Cluster"></a>Failback Cluster</h3><p>失败自动恢复，后台记录失败请求，定时重发。通常用于消息通知操作。</p>
<h3 id="Forking-Cluster"><a href="#Forking-Cluster" class="headerlink" title="Forking Cluster"></a>Forking Cluster</h3><p>并行调用多个服务器，只要一个成功即返回。通常用于实时性要求较高的读操作，但需要浪费更多服务资源。可通过 <code>forks=&quot;2&quot;</code> 来设置最大并行数。</p>
<h3 id="Broadcast-Cluster"><a href="#Broadcast-Cluster" class="headerlink" title="Broadcast Cluster"></a>Broadcast Cluster</h3><p>广播调用所有提供者，逐个调用，任意一台报错则报错 。通常用于通知所有提供者更新缓存或日志等本地资源信息。</p>
<h3 id="集群模式配置"><a href="#集群模式配置" class="headerlink" title="集群模式配置"></a>集群模式配置</h3><p>按照以下示例在服务提供方和消费方配置集群模式</p>
<pre><code class="xml">&lt;dubbo:service cluster=&quot;failsafe&quot; /&gt;
</code></pre>
<p>或</p>
<pre><code class="xml">&lt;dubbo:reference cluster=&quot;failsafe&quot; /&gt;
</code></pre>
<h3 id="服务容错应用（整合-Hystrix）"><a href="#服务容错应用（整合-Hystrix）" class="headerlink" title="服务容错应用（整合 Hystrix）"></a>服务容错应用（整合 Hystrix）</h3><p>一般实际项目上会整合 Hystrix 组件进行服务容错实现。</p>
<ol>
<li><p>首先导入 Hystrix 依赖</p>
<p>在 provider 和 consumer 中导入 Hystrix 依赖，注意版本要和 Spring Boot 兼容</p>
</li>
</ol>
<pre><code class="xml">&lt;dependency&gt;
        &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;
    &lt;artifactId&gt;spring-cloud-starter-netflix-hystrix&lt;/artifactId&gt;
    &lt;version&gt;2.1.5.RELEASE&lt;/version&gt;
&lt;/dependency&gt;
</code></pre>
<ol start="2">
<li><p>启动类配置 <code>@EnableHystrix</code></p>
<p>在两者的启动类上配置 <code>@EnableHystrix</code> 表示开启 Hystrix。</p>
</li>
<li><p>对需要容错的方法使用 <code>@HystrixCommand</code> 注解</p>
<p>此注解表示此方法是 hystrix 方法，其中 fallbackMethod 定义回退方法的名称。Spring Cloud 会自动将带有该批注的 Spring bean 包装在连接到 Hystrix 断路器的代理中。断路器计算何时断开和闭合电路，以及在发生故障时应采取的措施。</p>
<p>服务提供者修改示例：</p>
<pre><code class="java">@Component
@Service(weight = 700)

public class UserServiceImpl implements UserService &#123;
    @Override
    @HystrixCommand
    public List&lt;UserAddress&gt; getUserAddressList(String userId) &#123;


        System.out.println(&quot;服务提供者3&quot;);

        UserAddress address1 = new UserAddress(1, &quot;河北省衡水市&quot;, &quot;1&quot;, &quot;carson&quot;,&quot;12345678911&quot;,&quot;Y&quot;);
        UserAddress address2 = new UserAddress(1, &quot;山东省德州市&quot;, &quot;2&quot;, &quot;eason&quot;, &quot;4562144&quot;, &quot;Y&quot;);

          //测试异常
        if(Math.random() &gt; 0.5) &#123;
            throw new RuntimeException();
        &#125;

        return Arrays.asList(address1,address2);
    &#125;
&#125;
</code></pre>
<p>服务消费者修改示例：</p>
<pre><code class="java">@Controller
public class OrderController &#123;
    @Autowired
    private OrderService orderService;

    @ResponseBody
    @RequestMapping(&quot;/initOrder&quot;)
    @HystrixCommand(fallbackMethod = &quot;fallbackMethod&quot;)
    public List&lt;UserAddress&gt; initOrder(@RequestParam(&quot;uid&quot;) String userId) &#123;
        return orderService.initOrder(userId);
    &#125;

      //出异常时调用的方法
    public List&lt;UserAddress&gt; fallbackMethod(@RequestParam(&quot;uid&quot;) String userId) &#123;
        return Arrays.asList(new UserAddress(10,&quot;测试地址&quot;,&quot;1&quot;,&quot;测试&quot;,&quot;测试&quot;,&quot;Y&quot;));
    &#125;
&#125;
</code></pre>
</li>
</ol>
<p><strong>参考资料</strong>：</p>
<blockquote>
<p><a target="_blank" rel="noopener" href="http://dubbo.apache.org/zh-cn/docs/user/quick-start.html">Dubbo 官方文档</a></p>
<p><a target="_blank" rel="noopener" href="https://github.com/aaaTao66/dubbo-demo">Github——aaaTao66&#x2F;dubbo-demo</a></p>
<p><a target="_blank" rel="noopener" href="https://juejin.im/entry/5a5f3d1d6fb9a01cb912efea">Spring cloud系列十 使用@HystrixCommand使用Hystrix组件及@EnableCircuitBreaker原理介绍</a></p>
<p><a target="_blank" rel="noopener" href="https://cloud.spring.io/spring-cloud-static/spring-cloud-netflix/2.2.2.RELEASE/reference/html/">Spring Cloud Netflix 官方文档</a></p>
<p><a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1Gb411T7Ha?p=1">Dubbo教程-雷丰阳-尚硅谷</a></p>
</blockquote>

    </div>

    
    
    

    <footer class="post-footer">
          <div class="reward-container">
  <div>打工不易，想买杯奶茶</div>
  <button>
    赞赏
  </button>
  <div class="post-reward">
      <div>
        <img src="https://qiniu.xiaoming.net.cn/%E5%BE%AE%E4%BF%A1%E6%94%B6%E6%AC%BE%E7%A0%81.png" alt="Silverming 微信">
        <span>微信</span>
      </div>
      <div>
        <img src="https://qiniu.xiaoming.net.cn/%E6%94%AF%E4%BB%98%E5%AE%9D%E6%94%B6%E6%AC%BE%E7%A0%81.png" alt="Silverming 支付宝">
        <span>支付宝</span>
      </div>

  </div>
</div>

          <div class="post-tags">
              <a href="/tags/Dubbo/" rel="tag"># Dubbo</a>
              <a href="/tags/%E5%88%86%E5%B8%83%E5%BC%8F/" rel="tag"># 分布式</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/2020/04/01/Nginx%E9%AB%98%E5%B9%B6%E5%8F%91%E5%AE%9E%E7%8E%B0/" rel="prev" title="Nginx 高并发高性能实现">
                  <i class="fa fa-chevron-left"></i> Nginx 高并发高性能实现
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/2020/05/11/Dubbo%E6%BA%90%E7%A0%81%E8%A7%A3%E6%9E%90/" rel="next" title="Dubbo源码解析">
                  Dubbo源码解析 <i class="fa fa-chevron-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">

  <div class="beian"><a href="https://beian.miit.gov.cn/" rel="noopener" target="_blank">粤ICP备18114217号-1 </a>
  </div>

<div class="copyright">
  &copy; 
  <span itemprop="copyrightYear">2023</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Silverming</span>
</div>
<div class="wordcount">
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-line"></i>
    </span>
    <span title="站点总字数">2.5m</span>
  </span>
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
    <span title="站点阅读时长">37:40</span>
  </span>
</div>
<div class="busuanzi-count">
    <span class="post-meta-item" id="busuanzi_container_site_uv">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="总访客量">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-item" id="busuanzi_container_site_pv">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="总访问量">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/mist/" rel="noopener" target="_blank">NexT.Mist</a> 强力驱动
  </div>

    </div>
  </footer>

  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/schemes/muse.js"></script><script src="/js/next-boot.js"></script>

  
<script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-generator-searchdb/1.4.0/search.js" integrity="sha256-vXZMYLEqsROAXkEw93GGIvaB2ab+QW6w3+1ahD9nXXA=" crossorigin="anonymous"></script>
<script src="/js/third-party/search/local-search.js"></script>





  
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>




  

  <script class="next-config" data-name="enableMath" type="application/json">true</script><script class="next-config" data-name="mathjax" type="application/json">{"enable":true,"tags":"all","js":{"url":"https://cdnjs.cloudflare.com/ajax/libs/mathjax/3.2.2/es5/tex-mml-chtml.js","integrity":"sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI="}}</script>
<script src="/js/third-party/math/mathjax.js"></script>



</body>
</html>
