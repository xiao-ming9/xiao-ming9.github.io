

<!DOCTYPE html>
<html lang="zh-CN" data-default-color-scheme=&quot;auto&quot;>



<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="https://qiniu.xiaoming.net.cn/%E5%8D%9A%E5%AE%A2icon.jpeg">
  <link rel="icon" href="https://qiniu.xiaoming.net.cn/%E5%8D%9A%E5%AE%A2icon.jpeg">
  <meta name="viewport"
        content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
    <meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="description" content="简介Elasticsearch 是一个分布式文档储存中间件，它不会将信息储存为列数据行，而是储存已序列化为 JSON 文档的复杂数据结构。当在一个集群中有多个节点时，储存的文档分布在整个集群里面，并且立刻可以从任意节点去访问。
ElasticSearch 是一个高可用开源全文检索和分析组件。提供存储服务，搜索服务，大数据准实时分析等。一般用于提供一些提供复杂搜索的应用。">
  <meta name="author" content="Silverming">
  <meta name="keywords" content="">
  
  <title>ElasticSearch - Silverming</title>

  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/css/bootstrap.min.css" />


  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/github-markdown-css@4.0.0/github-markdown.min.css" />
  <link  rel="stylesheet" href="/lib/hint/hint.min.css" />

  
    
    
      
      <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@10.4.0/styles/github-gist.min.css" />
    
  

  
    <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.css" />
  



<!-- 主题依赖的图标库，不要自行修改 -->
<link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_ba1fz6golrf.css">

<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_kmeydafke9r.css">

<link  rel="stylesheet" href="/css/main.css" />

<!-- 自定义样式保持在最底部 -->


  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    var CONFIG = {"hostname":"yoursite.com","root":"/","version":"1.8.9","typing":{"enable":true,"typeSpeed":70,"cursorChar":"|","loop":false},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"right","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"copy_btn":true,"image_zoom":{"enable":true},"toc":{"enable":true,"headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"lazyload":{"enable":true,"loading_img":"/img/loading.gif","onlypost":false,"offset_factor":2},"web_analytics":{"enable":true,"baidu":"54ebb03ad7ad5b762ac8ff7958df6d3f","google":"G-M2RT7SDT3L","gtag":"G-M2RT7SDT3L","tencent":{"sid":null,"cid":null},"woyaola":null,"cnzz":null,"leancloud":{"app_id":"tFHjJkaAYKqH8BIXKnJVurUc-MdYXbMMI","app_key":"1qR5F7XyydYd5YJtIpMJBFmP","server_url":null}}};
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
</head>


<body>
  <header style="height: 70vh;">
    <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand"
       href="/">&nbsp;<strong>Silverming</strong>&nbsp;</a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/">
                <i class="iconfont icon-home-fill"></i>
                首页
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/">
                <i class="iconfont icon-archive-fill"></i>
                归档
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/">
                <i class="iconfont icon-tags-fill"></i>
                标签
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/">
                <i class="iconfont icon-user-fill"></i>
                关于
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/links/">
                <i class="iconfont icon-link-fill"></i>
                友链
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <!-- <a class="nav-link" data-toggle="modal" data-target="#modalSearch">&nbsp;<i -->
              <a class="nav-link" target="_self" data-toggle="modal" data-target="#modalSearch">&nbsp;<i
                class="iconfont icon-search"></i>&nbsp;</a>
          </li>
        
        
          <li class="nav-item" id="color-toggle-btn">
           <!-- <a class="nav-link" href="javascript:" target="_blank" rel="noopener">&nbsp;<i -->
             <a class="nav-link" target="_self">&nbsp;<i
                class="iconfont icon-dark" id="color-toggle-icon"></i>&nbsp;</a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

    <div class="banner" id="banner" parallax=true
         style="background: url('https://qiniu.xiaoming.net.cn/%E5%8D%9A%E5%AE%A2%E8%83%8C%E6%99%AF%E5%9B%BE.jpg') no-repeat center center;
           background-size: cover;">
      <div class="full-bg-img">
        <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
          <div class="page-header text-center fade-in-up">
            <span class="h2" id="subtitle" title="ElasticSearch">
              
            </span>

            
              <div class="mt-3">
  
  
    <span class="post-meta">
      <i class="iconfont icon-date-fill" aria-hidden="true"></i>
      <time datetime="2020-11-19 12:31" pubdate>
        2020年11月19日 下午
      </time>
    </span>
  
</div>

<div class="mt-1">
  
    
    <span class="post-meta mr-2">
      <i class="iconfont icon-chart"></i>
      4.2k 字
    </span>
  

  
    
    <span class="post-meta mr-2">
      <i class="iconfont icon-clock-fill"></i>
      
      
      49
       分钟
    </span>
  

  
  
    
      <!-- LeanCloud 统计文章PV -->
      <span id="leancloud-page-views-container" class="post-meta" style="display: none">
        <i class="iconfont icon-eye" aria-hidden="true"></i>
        <span id="leancloud-page-views"></span> 次
      </span>
    
  
</div>

            
          </div>

          
        </div>
      </div>
    </div>
  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="d-none d-lg-block col-lg-2"></div>
    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div class="py-5" id="board">
          <article class="post-content mx-auto">
            <!-- SEO header -->
            <h1 style="display: none">ElasticSearch</h1>
            
              <p class="note note-info">
                
                  本文最后更新于：2021年3月27日 中午
                
              </p>
            
            <div class="markdown-body">
              <h1 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h1><p>Elasticsearch 是一个分布式文档储存中间件，它不会将信息储存为列数据行，而是储存已序列化为 JSON 文档的复杂数据结构。当在一个集群中有多个节点时，储存的文档分布在整个集群里面，并且立刻可以从任意节点去访问。</p>
<p>ElasticSearch 是一个高可用开源全文检索和分析组件。提供存储服务，搜索服务，大数据准实时分析等。一般用于提供一些提供复杂搜索的应用。</p>
<a id="more"></a>

<h1 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h1><h2 id="ElasticSearch-安装"><a href="#ElasticSearch-安装" class="headerlink" title="ElasticSearch 安装"></a>ElasticSearch 安装</h2><p>通过 <a href="https://www.elastic.co/cn/" target="_blank" rel="noopener">ElasticSearch官网</a>下载压缩包解压后，直接在 <code>bin</code> 目录下的 <code>./elasticserch</code> 即可启动。启动后默认端口是 9200，页面如下：</p>
<p><img src="https://qiniu.xiaoming.net.cn/ElasticSearch%E5%90%AF%E5%8A%A8%E9%A1%B5%E9%9D%A2.jpg" srcset="/img/loading.gif" lazyload alt="ElasticSearch启动页面"></p>
<p>ElasticSearch 的目录结构如下：</p>
<figure class="highlight crystal"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs crystal">bin				启动文件<br>config		配置文件<br>	log4j2							日志配置文件<br>	jvm.options					java虚拟机相关的配置<br>	elasticsearch.yml		elasticsearch的配置文件，默认 <span class="hljs-number">9200</span> 端口；跨域等<br><span class="hljs-class"><span class="hljs-keyword">lib</span>				相关<span class="hljs-title">jar</span>包</span><br>logs			日志<br>modules		功能模块<br>plugins		插件<br></code></pre></div></td></tr></table></figure>

<h2 id="ElasticSearch-可视化"><a href="#ElasticSearch-可视化" class="headerlink" title="ElasticSearch 可视化"></a>ElasticSearch 可视化</h2><p>ElasticSearch 可视化有两个工具，一个是 ElasticsearchHead，最简单的方式是直接安装 Chrome浏览器拓展：</p>
<p><img src="https://qiniu.xiaoming.net.cn/ElastricSearchHead%E7%95%8C%E9%9D%A2.png" srcset="/img/loading.gif" lazyload alt="ElastricSearchHead"></p>
<p>另外一个是 Kibana，通过 <a href="https://www.elastic.co/cn/" target="_blank" rel="noopener">ElasticSearch官网</a>下载压缩包解压后在 <code>bin</code> 目录下运行 <code>./kibana</code> 命令即可启动，这里可以对其进行汉化，汉化包在 <code>/x-pack/plugins/translations/translations/zh-CN.json</code>下，通过在 <code>config</code> 目录下修改 <code>kibana.yml</code>文件，最后一行修改或加入：</p>
<figure class="highlight yml"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs yml"><span class="hljs-attr">i18n.locale:</span> <span class="hljs-string">"zh-CN"</span><br></code></pre></div></td></tr></table></figure>

<p>重新启动即可看到汉化版的界面：</p>
<p><img src="https://qiniu.xiaoming.net.cn/Kibana%E9%A1%B5%E9%9D%A2.jpg" srcset="/img/loading.gif" lazyload alt="Kibana界面"></p>
<h1 id="核心概念"><a href="#核心概念" class="headerlink" title="核心概念"></a>核心概念</h1><h2 id="与关系型数据库对比"><a href="#与关系型数据库对比" class="headerlink" title="与关系型数据库对比"></a>与关系型数据库对比</h2><blockquote>
<p>es时面向文档的， ElasticSearch 一切都是 json</p>
</blockquote>
<table>
<thead>
<tr>
<th>关系型数据库</th>
<th>ElasticSearch</th>
</tr>
</thead>
<tbody><tr>
<td>数据库（database）</td>
<td>索引（indices）</td>
</tr>
<tr>
<td>表（tables）</td>
<td>types（8.0可能被淘汰）</td>
</tr>
<tr>
<td>行（rows）</td>
<td>documents</td>
</tr>
<tr>
<td>字段（columns）</td>
<td>fields</td>
</tr>
</tbody></table>
<p>ElasticSearch（集群）中可以包含多个索引（数据库），每个索引中可以包含多个类型（表），每个类型下又包含多个文档（行），每个文档中又包含多个字段（列）。</p>
<h2 id="相关概念"><a href="#相关概念" class="headerlink" title="相关概念"></a>相关概念</h2><h3 id="物理设计"><a href="#物理设计" class="headerlink" title="物理设计"></a>物理设计</h3><p>ElasticSearch 在后台把每个索引划分成多个分片，每个分片可以在集群中的不同服务器之间迁移，一个人启动默认就是一个集群。</p>
<h3 id="索引"><a href="#索引" class="headerlink" title="索引"></a>索引</h3><p>分片是物理空间概念，索引中的数据都分布在分片上。索引是具有某些相似特征的文档的集合。可以把索引理解为数据库文档中的数据库。事实上，数据被存储和索引在分片(shards)中，索引只是一个把一个或多个分片分组在一起的逻辑空间。</p>
<h3 id="文档"><a href="#文档" class="headerlink" title="文档"></a>文档</h3><p>文档是可索引信息的基本单元，以 JSON 表示。在 ElasticSearch 中，文档有几个重要属性：</p>
<ul>
<li><p>自我包含，一盘文档同时包含字段和对应的值，也就是同时包含 key-value</p>
</li>
<li><p>可以是层次型的，一个文档中包含自文档，复杂的逻辑实体就是这么来的</p>
</li>
<li><p>灵活的结构，文档不依赖于预先定义的模式，在 ElasticSearch 中，对于字段是非常灵活的，有时候可以忽略该字段，或者动态添加一个新的字段。</p>
</li>
<li><p>一个文档主要的元信息如下：</p>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs text">1. _index: 文档所属的索引名<br>2. _type: 文档所属的类型名<br>3. _id: 文档的唯一ID<br>4. _source: 文档存储的 Json 数据<br>5. _version：文档的版本信息<br>6. _score: 相关性打分<br></code></pre></div></td></tr></table></figure>

<p>可以用文档来定义单个产品信息或是员工信息。可以把文档理解为数据库文档中的行列数据。在索引/类型中，可以存储任意数量的文档。文档有几个共同不可缺的属性，分别为 _index, _type, _id, 针对特定一个或一类文档进行操作时，必须指定这些属性。 最后要注意的是，虽然文档物理上是驻留在索引中，但实际上文档必须索引/分配给索引中的类型。</p>
<h3 id="类型"><a href="#类型" class="headerlink" title="类型"></a>类型</h3><p>类型是文档的逻辑容器，就像关系型数据库中，表格是行的容器。在索引中，可以定义一个或多个类型。类型是索引的逻辑类别/分区，其语义完全由开发者决定。通常，为具有一组公共字段的文档定义类型。可以把索引理解成数据库文档中的表。类型中对于字段的定义称为映射，比如 name 映射为字符串类型。</p>
<h3 id="分片与复制"><a href="#分片与复制" class="headerlink" title="分片与复制"></a>分片与复制</h3><p>索引可以存储尽可能多的数据，但是这种情况下性能往往不太乐观，或者常见的磁盘容量限制也不能允许。所以 Elasticsearch 提供了类似于 MongoDB 中的分片功能，该功能能将索引细分为多个分片。每个分片本身是一个功能完全和独立的“索引”，可以托管在集群中的任何节点上。一个集群至少有一个节点，而一个节点就是一个 ElasticSearch 进程，如果创建索引，那么索引将会有 5 个分片（primary shard，又称主分片）构成的，每个主分片会有一个副本（replica shard，又称复制副本）。</p>
<p>同样的，有分片技术来处理数据量增长快速的问题，就意味着需要复制技术来应对这种过程中(其实不只是该过程，任何情况下都应该有安全意识)数据安全的问题。Elasticsearch 允许将索引分片的一个或多个副本转换为所谓的副本分片。复制技术提供了数据的高可用性和搜索吞吐的扩展性。不过需要注意的是，<strong>副本分片从不分配在与从其复制的原始/主分片相同的节点上</strong>，有利于保证一个挂了其他的不至于丢失。</p>
<p>总而言之，每个索引可以拆分为多个分片。索引也可以复制为零(意味着没有副本)或更多次。一旦复制，每个索引将具有主分片(从索引复制的原始分片)和副本分片(主分片的副本)。开发者可以在创建索引时就为每个索引定义分片和副本的数量。创建索引后，可以随时动态更改副本数，但不能在此过程后随即更改分片数。</p>
<h3 id="倒排索引"><a href="#倒排索引" class="headerlink" title="倒排索引"></a>倒排索引</h3><p>Elasticsearch 使用一种被称为倒排索引的数据结构，该结构支持快速全文搜索。在倒排索引里列出了所有文档中出现的每一个唯一单词并分别标识了每个单词在哪一个文档中。</p>
<p>索引可以被认为是文档的优化集合，每个文档索引都是字段的集合，这些字段是包含了数据的键值对。默认情况下，Elasticsearch 为每个字段中的所有数据建立倒排索引，并且每个索引字段都有专门的优化数据结构。例如：文本字段在倒排索引里，数值和地理字段被储存在 BKD 树中。正是因为通过使用按字段数据结构组合，才使得 Elasticsearch 拥有如此快速的搜索能力。</p>
<h1 id="IK-分词器插件"><a href="#IK-分词器插件" class="headerlink" title="IK 分词器插件"></a>IK 分词器插件</h1><p>当一个文档被存储时，ES 会使用分词器从文档中提取出若干词元（<code>token</code>）来支持索引的存储和搜索。ES 内置了很多分词器，但内置的分词器对中文的处理不好。ElasticSearch 可以安装插件，这里以 IK 分词器为例：</p>
<p>下载地址：<a href="https://github.com/medcl/elasticsearch-analysis-ik" target="_blank" rel="noopener">https://github.com/medcl/elasticsearch-analysis-ik</a></p>
<p>安装方式有两种：</p>
<ol>
<li><p>直接下载压缩包解压后放到 ElasticSearch 的 plugins 目录下。</p>
</li>
<li><p>利用 ElasticSearch 自带的插件下载工具：</p>
<figure class="highlight awk"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs awk">.<span class="hljs-regexp">/bin/</span>elasticsearch-plugin install https:<span class="hljs-regexp">//gi</span>thub.com<span class="hljs-regexp">/medcl/</span>elasticsearch-analysis-ik<span class="hljs-regexp">/releases/</span>download<span class="hljs-regexp">/v6.3.0/</span>elasticsearch-analysis-ik-<span class="hljs-number">6.3</span>.<span class="hljs-number">0</span>.zip<br></code></pre></div></td></tr></table></figure>

<p>注意：替换<code>6.3.0</code>为自己的 elasticsearch 版本</p>
</li>
</ol>
<p>IK 提供了两个分词算法：<code>ik_smart</code> 和 <code>ik_max_word</code>，其中 <code>ik_smart</code> 为最少切分，<code>ik_max_word</code> 为最细粒度划分。</p>
<ul>
<li><p><code>ik_max_word</code>：可以插入文本做最细粒度的细分，替换为“中华人民共和国国歌”分割为“中华人民共和国，中华人民，中华，华人，人民共和国，人民，人，民，共和国，共和，和，国国，国歌”，会穷尽各种可能的组合，适合 Term Query</p>
<p><img src="https://qiniu.xiaoming.net.cn/ik_max_word.jpg" srcset="/img/loading.gif" lazyload alt="ik_max_word"></p>
</li>
<li><p><code>ik_smart</code>：会做最粗粒度的分割，细分为“中华人民共和国国歌”分割为“中华人民共和国，国歌”，适合词组查询。</p>
<p><img src="https://qiniu.xiaoming.net.cn/ik_smart.jpg" srcset="/img/loading.gif" lazyload alt="ik_smart"></p>
</li>
</ul>
<p>另外，对于一些词语可能分词器没发识别，比如名字，可以自己定义配置文件：</p>
<p><code>IKAnalyzer.cfg.xml</code>文件存在于 ElasticSearch 的配置文件目录或者插件中 IK 的配置目录中，配置项如下：</p>
<figure class="highlight xml"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-meta">&lt;!DOCTYPE properties SYSTEM "http://java.sun.com/dtd/properties.dtd"&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">properties</span>&gt;</span><br>	<span class="hljs-tag">&lt;<span class="hljs-name">comment</span>&gt;</span>IK Analyzer 扩展配置<span class="hljs-tag">&lt;/<span class="hljs-name">comment</span>&gt;</span><br>	<span class="hljs-comment">&lt;!--用户可以在这里配置自己的扩展字典 --&gt;</span><br>	<span class="hljs-tag">&lt;<span class="hljs-name">entry</span> <span class="hljs-attr">key</span>=<span class="hljs-string">"ext_dict"</span>&gt;</span>custom/mydict.dic;custom/single_word_low_freq.dic<span class="hljs-tag">&lt;/<span class="hljs-name">entry</span>&gt;</span><br>	 <span class="hljs-comment">&lt;!--用户可以在这里配置自己的扩展停止词字典--&gt;</span><br>	<span class="hljs-tag">&lt;<span class="hljs-name">entry</span> <span class="hljs-attr">key</span>=<span class="hljs-string">"ext_stopwords"</span>&gt;</span>custom/ext_stopword.dic<span class="hljs-tag">&lt;/<span class="hljs-name">entry</span>&gt;</span><br> 	<span class="hljs-comment">&lt;!--用户可以在这里配置远程扩展字典 --&gt;</span><br>	<span class="hljs-tag">&lt;<span class="hljs-name">entry</span> <span class="hljs-attr">key</span>=<span class="hljs-string">"remote_ext_dict"</span>&gt;</span>location<span class="hljs-tag">&lt;/<span class="hljs-name">entry</span>&gt;</span><br> 	<span class="hljs-comment">&lt;!--用户可以在这里配置远程扩展停止词字典--&gt;</span><br>	<span class="hljs-tag">&lt;<span class="hljs-name">entry</span> <span class="hljs-attr">key</span>=<span class="hljs-string">"remote_ext_stopwords"</span>&gt;</span>http://xxx.com/xxx.dic<span class="hljs-tag">&lt;/<span class="hljs-name">entry</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">properties</span>&gt;</span><br></code></pre></div></td></tr></table></figure>

<p>然后只需要自己创建一个 <code>dic</code>文件，直接写入定义的词语即可，比如 <code>study_test.dic</code>：</p>
<figure class="highlight plain"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs plain">啊巴啊巴<br></code></pre></div></td></tr></table></figure>

<h1 id="数据操作"><a href="#数据操作" class="headerlink" title="数据操作"></a>数据操作</h1><p>ElasticSearch 的数据操作使用 RestFul 风格的接口设计，可以使用 curl 发送操作请求，也可以直接在 Cabana 操作。</p>
<p>ElasticSearch 主要有以下几种操作：</p>
<table>
<thead>
<tr>
<th>method</th>
<th>url地址</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>PUT</td>
<td>localhost:9200/索引名称/类型名称/文档id</td>
<td>创建文档（指定文档id）</td>
</tr>
<tr>
<td>POST</td>
<td>localhost:9200/索引名称/类型名称/</td>
<td>创建文档（随机文档id）</td>
</tr>
<tr>
<td>POST</td>
<td>localhost:9200/索引名称/类型名称/文档id/_update</td>
<td>修改文档</td>
</tr>
<tr>
<td>DELETE</td>
<td>localhost:9200/索引名称/类型名称/文档id</td>
<td>删除文档</td>
</tr>
<tr>
<td>GET</td>
<td>localhost:9200/索引名称/类型名称/文档id</td>
<td>通过文档id查询文档</td>
</tr>
<tr>
<td>POST</td>
<td>localhost:9200/索引名称/类型名称/_search</td>
<td>查询所有数据</td>
</tr>
</tbody></table>
<h2 id="新增操作"><a href="#新增操作" class="headerlink" title="新增操作"></a>新增操作</h2><figure class="highlight dts"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs dts"><span class="hljs-comment">// RestFul风格，到哪个url目录就修改哪个级别（索引、类型、文档）</span><br>PUT /索引名/类型名（未来删除）/文档<span class="hljs-class">id<br></span>&#123;请求体&#125;<br></code></pre></div></td></tr></table></figure>

<figure class="highlight"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs json">PUT /test1/type1/1<br>&#123;<br>  "name":"silverming",<br>  "age":10<br>&#125;<br></code></pre></div></td></tr></table></figure>

<p>对于类型名，由于这个其实现在使用的情况不多，渐渐被淘汰，默认采用 <code>_doc</code> 替代，即 <code>PUT /test2/_doc/1</code></p>
<h3 id="关于映射关系"><a href="#关于映射关系" class="headerlink" title="关于映射关系"></a>关于映射关系</h3><p>Mapping 主要用于定义索引的字段名称和数据类型以及倒排索引等相关配置，Mapping 可以系统自动推断生成，也可以由用户自己定义：</p>
<figure class="highlight"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs json">PUT /test3<br>//该索引包含三个字段<br>//name，类型是 long，不支持索引搜索<br>//phone，类型是 keyword，对于值为空的情况可以使用"NULL"字符串来搜索<br>//name，类型是 text，并定义了索引级别，以及自定义的分词器<br>&#123;<br>  "mappings" : &#123;<br>      "properties" : &#123;<br>        "id" : &#123;<br>          "type" : "long",<br>          "index": false<br>        &#125;,<br>        "name" : &#123;<br>          "type" : "text",<br>          "index_options": "positions",<br>          "copy_to": "fullName",<br>          "fields": &#123;<br>            "english_comment":&#123;<br>              "type": "text",<br>              "analyzer": "english",<br>              "search_analyzer": "english"<br>            &#125;<br>          &#125;<br>        &#125;,<br>        "phone" : &#123;<br>          "type" : "keyword",<br>          "null_value": "NULL"<br>        &#125;<br>      &#125;<br>    &#125;<br>&#125;<br></code></pre></div></td></tr></table></figure>

<p>mapping 具有以下这些字段属性：</p>
<ul>
<li>type：字段的数据类型，并没有提供专门数组类型，通过 TEXT 字段实现，Elasticsearch 主要支持以下几种数据类型：</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs text">- Text：默认情况下会进行分词，会被分词器解析<br>- Keyword：不会进行分词，全文本匹配，不会被分词器解析<br>- Date：日期类型<br>- Integer/Floating：整数/浮点数<br>- Boolean：布尔类型<br>- IPv4 &amp; IPv6<br>- 特殊类型：geo_point &amp; geo_shape &amp; percolator<br></code></pre></div></td></tr></table></figure>

<ul>
<li>index：表示该字段是否可以被搜索，是否需要建立倒排索引</li>
<li>index_options 属性：控制倒排索引记录的内容，内容越多，占用空间越大，text 类型默认是 positions，其它默认是 docs</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs text">- docs: 记录 docId<br>- freqs：记录 docId 和 term frequencies<br>- positions：记录 docId 和 term frequencies 和 term postion<br>- offsets：记录 docId 和 term frequencies 和 term postion 和 character offsets<br></code></pre></div></td></tr></table></figure>

<ul>
<li>null_value：默认情况下 null 是无法被直接搜索的，如果需要对 Null 值进行搜索，可以设置该属性，表示 null 值被当成什么来搜索</li>
<li>copy_to：将值拷贝到对应的字段上，多个字段可以同时 copy_to 到同一个字段上，用于对于多个字段同时查询，目标字段不会出现在 mapping 的定义中，但是可以用于搜索</li>
<li>fields: 多字段特性，可以增加一个 keyword 字段，可以为搜索和索引指定不同的分词器等</li>
</ul>
<h2 id="删除操作"><a href="#删除操作" class="headerlink" title="删除操作"></a>删除操作</h2><p>使用 <code>DELETE</code> 命令。</p>
<h2 id="修改操作"><a href="#修改操作" class="headerlink" title="修改操作"></a>修改操作</h2><p>关于修改操作，可以直接使用 PUT 命令，但是有时候如果只需要更新个别字段，需要将原有字段的值也写上，否则原有的会被删除。</p>
<p>更好的办法是使用 <code>POST</code> 命令，在后面加上<code>/_update</code>，就可以直接修改相应的值。</p>
<blockquote>
<p>不加 <code>/update</code> 会跟 PUT 效果一样 </p>
</blockquote>
<figure class="highlight"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs json">//"doc"要加上<br>POST /test1/_doc/1/_update<br>&#123;<br>  "doc":&#123;<br>    "birth":"1998-02-25"<br>  &#125;<br>&#125;<br></code></pre></div></td></tr></table></figure>

<h2 id="查询操作"><a href="#查询操作" class="headerlink" title="查询操作"></a>查询操作</h2><p>使用 <code>GET</code> 命令或者 <code>POST</code>命令加后缀 <code>/_search</code> 进行查询。url 具体到文档 id 就可以查到数据，到索引只会显示索引的信息。</p>
<figure class="highlight"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs json">GET /user/_doc/1<br></code></pre></div></td></tr></table></figure>

<p>对于搜索可以使用条件搜索：</p>
<h3 id="基础条件查询"><a href="#基础条件查询" class="headerlink" title="基础条件查询"></a>基础条件查询</h3><p>对于模糊匹配查询，可以使用 <code>match</code> 查询，<code>_source</code> 可以指定需要查询出来的字段，<code>sort</code> 可以对查询结果进行排序，使用 <code>order</code> 进行排序规则说明（asc、desc），<code>from</code>和 <code>size</code> 用于范围查找。</p>
<figure class="highlight"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs json"># match 会使用分词器解析，先分析分档，然后通过分析的文档进行查询<br>GET user/_doc/_search<br>&#123;<br>  "query":&#123;<br>    "match":&#123;<br>      "name":"xxx"<br>    &#125;<br>  &#125;,<br>  "_source":["name","dsec","age"],<br>  "sort":[<br>    &#123;<br>      "age":&#123;<br>        "order":"asc"<br>      &#125;<br>    &#125;<br>  ],<br>  "from":0,<br>  "size":1<br>&#125;<br><br># 对于搜索的内容，多个内容可以使用空格隔开，只要满足其中一个结果既可以被查出来，匹配度可以通过score判断<br>GET user/_search<br>&#123;<br>  "query": &#123;<br>    "match": &#123;<br>      "tags": "男 技术 猛"<br>    &#125;<br>  &#125;<br>&#125;<br></code></pre></div></td></tr></table></figure>

<h3 id="多条件查询"><a href="#多条件查询" class="headerlink" title="多条件查询"></a>多条件查询</h3><p>用 <code>bool</code> 查询可以实现多条件组合查询。这种查询将多查询组合在一起，成为用户自己想要的布尔查询。它接收以下参数：</p>
<ul>
<li><p><strong><code>must</code></strong></p>
<p>文档必须匹配这些条件才能被包含进来。</p>
</li>
<li><p><strong><code>must_not</code></strong></p>
<p>文档 必须不匹配这些条件才能被包含进来。</p>
</li>
<li><p><strong><code>should</code></strong></p>
<p>如果满足这些语句中的任意语句，将增加 <code>_score</code> ，否则，无任何影响。它们主要用于修正每个文档的相关性得分。</p>
</li>
<li><p><strong><code>filter</code></strong></p>
<p>必须匹配，但它以不评分、过滤模式来进行。这些语句对评分没有贡献，只是根据过滤标准来排除或包含文档。</p>
</li>
</ul>
<blockquote>
<p>使用 <code>must</code> 相当于 AND 条件查询，使用 <code>should</code> 相当于 OR 条件查询，使用 <code>must_not</code> 相当于 NOT IN 条件查询。</p>
</blockquote>
<figure class="highlight"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs json"># AND<br>GET user/_doc/_search<br>&#123;<br>  "query": &#123;<br>    "bool": &#123;<br>      "must": [<br>        &#123;<br>          "match": &#123;<br>            "name": "xx"<br>          &#125;<br>        &#125;,<br>        &#123;<br>          "match": &#123;<br>            "age": "12"<br>          &#125;<br>        &#125;<br>      ]<br>    &#125;<br>  &#125;<br>&#125;<br><br># OR<br>GET user/_doc/_search<br>&#123;<br>  "query": &#123;<br>    "bool": &#123;<br>      "should": [<br>        &#123;<br>          "match": &#123;<br>            "name": "xx"<br>          &#125;<br>        &#125;,<br>        &#123;<br>          "match": &#123;<br>            "age": "18"<br>          &#125;<br>        &#125;<br>      ]<br>    &#125;<br>  &#125;<br>&#125;<br><br><br># NOT IN<br>GET user/_doc/_search<br>&#123;<br>  "query": &#123;<br>    "bool": &#123;<br>      "must_not": [<br>        &#123;<br>          "match": &#123;<br>            "name": "xx"<br>          &#125;<br>        &#125;<br>      ]<br>    &#125;<br>  &#125;<br>&#125;<br></code></pre></div></td></tr></table></figure>

<h3 id="带过滤条件的查询"><a href="#带过滤条件的查询" class="headerlink" title="带过滤条件的查询"></a>带过滤条件的查询</h3><p>使用 <code>filter</code> 可以实现过滤查询，<code>range</code> 表示结果集的范围：</p>
<ul>
<li>gt ：<code>&gt;</code></li>
<li>gte：<code>&gt;=</code></li>
<li>lt：<code>&lt;</code></li>
<li>lte：<code>&lt;=</code></li>
</ul>
<figure class="highlight"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs json"># 过滤<br>GET user/_search<br>&#123;<br>  "query":&#123;<br>    "bool":&#123;<br>      "must":[<br>        &#123;<br>          "match":&#123;<br>            "name":"xx"<br>          &#125;<br>        &#125;<br>      ],<br>      "filter":&#123;<br>        "range":&#123;<br>          "age":&#123;<br>            "gte":12,<br>            "lte":17<br>          &#125;<br>        &#125;<br>      &#125;<br>    &#125;<br>  &#125;<br>&#125;<br></code></pre></div></td></tr></table></figure>

<h3 id="精确查询"><a href="#精确查询" class="headerlink" title="精确查询"></a>精确查询</h3><figure class="highlight"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs json"># 假设 mapping 定义如下：<br>PUT testdb<br>&#123;<br>  "mappings": &#123;<br>    "properties": &#123;<br>      "name":&#123;<br>        "type":"text"<br>      &#125;,<br>      "desc":&#123;<br>        "type": "keyword"<br>      &#125;<br>    &#125;<br>  &#125;<br>&#125;<br><br># 精确查询，term 查询是通过倒排索引指定的词条进行精确查找的。<br><br># name 是 text，所以会被拆分，结果可能有多个<br>GET testdb/_search<br>&#123;<br>  "query": &#123;<br>    "term": &#123;<br>      "name": "xxx"<br>    &#125;<br>  &#125;<br>&#125;<br><br># desc 是 keyword，其不会被拆分，有完全一样的才返回<br>GET testdb/_search<br>&#123;<br>  "query": &#123;<br>    "term": &#123;<br>      "desc": "梓铭学es"<br>    &#125;<br>  &#125;<br>&#125;<br></code></pre></div></td></tr></table></figure>

<p>多个值的精确匹配如下：</p>
<figure class="highlight"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs json"># 多个值精确匹配<br>PUT testdb/_doc/3<br>&#123;<br>  "t1":"22",<br>  "t2":"2020-11-24"<br>&#125;<br><br>PUT testdb/_doc/3<br>&#123;<br>  "t1":"23",<br>  "t2":"2021-11-24"<br>&#125;<br><br>GET testdb/_search<br>&#123;<br>  "query": &#123;<br>    "bool": &#123;<br>      "should": [<br>        &#123;<br>          "term": &#123;<br>            "t1": "22"<br>          &#125;<br>        &#125;,<br>        &#123;<br>          "term": &#123;<br>            "t1":  "23"<br>          &#125;<br>        &#125;<br>      ]<br>    &#125;<br>  &#125;<br>&#125;<br></code></pre></div></td></tr></table></figure>

<h2 id="高亮查询"><a href="#高亮查询" class="headerlink" title="高亮查询"></a>高亮查询</h2><figure class="highlight"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs json"># 高亮查询<br>GET user/_search<br>&#123;<br>  "query": &#123;<br>    "match": &#123;<br>      "name": "梓铭"<br>    &#125;<br>  &#125;,<br>  "highlight": &#123;<br>    "pre_tags": "&lt;p class='key' style='color:red'&gt;", <br>    "post_tags": "&lt;/p&gt;", <br>    "fields": &#123;<br>      "name": &#123;&#125;<br>    &#125;<br>  &#125;<br>&#125;<br></code></pre></div></td></tr></table></figure>

<h2 id="其他命令"><a href="#其他命令" class="headerlink" title="其他命令"></a>其他命令</h2><p> 可以通过 <code>GET _cat/...</code> 命令查看相关状态、数量、健康等很多信息。</p>
<blockquote>
<p> <strong>参考目录</strong>：</p>
<p> <a href="https://learnku.com/docs/elasticsearch73/7.3" target="_blank" rel="noopener">Elasticsearch中文文档</a></p>
<p> <a href="https://www.bilibili.com/video/BV17a4y1x7zq?from=search&seid=12148825921682017310" target="_blank" rel="noopener">B站狂神视频教程</a></p>
<p> <a href="https://zhuanlan.zhihu.com/p/128609898" target="_blank" rel="noopener">ElasticSearch 入门教程</a></p>
<p> <a href="https://zhuanlan.zhihu.com/p/104215274" target="_blank" rel="noopener">Elasticsearch 入门学习</a></p>
<p> <a href="https://www.elastic.co/guide/cn/elasticsearch/guide/current/getting-started.html" target="_blank" rel="noopener">Elasticsearch 权威指南</a></p>
</blockquote>

            </div>
            <hr>
            <div>
              <div class="post-metas mb-3">
                
                
                  <div class="post-meta">
                    <i class="iconfont icon-tags"></i>
                    
                      <a class="hover-with-bg" href="/tags/ElasticSearch/">ElasticSearch</a>
                    
                  </div>
                
              </div>
              
                <p class="note note-warning">
                  
                    本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-sa/4.0/deed.zh" target="_blank" rel="nofollow noopener noopener">CC BY-SA 4.0 协议</a> ，转载请注明出处！
                  
                </p>
              
              
                <div class="post-prevnext">
                  <article class="post-prev col-6">
                    
                    
                      <a href="/2020/11/25/Elasticsearch%20%E5%80%92%E6%8E%92%E7%B4%A2%E5%BC%95/">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">Elasticsearch 倒排索引原理</span>
                        <span class="visible-mobile">上一篇</span>
                      </a>
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/2020/08/20/go%20%E5%AE%9E%E7%94%A8%E4%BB%A3%E7%A0%81%E7%89%87%E6%AE%B5%E5%92%8C%E6%B3%A8%E6%84%8F%E4%BA%8B%E9%A1%B9/">
                        <span class="hidden-mobile">go 实用代码片段和注意事项</span>
                        <span class="visible-mobile">下一篇</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
              <!-- Comments -->
              <article class="comments" id="comments" lazyload>
                
                  
                
                
  <script type="text/javascript">
    Fluid.utils.lazyComments('comments', function() {
      var light = 'github-light';
      var dark = 'github-dark';
      var schema = document.documentElement.getAttribute('data-user-color-scheme');
      if (schema === 'dark') {
        schema = dark;
      } else {
        schema = light;
      }
      window.UtterancesThemeLight = light;
      window.UtterancesThemeDark = dark;
      var s = document.createElement('script');
      s.setAttribute('src', 'https://utteranc.es/client.js');
      s.setAttribute('repo', 'xiao-ming9/xiao-ming9.github.io');
      s.setAttribute('issue-term', 'pathname');
      
      s.setAttribute('label', 'utterances');
      
      s.setAttribute('theme', schema);
      s.setAttribute('crossorigin', 'anonymous');
      document.getElementById('comments').appendChild(s);
    })
  </script>
  <noscript>Please enable JavaScript to view the comments</noscript>


              </article>
            
          </article>
        </div>
      </div>
    </div>
    
      <div class="d-none d-lg-block col-lg-2 toc-container" id="toc-ctn">
        <div id="toc">
  <p class="toc-header"><i class="iconfont icon-list"></i>&nbsp;目录</p>
  <div class="toc-body" id="toc-body"></div>
</div>

      </div>
    
  </div>
</div>

<!-- Custom -->


    

    
      <a id="scroll-top-button" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">搜索</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v"
                 for="local-search-input">关键词</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>
    

    
  </main>

  <footer class="text-center mt-5 py-3">
  <div class="footer-content">
     <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a> 
  </div>
  
  <div class="statistics">
    
    

    
      
        <!-- LeanCloud 统计PV -->
        <span id="leancloud-site-pv-container" style="display: none">
            总访问量 
            <span id="leancloud-site-pv"></span>
             次
          </span>
      
      
        <!-- LeanCloud 统计UV -->
        <span id="leancloud-site-uv-container" style="display: none">
            总访客数 
            <span id="leancloud-site-uv"></span>
             人
          </span>
      

    
  </div>


  
  <!-- 备案信息 -->
  <div class="beian">
    <span>
      <a href="http://beian.miit.gov.cn/" target="_blank" rel="nofollow noopener">
        粤ICP备18114217号
      </a>
    </span>
    
      
        <span>
          <a
            href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=粤ICP备18114217号-1"
            rel="nofollow noopener"
            class="beian-police"
            target="_blank"
          >
            
              <span style="visibility: hidden; width: 0">|</span>
              <img src="/img/police_beian.png" srcset="/img/loading.gif" lazyload alt="police-icon"/>
            
            <span>粤ICP备18114217号-1</span>
          </a>
        </span>
      
    
  </div>


  
</footer>


  <!-- SCRIPTS -->
  
  <script  src="https://cdn.jsdelivr.net/npm/nprogress@0.2.0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/nprogress@0.2.0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.min.js" ></script>
<script  src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/js/bootstrap.min.js" ></script>
<script  src="/js/debouncer.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>

<!-- Plugins -->


  
    <script  src="/js/img-lazyload.js" ></script>
  



  



  <script  src="https://cdn.jsdelivr.net/npm/tocbot@4.12.0/dist/tocbot.min.js" ></script>



  <script  src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.js" ></script>



  <script  src="https://cdn.jsdelivr.net/npm/anchor-js@4.3.0/anchor.min.js" ></script>



  <script defer src="https://cdn.jsdelivr.net/npm/clipboard@2.0.6/dist/clipboard.min.js" ></script>




  <script defer src="/js/leancloud.js" ></script>



  <script  src="https://cdn.jsdelivr.net/npm/typed.js@2.0.11/lib/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var title = document.getElementById('subtitle').title;
      
      typing(title)
      
    })(window, document);
  </script>



  <script  src="/js/local-search.js" ></script>
  <script>
    (function () {
      var path = "/local-search.xml";
      $('#local-search-input').on('click', function() {
        searchFunc(path, 'local-search-input', 'local-search-result');
      });
      $('#modalSearch').on('shown.bs.modal', function() {
        $('#local-search-input').focus();
      });
    })()
  </script>












  
    <!-- Baidu Analytics -->
    <script defer>
      var _hmt = _hmt || [];
      (function () {
        var hm = document.createElement("script");
        hm.src = "https://hm.baidu.com/hm.js?54ebb03ad7ad5b762ac8ff7958df6d3f";
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(hm, s);
      })();
    </script>
  

  
    <!-- Google Analytics -->
    <script defer>
      window.ga = window.ga || function () { (ga.q = ga.q || []).push(arguments) };
      ga.l = +new Date;
      ga('create', 'G-M2RT7SDT3L', 'auto');
      ga('send', 'pageview');
    </script>
    <script async src='https://www.google-analytics.com/analytics.js'></script>
  

  
    <!-- Google gtag.js -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-M2RT7SDT3L"></script>
    <script defer>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-M2RT7SDT3L');
    </script>
  

  

  

  





<!-- 主题的启动项 保持在最底部 -->
<script  src="/js/boot.js" ></script>


<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
        tex2jax: {
            inlineMath: [ ["$","$"], ["\\(","\\)"] ],
            skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code'],
            processEscapes: true
        }
    });
    MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax();
        for (var i = 0; i < all.length; ++i)
            all[i].SourceElement().parentNode.className += ' has-jax';
    });
</script>
<script src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
</body>
</html>
