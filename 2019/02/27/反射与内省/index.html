<!DOCTYPE html><html class="appearance-auto" lang="zh-CN"><head><meta charset="UTF-8"><title>java反射与内省</title><meta name="description" content="Wechat:934933088"><meta name="viewport" content="width=device-width, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no, initial-scale=1"><!-- Google Analytics --><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q || []).push(arguments)},i[r].l=1 * new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

ga('create', 'G-M2RT7SDT3L', 'auto');
ga('send', 'pageview');</script><!-- End Google Analytics -->
<!-- Baidu Analytics --><script>var _hmt = _hmt || [];
(function() {
var hm = document.createElement("script");
hm.src = "//hm.baidu.com/hm.js?" + '54ebb03ad7ad5b762ac8ff7958df6d3f';
var s = document.getElementsByTagName("script")[0];
s.parentNode.insertBefore(hm, s);
})();</script><!-- End Baidu Analytics --><link rel="icon" href="https://qiniu.xiaoming.net.cn/%E5%8D%9A%E5%AE%A2icon.jpeg"><link rel="stylesheet" href="/style/common/bulma.css"><link rel="stylesheet" href="/style/base.css"><link rel="stylesheet" href="/style/common/helper.css"><script src="/js/common.js"></script><link rel="stylesheet" href="/style/post.css"><link rel="stylesheet" href="/style/themes/highlight-theme-light.css"><script src="/js/highlight.pack.js"></script><meta name="description" content="反射通过程序运行时信息来获取类或对象的类信息获取Class对象的三种方法
Class class = dog.getCalss();
Class class = Dog.class;
Class class = Class.forName(&amp;quot;com.vince.Dog&amp;quot;);//会有ClassNotFoundExeception

通过反射实例化对象和获取对象信息
package reflection;

import java.lang.reflect.*;

public class ReflectionDemo {

    public static void main(String[] args) {
        Dog dog = new Dog(&amp;quot;dabao&amp;q.."></head><body class="is-flex is-flex-direction-column"><header class="header-widget is-flex-shrink-0 is-hidden-mobile"><div class="container is-fullhd is-flex is-justify-content-space-between is-align-items-center is-full-height"><section class="is-hidden-mobile is-flex-shrink-0"><h2><a href="/">silverming's blog</a></h2></section><h3 class="is-hidden-mobile is-family-serif is-full-height is-flex is-align-items-center is-flex-shrink-0"><div class="is-full-height" id="postTopic"><p class="is-full-height is-flex-shrink-0 is-flex is-align-items-center is-justify-content-center">java反射与内省</p><p class="is-full-height is-flex-shrink-0 is-flex is-align-items-center is-justify-content-center">点击返回顶部</p></div></h3><aside class="is-flex-shrink-0"><h3 class="is-inline-block"><a href="/">首页</a></h3><h3 class="is-inline-block"><a href="/about">关于</a></h3><h3 class="is-inline-block"><a href="/archives">归档</a></h3></aside></div></header><header class="is-flex header-widget is-flex-shrink-0 is-align-items-center is-justify-content-center is-hidden-tablet"><h3 class="is-inline-block"><a href="/">首页</a></h3><h3 class="is-inline-block"><a href="/about">关于</a></h3><h3 class="is-inline-block"><a href="/archives">归档</a></h3></header><main><main class="container is-max-widescreen content section post-page pt-4 px-4"><div class="columns is-flex-desktop is-justify-content-center is-flex-direction-row-reverse"><div class="column is-3 is-hidden-mobile"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#反射"><span class="toc-text">反射</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#内省"><span class="toc-text">内省</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#AOP编程"><span class="toc-text">AOP编程</span></a></li></ol></div><div class="column is-9"><header class="my-4"><a href="/tags/java"><i class="tag post-item-tag">java</i></a></header><h1 class="mt-0 mb-1 is-family-serif" id="postTitle">java反射与内省</h1><time class="has-text-grey" datetime="2019-02-27T13:55:58.000Z">2019-02-27</time><article class="mt-2 post-content"><h1 id="反射"><a href="#反射" class="headerlink" title="反射"></a>反射</h1><p>通过程序运行时信息来获取类或对象的类信息<br><strong>获取Class对象的三种方法</strong></p>
<pre><code class="java">Class class = dog.getCalss();
Class class = Dog.class;
Class class = Class.forName(&quot;com.vince.Dog&quot;);//会有ClassNotFoundExeception</code></pre>
<a id="more"></a>
<p><strong>通过反射实例化对象和获取对象信息</strong></p>
<pre><code class="java">package reflection;

import java.lang.reflect.*;

public class ReflectionDemo {

    public static void main(String[] args) {
        Dog dog = new Dog(&quot;dabao&quot;,5,&quot;白色&quot;,&quot;藏獒&quot;);
        Class dogClass = dog.getClass();
        //通过反射实例化对象
        try {
            //Dog inflectDog = (Dog)dogClass.newInstance(&quot;dwr&quot;);//jdk1.9之后不推荐使用
            Dog inflectDog = (Dog)dogClass.getDeclaredConstructor(String.class, int.class, String.class, String.class).newInstance(&quot;xiaobai&quot;,3,&quot;黑色&quot;,&quot;咖啡毛&quot;);
        } catch (InstantiationException e) {
            e.printStackTrace();
        } catch (IllegalAccessException e) {
            e.printStackTrace();
        } catch (NoSuchMethodException e) {
            e.printStackTrace();
        } catch (InvocationTargetException e) {
            e.printStackTrace();
        }

        //获取构造方法
        Constructor[] constructors = dogClass.getConstructors();//获取所有构造方法
        for (int i = 0; i &lt; constructors.length; i++) {
            System.out.println(constructors[i].getName());//构造参数名
            System.out.println(constructors[i].getParameterCount());//参数数目
        }
        try {
            Constructor constructor = dogClass.getConstructor(String.class, int.class, String.class, String.class);//根据变量类型获取指定的构造方法
            //之后就可以调用上面的newInstance方法实例化一个对象
        } catch (NoSuchMethodException e) {
            e.printStackTrace();
        }

        //获取类中的所有属性
        Field[] fields = dogClass.getFields();//获取所有非private的属性
        System.out.println(fields.length);
        Field[] declaredFields = dogClass.getDeclaredFields();//获取所有属性
        System.out.println(declaredFields.length);
        for (int i = 0; i &lt; declaredFields.length; i++) {
            int modifiers = declaredFields[i].getModifiers();
            System.out.println(Modifier.toString(modifiers)+&quot; &quot;+declaredFields[i].getType()+&quot; &quot;+declaredFields[i].getName());
        }

        //获取包对象的包信息
        Package aPackage = dogClass.getPackage();
        System.out.println(aPackage.getName());

        //获取方法
        //获取所有非private方法，包括父类的方法
        Method[] methods = dogClass.getMethods();
        for (int i = 0; i &lt; methods.length; i++) {
            System.out.println(methods[i]);
            if(methods[i].getName().equals(&quot;toString&quot;)){
                try {
                    String s = (String)methods[i].invoke(dog);//调用方法
                    System.out.println(s);
                } catch (IllegalAccessException e) {
                    e.printStackTrace();
                } catch (InvocationTargetException e) {
                    e.printStackTrace();
                }
            }
        }
        System.out.println(&quot;-------------&quot;);
        //获取当前类的所有方法（包括private），不包括父类
        Method[] methods1 = dogClass.getDeclaredMethods();
        for (int i = 0; i &lt; methods1.length; i++) {
            System.out.println(methods1[i]);
            if(methods1[i].getName().equals(&quot;set&quot;)){
                //设置私有方法可以被访问（去除访问修饰符的检查）
                methods1[i].setAccessible(true);
                try {
                    methods1[i].invoke(dog);
                } catch (IllegalAccessException e) {
                    e.printStackTrace();
                } catch (InvocationTargetException e) {
                    e.printStackTrace();
                }
            }
        }
    }
}
</code></pre>
<h1 id="内省"><a href="#内省" class="headerlink" title="内省"></a>内省</h1><p>Java中提供的一套用来访问某个属性的getter/setter方法的API</p>
<p><strong>读取配置文件案例</strong></p>
<pre><code class="java">package instrospector;
//配置类
public class Config {
    private String username;
    private String password;
    private String url;

    public String getUsername() {
        return username;
    }

    public void setUsername(String name) {
        this.username = name;
    }

    public String getPassword() {
        return password;
    }

    public void setPassword(String password) {
        this.password = password;
    }

    public String getUrl() {
        return url;
    }

    public void setUrl(String url) {
        this.url = url;
    }

    @Override
    public String toString() {
        return &quot;Config{&quot; +
                &quot;username=&#39;&quot; + username + &#39;\&#39;&#39; +
                &quot;, password=&#39;&quot; + password + &#39;\&#39;&#39; +
                &quot;, url=&#39;&quot; + url + &#39;\&#39;&#39; +
                &#39;}&#39;;
    }
}

//配置文件config.properties
bean.name= instrospector.Config
bean.username = hello
bean.password = 123
bean.url = http://www.xiaoming.net.cn

package instrospector;
//读取配置文件的工厂
import java.beans.BeanInfo;
import java.beans.IntrospectionException;
import java.beans.Introspector;
import java.beans.PropertyDescriptor;
import java.io.IOException;
import java.io.InputStream;
import java.lang.reflect.InvocationTargetException;
import java.lang.reflect.Method;
import java.util.Properties;

public class BeanFactory {
    private static Properties prop = new Properties();
    //使用静态代码块读取配置文件
    static{
        InputStream in = Thread.currentThread().getContextClassLoader()
                .getResourceAsStream(&quot;instrospector/config.properties&quot;);
        try {
            prop.load(in);//加载文件
        } catch (IOException e) {
            e.printStackTrace();
        }
    }

    /**
     * 获取一个Bean
     * @param name
     * @return
     */
    public static Object getBean(String name){
        Object bean = null;
        String beanName = prop.getProperty(name);
        try {
            Class&lt;?&gt; aClass = Class.forName(beanName);
            bean = aClass.getDeclaredConstructor().newInstance();
            //通过类信息获取javaBean的描述信息
            BeanInfo beanInfo = Introspector.getBeanInfo(aClass);
            //通过javaBean的描述信息，获取该类的所有属性描述器
            PropertyDescriptor[] propertyDescriptors = beanInfo.getPropertyDescriptors();
            for (int i = 0; i &lt; propertyDescriptors.length; i++) {
                //获取属性名
                String propertyName = propertyDescriptors[i].getName();
                //获取某个属性的写方法
                Method writeMethod = propertyDescriptors[i].getWriteMethod();
                if(&quot;username&quot;.equals(propertyName)){
                    writeMethod.invoke(bean,prop.getProperty(&quot;bean.username&quot;));
                }else if(&quot;password&quot;.equals(propertyName)){
                    writeMethod.invoke(bean,prop.getProperty(&quot;bean.password&quot;));
                }else if(&quot;url&quot;.equals(propertyName)){
                    writeMethod.invoke(bean,prop.getProperty(&quot;bean.url&quot;));
                }
            }
        } catch (ClassNotFoundException e) {
            e.printStackTrace();
        } catch (IntrospectionException e) {
            e.printStackTrace();
        } catch (IllegalAccessException e) {
            e.printStackTrace();
        } catch (InstantiationException e) {
            e.printStackTrace();
        } catch (NoSuchMethodException e) {
            e.printStackTrace();
        } catch (InvocationTargetException e) {
            e.printStackTrace();
        }
        return bean;
    }
}

package instrospector;
//测试
public class BeanTest {
    public static void main(String[] args) {
        Config bean = (Config)BeanFactory.getBean(&quot;bean.name&quot;);
        System.out.println(bean);
    }
}</code></pre>
<h1 id="AOP编程"><a href="#AOP编程" class="headerlink" title="AOP编程"></a>AOP编程</h1><p>面向切面编程，将一些与业务代码无关的代码放在另外的一个地方，让业务代码执行的时候跟着执行</p>
<pre><code class="java">//业务接口
public interface IManager {
    public void add(String item);
}

import java.util.ArrayList;
//业务内容
public class IManagerImpl implements IManager{
    private ArrayList&lt;String&gt; list = new ArrayList&lt;&gt;();
    @Override
    public void add(String item) {
        list.add(item);
    }
}

//通知（切面内容）
public interface Advice {
    public void beforeAdvice();
    public void afterAdvice();
}

//切面内容实现类
public class LogAdvice implements Advice{

    @Override
    public void beforeAdvice() {
        System.out.println(&quot;start time:&quot;+System.currentTimeMillis());
    }

    @Override
    public void afterAdvice() {
        System.out.println(&quot;end time:&quot;+System.currentTimeMillis());
    }
}

//配置文件
bean.target = aop.IManagerImpl
bean.advice = aop.LogAdvice
bean = aop.ProxyFactoryBean

//动态代理类
import java.lang.reflect.InvocationHandler;
import java.lang.reflect.Method;
import java.lang.reflect.Proxy;

public class ProxyFactoryBean implements InvocationHandler {
    private Object target;//业务对象
    private Advice advice;//切面对象

    public Object getTarget() {
        return target;
    }

    public void setTarget(Object target) {
        this.target = target;
    }

    public Advice getAdvice() {
        return advice;
    }

    public void setAdvice(Advice advice) {
        this.advice = advice;
    }

    /**
     * 获取代理对象
     */
    public Object getProxy(){
        Object proxy = Proxy.newProxyInstance(
                target.getClass().getClassLoader(),
                target.getClass().getInterfaces(),
                this);
        return proxy;
    }

    @Override
    public Object invoke(Object proxy, Method method, Object[] args) throws Throwable {
        advice.beforeAdvice();
        Object object = method.invoke(target,args);
        advice.afterAdvice();
        return object;
    }
}

//代理类的处理加工工厂
import java.beans.BeanInfo;
import java.beans.IntrospectionException;
import java.beans.Introspector;
import java.beans.PropertyDescriptor;
import java.io.IOException;
import java.io.InputStream;
import java.lang.reflect.InvocationTargetException;
import java.lang.reflect.Method;
import java.util.Properties;

public class BeanFactory {
    private Properties prop = new Properties();

    //读取配置文件
    public BeanFactory(InputStream in){
        try {
            prop.load(in);
        } catch (IOException e) {
            e.printStackTrace();
        }
    }

    /**
     * 获取一个bean实例
     * @param name
     * @return
     */
    public Object getBean(String name){
        String className = prop.getProperty(name);
        Object bean = null;
        try {
            //获取ProxyFactoryBean的class对象
            Class&lt;?&gt; aClass = Class.forName(className);//创建一个代理类
            bean = aClass.getDeclaredConstructor().newInstance();

            //根据配置文件实例化target，advice对象
            Object target = Class.forName(prop.getProperty(name+&quot;.target&quot;)).getDeclaredConstructor().newInstance();
            Object advice = Class.forName(prop.getProperty(name+&quot;.advice&quot;)).getDeclaredConstructor().newInstance();
            //通过内省获取代理类属性信息
            BeanInfo beanInfo = Introspector.getBeanInfo(aClass);
            PropertyDescriptor[] propertyDescriptors = beanInfo.getPropertyDescriptors();
            for(PropertyDescriptor pd:propertyDescriptors){
                String propertyName = pd.getName();
                Method writeMethod = pd.getWriteMethod();
                if(&quot;target&quot;.equals(propertyName)){
                    writeMethod.invoke(bean,target);
                }else if(&quot;advice&quot;.equals(propertyName)){
                    writeMethod.invoke(bean,advice);
                }
            }
        } catch (ClassNotFoundException e) {
            e.printStackTrace();
        } catch (IllegalAccessException e) {
            e.printStackTrace();
        } catch (InstantiationException e) {
            e.printStackTrace();
        } catch (NoSuchMethodException e) {
            e.printStackTrace();
        } catch (InvocationTargetException e) {
            e.printStackTrace();
        } catch (IntrospectionException e) {
            e.printStackTrace();
        }

        return bean;
    }

}

//测试
import java.io.InputStream;
public class AOPTest {
    public static void main(String[] args) {
        //读取配置文件
        InputStream in = Thread.currentThread().getContextClassLoader().getResourceAsStream(&quot;aop/bean.properties&quot;);
        //创建Bean的工厂对象
        BeanFactory beanFactory = new BeanFactory(in);
        //获取代理对象
        ProxyFactoryBean proxyFactoryBean = (ProxyFactoryBean)beanFactory.getBean(&quot;bean&quot;);
        IManager proxy = (IManager) proxyFactoryBean.getProxy();//反射得到的代理实例
        proxy.add(&quot;我是一只猫&quot;);
    }
}</code></pre>
</article><section class="jump-container is-flex is-justify-content-space-between my-6"><!-- em is empty placeholder--><a class="button is-default" href="/2019/03/02/%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F/" title="正则表达式"><i class="iconfont icon-prev mr-2 has-text-grey"></i><span class="has-text-weight-semibold">上一页: 正则表达式</span></a><a class="button is-default" href="/2019/02/25/java%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B/" title="java网络编程"><span class="has-text-weight-semibold">下一页: java网络编程</span><i class="iconfont icon-next ml-2 has-text-grey"></i></a></section><article class="mt-6 comment-container"><script async repo="xiao-ming9/xiao-ming9.github.io" src="https://utteranc.es/client.js" issue-term="pathname" theme="preferred-color-scheme"></script></article></div></div></main></main><footer class="is-flex is-flex-direction-column is-align-items-center is-flex-shrink-0 is-family-serif"><section class="sns-container"><!-- Github--><!-- Ins--><!-- RSS--><!-- 知乎--><!-- 领英--><!-- 脸书--></section><p><span>Copyright ©</span><span> silverming 2021</span></p><div class="is-flex is-justify-content-center is-flex-wrap-wrap"><p>Powered by Hexo &verbar;&nbsp;</p><p class="is-flex is-justify-content-center"><a title="Hexo theme author" href="//github.com/haojen">Theme by Haojen&nbsp;</a></p><div style="margin-top: 2px"><a class="github-button" title="github-button" href="https://github.com/haojen/hexo-theme-Claudia" target="_blank" rel="noopener" data-color-scheme="no-preference: light; light: light; dark: dark;" data-show-count="true"></a></div></div><div><span><a href="https://beian.miit.gov.cn/" target="_blank">粤ICP备18114217号</a></span></div></footer><script async defer src="https://buttons.github.io/buttons.js"></script><script src="/js/post.js"></script></body></html>