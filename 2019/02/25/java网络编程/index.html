<!DOCTYPE html><html class="appearance-auto" lang="zh-CN"><head><meta charset="UTF-8"><title>java网络编程</title><meta name="description" content="Wechat:934933088"><meta name="viewport" content="width=device-width, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no, initial-scale=1"><!-- Google Analytics --><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q || []).push(arguments)},i[r].l=1 * new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

ga('create', 'G-M2RT7SDT3L', 'auto');
ga('send', 'pageview');</script><!-- End Google Analytics -->
<!-- Baidu Analytics --><script>var _hmt = _hmt || [];
(function() {
var hm = document.createElement("script");
hm.src = "//hm.baidu.com/hm.js?" + '54ebb03ad7ad5b762ac8ff7958df6d3f';
var s = document.getElementsByTagName("script")[0];
s.parentNode.insertBefore(hm, s);
})();</script><!-- End Baidu Analytics --><link rel="icon" href="https://qiniu.xiaoming.net.cn/%E5%8D%9A%E5%AE%A2%E5%9B%BE%E6%A0%87.jpeg"><link rel="stylesheet" href="/style/common/bulma.css"><link rel="stylesheet" href="/style/base.css"><link rel="stylesheet" href="/style/common/helper.css"><script src="/js/common.js"></script><link rel="stylesheet" href="/style/post.css"><link rel="stylesheet" href="/style/themes/highlight-theme-light.css"><script src="/js/highlight.pack.js"></script></head><body class="is-flex is-flex-direction-column"><header class="header-widget is-flex-shrink-0 is-hidden-mobile"><div class="container is-fullhd is-flex is-justify-content-space-between is-align-items-center is-full-height"><section class="is-hidden-mobile is-flex-shrink-0"><h2><a href="/">silverming's blog</a></h2></section><h3 class="is-hidden-mobile is-family-serif is-full-height is-flex is-align-items-center is-flex-shrink-0"><div class="is-full-height" id="postTopic"><p class="is-full-height is-flex-shrink-0 is-flex is-align-items-center is-justify-content-center">java网络编程</p><p class="is-full-height is-flex-shrink-0 is-flex is-align-items-center is-justify-content-center">点击返回顶部</p></div></h3><aside class="is-flex-shrink-0"><h3 class="is-inline-block"><a href="/">首页</a></h3><h3 class="is-inline-block"><a href="/about">关于</a></h3><h3 class="is-inline-block"><a href="/archives">归档</a></h3></aside></div></header><header class="is-flex header-widget is-flex-shrink-0 is-align-items-center is-justify-content-center is-hidden-tablet"><h3 class="is-inline-block"><a href="/">首页</a></h3><h3 class="is-inline-block"><a href="/about">关于</a></h3><h3 class="is-inline-block"><a href="/archives">归档</a></h3></header><main><main class="container is-max-widescreen content section post-page pt-4 px-4"><div class="columns is-flex-desktop is-justify-content-center is-flex-direction-row-reverse"><div class="column is-3 is-hidden-mobile"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#TCP协议原理案例"><span class="toc-text">TCP协议原理案例</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#服务器同时处理多个客户端实例"><span class="toc-text">服务器同时处理多个客户端实例</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#即时聊天案例"><span class="toc-text">即时聊天案例</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#UDP协议示例"><span class="toc-text">UDP协议示例</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#URL"><span class="toc-text">URL</span></a></li></ol></div><div class="column is-9"><header class="my-4"><a href="/tags/java"><i class="tag post-item-tag">java</i></a></header><h1 class="mt-0 mb-1 is-family-serif" id="postTitle">java网络编程</h1><time class="has-text-grey" datetime="2019-02-25T07:44:17.000Z">2019-02-25</time><article class="mt-2 post-content"><h1 id="TCP协议原理案例"><a href="#TCP协议原理案例" class="headerlink" title="TCP协议原理案例"></a>TCP协议原理案例</h1><pre><code class="java">package inet;

import java.io.*;
import java.net.ServerSocket;
import java.net.Socket;

/**
 * 服务器端
 */

public class EchoServeDemo {
    public static void main(String[] args){
        //创建一个服务器端的Socket(0-1024)一般不用，因为是一些其他公司产品的端口
        try {
            ServerSocket server = new ServerSocket(6666);
            System.out.println(&quot;服务器已启动，等待客户端的连接...&quot;);

            //等待客户端连接，会造成阻塞，如果客户端连接成功，立即返回一个Socket对象
            Socket socket = server.accept();
            System.out.println(&quot;客户端连接成功&quot;+server.getInetAddress().getHostName());
            BufferedReader br = new BufferedReader(
                    new InputStreamReader(socket.getInputStream())
            );
            //通过输入流读取网络数据
            String info = br.readLine();
            System.out.println(info);
            //获取输出流，向客户端返回消息
            PrintStream ps = new PrintStream(
                    new BufferedOutputStream(socket.getOutputStream()));
            ps.println(&quot;echo &quot;+info);
            ps.flush();
            //关闭
            ps.close();
            br.close();
        } catch (IOException e) {
            e.printStackTrace();
        }

    }
}

package inet;

import java.io.*;
import java.net.Socket;

/**
 * 客户端
 */
public class EchoClientDemo {
    public static void main(String[] args) {
        //创建一个socket对象，指定要连接的服务器
        try {
            Socket socket = new Socket(&quot;localhost&quot;,6666);
            //获取socket的输入项
            PrintStream ps = new PrintStream(
                    new BufferedOutputStream(socket.getOutputStream()));
            BufferedReader br = new BufferedReader(
                    new InputStreamReader(socket.getInputStream()));
            ps.println(&quot;hello,my name is xiaoming.&quot;);
            ps.flush();
            //读取服务器返回的数据
            String info = br.readLine();
            System.out.println(info);
            ps.close();
            br.close();
        } catch (IOException e) {
            e.printStackTrace();
        }
    }
}</code></pre>
<a id="more"></a>
<h1 id="服务器同时处理多个客户端实例"><a href="#服务器同时处理多个客户端实例" class="headerlink" title="服务器同时处理多个客户端实例"></a>服务器同时处理多个客户端实例</h1><pre><code class="java">package inet;

import com.sun.source.tree.NewArrayTree;

import java.io.*;
import java.net.ServerSocket;
import java.net.Socket;
import java.util.concurrent.ExecutorService;
import java.util.concurrent.Executors;

//服务器同时处理多个客户端实例
public class MultiServeDemo {
    public static void main(String[] args) {
        ExecutorService es = Executors.newFixedThreadPool(3);//通过线程控制多个客户端
        System.out.println(&quot;服务器已启动，等待客户端链接...&quot;);
        try {
            ServerSocket server = new ServerSocket(6666);
            while(true){
                Socket socket = server.accept();
                System.out.println(socket.getInetAddress().getHostName());
                MyRunnable mr = new MyRunnable(socket);
                es.execute(mr);
            }
        } catch (IOException e) {
            e.printStackTrace();
        }

    }
}

/**
 * 用来处理客户端请求的线程
 */
class MyRunnable implements Runnable{
    private Socket socket;

    public MyRunnable(Socket socket){
        this.socket = socket;
    }

    @Override
    public void run() {
        try {
            BufferedReader br = new BufferedReader(new InputStreamReader(socket.getInputStream()));
            PrintStream ps = new PrintStream(new BufferedOutputStream(socket.getOutputStream()));
            String info = br.readLine();
            System.out.println(info);
            ps.println(&quot;收到，返回给你信息&quot;+info);
            ps.flush();
            ps.close();
            br.close();
        } catch (IOException e) {
            e.printStackTrace();
        }
    }
}</code></pre>
<h1 id="即时聊天案例"><a href="#即时聊天案例" class="headerlink" title="即时聊天案例"></a>即时聊天案例</h1><p><strong>相关类</strong></p>
<pre><code class="java">package communication;

import java.io.Serializable;

/**
 * 消息包，需要进行对象流处理，所以要继承Serializable标记接口
 */
public class Message implements Serializable {

    private String from;//消息来源
    private String to;//消息发送目的地
    private String info;//消息内容
    private int type;//消息内容

    public Message() {
    }

    public Message(String from, String to, String info, int type) {
        this.from = from;
        this.to = to;
        this.info = info;
        this.type = type;
    }

    public String getFrom() {
        return from;
    }

    public void setFrom(String from) {
        this.from = from;
    }

    public String getTo() {
        return to;
    }

    public void setTo(String to) {
        this.to = to;
    }

    public String getInfo() {
        return info;
    }

    public void setInfo(String info) {
        this.info = info;
    }

    public int getType() {
        return type;
    }

    public void setType(int type) {
        this.type = type;
    }
}

public class MessageType {
    public static final int TYPE_LOGIN = 0x01;
    public static final int TYPE__SEND = 0X02;
}
</code></pre>
<p><strong>服务器端</strong></p>
<pre><code class="java">package communication;

import java.io.BufferedReader;
import java.io.IOException;
import java.io.ObjectInputStream;
import java.io.ObjectOutputStream;
import java.net.ServerSocket;
import java.net.Socket;
import java.util.Vector;
import java.util.concurrent.ExecutorService;
import java.util.concurrent.Executors;

/**
 * 服务器端
 */
public class Server {
    public static void main(String[] args) {
        //保存客户端处理的线程
        Vector&lt;UserThread&gt; vector = new Vector&lt;&gt;();
        ExecutorService executor = Executors.newFixedThreadPool(10);

        //创建服务器端的Socket
        try {
            ServerSocket server = new ServerSocket(8888);
            System.out.println(&quot;服务器已启动，等待客户端连接...&quot;);

            while(true){
                Socket socket = server.accept();
                UserThread user = new UserThread(socket, vector);
                executor.execute(user);
            }
        } catch (IOException e) {
            e.printStackTrace();
        }
    }
}

/**
 * 用户线程
 */
class UserThread implements Runnable{
    private String name;
    private Socket socket;
    Vector&lt;UserThread&gt; vector;
    private ObjectInputStream ois;
    private ObjectOutputStream oos;
    private boolean flag=true;

    public UserThread(){

    }
    public UserThread(Socket socket,Vector&lt;UserThread&gt; vector){
        this.socket = socket;
        this.vector = vector;
        vector.add(this);
    }
    @Override
    public void run() {
        System.out.println(&quot;客户端已连接&quot;+socket.getInetAddress().getHostName());
        try {
            ois = new ObjectInputStream(socket.getInputStream());
            oos = new ObjectOutputStream(socket.getOutputStream());

            while(flag){
                Message msg = (Message)ois.readObject();
                int type = msg.getType();
                switch (type){
                    case MessageType.TYPE_LOGIN:
                        name = msg.getFrom();
                        msg.setInfo(&quot;欢迎你（来自服务器）&quot;+name);
                        oos.writeObject(msg);
                        break;

                    case MessageType.TYPE__SEND:
                        String to = msg.getTo();
                        UserThread ur;
                        int size = vector.size();
                        for (int i = 0; i &lt; size; i++) {
                            ur = vector.get(i);
                            if(to.equals(ur.name)&amp;&amp; ur!=this){
                                ur.oos.writeObject(msg);
                                break;
                            }
                        }
                        break;
                }
            }
            ois.close();
            oos.close();
        } catch (IOException | ClassNotFoundException e) {
            e.printStackTrace();
        }
    }
}
</code></pre>
<p><strong>用户端</strong></p>
<pre><code class="java">package communication;

import java.io.IOException;
import java.io.ObjectInputStream;
import java.io.ObjectOutputStream;
import java.net.Socket;
import java.util.Scanner;
import java.util.concurrent.ExecutorService;
import java.util.concurrent.Executors;

public class Client {
    public static void main(String[] args) {
        ExecutorService es = Executors.newSingleThreadExecutor();
        Scanner input  = new Scanner(System.in);
        try {
            Socket socket = new Socket(&quot;localhost&quot;,8888);
            System.out.println(&quot;连接服务器成功&quot;);

            //构建对象传输流
            ObjectOutputStream oos = new ObjectOutputStream(socket.getOutputStream());
            ObjectInputStream ois = new ObjectInputStream(socket.getInputStream());

            //向服务器发送登录信息
            System.out.println(&quot;请输入登录用户名：&quot;);
            String name = input.nextLine();
            Message msg = new Message(name,null,null,MessageType.TYPE_LOGIN);
            oos.writeObject(msg);
            //接收服务器消息
            msg = (Message)ois.readObject();
            System.out.println(msg.getFrom()+&#39;:&#39;+ msg.getInfo());

            //启动读取消息的线程
            es.execute(new ReadInfoThread(ois));
            //使用主线程发送消息
            boolean flag = true;
            while (flag){
                msg = new Message();
                System.out.println(&quot;请输入要发送的用户：&quot;);
                msg.setTo(input.nextLine());
                msg.setFrom(name);
                System.out.println(&quot;INFO:&quot;);
                msg.setInfo(input.nextLine());
                msg.setType(MessageType.TYPE__SEND);
                oos.writeObject(msg);
            }
        } catch (IOException | ClassNotFoundException e) {
            e.printStackTrace();
        }
    }
}

//接收消息的线程
class ReadInfoThread implements Runnable{
    private boolean flag=true;
    private ObjectInputStream in;

    public ReadInfoThread(ObjectInputStream in){
        this.in = in;
    }
    public void setFlag(boolean flag) {
        this.flag = flag;
    }

    @Override
    public void run() {
        try{
            while(flag){
                Message message = (Message)in.readObject();
                System.out.println(message.getFrom()+&quot;对我说&quot;+message.getInfo());
            }
            if(in!=null){
                in.close();
            }
        } catch (IOException e) {
            e.printStackTrace();
        } catch (ClassNotFoundException e) {
            e.printStackTrace();
        }
    }
}
</code></pre>
<h1 id="UDP协议示例"><a href="#UDP协议示例" class="headerlink" title="UDP协议示例"></a>UDP协议示例</h1><pre><code class="java">/**
*服务器端
*/
package inet;

import java.io.IOException;
import java.net.*;

public class UDPServerDemo {
    public static void main(String[] args) {
        String info = &quot;这是一个UDP数据报&quot;;
        byte[] bytes = info.getBytes();

        try {
            DatagramPacket dp = new DatagramPacket(
                    bytes,//数据包数据
                    0,//起始位置
                    bytes.length,//读取数据长度
                    InetAddress.getByName(&quot;127.0.0.1&quot;),//目标地址
                    8000);//目标地址端口号
            DatagramSocket server = new DatagramSocket(5000);//服务器的端口
            server.send(dp);//发送数据报
            server.close();
        } catch (UnknownHostException e) {
            e.printStackTrace();
        } catch (SocketException e) {
            e.printStackTrace();
        } catch (IOException e) {
            e.printStackTrace();
        }

    }
}


package inet;

import java.io.IOException;
import java.net.DatagramPacket;
import java.net.DatagramSocket;
import java.net.SocketException;
/**
* 客户端
*/
public class UDPClientDemo {
    public static void main(String[] args) {
        byte[] bytes = new byte[1024];
        DatagramPacket dp = new DatagramPacket(bytes,bytes.length);
        try {
            DatagramSocket socket = new DatagramSocket(8000);
            System.out.println(&quot;数据接收中...&quot;);
            socket.receive(dp);//接受数据
            String s = new String(dp.getData(),0,dp.getLength());
            System.out.println(s);
            socket.close();
        } catch (SocketException e) {
            e.printStackTrace();
        } catch (IOException e) {
            e.printStackTrace();
        }
    }
}
</code></pre>
<h1 id="URL"><a href="#URL" class="headerlink" title="URL"></a>URL</h1><pre><code class="java">package inet;

import java.io.*;
import java.net.MalformedURLException;
import java.net.URL;
import java.net.URLConnection;

public class URLDemo {
    public static void main(String[] args) {
        try {
            URL url = new URL(&quot;http://qiniu.xiaoming.net.cn/files/2019-01-17%2015-26-01%20%E7%9A%84%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE.png&quot;);
            URLConnection urlConnection = url.openConnection();
            BufferedInputStream br = new BufferedInputStream(urlConnection.getInputStream());
            BufferedOutputStream bo = new BufferedOutputStream(new FileOutputStream(&quot;/home/xiaoming/下载/xxx.jpg&quot;));
            byte[] bytes = new byte[1024];
            int len = -1;
            while((len = br.read(bytes))!= -1){
                bo.write(bytes,0,len);
                bo.flush();
            }
            bo.close();
            br.close();
            System.out.println(&quot;下载成功！&quot;);
        } catch (MalformedURLException e) {
            e.printStackTrace();
        } catch (IOException e) {
            e.printStackTrace();
        }

    }
}
</code></pre>
</article><section class="jump-container is-flex is-justify-content-space-between my-6"><!-- em is empty placeholder--><a class="button is-default" href="/2019/02/27/%E5%8F%8D%E5%B0%84%E4%B8%8E%E5%86%85%E7%9C%81/" title="java反射与内省"><i class="iconfont icon-prev mr-2 has-text-grey"></i><span class="has-text-weight-semibold">上一页: java反射与内省</span></a><a class="button is-default" href="/2019/02/18/java%E5%A4%9A%E7%BA%BF%E7%A8%8B%E4%B8%8E%E5%B9%B6%E5%8F%91/" title="java多线程与并发"><span class="has-text-weight-semibold">下一页: java多线程与并发</span><i class="iconfont icon-next ml-2 has-text-grey"></i></a></section><article class="mt-6 comment-container"><script async repo="xiao-ming9/xiao-ming9.github.io" src="https://utteranc.es/client.js" issue-term="pathname" theme="preferred-color-scheme"></script></article></div></div></main></main><footer class="is-flex is-flex-direction-column is-align-items-center is-flex-shrink-0 is-family-serif"><section class="sns-container"><!-- Github--><!-- Ins--><!-- RSS--><!-- 知乎--><!-- 领英--><!-- 脸书--></section><p><span>Copyright ©</span><span> silverming 2021</span></p><div class="is-flex is-justify-content-center is-flex-wrap-wrap"><p>Powered by Hexo &verbar;&nbsp;</p><p class="is-flex is-justify-content-center"><a title="Hexo theme author" href="//github.com/haojen">Theme by Haojen&nbsp;</a></p><div style="margin-top: 2px"><a class="github-button" title="github-button" href="https://github.com/haojen/hexo-theme-Claudia" target="_blank" rel="noopener" data-color-scheme="no-preference: light; light: light; dark: dark;" data-show-count="true"></a></div></div><div><span></span></div></footer><script async defer src="https://buttons.github.io/buttons.js"></script><script src="/js/post.js"></script></body></html>