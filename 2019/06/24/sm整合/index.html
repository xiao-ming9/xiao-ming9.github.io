<!DOCTYPE html><html class="appearance-auto" lang="zh-CN"><head><meta charset="UTF-8"><title>Spring mybatis整合</title><meta name="description" content="Wechat:934933088"><meta name="viewport" content="width=device-width, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no, initial-scale=1"><!-- Google Analytics --><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q || []).push(arguments)},i[r].l=1 * new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

ga('create', 'G-M2RT7SDT3L', 'auto');
ga('send', 'pageview');</script><!-- End Google Analytics -->
<!-- Baidu Analytics --><script>var _hmt = _hmt || [];
(function() {
var hm = document.createElement("script");
hm.src = "//hm.baidu.com/hm.js?" + '54ebb03ad7ad5b762ac8ff7958df6d3f';
var s = document.getElementsByTagName("script")[0];
s.parentNode.insertBefore(hm, s);
})();</script><!-- End Baidu Analytics --><link rel="icon" href="https://qiniu.xiaoming.net.cn/%E5%8D%9A%E5%AE%A2%E5%9B%BE%E6%A0%87.jpeg"><link rel="stylesheet" href="/style/common/bulma.css"><link rel="stylesheet" href="/style/base.css"><link rel="stylesheet" href="/style/common/helper.css"><script src="/js/common.js"></script><link rel="stylesheet" href="/style/post.css"><link rel="stylesheet" href="/style/themes/highlight-theme-light.css"><script src="/js/highlight.pack.js"></script></head><body class="is-flex is-flex-direction-column"><header class="header-widget is-flex-shrink-0 is-hidden-mobile"><div class="container is-fullhd is-flex is-justify-content-space-between is-align-items-center is-full-height"><section class="is-hidden-mobile is-flex-shrink-0"><h2><a href="/">silverming's blog</a></h2></section><h3 class="is-hidden-mobile is-family-serif is-full-height is-flex is-align-items-center is-flex-shrink-0"><div class="is-full-height" id="postTopic"><p class="is-full-height is-flex-shrink-0 is-flex is-align-items-center is-justify-content-center">Spring mybatis整合</p><p class="is-full-height is-flex-shrink-0 is-flex is-align-items-center is-justify-content-center">点击返回顶部</p></div></h3><aside class="is-flex-shrink-0"><h3 class="is-inline-block"><a href="/">首页</a></h3><h3 class="is-inline-block"><a href="/about">关于</a></h3><h3 class="is-inline-block"><a href="/archives">归档</a></h3></aside></div></header><header class="is-flex header-widget is-flex-shrink-0 is-align-items-center is-justify-content-center is-hidden-tablet"><h3 class="is-inline-block"><a href="/">首页</a></h3><h3 class="is-inline-block"><a href="/about">关于</a></h3><h3 class="is-inline-block"><a href="/archives">归档</a></h3></header><main><main class="container is-max-widescreen content section post-page pt-4 px-4"><div class="columns is-flex-desktop is-justify-content-center is-flex-direction-row-reverse"><div class="column is-3 is-hidden-mobile"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#方案一：传统的dao方式开发"><span class="toc-text">方案一：传统的dao方式开发</span></a></li></ol></div><div class="column is-9"><header class="my-4"><a href="/tags/java"><i class="tag post-item-tag">java</i></a><a href="/tags/mybatis"><i class="tag post-item-tag">mybatis</i></a><a href="/tags/spring"><i class="tag post-item-tag">spring</i></a></header><h1 class="mt-0 mb-1 is-family-serif" id="postTitle">Spring mybatis整合</h1><time class="has-text-grey" datetime="2019-06-24T13:44:52.000Z">2019-06-24</time><article class="mt-2 post-content"><h1 id="方案一：传统的dao方式开发"><a href="#方案一：传统的dao方式开发" class="headerlink" title="方案一：传统的dao方式开发"></a>方案一：传统的dao方式开发</h1><p>需要自己开发dao层，编写sql语句</p>
<ol>
<li><p>创建项目，引入依赖<br>需要注意的是需要导入mybatis和spring整合的包<code>mybatis-spring</code></p>
<a id="more"></a>
<pre><code class="xml">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;project xmlns=&quot;http://maven.apache.org/POM/4.0.0&quot;
      xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;
      xsi:schemaLocation=&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;&gt;
 &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;

 &lt;groupId&gt;xm&lt;/groupId&gt;
 &lt;artifactId&gt;sm&lt;/artifactId&gt;
 &lt;version&gt;1.0-SNAPSHOT&lt;/version&gt;

 &lt;dependencies&gt;
     &lt;!-- spring所需的包 --&gt;
     &lt;dependency&gt;
         &lt;groupId&gt;org.springframework&lt;/groupId&gt;
         &lt;artifactId&gt;spring-context&lt;/artifactId&gt;
         &lt;version&gt;5.1.7.RELEASE&lt;/version&gt;
     &lt;/dependency&gt;

     &lt;dependency&gt;
         &lt;groupId&gt;org.springframework&lt;/groupId&gt;
         &lt;artifactId&gt;spring-aop&lt;/artifactId&gt;
         &lt;version&gt;5.1.7.RELEASE&lt;/version&gt;
     &lt;/dependency&gt;

     &lt;dependency&gt;
         &lt;groupId&gt;org.springframework&lt;/groupId&gt;
         &lt;artifactId&gt;spring-aspects&lt;/artifactId&gt;
         &lt;version&gt;5.1.7.RELEASE&lt;/version&gt;
     &lt;/dependency&gt;

     &lt;dependency&gt;
         &lt;groupId&gt;org.springframework&lt;/groupId&gt;
         &lt;artifactId&gt;spring-orm&lt;/artifactId&gt;
         &lt;version&gt;5.1.7.RELEASE&lt;/version&gt;
     &lt;/dependency&gt;

     &lt;dependency&gt;
         &lt;groupId&gt;org.springframework&lt;/groupId&gt;
         &lt;artifactId&gt;spring-test&lt;/artifactId&gt;
         &lt;version&gt;5.1.7.RELEASE&lt;/version&gt;
     &lt;/dependency&gt;

     &lt;!-- mybatis所需的包 --&gt;
     &lt;dependency&gt;
         &lt;groupId&gt;org.mybatis&lt;/groupId&gt;
         &lt;artifactId&gt;mybatis&lt;/artifactId&gt;
         &lt;version&gt;3.5.1&lt;/version&gt;
     &lt;/dependency&gt;

     &lt;!-- mybatis和spring整合的包 --&gt;
     &lt;dependency&gt;
         &lt;groupId&gt;org.mybatis&lt;/groupId&gt;
         &lt;artifactId&gt;mybatis-spring&lt;/artifactId&gt;
         &lt;version&gt;2.0.1&lt;/version&gt;
     &lt;/dependency&gt;

     &lt;!-- mysql驱动包 --&gt;
     &lt;dependency&gt;
         &lt;groupId&gt;mysql&lt;/groupId&gt;
         &lt;artifactId&gt;mysql-connector-java&lt;/artifactId&gt;
         &lt;version&gt;8.0.16&lt;/version&gt;
     &lt;/dependency&gt;

     &lt;!-- 数据库连接池 --&gt;
     &lt;dependency&gt;
         &lt;groupId&gt;com.mchange&lt;/groupId&gt;
         &lt;artifactId&gt;c3p0&lt;/artifactId&gt;
         &lt;version&gt;0.9.5.4&lt;/version&gt;
     &lt;/dependency&gt;

     &lt;dependency&gt;
         &lt;groupId&gt;org.junit.jupiter&lt;/groupId&gt;
         &lt;artifactId&gt;junit-jupiter-api&lt;/artifactId&gt;
         &lt;version&gt;5.5.0-RC2&lt;/version&gt;
         &lt;scope&gt;test&lt;/scope&gt;
     &lt;/dependency&gt;
 &lt;/dependencies&gt;
</code></pre>
</li>
</ol>
</project>
```
2. 创建pojo
```java
package com.xm.pojo;

<p>import java.util.Date;</p>
<p>public class User {<br>    private int id;<br>    private String username;<br>    private String sex;<br>    private Date birthday;<br>    private String address;<br>      //get,set等方法省略<br>}</p>
<pre><code>3. dao层接口及实现
```java
package com.xm.dao;

import com.xm.pojo.User;

public interface UserDao {
    public User selectUserById(int id);
}</code></pre><p>接口实现要继承<code>SqlSessionDaoSupport</code>类，该类是mybatis和spring的整合</p>
<pre><code class="java">package com.xm.dao.impl;

import com.xm.dao.UserDao;
import com.xm.pojo.User;
import org.mybatis.spring.support.SqlSessionDaoSupport;

public class UserDaoImpl extends SqlSessionDaoSupport implements UserDao {
    @Override
    public User selectUserById(int id) {
        User user = this.getSqlSession().selectOne(&quot;com.xm.dao.UserDao.selectUserById&quot;, id);//指定到后面需要写的mapper映射文件的命名空间下
        return user;
    }
}</code></pre>
<ol start="3">
<li><p>数据库配置文件db.propertiers</p>
<pre><code>jdbc.driver = com.mysql.jdbc.Driver
jdbc.url = jdbc:mysql://localhost:3306/sm
jdbc.username = root
jdbc.password = 123</code></pre></li>
<li><p>spring配置文件</p>
<pre><code class="xml">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;beans xmlns=&quot;http://www.springframework.org/schema/beans&quot;
    xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;
    xmlns:context=&quot;http://www.springframework.org/schema/context&quot;
    xsi:schemaLocation=&quot;http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd http://www.springframework.org/schema/context https://www.springframework.org/schema/context/spring-context.xsd&quot;&gt;

 &lt;!-- 加载配置文件 --&gt;
 &lt;context:property-placeholder location=&quot;classpath:db.properties&quot;/&gt;
 &lt;!-- 连接池 --&gt;
 &lt;bean name=&quot;dataSource&quot; class=&quot;com.mchange.v2.c3p0.ComboPooledDataSource&quot;&gt;
     &lt;property name=&quot;driverClass&quot; value=&quot;${jdbc.driver}&quot;/&gt;
     &lt;property name=&quot;jdbcUrl&quot; value=&quot;${jdbc.url}&quot;/&gt;
     &lt;property name=&quot;user&quot; value=&quot;${jdbc.username}&quot;/&gt;
     &lt;property name=&quot;password&quot; value=&quot;${jdbc.password}&quot;/&gt;
 &lt;/bean&gt;

 &lt;!-- mybatis的工厂 --&gt;
 &lt;bean id=&quot;sqlSessionFactoryBean&quot; class=&quot;org.mybatis.spring.SqlSessionFactoryBean&quot;&gt;
     &lt;property name=&quot;dataSource&quot; ref=&quot;dataSource&quot;&gt;&lt;/property&gt;
     &lt;!-- 注入mybatis配置文件 --&gt;
     &lt;property name=&quot;configLocation&quot; value=&quot;classpath:spring-mybatis.xml&quot;&gt;&lt;/property&gt;
 &lt;/bean&gt;

 &lt;!-- 注入sqlSessionFactory --&gt;
 &lt;bean id=&quot;userDao&quot; class=&quot;com.xm.dao.impl.UserDaoImpl&quot;&gt;
     &lt;property name=&quot;sqlSessionFactory&quot; ref=&quot;sqlSessionFactoryBean&quot;&gt;&lt;/property&gt;
 &lt;/bean&gt;
&lt;/beans&gt;</code></pre>
</li>
<li><p>mybatis配置文件</p>
<pre><code class="xml">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;
&lt;!DOCTYPE configuration
     PUBLIC &quot;-//mybatis.org//DTD Config 3.0//EN&quot;
     &quot;http://mybatis.org/dtd/mybatis-3-config.dtd&quot;&gt;
&lt;configuration&gt;

 &lt;!-- 用于定义类型别名 --&gt;
 &lt;typeAliases&gt;
     &lt;package name=&quot;com.xm.pojo&quot;/&gt;
 &lt;/typeAliases&gt;

 &lt;!--定义映射文件--&gt;
 &lt;mappers&gt;
     &lt;mapper resource=&quot;UserMapper.xml&quot;&gt;&lt;/mapper&gt;
 &lt;/mappers&gt;
</code></pre>
</li>
</ol>
</configuration>
```
6. 映射文件
```xml
<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.xm.dao.UserDao">
    <!-- 需要创建相应的接口,id的值为接口方法名 -->
    <select id="selectUserById" parameterType="int" resultType="User">
        select * from users where id = #{id}
    </select>
</mapper>
```
7. 测试
```java
import com.xm.dao.UserDao;
import com.xm.pojo.User;
import org.junit.jupiter.api.Test;
import org.springframework.context.ApplicationContext;
import org.springframework.context.support.ClassPathXmlApplicationContext;

<p>public class UserDaoTest {</p>
<pre><code>@Test
public void testSelectUserById(){
    ApplicationContext context = new ClassPathXmlApplicationContext(&quot;classpath:spring-applicationContext.xml&quot;);
    //获取userDao
    UserDao userDao = context.getBean(UserDao.class);
    User user = userDao.selectUserById(1);
    System.out.println(user);
}</code></pre><p>}</p>
<pre><code>### 目录结构
![](https://github.com/xiao-ming9/xiao-ming9.github.io/blob/master/images/sm%E6%95%B4%E5%90%88%E7%9B%AE%E5%BD%95.png?raw=true)

# 方案二：Mapper动态代理开发（不用自己写Dao实现类）
1. 创建项目
2. 创建dao接口
```java
package com.xm.dao;

import com.xm.pojo.User;

public interface UserDao {
   User selectUserById(Integer id);
}</code></pre><ol start="3">
<li><p>配置spring核心配置文件</p>
<pre><code class="xml">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;beans xmlns=&quot;http://www.springframework.org/schema/beans&quot;
    xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;
    xmlns:context=&quot;http://www.springframework.org/schema/context&quot;
    xsi:schemaLocation=&quot;http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd http://www.springframework.org/schema/context https://www.springframework.org/schema/context/spring-context.xsd&quot;&gt;

 &lt;context:property-placeholder location=&quot;db.properties&quot;/&gt;

 &lt;!-- 连接池 --&gt;
 &lt;bean name=&quot;dataSource&quot; class=&quot;com.mchange.v2.c3p0.ComboPooledDataSource&quot;&gt;
     &lt;property name=&quot;driverClass&quot; value=&quot;${jdbc.driver}&quot;/&gt;
     &lt;property name=&quot;jdbcUrl&quot; value=&quot;${jdbc.url}&quot;/&gt;
     &lt;property name=&quot;user&quot; value=&quot;${jdbc.username}&quot;/&gt;
     &lt;property name=&quot;password&quot; value=&quot;${jdbc.password}&quot;/&gt;
 &lt;/bean&gt;

 &lt;!-- mybatis工厂 --&gt;
 &lt;bean id=&quot;sqlSessionFactoryBean&quot; class=&quot;org.mybatis.spring.SqlSessionFactoryBean&quot;&gt;
     &lt;property name=&quot;dataSource&quot; ref=&quot;dataSource&quot;/&gt;
     &lt;!-- mybatis核心配置文件的位置 --&gt;
     &lt;property name=&quot;configLocation&quot; value=&quot;classpath:spring-mybatisConfig.xml&quot;/&gt;
 &lt;/bean&gt;

 &lt;!-- Mapper动态代理开发 --&gt;
 &lt;bean id=&quot;userDao&quot; class=&quot;org.mybatis.spring.mapper.MapperFactoryBean&quot;&gt;
     &lt;property name=&quot;sqlSessionFactory&quot; ref=&quot;sqlSessionFactoryBean&quot;/&gt;
       &lt;!-- 此处关联到dao层接口 --&gt;
     &lt;property name=&quot;mapperInterface&quot; value=&quot;com.xm.dao.UserDao&quot;/&gt;
 &lt;/bean&gt;
&lt;/beans&gt;</code></pre>
</li>
<li><p>UserMapper.xml</p>
<pre><code class="xml">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;
&lt;!DOCTYPE mapper
     PUBLIC &quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;
     &quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;&gt;
</code></pre>
</li>
</ol>
<mapper namespace="com.xm.dao.UserDao">
    <select id="selectUserById" parameterType="Integer" resultType="User">
        select * from users where id = #{id}
    </select>
</mapper>
```
5. mtybatis配置文件
```xml
<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE configuration
        PUBLIC "-//mybatis.org//DTD Config 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-config.dtd">
<configuration>

<pre><code>&lt;!-- 用于定义类型别名 --&gt;
&lt;typeAliases&gt;
    &lt;!-- 指定扫描包，会把包内所有的类都设置别名，别名的名称就是类名，大小写不敏感 --&gt;
    &lt;package name=&quot;com.xm.pojo&quot;/&gt;
&lt;/typeAliases&gt;

&lt;mappers&gt;
    &lt;mapper resource=&quot;UserMapper.xml&quot;&gt;&lt;/mapper&gt;
&lt;/mappers&gt;</code></pre></configuration>
```
6. 测试类
```java
import com.xm.dao.UserDao;
import com.xm.pojo.User;
import org.junit.jupiter.api.Test;
import org.springframework.context.ApplicationContext;
import org.springframework.context.support.ClassPathXmlApplicationContext;

<p>public class JunitTest {</p>
<pre><code>@Test
public void testMapper() throws Exception{
    ApplicationContext applicationContext = new ClassPathXmlApplicationContext(&quot;spring-applicationContext.xml&quot;);
    UserDao userDao = applicationContext.getBean(UserDao.class);
    User user = userDao.selectUserById(1);
    System.out.println(user);

}</code></pre><p>}</p>
<pre><code>
# 方案三：Mapper动态代理扫描包形式开发dao
这种方法是对方案二的简化，只需要修改spring配置文件：将最后的mapper动态代理开发修改如下：这样会自动去寻找basePackage下的包中文件，不用为每一个dao层都配置一次动态代理
```xml
&lt;!--    &amp;lt;!&amp;ndash; Mapper动态代理开发 &amp;ndash;&amp;gt;--&gt;
&lt;!--    &lt;bean id=&quot;userDao&quot; class=&quot;org.mybatis.spring.mapper.MapperFactoryBean&quot;&gt;--&gt;
&lt;!--        &lt;property name=&quot;sqlSessionFactory&quot; ref=&quot;sqlSessionFactoryBean&quot;/&gt;--&gt;
&lt;!--        &lt;property name=&quot;mapperInterface&quot; value=&quot;com.xm.dao.UserDao&quot;/&gt;--&gt;
&lt;!--    &lt;/bean&gt;--&gt;
    &lt;bean class=&quot;org.mybatis.spring.mapper.MapperScannerConfigurer&quot;&gt;
        &lt;!-- 基本包 --&gt;
        &lt;property name=&quot;basePackage&quot; value=&quot;com.xm.dao&quot;/&gt;
    &lt;/bean&gt;</code></pre></article><section class="jump-container is-flex is-justify-content-space-between my-6"><!-- em is empty placeholder--><a class="button is-default" href="/2019/07/04/SSM%E6%95%B4%E5%90%88/" title="SSM框架整合"><i class="iconfont icon-prev mr-2 has-text-grey"></i><span class="has-text-weight-semibold">上一页: SSM框架整合</span></a><a class="button is-default" href="/2019/06/01/SpringMVC/" title="SpringMVC"><span class="has-text-weight-semibold">下一页: SpringMVC</span><i class="iconfont icon-next ml-2 has-text-grey"></i></a></section><article class="mt-6 comment-container"><script async repo="xiao-ming9/xiao-ming9.github.io" src="https://utteranc.es/client.js" issue-term="pathname" theme="preferred-color-scheme"></script></article></div></div></main></main><footer class="is-flex is-flex-direction-column is-align-items-center is-flex-shrink-0 is-family-serif"><section class="sns-container"><!-- Github--><!-- Ins--><!-- RSS--><!-- 知乎--><!-- 领英--><!-- 脸书--></section><p><span>Copyright ©</span><span> silverming 2021</span></p><div class="is-flex is-justify-content-center is-flex-wrap-wrap"><p>Powered by Hexo &verbar;&nbsp;</p><p class="is-flex is-justify-content-center"><a title="Hexo theme author" href="//github.com/haojen">Theme by Haojen&nbsp;</a></p><div style="margin-top: 2px"><a class="github-button" title="github-button" href="https://github.com/haojen/hexo-theme-Claudia" target="_blank" rel="noopener" data-color-scheme="no-preference: light; light: light; dark: dark;" data-show-count="true"></a></div></div><div><span></span></div></footer><script async defer src="https://buttons.github.io/buttons.js"></script><script src="/js/post.js"></script></body></html>