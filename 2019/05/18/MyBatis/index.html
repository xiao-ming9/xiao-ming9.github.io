<!DOCTYPE html><html class="appearance-auto" lang="zh-CN"><head><meta charset="UTF-8"><title>MyBatis</title><meta name="description" content="Wechat:934933088"><meta name="viewport" content="width=device-width, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no, initial-scale=1"><!-- Google Analytics --><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q || []).push(arguments)},i[r].l=1 * new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

ga('create', 'G-M2RT7SDT3L', 'auto');
ga('send', 'pageview');</script><!-- End Google Analytics -->
<!-- Baidu Analytics --><script>var _hmt = _hmt || [];
(function() {
var hm = document.createElement("script");
hm.src = "//hm.baidu.com/hm.js?" + '54ebb03ad7ad5b762ac8ff7958df6d3f';
var s = document.getElementsByTagName("script")[0];
s.parentNode.insertBefore(hm, s);
})();</script><!-- End Baidu Analytics --><link rel="icon" href="https://qiniu.xiaoming.net.cn/%E5%8D%9A%E5%AE%A2%E5%9B%BE%E6%A0%87.jpeg"><link rel="stylesheet" href="/style/common/bulma.css"><link rel="stylesheet" href="/style/base.css"><link rel="stylesheet" href="/style/common/helper.css"><script src="/js/common.js"></script><link rel="stylesheet" href="/style/post.css"><link rel="stylesheet" href="/style/themes/highlight-theme-light.css"><script src="/js/highlight.pack.js"></script></head><body class="is-flex is-flex-direction-column"><header class="header-widget is-flex-shrink-0 is-hidden-mobile"><div class="container is-fullhd is-flex is-justify-content-space-between is-align-items-center is-full-height"><section class="is-hidden-mobile is-flex-shrink-0"><h2><a href="/">silverming's blog</a></h2></section><h3 class="is-hidden-mobile is-family-serif is-full-height is-flex is-align-items-center is-flex-shrink-0"><div class="is-full-height" id="postTopic"><p class="is-full-height is-flex-shrink-0 is-flex is-align-items-center is-justify-content-center">MyBatis</p><p class="is-full-height is-flex-shrink-0 is-flex is-align-items-center is-justify-content-center">点击返回顶部</p></div></h3><aside class="is-flex-shrink-0"><h3 class="is-inline-block"><a href="/">首页</a></h3><h3 class="is-inline-block"><a href="/about">关于</a></h3><h3 class="is-inline-block"><a href="/archives">归档</a></h3></aside></div></header><header class="is-flex header-widget is-flex-shrink-0 is-align-items-center is-justify-content-center is-hidden-tablet"><h3 class="is-inline-block"><a href="/">首页</a></h3><h3 class="is-inline-block"><a href="/about">关于</a></h3><h3 class="is-inline-block"><a href="/archives">归档</a></h3></header><main><main class="container is-max-widescreen content section post-page pt-4 px-4"><div class="columns is-flex-desktop is-justify-content-center is-flex-direction-row-reverse"><div class="column is-3 is-hidden-mobile"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#MyBatis-持久层"><span class="toc-text">MyBatis 持久层</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#MyBatis配置"><span class="toc-text">MyBatis配置</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#相关配置说明"><span class="toc-text">相关配置说明</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#映射文件的配置"><span class="toc-text">映射文件的配置</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#构建SqlSessionFactory"><span class="toc-text">构建SqlSessionFactory</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#mapper相关使用细节"><span class="toc-text">mapper相关使用细节</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#列名与属性名不一致的情况"><span class="toc-text">列名与属性名不一致的情况</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#模糊查询-和"><span class="toc-text">模糊查询#和$</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#查询排序"><span class="toc-text">查询排序</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#多参数传递"><span class="toc-text">多参数传递</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#插入和获取最新插入id"><span class="toc-text">插入和获取最新插入id</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#修改"><span class="toc-text">修改</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#删除"><span class="toc-text">删除</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#动态sql"><span class="toc-text">动态sql</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#if"><span class="toc-text">if</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#choose-when-otherwise"><span class="toc-text">choose(when,otherwise)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#where"><span class="toc-text">where</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#set"><span class="toc-text">set</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#trim"><span class="toc-text">trim</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#foreach"><span class="toc-text">foreach</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#sql"><span class="toc-text">sql</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#鉴别器"><span class="toc-text">鉴别器</span></a></li></ol></div><div class="column is-9"><header class="my-4"><a href="/tags/java"><i class="tag post-item-tag">java</i></a><a href="/tags/mybatis"><i class="tag post-item-tag">mybatis</i></a></header><h1 class="mt-0 mb-1 is-family-serif" id="postTitle">MyBatis</h1><time class="has-text-grey" datetime="2019-05-18T07:12:49.000Z">2019-05-18</time><article class="mt-2 post-content"><h1 id="MyBatis-持久层"><a href="#MyBatis-持久层" class="headerlink" title="MyBatis 持久层"></a>MyBatis 持久层</h1><ul>
<li>对JDBC的封装</li>
<li>将sql语句放在映射文件中（xml）</li>
<li>自动将输入参数映射到sql语句的动态参数上</li>
<li>自动将sql语句执行的结果映射成java对象</li>
</ul>
<a id="more"></a>
<h1 id="MyBatis配置"><a href="#MyBatis配置" class="headerlink" title="MyBatis配置"></a>MyBatis配置</h1><ol>
<li><p>需要导入mybatis包</p>
<pre><code class="xml">&lt;dependency&gt;
 &lt;groupId&gt;org.mybatis&lt;/groupId&gt;
 &lt;artifactId&gt;mybatis&lt;/artifactId&gt;
 &lt;version&gt;3.5.1&lt;/version&gt;
&lt;/dependency&gt;</code></pre>
</li>
<li><p>创建xml配置文件</p>
<pre><code class="xml">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;
&lt;!DOCTYPE configuration
     PUBLIC &quot;-//mybatis.org//DTD Config 3.0//EN&quot;
     &quot;http://mybatis.org/dtd/mybatis-3-config.dtd&quot;&gt;
&lt;configuration&gt;
 &lt;!--引入数据库连接配置--&gt;
 &lt;properties resource=&quot;db.properties&quot;/&gt;
   &lt;!-- 用于定义类型别名 --&gt;
   &lt;typeAliases&gt;
       &lt;package name=&quot;com.xm.pojo&quot;/&gt;
   &lt;/typeAliases&gt;

 &lt;!--定义数据源--&gt;
 &lt;environments default=&quot;development&quot;&gt;
     &lt;environment id=&quot;development&quot;&gt;
         &lt;transactionManager type=&quot;JDBC&quot;/&gt;
         &lt;dataSource type=&quot;POOLED&quot;&gt;
             &lt;property name=&quot;driver&quot; value=&quot;${jdbc.driver}&quot;/&gt;
             &lt;property name=&quot;url&quot; value=&quot;${jdbc.url}&quot;/&gt;
             &lt;property name=&quot;username&quot; value=&quot;${jdbc.username}&quot;/&gt;
             &lt;property name=&quot;password&quot; value=&quot;${jdbc.password}&quot;/&gt;
         &lt;/dataSource&gt;
     &lt;/environment&gt;
 &lt;/environments&gt;
 &lt;!--定义映射文件--&gt;
 &lt;mappers&gt;
 &lt;!--&lt;mapper resource=&quot;com.xm.mybatis.mapper.BlogMapper.xml&quot;/&gt;--&gt;
     &lt;package name=&quot;com.xm.mybatis.mapper&quot;/&gt;
 &lt;/mappers&gt;
&lt;/configuration&gt;</code></pre>
</li>
</ol>
<h2 id="相关配置说明"><a href="#相关配置说明" class="headerlink" title="相关配置说明"></a>相关配置说明</h2><ol>
<li><code>enviironments</code>用于配置多种运行环境</li>
<li><code>default</code>指定默认的环境id</li>
<li>每个<code>environment</code>元素可以定义自己的环境id</li>
<li><code>transactionManager</code>是事务管理器，MyBatis中有两种类型的事务管理器</li>
</ol>
<ul>
<li><code>JDBC</code> 这个配置直接使用了JDBC的提交和回滚设置，它依赖于从数据源得到的连接来管理事务作用域</li>
<li><code>MANAGER</code>这个配置几乎什么都没做，它从来不提交或者回滚一个连接，而是让容器来管理事务的整个生命周期</li>
</ul>
<ol start="5">
<li><code>datasource</code>配置数据源，<code>type</code>有三种类型可选</li>
</ol>
<ul>
<li><code>UNPLOOLED</code>:每次请求时都打开和关闭连接</li>
<li><code>POOLED</code>:使用连接池，可以设置<code>poolMaximumActiveConnection</code>最大连接数量；<code>poolMaximumIdleConnections</code>最大空闲数；<code>poolMaximumCheckoutTime</code>在被强制返回之前连接超时时间，默认20000毫秒（20秒）；<code>poolTimeWait</code>超时时间（默认20秒）等等</li>
<li><code>JNDI</code></li>
</ul>
<ol start="6">
<li><code>mappers</code>映射器，用于告诉MyBatis去哪里寻找sql映射语句，可以使用类路径，完全限定资源定位符（URL），类名，包名等<pre><code class="xml">&lt;mappers&gt;    
 &lt;!-- 使用相对类路径的资源引用 --&gt;
 &lt;mapper resource=&quot;com.xm.mybatis.xxxMapper.xml&quot;/&gt;
 &lt;!-- 使用完全限定资源定位符（URL）--&gt;
 &lt;mapper url=&quot;file:///var/mappers/xxxMapper.xml&quot;/&gt;
 &lt;!-- 使用类名 --&gt;
 &lt;mapper class=&quot;com.xm.mybatis.xxxMapper&quot;/&gt;
 &lt;!--将包内的所用内容注册为映射器 --&gt;
 &lt;package name=&quot;com.xm.mybatis&quot;/&gt;
&lt;/mappers&gt;</code></pre>
</li>
<li><code>typeAliases</code>用于配置类型别名，即对实体类进行命名，方便后面在配置映射文件时指定具体实体类，可以指定具体类或指定一个包的方式进行配置<pre><code class="xml">&lt;!-- 通过指定具体类型 --&gt;
&lt;typeAliases&gt;
   &lt;typeAliase alias=&quot;Blog&quot; type=&quot;com.xm.pojo.Blog&quot;/&gt;
&lt;/typeAliases&gt;
&lt;!-- 指定包名，MyBatis会在包名下搜索，默认别名为类名 --&gt;
&lt;typeAliases&gt;
 &lt;package name=&quot;com.xm.pojo&quot;/&gt;
&lt;/typeAliases&gt;</code></pre>
<blockquote>
<p>在Mybatis中，已经封装了一些常见的类型别名：<br><code>int</code>表示<strong>integer</strong><br><code>_int</code>表示<strong>int</strong></p>
</blockquote>
</li>
</ol>
<h1 id="映射文件的配置"><a href="#映射文件的配置" class="headerlink" title="映射文件的配置"></a>映射文件的配置</h1><pre><code class="xml">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;
        &lt;!DOCTYPE mapper
                PUBLIC &quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;
                &quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;&gt;
&lt;mapper namespace=&quot;com.xm.mapper.BlogMapper&quot;&gt;
      &lt;!-- 需要创建相应的接口,id的值为接口方法名 --&gt;
    &lt;select id=&quot;selectBlog&quot; parameterType=&quot;int&quot; resultType=&quot;Blog&quot;&gt;
        select * from Blogs where id = #{id}
    &lt;/select&gt;
&lt;/mapper&gt;</code></pre>
<p>对应的接口</p>
<pre><code class="java">package com.xm.mapper;

import com.xm.pojo.Blog;

public interface BlogMapper {
    public Blog selectBlog(int id);
}</code></pre>
<h1 id="构建SqlSessionFactory"><a href="#构建SqlSessionFactory" class="headerlink" title="构建SqlSessionFactory"></a>构建SqlSessionFactory</h1><p>每个基于MyBatis的应用都需要以一个<code>SqlSessionFactory</code>的实例为核心，SqlSessionFactoryd的实例可以通过<code>SqlSessionFactoryBuilder</code>获得，通过SqlSesstionFactory就可以获得<code>sqlSession</code>实例，该实例包含了面向数据库执行SQL命令所需的所有方法，通过sqlSession可以获取指定的mapper映射类<br>具体使用方法如下：</p>
<pre><code class="java">package com.xm.utils;

import org.apache.ibatis.io.Resources;
import org.apache.ibatis.session.SqlSession;
import org.apache.ibatis.session.SqlSessionFactory;
import org.apache.ibatis.session.SqlSessionFactoryBuilder;

import java.io.IOException;
import java.io.InputStream;

public class MyBatisUtil {
    private static SqlSessionFactory sqlSessionFactory = null;
    static {
        try {
              //加载mybatis配置文件
            InputStream inputStream = Resources.getResourceAsStream(&quot;mybatis-config.xml&quot;);
              //获取sqlSessionFactory
            sqlSessionFactory = new SqlSessionFactoryBuilder().build(inputStream);
        } catch (IOException e) {
            e.printStackTrace();
        }
    }

    public MyBatisUtil() {
    }

    public static SqlSession sqlSession(){
          //获取sqlSession实例
        return sqlSessionFactory.openSession();
    }
}</code></pre>
<p>测试案例</p>
<pre><code class="java">/**
* 需要创建BlogMapper接口的方式 
*/
@Test
public void testSelectBlog(){
    SqlSession sqlSession = MyBatisUtil.sqlSession();
    BlogMapper mapper = sqlSession.getMapper(BlogMapper.class);
    Blog blog = mapper.selectBlog(1);//执行映射文件id为selectBlog的方法
    System.out.println(blog);
    sqlSession.close();
}

/**
* 不需要创建BlogMapper的方式
*/
@Test
public void testSelectBlogNoInterface(){
    SqlSession sqlSession = MyBatisUtil.sqlSession();
      //指定到BlogMapper.xml配置的命名空间
    Blog blog = sqlSession.selectOne(
            &quot;com.xm.mapper.BlogMapper.selectBlog&quot;,1);
    sqlSession.close();
    System.out.println(blog);
}</code></pre>
<h1 id="mapper相关使用细节"><a href="#mapper相关使用细节" class="headerlink" title="mapper相关使用细节"></a>mapper相关使用细节</h1><h2 id="列名与属性名不一致的情况"><a href="#列名与属性名不一致的情况" class="headerlink" title="列名与属性名不一致的情况"></a>列名与属性名不一致的情况</h2><p>当对类中的某个属性定义的属性名与所对应的数据表的字段名不一致时，需要手动配置指定对应字段名，否则会读取不到数据<br>配置字段对应类属性名的方式：</p>
<ol>
<li><p>在select语句中对字段起别名</p>
<pre><code class="xml">&lt;select id=&quot;selectBlog&quot; parameterType=&quot;int&quot; resultType=&quot;Blog&quot;&gt;
 select id,title,author_id as authorId,featured,style from Blogs where id = #{id}
&lt;/select&gt;</code></pre>
</li>
<li><p>配置<code>resultMap</code>:在mapper配置文件中，添加resultMap节点，同时在statement中指定resultMap.</p>
<pre><code class="xml">&lt;mapper namespace=&quot;com.xm.mapper.BlogMapper&quot;&gt;
 &lt;resultMap id=&quot;blogResultMap&quot; type=&quot;Blog&quot;&gt;
     &lt;id column=&quot;id&quot; property=&quot;id&quot; javaType=&quot;INTEGER&quot;/&gt;
     &lt;result column=&quot;author_id&quot; property=&quot;authorId&quot; javaType=&quot;INTEGER&quot;/&gt;
 &lt;/resultMap&gt;

 &lt;select id=&quot;selectBlog2&quot; parameterType=&quot;int&quot; resultMap=&quot;blogResultMap&quot;&gt;
     select * from blogs where id = #{id}
 &lt;/select&gt;
&lt;/mapper&gt;</code></pre>
</li>
</ol>
<h2 id="模糊查询-和"><a href="#模糊查询-和" class="headerlink" title="模糊查询#和$"></a>模糊查询#和$</h2><p><code>#</code>表示的是占位符，即<strong>会使用?符号进行预处理</strong>，而<code>$</code>表示的是字符串拼接符，会<strong>直接替换内容</strong>。<br>当使用$的时候，如果要设置其值（非列名和表名的情况），只能使用<strong>value</strong>作为参数，但是会有sql注入问题，一般不建议这样使用</p>
<pre><code class="xml">&lt;select id=&quot;selectBlogByTitle&quot; parameterType=&quot;string&quot; resultMap=&quot;blogResultMap&quot;&gt;
    select * from blogs where lower(title) like lower(#{title})
&lt;/select&gt;

&lt;select id=&quot;selectBlogByTitle2&quot; parameterType=&quot;string&quot; resultMap=&quot;blogResultMap&quot;&gt;
    select * from blogs where lower (title) like lower (${value})
&lt;/select&gt;</code></pre>
<h2 id="查询排序"><a href="#查询排序" class="headerlink" title="查询排序"></a>查询排序</h2><p>对于查询中使用列名，表名的情况，只能使用$,使用#没有效果</p>
<pre><code class="xml">&lt;select id=&quot;selectBlogBySort&quot; parameterType=&quot;string&quot; resultMap=&quot;blogResultMap&quot;&gt;
      &lt;!-- convert函数用于指定字符编码，针对中文排序的情况 --&gt;
    select * from blogs order by convert(${value} using gbk);
&lt;/select&gt;</code></pre>
<h2 id="多参数传递"><a href="#多参数传递" class="headerlink" title="多参数传递"></a>多参数传递</h2><p>可以有多种方法进行多参数传递</p>
<ol>
<li>使用索引：按照参数排序，<code>arg</code>从<strong>0</strong>开始，<code>param</code>从<strong>1</strong>开始<pre><code class="xml">&lt;select id=&quot;selectBlogByPage&quot; resultMap=&quot;blogResultMap&quot;&gt;
 select * from blogs limit #{arg0},#{arg1}
&lt;/select&gt;
</code></pre>
</li>
</ol>
<select id="selectBlogByPage" resultMap="blogResultMap">
    select * from blogs limit #{param1},#{param2}
</select>
```

<ol start="2">
<li><p>使用注解：注解的value值要和mapper的占位参数名一致</p>
<pre><code class="xml">&lt;select id=&quot;selectBlogByPage2&quot; resultMap=&quot;blogResultMap&quot;&gt;
 select * from blogs limit #{offset},#{pagesize}
&lt;/select&gt;</code></pre>
<p>对应的接口：</p>
<pre><code class="java">List&lt;Blog&gt; selectBlogByPage2(
     @Param(value = &quot;offset&quot;) int offset,
     @Param(value = &quot;pagesize&quot;) int pagesize);</code></pre>
</li>
<li><p>使用map<br>mapper的配置保持不变，其中的占位符参数名要和测试中map的key一一对应<br>接口：</p>
<pre><code class="java">List&lt;Blog&gt; selectBlogByPage3(Map&lt;String,Object&gt; map);</code></pre>
<p>测试：</p>
<pre><code class="java">@Test
public void testSelectBlogByPage3(){
 SqlSession sqlSession = MyBatisUtil.sqlSession();
 BlogMapper mapper = sqlSession.getMapper(BlogMapper.class);
 //自己构建一个map
 Map&lt;String,Object&gt; map = new HashMap&lt;String, Object&gt;();
 //注意key要和参数名对应
 map.put(&quot;offset&quot;,0);
 map.put(&quot;pagesize&quot;,2);
 List&lt;Blog&gt; blogs = mapper.selectBlogByPage3(map);
 sqlSession.close();
 for (Blog blog : blogs) {
     System.out.println(blog);
 }
}</code></pre>
</li>
</ol>
<h2 id="插入和获取最新插入id"><a href="#插入和获取最新插入id" class="headerlink" title="插入和获取最新插入id"></a>插入和获取最新插入id</h2><p>在mapeer中使用insert节点,insert方法返回的是该操作影响的行数</p>
<pre><code class="xml">&lt;insert id=&quot;insertBlog&quot; parameterType=&quot;Blog&quot; &gt;
    insert into blogs (title, author_id, featured, style) value (#{title},#{authorId},#{featured},#{style})
&lt;/insert&gt;</code></pre>
<p>测试：</p>
<pre><code class="java">@Test
public void testInsertBlog(){
    SqlSession sqlSession = MyBatisUtil.sqlSession();
    BlogMapper mapper = sqlSession.getMapper(BlogMapper.class);
    Blog blog = new Blog();
    int id = mapper.insertBlog(blog);//返回影响行数
    sqlSession.commit();//要进行提交
    System.out.println(id);
    sqlSession.close();
}</code></pre>
<p><strong>获取插入id的三种方式</strong></p>
<ol>
<li>在mapper中配置insert节点的属性<blockquote>
<p>useGeneratedKeys = true keyProperty=”id”  </p>
</blockquote>
</li>
</ol>
<ul>
<li>useGeneratedKeys仅对 insert 和 update 有用，这会令 MyBatis 使用 JDBC 的 getGeneratedKeys 方法来取出由数据库内部生成的主键（比如：像 MySQL 和 SQL Server 这样的关系数据库管理系统的自动递增字段），默认值：false。</li>
<li>keyProperty仅对 insert 和 update 有用）唯一标记一个属性，指定主键名是什么，MyBatis 会通过 getGeneratedKeys 的返回值或者通过 insert 语句的 selectKey 子元素设置它的键值，默认值：未设置（unset）。如果希望得到多个生成的列，也可以是逗号分隔的属性名称列表。<pre><code class="xml">&lt;insert id=&quot;insertBlog&quot; parameterType=&quot;Blog&quot; useGeneratedKeys=&quot;true&quot; keyProperty=&quot;id&quot;&gt;
  insert into blogs (title, author_id, featured, style) value (#{title},#{authorId},#{featured},#{style})
&lt;/insert&gt;</code></pre>
测试：<pre><code class="java">@Test
public void testInsertBlog(){
  SqlSession sqlSession = MyBatisUtil.sqlSession();
  BlogMapper mapper = sqlSession.getMapper(BlogMapper.class);
  Blog blog = new Blog();
  System.out.println(blog);//blog的id属性尚未赋值
  int id = mapper.insertBlog(blog);//返回影响行数
  sqlSession.commit();//要进行提交
  System.out.println(id);
  System.out.println(blog);//在事务提交执行成功之后自动为对象的id属性赋值
  sqlSession.close();
}</code></pre>
</li>
</ul>
<ol start="2">
<li><p>在全局配置文件中配置<code>settings</code>节点，并且在mapper的insert节点指定主键名，即配置<code>keyProperty=“id</code></p>
<pre><code class="xml">&lt;settings&gt;
 &lt;setting name=&quot;useGeneratedKeys&quot; value=&quot;true&quot;/&gt;
&lt;/settings&gt;</code></pre>
</li>
<li><p>（针对Oracle等无主键的数据库）在inseert节点中加入<code>selectKey</code>属性，其有一下变量属性：</p>
<ul>
<li>keyProperty：selectKey 语句结果应该被设置的目标属性。如果希望得到多个生成的列，也可以是逗号分隔的属性名称列表。</li>
<li>keyColumn：匹配属性的返回结果集中的列名称。如果希望得到多个生成的列，也可以是逗号分隔的属性名称列表。</li>
<li>resultType：结果的类型。MyBatis 通常可以推断出来，但是为了更加精确，写上也不会有什么问题。MyBatis 允许将任何简单类型用作主键的类型，包括字符串。如果希望作用于多个生成的列，则可以使用一个包含期望属性的 Object 或一个 Map。-</li>
<li>order：这可以被设置为 BEFORE 或 AFTER。如果设置为 BEFORE，那么它会首先生成主键，设置 keyProperty 然后执行插入语句。如果设置为 AFTER，那么先执行插入语句，然后是 selectKey 中的语句 - 这和 Oracle 数据库的行为相似，在插入语句内部可能有嵌入索引调用。</li>
<li>statementType：STATEMENT，PREPARED 或 CALLABLE 的一个。这会让 MyBatis 分别使用 Statement，PreparedStatement 或 CallableStatement，默认值：PREPARED。<pre><code class="xml">&lt;insert id=&quot;insertBlog2&quot; parameterType=&quot;Blog&quot; keyProperty=&quot;id&quot;&gt;
&lt;selectKey keyProperty=&quot;id&quot; order=&quot;AFTER&quot; resultType=&quot;java.lang.Integer&quot;&gt;
  select LAST_INSERT_ID()
&lt;/selectKey&gt;
insert into blogs (title, author_id, featured, style) value (#{title},#{authorId},#{featured},#{style})
&lt;/insert&gt;</code></pre>
</li>
</ul>
</li>
</ol>
<h2 id="修改"><a href="#修改" class="headerlink" title="修改"></a>修改</h2><p>使用update节点</p>
<pre><code class="xml">&lt;update id=&quot;updateBlog&quot; parameterType=&quot;Blog&quot;&gt;
    update blogs set title=#{title},author_id=#{authorId},featured=#{featured},style=#{style} where id=#{id}
&lt;/update&gt;</code></pre>
<p>在实际应用中，如果只针对某个字段做修改，可以先查询获得实体类，再对实体类属性进行修改<br>为了进一步提高效率，可以使用<strong>动态sql</strong>的方式</p>
<h2 id="删除"><a href="#删除" class="headerlink" title="删除"></a>删除</h2><pre><code class="xml">&lt;delete id=&quot;deleteBlogById&quot; parameterType=&quot;int&quot;&gt;
    delete from blogs where id=#{id}
&lt;/delete&gt;</code></pre>
<h1 id="动态sql"><a href="#动态sql" class="headerlink" title="动态sql"></a>动态sql</h1><p>动态sql有以下几种类型</p>
<ul>
<li>if</li>
<li>choose (when, otherwise)</li>
<li>trim (where, set)</li>
<li>foreach</li>
</ul>
<h2 id="if"><a href="#if" class="headerlink" title="if"></a>if</h2><p>if提供了可选的查询方案，如果if中的条件成立，则执行if中的语句，否则只执行if外的sql语句</p>
<pre><code class="xml">&lt;select id=&quot;selectActiveBlogByTitle&quot; parameterType=&quot;string&quot; resultMap=&quot;blogResultMap&quot;&gt;
    select * from blogs where featured=false
    &lt;if test=&quot;_parameter != null&quot;&gt;
        AND title like #{title}
    &lt;/if&gt;
&lt;/select&gt;</code></pre>
<p><strong>注意</strong>：<br>当参数类型为<strong>string</strong>时，test中的属性名不能直接写参数名，否则会抛出异常：</p>
<blockquote>
<p>There is no getter for property named ‘XXX’ in ‘class java.lang.String  </p>
</blockquote>
<p><strong>解决办法</strong></p>
<ol>
<li>将test中的属性名更换为<code>_parameter</code></li>
<li>加上<strong>单引号</strong></li>
<li>可以在接口处的参数使用<code>@param</code>修饰<pre><code class="java">List&lt;Blog&gt; selectActiveBlogByTitle(
@Param(value = &quot;title&quot;) String title);</code></pre>
</li>
</ol>
<h2 id="choose-when-otherwise"><a href="#choose-when-otherwise" class="headerlink" title="choose(when,otherwise)"></a>choose(when,otherwise)</h2><p>用于多个条件判断，当满足其中某个when条件时，sql语句加上其中的内容，否则只执行外部的内容</p>
<blockquote>
<p>一旦某个when条件成立，就不会再判断下面的when语句了  </p>
</blockquote>
<pre><code class="xml">&lt;!-- 此时接收的参数为一个对象 --&gt;
&lt;select id=&quot;selectActiveBlogByTitleOrOther&quot; parameterType=&quot;Blog&quot; resultMap=&quot;blogResultMap&quot;&gt;
    select * from blogs where featured=false
    &lt;choose&gt;
        &lt;when test=&quot;title != null&quot;&gt;
            AND title =#{title}
        &lt;/when&gt;
        &lt;when test=&quot;authorId != null&quot;&gt;
            and author_id = #{authorId}
        &lt;/when&gt;
        &lt;when test=&quot;style&quot;&gt;
            and style = #{style}
        &lt;/when&gt;
        &lt;otherwise&gt;
            and id&gt;0
        &lt;/otherwise&gt;
    &lt;/choose&gt;
&lt;/select&gt;</code></pre>
<h2 id="where"><a href="#where" class="headerlink" title="where"></a>where</h2><p>如果希望where条件语句也在需要的时候才加入，可以使用<code>where</code>来进行判断。<br>where元素只会在至少有一个子元素的条件返回 SQL 子句的情况下才去插入“WHERE”子句。而且，<strong>若语句的开头为“AND”或“OR”，where元素也会将它们去除</strong></p>
<pre><code class="xml">&lt;select id=&quot;selectActiveBlogByTitle2&quot;  resultMap=&quot;blogResultMap&quot;&gt;
    select * from blogs
    &lt;where&gt;
        &lt;if test=&quot;featured != null&quot;&gt;
            featured = #{featured}
        &lt;/if&gt;
        &lt;if test=&quot;title != null&quot;&gt;
            AND title like #{title}
        &lt;/if&gt;
    &lt;/where&gt;
&lt;/select&gt;</code></pre>
<h2 id="set"><a href="#set" class="headerlink" title="set"></a>set</h2><p>可以使用set元素实现按需更新，指定具体需要更新的字段,set元素会动态前置 SET 关键字，同时也会删掉无关的逗号。</p>
<pre><code class="xml">&lt;update id=&quot;updateBlogByCondition&quot; parameterType=&quot;Blog&quot;&gt;
    update blogs
    &lt;set&gt;
        &lt;if test=&quot;title != null&quot;&gt;title = #{title},&lt;/if&gt;
        &lt;if test=&quot;authorId != null&quot;&gt;author_id = #{authorId},&lt;/if&gt;
        &lt;if test=&quot;featured != null&quot;&gt;featured = #{featured},&lt;/if&gt;
        &lt;if test=&quot;style != null&quot;&gt;style = #{style},&lt;/if&gt;
    &lt;/set&gt;
    where id = #{id}
&lt;/update&gt;</code></pre>
<h2 id="trim"><a href="#trim" class="headerlink" title="trim"></a>trim</h2><p>trim可以用于指定加入的前缀和指定自动去除的前面或后面的内容，它有下面四个属性</p>
<ul>
<li>prefix ：加入的前置名</li>
<li>suffix：加入的后缀名</li>
<li>prefixOverrides：自动去除前面的内容</li>
<li>suffiexOverrides：自动去除后面的内容</li>
</ul>
<blockquote>
<p><em>prefixOverrides</em>属性会忽略通过管道分隔的文本序列（注意此例中的空格也是必要的）。它的作用是移除所有指定在<em>prefixOverrides</em>属性中的内容，并且插入<em>prefix</em>属性中指定的内容。(<strong>suffiexOverrides</strong>同理）  </p>
</blockquote>
<p>where属性相当于：</p>
<pre><code class="xml">&lt;trim prefix=&quot;WHERE&quot; prefixOverrides=&quot;AND |OR &quot;&gt;
  ...
&lt;/trim&gt;</code></pre>
<p>set属性相当于:</p>
<pre><code class="xml">&lt;trim prefix=&quot;SET&quot; suffixOverrides=&quot;,&quot;&gt;
  ...
&lt;/trim&gt;</code></pre>
<h2 id="foreach"><a href="#foreach" class="headerlink" title="foreach"></a>foreach</h2><p>foreach是对一个集合进行遍历，通常是在构建 IN 条件语句的时候。</p>
<ul>
<li><code>item</code>：集合的值</li>
<li><code>index</code>：集合的索引</li>
<li><code>collection</code>:指定传入单数的类型， List、Set、Map 对象或者数组对象等都可以传递给<em>foreach</em>作为集合参数</li>
<li><code>open</code>：指定开头</li>
<li><code>sepatator</code>：指定分隔符</li>
<li><code>close</code>：指定结尾</li>
</ul>
<blockquote>
<p>当使用可迭代对象或者数组时，index 是当前迭代的次数，item 的值是本次迭代获取的元素。当使用 Map 对象（或者 Map.Entry 对象的集合）时，index 是键，item 是值。  </p>
</blockquote>
<pre><code class="xml">&lt;select id=&quot;selectPostIn&quot; resultType=&quot;domain.blog.Post&quot;&gt;
  SELECT *
  FROM POST P
  WHERE ID in
  &lt;foreach item=&quot;item&quot; index=&quot;index&quot; collection=&quot;list&quot;
      open=&quot;(&quot; separator=&quot;,&quot; close=&quot;)&quot;&gt;
        #{item}
  &lt;/foreach&gt;
&lt;/select&gt;</code></pre>
<h2 id="sql"><a href="#sql" class="headerlink" title="sql"></a>sql</h2><p>这个元素可以被用来定义可重用的 SQL 代码段，这些 SQL 代码可以被包含在其他语句中。它可以（在加载的时候）被静态地设置参数。 在不同的包含语句中可以设置不同的值到参数占位符上</p>
<pre><code class="xml">&lt;sql id=&quot;columnBase&quot;&gt;
    id,title,author_id as authorId,featured,style
&lt;/sql&gt;

&lt;!-- 引用方式 --&gt;
&lt;select id=&quot;selectBlog&quot; parameterType=&quot;int&quot; resultType=&quot;Blog&quot;&gt;
    select 
    &lt;include refid=&quot;columnBase&quot;&gt;&lt;/include&gt;
    from Blogs where id = #{id}
&lt;/select&gt;</code></pre>
<h1 id="鉴别器"><a href="#鉴别器" class="headerlink" title="鉴别器"></a>鉴别器</h1><p>如果一个数据表中，某个字段为不同值会影响其他字段，比如说A字段为1时，它的x字段有值，而y字段为空；而当A字段为2时，x字段为空，y字段有值。此时可以通过子类继承拓展的方式实现：<br>父类不包含x，y字段，两个子类继承父类分别包含x和y，然后在映射中使用鉴别器<code>discriminator</code>进行判别，自动生成对应的字类。</p>
<pre><code class="xml">&lt;resultMap type=&quot;Vehicle&quot; id=&quot;vehicleResultMap&quot;&gt;
      &lt;id column=&quot;id&quot; property=&quot;id&quot; jdbcType=&quot;INTEGER&quot;/&gt;

      &lt;!-- 根据指定字段的值设置不同的返回类型 --&gt;
      &lt;discriminator javaType=&quot;int&quot; column=&quot;vehicle_type&quot;&gt;
            &lt;!-- Car是继承Vehicle的字类，其多了一个doorCount成员变量 --&gt;
            &lt;case value=&quot;1&quot; resultType=&quot;Car&quot;&gt;
                  &lt;result column=&quot;door_count&quot; property=&quot;doorCount&quot;/&gt;
            &lt;/case&gt;
            &lt;case value=&quot;2&quot; resultType=&quot;Suv&quot;&gt;
                  &lt;result column=&quot;all_wheel_drive&quot;  property=&quot;allWheelDrive&quot;/&gt;
            &lt;/case&gt;
      &lt;/discriminator&gt;</code></pre>
</article><section class="jump-container is-flex is-justify-content-space-between my-6"><!-- em is empty placeholder--><a class="button is-default" href="/2019/05/22/mybatis-generator/" title="MyBaits Generator"><i class="iconfont icon-prev mr-2 has-text-grey"></i><span class="has-text-weight-semibold">上一页: MyBaits Generator</span></a><a class="button is-default" href="/2019/05/14/spring%E6%95%B0%E6%8D%AE%E8%AE%BF%E9%97%AE/" title="Spring数据访问"><span class="has-text-weight-semibold">下一页: Spring数据访问</span><i class="iconfont icon-next ml-2 has-text-grey"></i></a></section><article class="mt-6 comment-container"><script async repo="xiao-ming9/xiao-ming9.github.io" src="https://utteranc.es/client.js" issue-term="pathname" theme="preferred-color-scheme"></script></article></div></div></main></main><footer class="is-flex is-flex-direction-column is-align-items-center is-flex-shrink-0 is-family-serif"><section class="sns-container"><!-- Github--><!-- Ins--><!-- RSS--><!-- 知乎--><!-- 领英--><!-- 脸书--></section><p><span>Copyright ©</span><span> silverming 2021</span></p><div class="is-flex is-justify-content-center is-flex-wrap-wrap"><p>Powered by Hexo &verbar;&nbsp;</p><p class="is-flex is-justify-content-center"><a title="Hexo theme author" href="//github.com/haojen">Theme by Haojen&nbsp;</a></p><div style="margin-top: 2px"><a class="github-button" title="github-button" href="https://github.com/haojen/hexo-theme-Claudia" target="_blank" rel="noopener" data-color-scheme="no-preference: light; light: light; dark: dark;" data-show-count="true"></a></div></div><div><span>footnotes</span></div></footer><script async defer src="https://buttons.github.io/buttons.js"></script><script src="/js/post.js"></script></body></html>