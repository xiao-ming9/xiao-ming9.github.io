<!DOCTYPE html>
<html style="display: none;" lang="zh">
    <head>
    <meta charset="utf-8">
    <!--
        © Material Theme
        https://github.com/viosey/hexo-theme-material
        Version: 1.5.6 -->
    <script>
        window.materialVersion = "1.5.6"
        // Delete localstorage with these tags
        window.oldVersion = [
            'codestartv1',
            '1.3.4',
            '1.4.0',
            '1.4.0b1',
            '1.5.0',
            '1.5.2',
            '1.5.5'
        ]
    </script>

    <!-- dns prefetch -->
    <meta http-equiv="x-dns-prefetch-control" content="on">





    <link rel="dns-prefetch" href="https://.disqus.com"/>



    <link rel="dns-prefetch" href="https://hm.baidu.com"/>

    <link rel="dns-prefetch" href="https://www.google-analytics.com"/>



    <link rel="dns-prefetch" href="https://fonts.proxy.ustclug.org"/>





    <!-- Meta & Info -->
    <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
    <meta name="renderer" content="webkit">
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">

    <!-- Title -->
    
    <title>
        
            Nginx基本配置和模块 | 
        
        Silverming
    </title>

    <!-- Favicons -->
    <link rel="icon shortcut" type="image/ico" href="https://qiniu.xiaoming.net.cn/%E5%8D%9A%E5%AE%A2icon.jpeg">
    <link rel="icon" href="https://qiniu.xiaoming.net.cn/%E5%8D%9A%E5%AE%A2icon.jpeg">

    <meta name="format-detection" content="telephone=no"/>
    <meta name="description" itemprop="description" content="Nginx基本配置#user  nobody;     #设置nginx服务的系统使用用户
worker_processes  1;     #工作进程数，一般跟电脑cpu保持一致

#error_log  logs/error.log;     #nginx错误日志
#error_log  logs/error.log  notice;
#error_log  logs/error.log  info; #错误日志级别

#pid        logs/nginx.pid;     #nginx服务启动的pid


events {
    worker_connections  1024;     #每个进程允许最大连接数
    #use;    #工作进程数
}


http {
    include       mime.types;
    default_type  application/octet-stream;

      #日志语法，main表示格式名称
    #log_format  main  &amp;#39;$remote_addr - $remote_user [$time_local] &amp;quot;$request&amp;quot; &amp;#39;
    #                  &amp;#39;$status $body_bytes_sent &amp;quot;$http_referer&amp;quot; &amp;#39;
    #                  &amp;#39;&amp;quot;$http_user_agent&amp;quot; &amp;quot;$http_x_forwarded_for&amp;quot;&amp;#39;;

    #access_log  logs/access.log  main; #日志位置，与上面的main对应

    sendfile        on;
    #tcp_nopush     on;

    #keepalive_timeout  0;
    keepalive_timeout  65; #连接超时时间

    #gzip  on;
    # 每个服务配置一个server
    server {
        listen       8080;     #监听端口
        server_name  localhost;    #服务器名称

        #charset koi8-r;

        #access_log  logs/host.access.log  main;

    #路径控制（加“/”表示控制首页路径）
        location / {
            root   html;    #首页文件路径
            index  index.html index.htm;
        }

        #error_page  404              /404.html; #统一错误页面，指定错误码定位到错误路径

        # redirect server error pages to the static page /50x.html
        #
        error_page   500 502 503 504  /50x.html;

    # 将上面指定的错误路径指定到特定的路径页面
        location = /50x.html {
            root   html;
        } 
    }
    include servers/*; #导入其他子配置文件
}">
    <meta name="keywords" content=",nginx">
    <meta name="theme-color" content="#0097A7">

    <!-- Disable Fucking Bloody Baidu Tranformation -->
    <meta http-equiv="Cache-Control" content="no-transform" />
    <meta http-equiv="Cache-Control" content="no-siteapp" />

    <!--[if lte IE 9]>
        <link rel="stylesheet" href="/css/ie-blocker.css">

        
            <script src="/js/ie-blocker.zhCN.js"></script>
        
    <![endif]-->

    <!-- Import lsloader -->
    <script>(function(){window.lsloader={jsRunSequence:[],jsnamemap:{},cssnamemap:{}};lsloader.removeLS=function(a){try{localStorage.removeItem(a)}catch(b){}};lsloader.setLS=function(a,c){try{localStorage.setItem(a,c)}catch(b){}};lsloader.getLS=function(a){var c="";try{c=localStorage.getItem(a)}catch(b){c=""}return c};versionString="/*"+(window.materialVersion||"unknownVersion")+"*/";lsloader.clean=function(){try{var b=[];for(var a=0;a<localStorage.length;a++){b.push(localStorage.key(a))}b.forEach(function(e){var f=lsloader.getLS(e);if(window.oldVersion){var d=window.oldVersion.reduce(function(g,h){return g||f.indexOf("/*"+h+"*/")!==-1},false);if(d){lsloader.removeLS(e)}}})}catch(c){}};lsloader.clean();lsloader.load=function(f,a,b,d){if(typeof b==="boolean"){d=b;b=undefined}d=d||false;b=b||function(){};var e;e=this.getLS(f);if(e&&e.indexOf(versionString)===-1){this.removeLS(f);this.requestResource(f,a,b,d);return}if(e){var c=e.split(versionString)[0];if(c!=a){console.log("reload:"+a);this.removeLS(f);this.requestResource(f,a,b,d);return}e=e.split(versionString)[1];if(d){this.jsRunSequence.push({name:f,code:e});this.runjs(a,f,e)}else{document.getElementById(f).appendChild(document.createTextNode(e));b()}}else{this.requestResource(f,a,b,d)}};lsloader.requestResource=function(b,e,a,c){var d=this;if(c){this.iojs(e,b,function(h,f,g){d.setLS(f,h+versionString+g);d.runjs(h,f,g)})}else{this.iocss(e,b,function(f){document.getElementById(b).appendChild(document.createTextNode(f));d.setLS(b,e+versionString+f)},a)}};lsloader.iojs=function(d,b,g){var a=this;a.jsRunSequence.push({name:b,code:""});try{var f=new XMLHttpRequest();f.open("get",d,true);f.onreadystatechange=function(){if(f.readyState==4){if((f.status>=200&&f.status<300)||f.status==304){if(f.response!=""){g(d,b,f.response);return}}a.jsfallback(d,b)}};f.send(null)}catch(c){a.jsfallback(d,b)}};lsloader.iocss=function(f,c,h,a){var b=this;try{var g=new XMLHttpRequest();g.open("get",f,true);g.onreadystatechange=function(){if(g.readyState==4){if((g.status>=200&&g.status<300)||g.status==304){if(g.response!=""){h(g.response);a();return}}b.cssfallback(f,c,a)}};g.send(null)}catch(d){b.cssfallback(f,c,a)}};lsloader.iofonts=function(f,c,h,a){var b=this;try{var g=new XMLHttpRequest();g.open("get",f,true);g.onreadystatechange=function(){if(g.readyState==4){if((g.status>=200&&g.status<300)||g.status==304){if(g.response!=""){h(g.response);a();return}}b.cssfallback(f,c,a)}};g.send(null)}catch(d){b.cssfallback(f,c,a)}};lsloader.runjs=function(f,c,e){if(!!c&&!!e){for(var b in this.jsRunSequence){if(this.jsRunSequence[b].name==c){this.jsRunSequence[b].code=e}}}if(!!this.jsRunSequence[0]&&!!this.jsRunSequence[0].code&&this.jsRunSequence[0].status!="failed"){var a=document.createElement("script");a.appendChild(document.createTextNode(this.jsRunSequence[0].code));a.type="text/javascript";document.getElementsByTagName("head")[0].appendChild(a);this.jsRunSequence.shift();if(this.jsRunSequence.length>0){this.runjs()}}else{if(!!this.jsRunSequence[0]&&this.jsRunSequence[0].status=="failed"){var d=this;var a=document.createElement("script");a.src=this.jsRunSequence[0].path;a.type="text/javascript";this.jsRunSequence[0].status="loading";a.onload=function(){d.jsRunSequence.shift();if(d.jsRunSequence.length>0){d.runjs()}};document.body.appendChild(a)}}};lsloader.tagLoad=function(b,a){this.jsRunSequence.push({name:a,code:"",path:b,status:"failed"});this.runjs()};lsloader.jsfallback=function(c,b){if(!!this.jsnamemap[b]){return}else{this.jsnamemap[b]=b}for(var a in this.jsRunSequence){if(this.jsRunSequence[a].name==b){this.jsRunSequence[a].code="";this.jsRunSequence[a].status="failed";this.jsRunSequence[a].path=c}}this.runjs()};lsloader.cssfallback=function(e,c,b){if(!!this.cssnamemap[c]){return}else{this.cssnamemap[c]=1}var d=document.createElement("link");d.type="text/css";d.href=e;d.rel="stylesheet";d.onload=d.onerror=b;var a=document.getElementsByTagName("script")[0];a.parentNode.insertBefore(d,a)};lsloader.runInlineScript=function(c,b){var a=document.getElementById(b).innerText;this.jsRunSequence.push({name:c,code:a});this.runjs()}})();</script>

    <!-- Import queue -->
    <script>function Queue(){this.dataStore=[];this.offer=b;this.poll=d;this.execNext=a;this.debug=false;this.startDebug=c;function b(e){if(this.debug){console.log("Offered a Queued Function.")}if(typeof e==="function"){this.dataStore.push(e)}else{console.log("You must offer a function.")}}function d(){if(this.debug){console.log("Polled a Queued Function.")}return this.dataStore.shift()}function a(){var e=this.poll();if(e!==undefined){if(this.debug){console.log("Run a Queued Function.")}e()}}function c(){this.debug=true}}var queue=new Queue();</script>

    <!-- Import CSS -->
    
        <style id="material_css"></style><script>if(typeof window.lsLoadCSSMaxNums === "undefined")window.lsLoadCSSMaxNums = 0;window.lsLoadCSSMaxNums++;lsloader.load("material_css","/css/material.min.css?Z7a72R1E4SxzBKR/WGctOA==",function(){if(typeof window.lsLoadCSSNums === "undefined")window.lsLoadCSSNums = 0;window.lsLoadCSSNums++;if(window.lsLoadCSSNums == window.lsLoadCSSMaxNums)document.documentElement.style.display="";}, false)</script>
        <style id="style_css"></style><script>if(typeof window.lsLoadCSSMaxNums === "undefined")window.lsLoadCSSMaxNums = 0;window.lsLoadCSSMaxNums++;lsloader.load("style_css","/css/style.min.css?NKhlKQkXw/c66TR5p4wO+w==",function(){if(typeof window.lsLoadCSSNums === "undefined")window.lsLoadCSSNums = 0;window.lsLoadCSSNums++;if(window.lsLoadCSSNums == window.lsLoadCSSMaxNums)document.documentElement.style.display="";}, false)</script>

        
            
                <style id="prettify_css"></style><script>if(typeof window.lsLoadCSSMaxNums === "undefined")window.lsLoadCSSMaxNums = 0;window.lsLoadCSSMaxNums++;lsloader.load("prettify_css","/css/prettify.min.css?zp8STOU9v89XWFEnN+6YmQ==",function(){if(typeof window.lsLoadCSSNums === "undefined")window.lsLoadCSSNums = 0;window.lsLoadCSSNums++;if(window.lsLoadCSSNums == window.lsLoadCSSMaxNums)document.documentElement.style.display="";}, false)</script>
                <style id="prettify_theme"></style><script>if(typeof window.lsLoadCSSMaxNums === "undefined")window.lsLoadCSSMaxNums = 0;window.lsLoadCSSMaxNums++;lsloader.load("prettify_theme","/css/prettify/github-v2.min.css?AfzKxt++K+/lhZBlSjnxwg==",function(){if(typeof window.lsLoadCSSNums === "undefined")window.lsLoadCSSNums = 0;window.lsLoadCSSNums++;if(window.lsLoadCSSNums == window.lsLoadCSSMaxNums)document.documentElement.style.display="";}, false)</script>
            
        

    

    

    <!-- Config CSS -->

<!-- Other Styles -->
<style>
  body, html {
    font-family: Roboto, "Helvetica Neue", Helvetica, "PingFang SC", "Hiragino Sans GB", "Microsoft YaHei", "微软雅黑", Arial, sans-serif;
    overflow-x: hidden !important;
  }
  
  code {
    font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
  }

  a {
    color: #00838F;
  }

  .mdl-card__media,
  #search-label,
  #search-form-label:after,
  #scheme-Paradox .hot_tags-count,
  #scheme-Paradox .sidebar_archives-count,
  #scheme-Paradox .sidebar-colored .sidebar-header,
  #scheme-Paradox .sidebar-colored .sidebar-badge{
    background-color: #0097A7 !important;
  }

  /* Sidebar User Drop Down Menu Text Color */
  #scheme-Paradox .sidebar-colored .sidebar-nav>.dropdown>.dropdown-menu>li>a:hover,
  #scheme-Paradox .sidebar-colored .sidebar-nav>.dropdown>.dropdown-menu>li>a:focus {
    color: #0097A7 !important;
  }

  #post_entry-right-info,
  .sidebar-colored .sidebar-nav li:hover > a,
  .sidebar-colored .sidebar-nav li:hover > a i,
  .sidebar-colored .sidebar-nav li > a:hover,
  .sidebar-colored .sidebar-nav li > a:hover i,
  .sidebar-colored .sidebar-nav li > a:focus i,
  .sidebar-colored .sidebar-nav > .open > a,
  .sidebar-colored .sidebar-nav > .open > a:hover,
  .sidebar-colored .sidebar-nav > .open > a:focus,
  #ds-reset #ds-ctx .ds-ctx-entry .ds-ctx-head a {
    color: #0097A7 !important;
  }

  .toTop {
    background: #757575 !important;
  }

  .material-layout .material-post>.material-nav,
  .material-layout .material-index>.material-nav,
  .material-nav a {
    color: #757575;
  }

  #scheme-Paradox .MD-burger-layer {
    background-color: #757575;
  }

  #scheme-Paradox #post-toc-trigger-btn {
    color: #757575;
  }

  .post-toc a:hover {
    color: #00838F;
    text-decoration: underline;
  }

</style>


<!-- Theme Background Related-->

    <style>
      body{
        background-image: url(/img/bg.png);
      }
    </style>




<!-- Fade Effect -->

    <style>
      .fade {
        transition: all 800ms linear;
        -webkit-transform: translate3d(0,0,0);
        -moz-transform: translate3d(0,0,0);
        -ms-transform: translate3d(0,0,0);
        -o-transform: translate3d(0,0,0);
        transform: translate3d(0,0,0);
        opacity: 1;
      }

      .fade.out{
        opacity: 0;
      }
    </style>


<!-- Import Font -->
<!-- Import Roboto -->

    <link href="https://fonts.proxy.ustclug.org/css?family=Roboto:300,400,500" rel="stylesheet">


<!-- Import Material Icons -->


    <style id="material_icons"></style><script>if(typeof window.lsLoadCSSMaxNums === "undefined")window.lsLoadCSSMaxNums = 0;window.lsLoadCSSMaxNums++;lsloader.load("material_icons","/css/material-icons.css?pqhB/Rd/ab0H2+kZp0RDmw==",function(){if(typeof window.lsLoadCSSNums === "undefined")window.lsLoadCSSNums = 0;window.lsLoadCSSNums++;if(window.lsLoadCSSNums == window.lsLoadCSSMaxNums)document.documentElement.style.display="";}, false)</script>




    <!-- Import jQuery -->
    
        <script>lsloader.load("jq_js","/js/jquery.min.js?qcusAULNeBksqffqUM2+Ig==", true)</script>
    

    <!-- WebAPP Icons -->
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="application-name" content="Silverming">
    <meta name="msapplication-starturl" content="http://yoursite.com/2019/07/21/Nginx%E5%9F%BA%E6%9C%AC%E9%85%8D%E7%BD%AE%E5%92%8C%E6%A8%A1%E5%9D%97/">
    <meta name="msapplication-navbutton-color" content="#0097A7">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-title" content="Silverming">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon" href="https://qiniu.xiaoming.net.cn/%E5%8D%9A%E5%AE%A2icon.jpeg">

    <!-- Site Verification -->
    
    

    <!-- RSS -->
    

    <!-- The Open Graph protocol -->
    <meta property="og:url" content="http://yoursite.com/2019/07/21/Nginx%E5%9F%BA%E6%9C%AC%E9%85%8D%E7%BD%AE%E5%92%8C%E6%A8%A1%E5%9D%97/">
    <meta property="og:type" content="blog">
    <meta property="og:title" content="Nginx基本配置和模块 | Silverming">
    <meta property="og:image" content="https://qiniu.xiaoming.net.cn/%E5%8D%9A%E5%AE%A2icon.jpeg">
    <meta property="og:description" content="Nginx基本配置#user  nobody;     #设置nginx服务的系统使用用户
worker_processes  1;     #工作进程数，一般跟电脑cpu保持一致

#error_log  logs/error.log;     #nginx错误日志
#error_log  logs/error.log  notice;
#error_log  logs/error.log  info; #错误日志级别

#pid        logs/nginx.pid;     #nginx服务启动的pid


events {
    worker_connections  1024;     #每个进程允许最大连接数
    #use;    #工作进程数
}


http {
    include       mime.types;
    default_type  application/octet-stream;

      #日志语法，main表示格式名称
    #log_format  main  &amp;#39;$remote_addr - $remote_user [$time_local] &amp;quot;$request&amp;quot; &amp;#39;
    #                  &amp;#39;$status $body_bytes_sent &amp;quot;$http_referer&amp;quot; &amp;#39;
    #                  &amp;#39;&amp;quot;$http_user_agent&amp;quot; &amp;quot;$http_x_forwarded_for&amp;quot;&amp;#39;;

    #access_log  logs/access.log  main; #日志位置，与上面的main对应

    sendfile        on;
    #tcp_nopush     on;

    #keepalive_timeout  0;
    keepalive_timeout  65; #连接超时时间

    #gzip  on;
    # 每个服务配置一个server
    server {
        listen       8080;     #监听端口
        server_name  localhost;    #服务器名称

        #charset koi8-r;

        #access_log  logs/host.access.log  main;

    #路径控制（加“/”表示控制首页路径）
        location / {
            root   html;    #首页文件路径
            index  index.html index.htm;
        }

        #error_page  404              /404.html; #统一错误页面，指定错误码定位到错误路径

        # redirect server error pages to the static page /50x.html
        #
        error_page   500 502 503 504  /50x.html;

    # 将上面指定的错误路径指定到特定的路径页面
        location = /50x.html {
            root   html;
        } 
    }
    include servers/*; #导入其他子配置文件
}">
    <meta property="og:article:tag" content="nginx"> 

    
        <meta property="article:published_time" content="Sun Jul 21 2019 21:33:58 GMT+0800">
        <meta property="article:modified_time" content="Tue Dec 01 2020 18:40:51 GMT+0800">
    

    <!-- The Twitter Card protocol -->
    <meta name="twitter:card" content="summary_large_image">

    <!-- Add canonical link for SEO -->
    
        <link rel="canonical" href="http://yoursite.com/2019/07/21/Nginx%E5%9F%BA%E6%9C%AC%E9%85%8D%E7%BD%AE%E5%92%8C%E6%A8%A1%E5%9D%97/index.html" />
    

    <!-- Structured-data for SEO -->
    
        


<script type="application/ld+json">
{
    "@context": "https://schema.org",
    "@type": "BlogPosting",
    "mainEntityOfPage": "http://yoursite.com/2019/07/21/Nginx%E5%9F%BA%E6%9C%AC%E9%85%8D%E7%BD%AE%E5%92%8C%E6%A8%A1%E5%9D%97/index.html",
    "headline": "Nginx基本配置和模块",
    "datePublished": "Sun Jul 21 2019 21:33:58 GMT+0800",
    "dateModified": "Tue Dec 01 2020 18:40:51 GMT+0800",
    "author": {
        "@type": "Person",
        "name": "Silverming",
        "image": {
            "@type": "ImageObject",
            "url": "https://qiniu.xiaoming.net.cn/%E5%8D%9A%E5%AE%A2%E5%A4%B4%E5%83%8F.jpeg"
        },
        "description": "Stay foolish, stay hungry."
    },
    "publisher": {
        "@type": "Organization",
        "name": "Silverming",
        "logo": {
            "@type":"ImageObject",
            "url": "https://qiniu.xiaoming.net.cn/%E5%8D%9A%E5%AE%A2icon.jpeg"
        }
    },
    "keywords": ",nginx",
    "description": "Nginx基本配置#user  nobody;     #设置nginx服务的系统使用用户
worker_processes  1;     #工作进程数，一般跟电脑cpu保持一致

#error_log  logs/error.log;     #nginx错误日志
#error_log  logs/error.log  notice;
#error_log  logs/error.log  info; #错误日志级别

#pid        logs/nginx.pid;     #nginx服务启动的pid


events {
    worker_connections  1024;     #每个进程允许最大连接数
    #use;    #工作进程数
}


http {
    include       mime.types;
    default_type  application/octet-stream;

      #日志语法，main表示格式名称
    #log_format  main  &amp;#39;$remote_addr - $remote_user [$time_local] &amp;quot;$request&amp;quot; &amp;#39;
    #                  &amp;#39;$status $body_bytes_sent &amp;quot;$http_referer&amp;quot; &amp;#39;
    #                  &amp;#39;&amp;quot;$http_user_agent&amp;quot; &amp;quot;$http_x_forwarded_for&amp;quot;&amp;#39;;

    #access_log  logs/access.log  main; #日志位置，与上面的main对应

    sendfile        on;
    #tcp_nopush     on;

    #keepalive_timeout  0;
    keepalive_timeout  65; #连接超时时间

    #gzip  on;
    # 每个服务配置一个server
    server {
        listen       8080;     #监听端口
        server_name  localhost;    #服务器名称

        #charset koi8-r;

        #access_log  logs/host.access.log  main;

    #路径控制（加“/”表示控制首页路径）
        location / {
            root   html;    #首页文件路径
            index  index.html index.htm;
        }

        #error_page  404              /404.html; #统一错误页面，指定错误码定位到错误路径

        # redirect server error pages to the static page /50x.html
        #
        error_page   500 502 503 504  /50x.html;

    # 将上面指定的错误路径指定到特定的路径页面
        location = /50x.html {
            root   html;
        } 
    }
    include servers/*; #导入其他子配置文件
}",
}
</script>


    

    <!-- Analytics -->
    
        <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
    ga('create', 'G-M2RT7SDT3L', 'auto');ga('send', 'pageview');
</script>
    
    
        <script>
    var _hmt = _hmt || [];
    (function() {var hm = document.createElement('script');
    hm.src = 'https://hm.baidu.com/hm.js?54ebb03ad7ad5b762ac8ff7958df6d3f';
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(hm, s);
    })();
</script>
    
    

    <!-- Custom Head -->
    

</head>


    
        <body id="scheme-Paradox" class="lazy">
            <div class="material-layout  mdl-js-layout has-drawer is-upgraded">
                

                <!-- Main Container -->
                <main class="material-layout__content" id="main">

                    <!-- Top Anchor -->
                    <div id="top"></div>

                    
                        <!-- Hamburger Button -->
                        <button class="MD-burger-icon sidebar-toggle">
                            <span id="MD-burger-id" class="MD-burger-layer"></span>
                        </button>
                    

                    <!-- Post TOC -->

    
    <!-- Back Button -->
    <!--
    <div class="material-back" id="backhome-div" tabindex="0">
        <a class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon"
           href="#" onclick="window.history.back();return false;"
           target="_self"
           role="button"
           data-upgraded=",MaterialButton,MaterialRipple">
            <i class="material-icons" role="presentation">arrow_back</i>
            <span class="mdl-button__ripple-container">
                <span class="mdl-ripple"></span>
            </span>
        </a>
    </div>
    -->


    <!-- Left aligned menu below button -->
    
    
    <button id="post-toc-trigger-btn"
        class="mdl-button mdl-js-button mdl-button--icon">
        <i class="material-icons">format_list_numbered</i>
    </button>

    <ul class="post-toc-wrap mdl-menu mdl-menu--bottom-left mdl-js-menu mdl-js-ripple-effect" for="post-toc-trigger-btn" style="max-height:80vh; overflow-y:scroll;">
        <ol class="post-toc"><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#Nginx基本配置"><span class="post-toc-number">1.</span> <span class="post-toc-text">Nginx基本配置</span></a></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#Nginx日志类型"><span class="post-toc-number">2.</span> <span class="post-toc-text">Nginx日志类型</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#nginx变量"><span class="post-toc-number">2.1.</span> <span class="post-toc-text">nginx变量</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#配置语法"><span class="post-toc-number">2.2.</span> <span class="post-toc-text">配置语法</span></a></li></ol></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#Nginx模块"><span class="post-toc-number">3.</span> <span class="post-toc-text">Nginx模块</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#http-stub-status-module配置"><span class="post-toc-number">3.1.</span> <span class="post-toc-text">http_stub_status_module配置</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#http-random-index-module模块"><span class="post-toc-number">3.2.</span> <span class="post-toc-text">http_random_index_module模块</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#http-sub-module模块"><span class="post-toc-number">3.3.</span> <span class="post-toc-text">http_sub_module模块</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#Nginx请求限制模块"><span class="post-toc-number">3.4.</span> <span class="post-toc-text">Nginx请求限制模块</span></a></li></ol></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#指明具体使用的限制空间-可以定义在http，server，location中"><span class="post-toc-number">4.</span> <span class="post-toc-text">指明具体使用的限制空间,可以定义在http，server，location中</span></a></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#zone：空间名，表示使用哪一块空间"><span class="post-toc-number">5.</span> <span class="post-toc-text">zone：空间名，表示使用哪一块空间</span></a></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#number：同一时间允许的连接并发数"><span class="post-toc-number">6.</span> <span class="post-toc-text">number：同一时间允许的连接并发数</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#Nginx访问控制模块"><span class="post-toc-number">6.1.</span> <span class="post-toc-text">Nginx访问控制模块</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#http-access-module"><span class="post-toc-number">6.1.1.</span> <span class="post-toc-text">http_access_module</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#http-auth-basic-module"><span class="post-toc-number">6.1.2.</span> <span class="post-toc-text">http_auth_basic_module</span></a></li></ol></li></ol></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#comment"><span class="post-toc-number">7.</span> <span class="post-toc-text">comment</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#secure-link-midule"><span class="post-toc-number">7.0.1.</span> <span class="post-toc-text">secure_link_midule</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#配置语法-1"><span class="post-toc-number">7.0.2.</span> <span class="post-toc-text">配置语法</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#配置示例"><span class="post-toc-number">7.0.3.</span> <span class="post-toc-text">配置示例</span></a></li></ol></li></ol></li></ol>
    </ul>
    




<!-- Layouts -->

    <!-- Post Module -->
    <div class="material-post_container">

        <div class="material-post mdl-grid">
            <div class="mdl-card mdl-shadow--4dp mdl-cell mdl-cell--12-col">

                <!-- Post Header(Thumbnail & Title) -->
                
    <!-- Paradox Post Header -->
    
        
            <!-- Random Thumbnail -->
            <div class="post_thumbnail-random mdl-card__media mdl-color-text--grey-50">
            <script type="text/ls-javascript" id="post-thumbnail-script">
    var randomNum = Math.floor(Math.random() * 19 + 1);

    $('.post_thumbnail-random').attr('data-original', '/img/random/material-' + randomNum + '.png');
    $('.post_thumbnail-random').addClass('lazy');
</script>

        
    
            <p class="article-headline-p">
                Nginx基本配置和模块
            </p>
        </div>





                
                    <!-- Paradox Post Info -->
                    <div class="mdl-color-text--grey-700 mdl-card__supporting-text meta">

    <!-- Author Avatar -->
    <div id="author-avatar">
        <img src="https://qiniu.xiaoming.net.cn/%E5%8D%9A%E5%AE%A2%E5%A4%B4%E5%83%8F.jpeg" width="44px" height="44px" alt="Author Avatar"/>
    </div>
    <!-- Author Name & Date -->
    <div>
        <strong>Silverming</strong>
        <span>7月 21, 2019</span>
    </div>

    <div class="section-spacer"></div>

    <!-- Favorite -->
    <!--
        <button id="article-functions-like-button" class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon btn-like">
            <i class="material-icons" role="presentation">favorite</i>
            <span class="visuallyhidden">favorites</span>
        </button>
    -->

    <!-- Qrcode -->
    
        <button id="article-functions-qrcode-button" class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon">
    <i class="material-icons" role="presentation">devices other</i>
    <span class="visuallyhidden">devices other</span>
</button>
<ul class="mdl-menu mdl-menu--bottom-right mdl-js-menu mdl-js-ripple-effect" for="article-functions-qrcode-button">
    <li class="mdl-menu__item">在其它设备中阅读本文章</li>
    
        <img src="https://pan.baidu.com/share/qrcode?w=246&h=246&url=http://yoursite.com/2019/07/21/Nginx%E5%9F%BA%E6%9C%AC%E9%85%8D%E7%BD%AE%E5%92%8C%E6%A8%A1%E5%9D%97/">
    
</ul>

    

    <!-- Tags (bookmark) -->
    
    <button id="article-functions-viewtags-button" class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon">
        <i class="material-icons" role="presentation">bookmark</i>
        <span class="visuallyhidden">bookmark</span>
    </button>
    <ul class="mdl-menu mdl-menu--bottom-right mdl-js-menu mdl-js-ripple-effect" for="article-functions-viewtags-button">
        <li class="mdl-menu__item">
        <a class="post_tag-link" href="/tags/nginx/" rel="tag">nginx</a>
    </ul>
    

    <!-- Share -->
    
        <button id="article-fuctions-share-button" class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon">
    <i class="material-icons" role="presentation">share</i>
    <span class="visuallyhidden">share</span>
</button>
<ul class="mdl-menu mdl-menu--bottom-right mdl-js-menu mdl-js-ripple-effect" for="article-fuctions-share-button">
    

    

    <!-- Share Weibo -->
    
        <a class="post_share-link" href="http://service.weibo.com/share/share.php?appkey=&title=Nginx基本配置和模块&url=http://yoursite.com/2019/07/21/Nginx%E5%9F%BA%E6%9C%AC%E9%85%8D%E7%BD%AE%E5%92%8C%E6%A8%A1%E5%9D%97/index.html&pic=http://yoursite.comhttps://qiniu.xiaoming.net.cn/%E5%8D%9A%E5%AE%A2icon.jpeg&searchPic=false&style=simple" target="_blank">
            <li class="mdl-menu__item">
                分享到微博
            </li>
        </a>
    

    <!-- Share Twitter -->
    
        <a class="post_share-link" href="https://twitter.com/intent/tweet?text=Nginx基本配置和模块&url=http://yoursite.com/2019/07/21/Nginx%E5%9F%BA%E6%9C%AC%E9%85%8D%E7%BD%AE%E5%92%8C%E6%A8%A1%E5%9D%97/index.html&via=Silverming" target="_blank">
            <li class="mdl-menu__item">
                分享到 Twitter
            </li>
        </a>
    

    <!-- Share Facebook -->
    
        <a class="post_share-link" href="https://www.facebook.com/sharer/sharer.php?u=http://yoursite.com/2019/07/21/Nginx%E5%9F%BA%E6%9C%AC%E9%85%8D%E7%BD%AE%E5%92%8C%E6%A8%A1%E5%9D%97/index.html" target="_blank">
            <li class="mdl-menu__item">
                分享到 Facebook
            </li>
        </a>
    

    <!-- Share Google+ -->
    
        <a class="post_share-link" href="https://plus.google.com/share?url=http://yoursite.com/2019/07/21/Nginx%E5%9F%BA%E6%9C%AC%E9%85%8D%E7%BD%AE%E5%92%8C%E6%A8%A1%E5%9D%97/index.html" target="_blank">
            <li class="mdl-menu__item">
                分享到 Google+
            </li>
        </a>
    

    <!-- Share LinkedIn -->
    
        <a class="post_share-link" href="https://www.linkedin.com/shareArticle?mini=true&url=http://yoursite.com/2019/07/21/Nginx%E5%9F%BA%E6%9C%AC%E9%85%8D%E7%BD%AE%E5%92%8C%E6%A8%A1%E5%9D%97/index.html&title=Nginx基本配置和模块" target="_blank">
            <li class="mdl-menu__item">
                分享到 LinkedIn
            </li>
        </a>
    

    <!-- Share QQ -->
    
        <a class="post_share-link" href="http://connect.qq.com/widget/shareqq/index.html?site=Silverming&title=Nginx基本配置和模块&summary=Wechat:934933088&pics=http://yoursite.comhttps://qiniu.xiaoming.net.cn/%E5%8D%9A%E5%AE%A2icon.jpeg&url=http://yoursite.com/2019/07/21/Nginx%E5%9F%BA%E6%9C%AC%E9%85%8D%E7%BD%AE%E5%92%8C%E6%A8%A1%E5%9D%97/index.html" target="_blank">
            <li class="mdl-menu__item">
                分享到 QQ
            </li>
        </a>
    

    <!-- Share Telegram -->
    
        <a class="post_share-link" href="https://telegram.me/share/url?url=http://yoursite.com/2019/07/21/Nginx%E5%9F%BA%E6%9C%AC%E9%85%8D%E7%BD%AE%E5%92%8C%E6%A8%A1%E5%9D%97/index.html&text=Nginx基本配置和模块" target="_blank">
            <li class="mdl-menu__item">
                分享到 Telegram
            </li>
        </a>
    
</ul>

    
</div>

                

                <!-- Post Content -->
                <div id="post-content" class="mdl-color-text--grey-700 mdl-card__supporting-text fade out">
    
        <h1 id="Nginx基本配置"><a href="#Nginx基本配置" class="headerlink" title="Nginx基本配置"></a>Nginx基本配置</h1><pre><code class="nginx">#user  nobody;     #设置nginx服务的系统使用用户
worker_processes  1;     #工作进程数，一般跟电脑cpu保持一致

#error_log  logs/error.log;     #nginx错误日志
#error_log  logs/error.log  notice;
#error_log  logs/error.log  info; #错误日志级别

#pid        logs/nginx.pid;     #nginx服务启动的pid


events {
    worker_connections  1024;     #每个进程允许最大连接数
    #use;    #工作进程数
}


http {
    include       mime.types;
    default_type  application/octet-stream;

      #日志语法，main表示格式名称
    #log_format  main  &#39;$remote_addr - $remote_user [$time_local] &quot;$request&quot; &#39;
    #                  &#39;$status $body_bytes_sent &quot;$http_referer&quot; &#39;
    #                  &#39;&quot;$http_user_agent&quot; &quot;$http_x_forwarded_for&quot;&#39;;

    #access_log  logs/access.log  main; #日志位置，与上面的main对应

    sendfile        on;
    #tcp_nopush     on;

    #keepalive_timeout  0;
    keepalive_timeout  65; #连接超时时间

    #gzip  on;
    # 每个服务配置一个server
    server {
        listen       8080;     #监听端口
        server_name  localhost;    #服务器名称

        #charset koi8-r;

        #access_log  logs/host.access.log  main;

    #路径控制（加“/”表示控制首页路径）
        location / {
            root   html;    #首页文件路径
            index  index.html index.htm;
        }

        #error_page  404              /404.html; #统一错误页面，指定错误码定位到错误路径

        # redirect server error pages to the static page /50x.html
        #
        error_page   500 502 503 504  /50x.html;

    # 将上面指定的错误路径指定到特定的路径页面
        location = /50x.html {
            root   html;
        } 
    }
    include servers/*; #导入其他子配置文件
}</code></pre>
<a id="more"></a>
<h1 id="Nginx日志类型"><a href="#Nginx日志类型" class="headerlink" title="Nginx日志类型"></a>Nginx日志类型</h1><p>包括:<strong>error.log</strong>和<strong>access_log</strong><br>error.log:错误日志<br>access_log:每次请求的状态<br>日志的形式可以在配置文件中进行配置</p>
<h2 id="nginx变量"><a href="#nginx变量" class="headerlink" title="nginx变量"></a>nginx变量</h2><p>在配置日志格式时，可以使用以下变量进行配置；</p>
<ul>
<li>HTTP请求变量：<code>arg_PARAMETER</code>,<code>http_HEADER</code>,<code>sent_http_HEADER</code></li>
<li>内置变量：Nginx有内置的许多变量，可以上官网查看</li>
<li>自定义变量</li>
</ul>
<h2 id="配置语法"><a href="#配置语法" class="headerlink" title="配置语法"></a>配置语法</h2><p>参考上面基础配置示例，在变量前加上美元符，同时使用单引号扩起来</p>
<pre><code class="nginx">log_format main &#39;$remote_addr - $remote_user [$time_local] &quot;$request&quot; &#39;
                 &#39;$status $body_bytes_sent &quot;$http_referer&quot; &#39;
                &#39;&quot;$http_user_agent&quot; &quot;$http_x_forwarded_for&quot;&#39;</code></pre>
<h1 id="Nginx模块"><a href="#Nginx模块" class="headerlink" title="Nginx模块"></a>Nginx模块</h1><h2 id="http-stub-status-module配置"><a href="#http-stub-status-module配置" class="headerlink" title="http_stub_status_module配置"></a>http_stub_status_module配置</h2><p>用于展示Nginx处理当前连接的客户端状态，默认没有配置，可以在配置文件的server,location中配置</p>
<pre><code class="nginx">location /mystatus{
        stub_status;
}</code></pre>
<p>更改完配置之后可以先测试文件是否出错：</p>
<blockquote>
<p>nginx -tc /usr/local/etc/nginx/nginx.conf  </p>
</blockquote>
<p>测试成功之后重新加载配置文件：</p>
<blockquote>
<p>nginx -s reload -c /usr/local/etc/nginx/nginx.conf  </p>
</blockquote>
<p>访问定义的<code>mystatus</code>页面：出现以下内容：</p>
<pre><code class="c">Active connections: 2 //当前活跃连接数
server accepts handled requests
 41 41 40 //握手总次数，处理连接数，总的请求数（通常握手数=连接数，表示数据无丢失）
Reading: 0 Writing: 1 Waiting: 1 （状态，正在读，正在写，等待）</code></pre>
<h2 id="http-random-index-module模块"><a href="#http-random-index-module模块" class="headerlink" title="http_random_index_module模块"></a>http_random_index_module模块</h2><p>用于从目录中选择一个作为随机主页（一般较少用到）<br>配置时在location中配置：</p>
<pre><code class="nginx">location / {
        root   某个目录; #该目录下有多个html文件随机作为主页
      #index  index.html index.htm;
      random_index on
}</code></pre>
<h2 id="http-sub-module模块"><a href="#http-sub-module模块" class="headerlink" title="http_sub_module模块"></a>http_sub_module模块</h2><p>用于HTTP中html内容替换，一般也比较少用<br>配置时同样在http,server,location中配置：</p>
<pre><code class="nginx">sub_filter &#39;要替换的内容‘ ’替换后的内容‘;
sub_filter_last_modified on|off; #用于服务端和浏览器端每一次请求时校验服务端内容是否发生变更，默认是off
sub_filter_once on|off; #替换全部还是第一个，默认on，表示只替换第一个</code></pre>
<h2 id="Nginx请求限制模块"><a href="#Nginx请求限制模块" class="headerlink" title="Nginx请求限制模块"></a>Nginx请求限制模块</h2><p>连接频率限制：<code>limit-conn-module</code><br>请求频率限制：<code>limit-req_module</code></p>
<blockquote>
<p>HTTP1.0 TCP不能复用，一次连接对应一次请求；HTTP1.1支持TCP顺序性服用，一个连接可以顺序性发起多个连接；HTTP2.0之后TCP连接可以多路复用  </p>
</blockquote>
<p>配置语法：</p>
<ul>
<li>连接限制：<pre><code class="nginx"># 首先需要申请连接限制空间,用于存储连接状态，需要定义在http中
# key：以连接哪个变量作为key，作为每次连接的标识
# name：空间名
# size：空间大小
limit_conn_zone key zone=name:size;
</code></pre>
</li>
</ul>
<h1 id="指明具体使用的限制空间-可以定义在http，server，location中"><a href="#指明具体使用的限制空间-可以定义在http，server，location中" class="headerlink" title="指明具体使用的限制空间,可以定义在http，server，location中"></a>指明具体使用的限制空间,可以定义在http，server，location中</h1><h1 id="zone：空间名，表示使用哪一块空间"><a href="#zone：空间名，表示使用哪一块空间" class="headerlink" title="zone：空间名，表示使用哪一块空间"></a>zone：空间名，表示使用哪一块空间</h1><h1 id="number：同一时间允许的连接并发数"><a href="#number：同一时间允许的连接并发数" class="headerlink" title="number：同一时间允许的连接并发数"></a>number：同一时间允许的连接并发数</h1><p>limit_conn zone number</p>
<pre><code>- 请求频率限制：
```nginx
# 同样需要先定义一个空间，同样只能在http中
# rate为限制请求的速率
limit_req_zone key zone=name:size rate=rate

# 指明具体的限制空间，可以定义在http，server,location中
# burst表死延迟处理，如果请求数超过rate，剩下的请求（注意是全部请求）将被延迟下一秒/分处理，如果请求数超过burst定义的数量，多余的请求则直接返回503错误。
# 如果开启nodelay，则处理burst数量的请求延迟，超过rate的请求直接返回503，不再延迟处理。
limit_req zone=name [burst=number] [nodelay]</code></pre><p>配置示例：</p>
<pre><code class="nginx">http{
    # 使用ip地址作为key标识每一次链接，同时加上binary该变量更节省内存空间
    limit_conn_zone $binary_remote_addr zone=conn_zone:1m
    # 1r/s表示一秒之内最多1次请求，也可以用5r/m,表示一分钟之内最多5次请求
    limit_req_zone $binary_remote_addr zone=req_zone:1m rate=1r/s;

    server{
        location / {
            limit_conn conn_zone 3;
            limit_req zone=req_zone burst=3 nodelay;
        }
    }
}</code></pre>
<h2 id="Nginx访问控制模块"><a href="#Nginx访问控制模块" class="headerlink" title="Nginx访问控制模块"></a>Nginx访问控制模块</h2><p>基于ip的访问控制：<code>http_access_module</code><br>基于用户的信任登录：<code>http_auth_basic_module</code></p>
<h3 id="http-access-module"><a href="#http-access-module" class="headerlink" title="http_access_module"></a>http_access_module</h3><p>配置语法：</p>
<pre><code class="nginx"># 配置在http，server，location，limit_except中

# 配置允许哪些访问
# 可以按照ip，网段，unix中的socket，所有配置
allow address|CIDR|unix:|all;
# 配置禁止哪些访问
deny address|CIDR|unix:|all;</code></pre>
<blockquote>
<p>allow和den可以成对配置，比如只禁止某一个ip，可以配置<code>deny ip;allow all</code>，注意先后顺序  </p>
</blockquote>
<p><strong>局限性</strong><br>使用ip访问控制，一旦客户端有中间件代理，则Nginx最终读取到的是代理的ip地址，而无法对预设的ip做限制，此时有以下几种解决方法：</p>
<ol>
<li><p><code>http_x_forwarded_for</code>，会同时记录源地址IP和代理ip：</p>
<blockquote>
<p>http_x_forwarded_for = Client IP,Proxy(1)IP,Proxy(2)IP,…  </p>
</blockquote>
</li>
<li><p>结合geo模块</p>
</li>
<li><p>听过HTTP自定义变量传递</p>
</li>
</ol>
<h3 id="http-auth-basic-module"><a href="#http-auth-basic-module" class="headerlink" title="http_auth_basic_module"></a>http_auth_basic_module</h3><p>配置语法：</p>
<pre><code class="nginx"># 配置在http，server，location，limit_except,默认是off
# string:即表示配置开启，又会在前端显示相应的字符串信息
auth_basic string|off;

# 配置在http，server，location，limit_except
# file:文件路径，作为认证存储用户名，密码等信息的文件
auth_basic_user_file file;</code></pre>
<p>对于存储用户认证信息的文件有指定的格式：</p>
<blockquote>
<h1 id="comment"><a href="#comment" class="headerlink" title="comment"></a>comment</h1><p>name1:password1<br>name2:password2:comment<br>name3:password3  </p>
</blockquote>
<p>可以使用<code>htpasswd</code>工具进行文件编辑：</p>
<pre><code>» htpasswd                                                                                    
Usage:
    htpasswd [-cimBdpsDv] [-C cost] passwordfile username
    htpasswd -b[cmBdpsDv] [-C cost] passwordfile username password

    htpasswd -n[imBdps] [-C cost] username
    htpasswd -nb[mBdps] [-C cost] username password
 -c  Create a new file.
 -n  Don&#39;t update file; display results on stdout.
 -b  Use the password from the command line rather than prompting for it.
 -i  Read password from stdin without verification (for script usage).
 -m  Force MD5 encryption of the password (default).
 -B  Force bcrypt encryption of the password (very secure).
 -C  Set the computing time used for the bcrypt algorithm
     (higher is more secure but slower, default: 5, valid: 4 to 31).
 -d  Force CRYPT encryption of the password (8 chars max, insecure).
 -s  Force SHA encryption of the password (insecure).
 -p  Do not encrypt the password (plaintext, insecure).
 -D  Delete the specified user.
 -v  Verify password for the specified user.
On other systems than Windows and NetWare the &#39;-p&#39; flag will probably not work.
The SHA algorithm does not use a salt and is less secure than the MD5 algorithm.</code></pre><p>输入下面指令然后输入两次密码即可生成文件</p>
<blockquote>
<p>htpasswd -c [文件路径] [用户名]  </p>
</blockquote>
<pre><code class="nginx">location / {
      root   html;
      auth_basic &quot;请输入用户名和密码以访问该页面。。。&quot;;
      auth_basic_user_file auth.conf;
        index  index.html index.htm;
}</code></pre>
<p><strong>局限性</strong>：</p>
<ul>
<li>用户信息依赖文件方式</li>
<li>操作管理繁琐，效率低下</li>
</ul>
<p>可以通过结合LUA实现高效验证，或者和LDAP打通<br>安全模块</p>
<h3 id="secure-link-midule"><a href="#secure-link-midule" class="headerlink" title="secure_link_midule"></a>secure_link_midule</h3><ol>
<li>制定并允许检查请求的链接的真实性以及保护资源免遭未经授权的访问</li>
<li>限制链接生效周期</li>
</ol>
<h3 id="配置语法-1"><a href="#配置语法-1" class="headerlink" title="配置语法"></a>配置语法</h3><pre><code class="nginx"># 配置在http，server，location中
secure_link expression

# 配置在http，server，location中
secure_link_md5 expression</code></pre>
<ul>
<li>对于secure_link:<br>expression由<strong>校验值</strong>和<strong>过期时间</strong>组成，其中校验值将会与 <code>secure_link_md5</code>中的指定参数的MD5哈希值进行对比，如果两个值不一致,<code>$secure_link</code>变量的值是<code>空（empty）</code>,如果两个值一致，则进行过期检查，如果<code>过期了</code>，则<code>$secure_link</code>变量值是<code>0</code>,如果没过期，则为<code>1</code> ;如果链接是有时效性的，那么过期时间用时间戳进行设置，在MD5哈希值后面声明，用逗号隔开。如果没有设置过期时间，该链接永久有效。</li>
<li>对于secure_link_md5:<br><code>expression</code>指定计算md5哈希值的参数，该md5值将会和url中传递的md5值进行对比校验。expression一般包含<code>uri</code>（如demo.com/s/link, uri则为<code>/s/link</code>）以及加密<code>密钥secret</code>，如果该链接具有时效，则expression需包含<code>$secure_link_expires</code>，expression还可以加入客户端信息，如访问IP,浏览器版本信息等</li>
</ul>
<h3 id="配置示例"><a href="#配置示例" class="headerlink" title="配置示例"></a>配置示例</h3><pre><code class="nginx">location / {
        # 此处会获取参数名为md5和参数名为expires的值
        secure_link $arg_md5,$arg_expires;
        # 将会根据参数计算出md5的值与上面的校验值$arg_md5进行比较,xm是服务端规定的标识信息
        secure_link_md5 &quot;$secure_link_expiress$uri xm&quot;;

        if($secure_link = &quot;&quot;){
                return 403;
        }
        if($secure_link = &quot;0&quot;){
                return 410;
        }
}</code></pre>
<p>利用shell产生的链接示例：</p>
<pre><code class="shell">servername=&quot;xiao-ming9.github.io&quot;
download_file=&quot;/download/file.img&quot;
time_num=$($date -d &quot;2019-7-23 00:00:00&quot; +%s)
secret_num=&quot;imooc&quot;

res=$(echo -n &quot;${time_num}${download_file} ${secret_num}&quot; |openssl md5 -binary | openssl base64 | tr +/ -_ | tr -d =)

echo &quot;https://${servername}${download_file}?md5=${res}&amp;expires=${time_num}&quot;</code></pre>

        
    

    
</div>


                

                <!-- Post Comments -->
                
                    
    <!-- 使用 DISQUS -->
<div id="disqus-comment">
    <div id="disqus_thread"></div>
<script type="text/javascript">
    var disqus_config = function () {
        this.page.url = 'http://yoursite.com/2019/07/21/Nginx%E5%9F%BA%E6%9C%AC%E9%85%8D%E7%BD%AE%E5%92%8C%E6%A8%A1%E5%9D%97/';  // Replace PAGE_URL with your page's canonical URL variable
        this.page.identifier = 'http://yoursite.com/2019/07/21/Nginx%E5%9F%BA%E6%9C%AC%E9%85%8D%E7%BD%AE%E5%92%8C%E6%A8%A1%E5%9D%97/'; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
    };
</script>
<script type="text/ls-javascript" id="disqus-thread-script">
    queue.offer(function() {
            (function() { // DON'T EDIT BELOW THIS LINE
                var d = document;
                var s = d.createElement('script');
                s.src = '//.disqus.com/embed.js';
                s.setAttribute('data-timestamp', + new Date());
                (d.head || d.body).appendChild(s);
            })();
        });
</script>

</div>
<style>
    #disqus-comment{
        background-color: #eee;
        padding: 2pc;
    }
</style>

                
            </div>

            <!-- Post Prev & Next Nav -->
            <nav class="material-nav mdl-color-text--grey-50 mdl-cell mdl-cell--12-col">
    <!-- Prev Nav -->
    
        <a href="/2019/07/22/Nginx%E9%9D%99%E6%80%81%E8%B5%84%E6%BA%90web%E6%9C%8D%E5%8A%A1/" id="post_nav-newer" class="prev-content">
            <button class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon mdl-color--white mdl-color-text--grey-900" role="presentation">
                <i class="material-icons">arrow_back</i>
            </button>
            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
            新篇
        </a>
    

    <!-- Section Spacer -->
    <div class="section-spacer"></div>

    <!-- Next Nav -->
    
        <a href="/2019/07/16/SpringBoot/" id="post_nav-older" class="next-content">
            旧篇
            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
            <button class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon mdl-color--white mdl-color-text--grey-900" role="presentation">
                <i class="material-icons">arrow_forward</i>
            </button>
        </a>
    
</nav>

        </div>
    </div>



                    
                        <!-- Overlay For Active Sidebar -->
<div class="sidebar-overlay"></div>

<!-- Material sidebar -->
<aside id="sidebar" class="sidebar sidebar-colored sidebar-fixed-left" role="navigation">
    <div id="sidebar-main">
        <!-- Sidebar Header -->
        <div class="sidebar-header header-cover" style="background-image: url(/img/sidebar_header.png);">
    <!-- Top bar -->
    <div class="top-bar"></div>

    <!-- Sidebar toggle button -->
    <button type="button" class="sidebar-toggle mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon" style="display: initial;" data-upgraded=",MaterialButton,MaterialRipple">
        <i class="material-icons">clear_all</i>
        <span class="mdl-button__ripple-container">
            <span class="mdl-ripple">
            </span>
        </span>
    </button>

    <!-- Sidebar Avatar -->
    <div class="sidebar-image">
        <img src="https://qiniu.xiaoming.net.cn/%E5%8D%9A%E5%AE%A2%E5%A4%B4%E5%83%8F.jpeg" alt="Silverming's avatar">
    </div>

    <!-- Sidebar Email -->
    <a data-toggle="dropdown" class="sidebar-brand" href="#settings-dropdown">
        934933088@qq.com
        <b class="caret"></b>
    </a>
</div>


        <!-- Sidebar Navigation  -->
        <ul class="nav sidebar-nav">
    <!-- User dropdown  -->
    <li class="dropdown">
        <ul id="settings-dropdown" class="dropdown-menu">
            
                <li>
                    <a href="mailto: 934933088@qq.com" target="_blank" title="Email Me">
                        
                            <i class="material-icons sidebar-material-icons sidebar-indent-left1pc-element">email</i>
                        
                        Email Me
                    </a>
                </li>
            
        </ul>
    </li>

    <!-- Homepage -->
    
        <li id="sidebar-first-li">
            <a href="/">
                
                    <i class="material-icons sidebar-material-icons">home</i>
                
                主页
            </a>
        </li>
        
    

    <!-- Archives  -->
    
        <li class="dropdown">
            <a href="#" class="ripple-effect dropdown-toggle" data-toggle="dropdown">
                
                    <i class="material-icons sidebar-material-icons">inbox</i>
                
                    归档
                <b class="caret"></b>
            </a>
            <ul class="dropdown-menu">
            <li>
                <a class="sidebar_archives-link" href="/archives/2021/03/">三月 2021<span class="sidebar_archives-count">4</span></a></li><li><a class="sidebar_archives-link" href="/archives/2020/12/">十二月 2020<span class="sidebar_archives-count">3</span></a></li><li><a class="sidebar_archives-link" href="/archives/2020/11/">十一月 2020<span class="sidebar_archives-count">3</span></a></li><li><a class="sidebar_archives-link" href="/archives/2020/08/">八月 2020<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/archives/2020/07/">七月 2020<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/archives/2020/05/">五月 2020<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/archives/2020/04/">四月 2020<span class="sidebar_archives-count">2</span></a></li><li><a class="sidebar_archives-link" href="/archives/2020/03/">三月 2020<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/archives/2020/02/">二月 2020<span class="sidebar_archives-count">2</span></a></li><li><a class="sidebar_archives-link" href="/archives/2020/01/">一月 2020<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/archives/2019/12/">十二月 2019<span class="sidebar_archives-count">3</span></a></li><li><a class="sidebar_archives-link" href="/archives/2019/11/">十一月 2019<span class="sidebar_archives-count">8</span></a></li><li><a class="sidebar_archives-link" href="/archives/2019/10/">十月 2019<span class="sidebar_archives-count">4</span></a></li><li><a class="sidebar_archives-link" href="/archives/2019/09/">九月 2019<span class="sidebar_archives-count">6</span></a></li><li><a class="sidebar_archives-link" href="/archives/2019/08/">八月 2019<span class="sidebar_archives-count">9</span></a></li><li><a class="sidebar_archives-link" href="/archives/2019/07/">七月 2019<span class="sidebar_archives-count">14</span></a></li><li><a class="sidebar_archives-link" href="/archives/2019/06/">六月 2019<span class="sidebar_archives-count">2</span></a></li><li><a class="sidebar_archives-link" href="/archives/2019/05/">五月 2019<span class="sidebar_archives-count">10</span></a></li><li><a class="sidebar_archives-link" href="/archives/2019/04/">四月 2019<span class="sidebar_archives-count">4</span></a></li><li><a class="sidebar_archives-link" href="/archives/2019/03/">三月 2019<span class="sidebar_archives-count">8</span></a></li><li><a class="sidebar_archives-link" href="/archives/2019/02/">二月 2019<span class="sidebar_archives-count">5</span></a></li><li><a class="sidebar_archives-link" href="/archives/2019/01/">一月 2019<span class="sidebar_archives-count">3</span></a></li><li><a class="sidebar_archives-link" href="/archives/2018/12/">十二月 2018<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/archives/2018/10/">十月 2018<span class="sidebar_archives-count">2</span></a></li><li><a class="sidebar_archives-link" href="/archives/2018/09/">九月 2018<span class="sidebar_archives-count">3</span></a></li><li><a class="sidebar_archives-link" href="/archives/2018/07/">七月 2018<span class="sidebar_archives-count">16</span></a></li><li><a class="sidebar_archives-link" href="/archives/2018/06/">六月 2018<span class="sidebar_archives-count">3</span></a></li><li><a class="sidebar_archives-link" href="/archives/2018/04/">四月 2018<span class="sidebar_archives-count">4</span></a>
            </ul>
        </li>
        
    

    <!-- Categories  -->
    

    <!-- Pages  -->
    

    <!-- Article Number  -->
    
        <li>
            <a href="/archives">
                文章总数
                <span class="sidebar-badge">124</span>
            </a>
        </li>
        
    
</ul>


        <!-- Sidebar Footer -->
        <!--
I'm glad you use this theme, the development is no so easy, I hope you can keep the copyright, I will thank you so much.
If you still want to delete the copyrights, could you still retain the first one? Which namely "Theme Material"
It will not impact the appearance and can give developers a lot of support :)

很高兴您使用并喜欢该主题，开发不易 十分谢谢与希望您可以保留一下版权声明。
如果您仍然想删除的话 能否只保留第一项呢？即 "Theme Material"
它不会影响美观并可以给开发者很大的支持和动力。 :)
-->

<!-- Sidebar Divider -->

    <div class="sidebar-divider"></div>


<!-- Theme Material -->

    <a href="https://github.com/viosey/hexo-theme-material"  class="sidebar-footer-text-a" target="_blank">
        <div class="sidebar-text mdl-button mdl-js-button mdl-js-ripple-effect sidebar-footer-text-div" data-upgraded=",MaterialButton,MaterialRipple">
            主题 - Material
            <span class="sidebar-badge badge-circle">i</span>
        </div>
    </a>


<!-- Help & Support -->
<!--

    <a href="mailto:hiviosey@gmail.com" target="_blank" rel="noopener" class="sidebar-footer-text-a">
        <div class="sidebar-text mdl-button mdl-js-button mdl-js-ripple-effect sidebar-footer-text-div" data-upgraded=",MaterialButton,MaterialRipple">
        sidebar.help
        <span class="mdl-button__ripple-container">
          <span class="mdl-ripple"></span>
        </span>
      </div>
    </a>

-->

<!-- Feedback -->
<!--

    <a href="https://github.com/viosey/hexo-theme-material/issues" target="_blank" class="sidebar-footer-text-a">
        <div class="sidebar-text mdl-button mdl-js-button mdl-js-ripple-effect sidebar-footer-text-div" data-upgraded=",MaterialButton,MaterialRipple">
        sidebar.feedback
        <span class="mdl-button__ripple-container"><span class="mdl-ripple"></span></span></div>
    </a>

-->

<!-- About Theme -->
<!--

    <a href="https://blog.viosey.com/index.php/Material.html" target="_blank" class="sidebar-footer-text-a">
        <div class="sidebar-text mdl-button mdl-js-button mdl-js-ripple-effect sidebar-footer-text-div" data-upgraded=",MaterialButton,MaterialRipple">
             sidebar.about_theme
            <span class="mdl-button__ripple-container"><span class="mdl-ripple"></span></span></div>
    </a>

-->

    </div>

    <!-- Sidebar Image -->
    

</aside>

                    

                    
                        <!-- Footer Top Button -->
                        <div id="back-to-top" class="toTop-wrap">
    <a href="#top" class="toTop">
        <i class="material-icons footer_top-i">expand_less</i>
    </a>
</div>

                    

                    <!--Footer-->
<footer class="mdl-mini-footer" id="bottom">
    
        <!-- Paradox Footer Left Section -->
        <div class="mdl-mini-footer--left-section sns-list">
    <!-- Twitter -->
    
        <a href="https://twitter.com/twitter" target="_blank">
            <button class="mdl-mini-footer--social-btn social-btn footer-sns-twitter">
                <span class="visuallyhidden">Twitter</span>
            </button><!--
     --></a>
    

    <!-- Facebook -->
    
        <a href="https://www.facebook.com/facebook" target="_blank">
            <button class="mdl-mini-footer--social-btn social-btn footer-sns-facebook">
                <span class="visuallyhidden">Facebook</span>
            </button><!--
     --></a>
    

    <!-- Google + -->
    
        <a href="https://www.google.com/" target="_blank">
            <button class="mdl-mini-footer--social-btn social-btn footer-sns-gplus">
                <span class="visuallyhidden">Google Plus</span>
            </button><!--
     --></a>
    

    <!-- Weibo -->
    

    <!-- Instagram -->
    

    <!-- Tumblr -->
    

    <!-- Github -->
    

    <!-- LinkedIn -->
    

    <!-- Zhihu -->
    

    <!-- Bilibili -->
    

    <!-- Telegram -->
    

    <!-- V2EX -->
    

    <!-- Segmentfault -->
    
</div>


        <!--Copyright-->
        <div id="copyright">
            Copyright&nbsp;©&nbsp;<span year></span>&nbsp;Silverming
            
                <br>
                
                    <a href="http://www.miitbeian.gov.cn" target="_blank" rel="nofollow noopener">粤ICP备18114217号</a>
                
            
        </div>

        <!-- Paradox Footer Right Section -->

        <!--
        I am glad you use this theme, the development is no so easy, I hope you can keep the copyright.
        It will not impact the appearance and can give developers a lot of support :)

        很高兴您使用该主题，开发不易，希望您可以保留一下版权声明。
        它不会影响美观并可以给开发者很大的支持。 :)
        -->

        <div class="mdl-mini-footer--right-section">
            <div>
                <div class="footer-develop-div">Powered by <a href="https://hexo.io" target="_blank" class="footer-develop-a">Hexo</a></div>
                <div class="footer-develop-div">Theme - <a href="https://github.com/viosey/hexo-theme-material" target="_blank" class="footer-develop-a">Material</a></div>
            </div>
        </div>
    
</footer>


                    <!-- Import JS File -->

    <script>lsloader.load("lazyload_js","/js/lazyload.min.js?1BcfzuNXqV+ntF6gq+5X3Q==", true)</script>



    <script>lsloader.load("js_js","/js/js.min.js?Bn9UzEm8RrBSxqyZB0zPjA==", true)</script>



    <script>lsloader.load("np_js","/js/nprogress.js?pl3Qhb9lvqR1FlyLUna1Yw==", true)</script>


<script type="text/ls-javascript" id="NProgress-script">
    NProgress.configure({
        showSpinner: true
    });
    NProgress.start();
    $('#nprogress .bar').css({
        'background': '#29d'
    });
    $('#nprogress .peg').css({
        'box-shadow': '0 0 10px #29d, 0 0 15px #29d'
    });
    $('#nprogress .spinner-icon').css({
        'border-top-color': '#29d',
        'border-left-color': '#29d'
    });
    setTimeout(function() {
        NProgress.done();
        $('.fade').removeClass('out');
    }, 800);
</script>









   <!-- 使用 DISQUS js 代码 -->
<script id="dsq-count-scr" src="//.disqus.com/count.js" async></script>





<!-- UC Browser Compatible -->
<script>
	var agent = navigator.userAgent.toLowerCase();
	if(agent.indexOf('ucbrowser')>0) {
		document.write('<link rel="stylesheet" href="/css/uc.css">');
	   alert('由于 UC 浏览器使用极旧的内核，而本网站使用了一些新的特性。\n为了您能更好的浏览，推荐使用 Chrome 或 Firefox 浏览器。');
	}
</script>

<!-- Import prettify js  -->

    
        
            <script>lsloader.load("prettify_js","/js/prettify.min.js?WN07fivHQSMKWy7BmHBB6w==", true)</script>
        
    



<!-- Window Load -->
<!-- add class for prettify -->
<script type="text/ls-javascript" id="window-load">
    $(window).on('load', function() {
        // Post_Toc parent position fixed
        $('.post-toc-wrap').parent('.mdl-menu__container').css('position', 'fixed');
    });

    
        
            $(function() {
                $('pre').addClass('prettyprint linenums').attr('style', 'overflow:auto;');
                prettyPrint();
                })
        
    
    
</script>

<!-- MathJax Load-->


<!-- Bing Background -->


<script type="text/ls-javascript" id="lazy-load">
    // Offer LazyLoad
    queue.offer(function(){
        $('.lazy').lazyload({
            effect : 'show'
        });
    });

    // Start Queue
    $(document).ready(function(){
        setInterval(function(){
            queue.execNext();
        },200);
    });
</script>

<!-- Custom Footer -->



<script>
    var copyrightNow = new Date().getFullYear();
    var textContent = document.querySelector('span[year]')

    copyrightSince = 2018;
    if (copyrightSince === copyrightNow||copyrightSince === 0000) {
        textContent.textContent = copyrightNow
    } else {
        textContent.textContent = copyrightSince + ' - ' + copyrightNow
    }

    (function(){
        var scriptList = document.querySelectorAll('script[type="text/ls-javascript"]')

        for (var i = 0; i < scriptList.length; ++i) {
            var item = scriptList[i];
            lsloader.runInlineScript(item.id,item.id);
        }
    })()
console.log('\n %c © Material Theme | Version: 1.5.6 | https://github.com/viosey/hexo-theme-material %c \n', 'color:#455a64;background:#e0e0e0;padding:5px 0;border-top-left-radius:5px;border-bottom-left-radius:5px;', 'color:#455a64;background:#e0e0e0;padding:5px 0;border-top-right-radius:5px;border-bottom-right-radius:5px;');
</script>

                </main>
            </div>
        <script type="text/x-mathjax-config">
    MathJax.Hub.Config({
        tex2jax: {
            inlineMath: [ ["$","$"], ["\\(","\\)"] ],
            skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code'],
            processEscapes: true
        }
    });
    MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax();
        for (var i = 0; i < all.length; ++i)
            all[i].SourceElement().parentNode.className += ' has-jax';
    });
</script>
<script src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
</body>
    
</html>
