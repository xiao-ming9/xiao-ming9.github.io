<!DOCTYPE html><html class="appearance-auto" lang="zh-CN"><head><meta charset="UTF-8"><title>在云服务器上部署项目</title><meta name="description" content="Wechat:934933088"><meta name="viewport" content="width=device-width, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no, initial-scale=1"><!-- Google Analytics --><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q || []).push(arguments)},i[r].l=1 * new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

ga('create', 'G-M2RT7SDT3L', 'auto');
ga('send', 'pageview');</script><!-- End Google Analytics -->
<!-- Baidu Analytics --><script>var _hmt = _hmt || [];
(function() {
var hm = document.createElement("script");
hm.src = "//hm.baidu.com/hm.js?" + '54ebb03ad7ad5b762ac8ff7958df6d3f';
var s = document.getElementsByTagName("script")[0];
s.parentNode.insertBefore(hm, s);
})();</script><!-- End Baidu Analytics --><link rel="icon" href="https://qiniu.xiaoming.net.cn/%E5%8D%9A%E5%AE%A2icon.jpeg"><link rel="stylesheet" href="/style/common/bulma.css"><link rel="stylesheet" href="/style/base.css"><link rel="stylesheet" href="/style/common/helper.css"><script src="/js/common.js"></script><link rel="stylesheet" href="/style/post.css"><link rel="stylesheet" href="/style/themes/highlight-theme-light.css"><script src="/js/highlight.pack.js"></script></head><body class="is-flex is-flex-direction-column"><header class="header-widget is-flex-shrink-0 is-hidden-mobile"><div class="container is-fullhd is-flex is-justify-content-space-between is-align-items-center is-full-height"><section class="is-hidden-mobile is-flex-shrink-0"><h2><a href="/">silverming's blog</a></h2></section><h3 class="is-hidden-mobile is-family-serif is-full-height is-flex is-align-items-center is-flex-shrink-0"><div class="is-full-height" id="postTopic"><p class="is-full-height is-flex-shrink-0 is-flex is-align-items-center is-justify-content-center">在云服务器上部署项目</p><p class="is-full-height is-flex-shrink-0 is-flex is-align-items-center is-justify-content-center">点击返回顶部</p></div></h3><aside class="is-flex-shrink-0"><h3 class="is-inline-block"><a href="/">首页</a></h3><h3 class="is-inline-block"><a href="/about">关于</a></h3><h3 class="is-inline-block"><a href="/archives">归档</a></h3></aside></div></header><header class="is-flex header-widget is-flex-shrink-0 is-align-items-center is-justify-content-center is-hidden-tablet"><h3 class="is-inline-block"><a href="/">首页</a></h3><h3 class="is-inline-block"><a href="/about">关于</a></h3><h3 class="is-inline-block"><a href="/archives">归档</a></h3></header><main><main class="container is-max-widescreen content section post-page pt-4 px-4"><div class="columns is-flex-desktop is-justify-content-center is-flex-direction-row-reverse"><div class="column is-3 is-hidden-mobile"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#远程登录云服务器"><span class="toc-text">远程登录云服务器</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#搭建环境"><span class="toc-text">搭建环境</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#安装配置PHP"><span class="toc-text">安装配置PHP</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#安装MySQL"><span class="toc-text">安装MySQL</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#安装Nginx"><span class="toc-text">安装Nginx</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#本地将项目放到github上，服务器通过git拉去"><span class="toc-text">本地将项目放到github上，服务器通过git拉去</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#配置laravel环境"><span class="toc-text">配置laravel环境</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#创建并修改-env文件"><span class="toc-text">创建并修改.env文件</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#生成laravel-key执行迁移"><span class="toc-text">生成laravel key执行迁移</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#修改权限并重启"><span class="toc-text">修改权限并重启</span></a></li></ol></li></ol></div><div class="column is-9"><header class="my-4"><a href="/tags/%E6%9C%8D%E5%8A%A1%E5%99%A8"><i class="tag post-item-tag">服务器</i></a></header><h1 class="mt-0 mb-1 is-family-serif" id="postTitle">在云服务器上部署项目</h1><time class="has-text-grey" datetime="2018-09-01T00:55:12.000Z">2018-09-01</time><article class="mt-2 post-content"><ul>
<li>以腾讯云为例  </li>
</ul>
<h1 id="远程登录云服务器"><a href="#远程登录云服务器" class="headerlink" title="远程登录云服务器"></a>远程登录云服务器</h1><p>在腾讯云中添加SSH密匙（<code>会提示保存一个文件</code>），并绑定到所购买的云服务器上，在本地打开终端输入：  </p>
<p>先赋予仅本人可读权限</p>
<blockquote>
<p>chmod 400 &lt;下载的与云服务器关联的私钥的绝对路径&gt;  </p>
</blockquote>
<p>输入以下指令即可远程登录</p>
<blockquote>
<p>ssh -i “&lt;下载的与云服务器关联的私钥的绝对路径&gt;” &#60;username&#62;@&#60;hostname or ip address&#62;  </p>
</blockquote>
<ul>
<li>username根据购买服务器种类而定，ubuntu的为<code>ubuntu</code>，其他的为<code>root</code></li>
<li>hostname为<code>域名</code>，也可以填写ip地址  </li>
</ul>
<h1 id="搭建环境"><a href="#搭建环境" class="headerlink" title="搭建环境"></a>搭建环境</h1><p>更新列表</p>
<blockquote>
<p>sudo apt-get update  </p>
</blockquote>
<p>安装语言包</p>
<blockquote>
<p>sudo apt-get install  language-pack-zh-han*<br>locale-gen zh_CN.UTF-8  </p>
</blockquote>
<p>安装常用软件</p>
<blockquote>
<p>sudo apt-get install -y vim git zip unzip</p>
</blockquote>
<a id="more"></a>
<h2 id="安装配置PHP"><a href="#安装配置PHP" class="headerlink" title="安装配置PHP"></a>安装配置PHP</h2><pre><code class="php">sudo apt-get install -y software-properties-common

sudo LC_ALL=zh_CN.UTF-8 add-apt-repository ppa:ondrej/php

sudo apt-get update

apt-cache search php7.2

sudo apt-get install -y php7.2

sudo apt-get install -y php7.2-mysql

sudo apt-get install -y php7.2-fpm

//另外根据laravel项目要求安装相应拓展 

//配置php

sudo vim /etc/php/7.2/fpm/pool.d/www.conf
//36行修改为：listen = /run/php/php7.2-fpm.sock

sudo vim /etc/php/7.2/fpm/php.ini
//776行修改为：cgi.fix_pathinfo =1</code></pre>
<h2 id="安装MySQL"><a href="#安装MySQL" class="headerlink" title="安装MySQL"></a>安装MySQL</h2><blockquote>
<p>sudo apt-get install -y mysql-server  </p>
</blockquote>
<h2 id="安装Nginx"><a href="#安装Nginx" class="headerlink" title="安装Nginx"></a>安装Nginx</h2><pre><code class="php">//安装之前需确认是否安装了apache2，如果已经安装了apache2，需要先停止/卸载 apache2
//停止
sudo service apache2 stop

//卸载
sudo apt-get --purge remove apache2
sudo apt-get --purge remove apache2.2-common
sudo apt-get autoremove

//安装 nginx
sudo apt-get install -y nginx</code></pre>
<p>配置：</p>
<pre><code class="php">sudo vim /etc/nginx/sites-available/default

server{
    root /var/www/laravel-project/public;//自定义项目根目录，laravel-project为自定义项目名称
    index index.php index.html index.htm

    server_name localhost;//如果有域名改为域名

    location / {
        try_files $uri $uri/ /index.php?query_string;
    }

    location ~ \.php$ {
        try_files $uri /index.php =404;
        fastcgi_split_path_info ^(.+\.php)(/.+)$;
        fastcgi_pass unix:/var/run/php/php7.2-fpm.sock;
        fastcgi_index index.php;
        fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;
        include fastcgi_params;

        //配置跨域访问
        add_header &#39;Access-Control-Allow-Origin&#39; &#39;*&#39;;
        add_header &#39;Access-Control-Allow-Credentials&#39; &#39;true&#39;;
        add_header &#39;Access-Control-Allow-Methods&#39; &#39;POST,GET,OPTIONS,DELETE&#39;;
        add_header &#39;Access-Control-Allow-Headers&#39; &#39;X-Requested-With,Authorization&#39;;
    }

    location ~ /\.ht {
        deny all;
    }
}</code></pre>
<h1 id="本地将项目放到github上，服务器通过git拉去"><a href="#本地将项目放到github上，服务器通过git拉去" class="headerlink" title="本地将项目放到github上，服务器通过git拉去"></a>本地将项目放到github上，服务器通过git拉去</h1><p>将本地项目放到github上,先在github上创建新项目</p>
<pre><code class="php">cd /var/www/laravel-project

git init
git add -A
git commit -m &quot;更改描述&quot;

git remote add origin https://github.com/UserName/laravel-project.git  //UserName为github用户名
git push -u origin master</code></pre>
<p>在服务器上拉去代码</p>
<pre><code class="php">git pull  //更新github上的代码
git clone https://github.com/UserName/laravel-project.git</code></pre>
<h1 id="配置laravel环境"><a href="#配置laravel环境" class="headerlink" title="配置laravel环境"></a>配置laravel环境</h1><p>通过<a href="https://getcomposer.org/download/" target="_blank" rel="noopener">composer官网</a>获取最新四行代码</p>
<pre><code class="php">php -r &quot;copy(&#39;https://getcomposer.org/installer&#39;, &#39;composer-setup.php&#39;);&quot;
php -r &quot;if (hash_file(&#39;SHA384&#39;, &#39;composer-setup.php&#39;) === &#39;544e09ee996cdf60ece3804abc52599c22b1f40f4323403c44d44fdfdd586475ca9813a858088ffbc1f233e9b180f061&#39;) { echo &#39;Installer verified&#39;; } else { echo &#39;Installer corrupt&#39;; unlink(&#39;composer-setup.php&#39;); } echo PHP_EOL;&quot;
php composer-setup.php
php -r &quot;unlink(&#39;composer-setup.php&#39;);&quot;

mv composer.phar /usr/local/bin/composer

cd /var/www/laravel-project

composer install --no-dev</code></pre>
<h2 id="创建并修改-env文件"><a href="#创建并修改-env文件" class="headerlink" title="创建并修改.env文件"></a>创建并修改.env文件</h2><pre><code class="php">cd /var/www/laravel-project

sudo cp .env.example .env

sudo vim .env

APP_ENV = production
APP_DEBUG = false

DB_DATABASE = 数据库名
DB_USERNAME = 数据库用户名
DB_PASSWORD = 数据库用户密码</code></pre>
<h2 id="生成laravel-key执行迁移"><a href="#生成laravel-key执行迁移" class="headerlink" title="生成laravel key执行迁移"></a>生成laravel key执行迁移</h2><blockquote>
<p>php artisan key:generate<br>php artisan migrate  </p>
</blockquote>
<h2 id="修改权限并重启"><a href="#修改权限并重启" class="headerlink" title="修改权限并重启"></a>修改权限并重启</h2><pre><code class="php">sudo chown -R www-data:www-data /var/www

sudo chmod -R 777 /var/www/laravel-project/storage

service nginx restart

service php7.2-fpm restart</code></pre>
<ul>
<li>更新项目时，只需要在本地<code>git push origin master</code>，之后在项目目录<code>git pull</code>更新即可</li>
</ul>
</article><section class="jump-container is-flex is-justify-content-space-between my-6"><!-- em is empty placeholder--><a class="button is-default" href="/2018/09/07/laravel-admin/" title="Laravel-admin"><i class="iconfont icon-prev mr-2 has-text-grey"></i><span class="has-text-weight-semibold">上一页: Laravel-admin</span></a><a class="button is-default" href="/2018/07/30/Laravel%E2%80%94%E6%A8%A1%E5%9E%8B/" title="Laravel—Eloquent ORM"><span class="has-text-weight-semibold">下一页: Laravel—Eloquent ORM</span><i class="iconfont icon-next ml-2 has-text-grey"></i></a></section><article class="mt-6 comment-container"><script async repo="xiao-ming9/xiao-ming9.github.io" src="https://utteranc.es/client.js" issue-term="pathname" theme="preferred-color-scheme"></script></article></div></div></main></main><footer class="is-flex is-flex-direction-column is-align-items-center is-flex-shrink-0 is-family-serif"><section class="sns-container"><!-- Github--><!-- Ins--><!-- RSS--><!-- 知乎--><!-- 领英--><!-- 脸书--></section><p><span>Copyright ©</span><span> silverming 2021</span></p><div class="is-flex is-justify-content-center is-flex-wrap-wrap"><p>Powered by Hexo &verbar;&nbsp;</p><p class="is-flex is-justify-content-center"><a title="Hexo theme author" href="//github.com/haojen">Theme by Haojen&nbsp;</a></p><div style="margin-top: 2px"><a class="github-button" title="github-button" href="https://github.com/haojen/hexo-theme-Claudia" target="_blank" rel="noopener" data-color-scheme="no-preference: light; light: light; dark: dark;" data-show-count="true"></a></div></div><div><span>&lt;a href=&quot;http://www.beian.miit.gov.cn/&quot;&gt;备案号&lt;/a&gt;</span></div></footer><script async defer src="https://buttons.github.io/buttons.js"></script><script src="/js/post.js"></script></body></html>