<!DOCTYPE html><html class="appearance-auto" lang="zh-CN"><head><meta charset="UTF-8"><title>Laravel集成dingo+jwt</title><meta name="description" content="Wechat:934933088"><meta name="viewport" content="width=device-width, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no, initial-scale=1"><!-- Google Analytics --><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q || []).push(arguments)},i[r].l=1 * new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

ga('create', 'G-M2RT7SDT3L', 'auto');
ga('send', 'pageview');</script><!-- End Google Analytics -->
<!-- Baidu Analytics --><script>var _hmt = _hmt || [];
(function() {
var hm = document.createElement("script");
hm.src = "//hm.baidu.com/hm.js?" + '54ebb03ad7ad5b762ac8ff7958df6d3f';
var s = document.getElementsByTagName("script")[0];
s.parentNode.insertBefore(hm, s);
})();</script><!-- End Baidu Analytics --><link rel="icon" href="https://qiniu.xiaoming.net.cn/%E5%8D%9A%E5%AE%A2icon.jpeg"><link rel="stylesheet" href="/style/common/bulma.css"><link rel="stylesheet" href="/style/base.css"><link rel="stylesheet" href="/style/common/helper.css"><script src="/js/common.js"></script><link rel="stylesheet" href="/style/post.css"><link rel="stylesheet" href="/style/themes/highlight-theme-light.css"><script src="/js/highlight.pack.js"></script><meta name="description" content="DingoDingo是一个composer的包，能够用于创建自己想要的API，返回JSON数据  
官方文档
Dingo安装与配置关于JWT-auth的安装参考Laravel-JWT
修改composer.json文件，在require中添加：

“dingo/api”:”2.0.0-alpha1”  


然后命令行执行：

composer update

发布配置文件：

php artisan vendor:publish –provider=”Dingo\Api\Provider\LaravelServiceProvider”

修改config/auth.php:

修改defaults的guards为：

‘guard’=&amp;gt;’api’  


在guards中添加：
`api` =&amp;gt.."></head><body class="is-flex is-flex-direction-column"><header class="header-widget is-flex-shrink-0 is-hidden-mobile"><div class="container is-fullhd is-flex is-justify-content-space-between is-align-items-center is-full-height"><section class="is-hidden-mobile is-flex-shrink-0"><h2><a href="/">silverming's blog</a></h2></section><h3 class="is-hidden-mobile is-family-serif is-full-height is-flex is-align-items-center is-flex-shrink-0"><div class="is-full-height" id="postTopic"><p class="is-full-height is-flex-shrink-0 is-flex is-align-items-center is-justify-content-center">Laravel集成dingo+jwt</p><p class="is-full-height is-flex-shrink-0 is-flex is-align-items-center is-justify-content-center">点击返回顶部</p></div></h3><aside class="is-flex-shrink-0"><h3 class="is-inline-block"><a href="/">首页</a></h3><h3 class="is-inline-block"><a href="/about">关于</a></h3><h3 class="is-inline-block"><a href="/archives">归档</a></h3></aside></div></header><header class="is-flex header-widget is-flex-shrink-0 is-align-items-center is-justify-content-center is-hidden-tablet"><h3 class="is-inline-block"><a href="/">首页</a></h3><h3 class="is-inline-block"><a href="/about">关于</a></h3><h3 class="is-inline-block"><a href="/archives">归档</a></h3></header><main><main class="container is-max-widescreen content section post-page pt-4 px-4"><div class="columns is-flex-desktop is-justify-content-center is-flex-direction-row-reverse"><div class="column is-3 is-hidden-mobile"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#Dingo"><span class="toc-text">Dingo</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Dingo安装与配置"><span class="toc-text">Dingo安装与配置</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#使用Dingo"><span class="toc-text">使用Dingo</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#路由创建Api"><span class="toc-text">路由创建Api</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#创建控制器"><span class="toc-text">创建控制器</span></a></li></ol></li></ol></div><div class="column is-9"><header class="my-4"><a href="/tags/Laravel"><i class="tag post-item-tag">Laravel</i></a><a href="/tags/php"><i class="tag post-item-tag">php</i></a></header><h1 class="mt-0 mb-1 is-family-serif" id="postTitle">Laravel集成dingo+jwt</h1><time class="has-text-grey" datetime="2018-10-16T06:46:47.000Z">2018-10-16</time><article class="mt-2 post-content"><h1 id="Dingo"><a href="#Dingo" class="headerlink" title="Dingo"></a>Dingo</h1><p>Dingo是一个composer的包，能够用于创建自己想要的API，返回JSON数据  </p>
<p><a href="https://github.com/dingo/api/wiki" target="_blank" rel="noopener">官方文档</a></p>
<h1 id="Dingo安装与配置"><a href="#Dingo安装与配置" class="headerlink" title="Dingo安装与配置"></a>Dingo安装与配置</h1><p>关于<code>JWT-auth</code>的安装参考<a href="https://xiao-ming9.github.io/2018/09/18/Laravel-JWT/" target="_blank" rel="noopener">Laravel-JWT</a></p>
<p>修改<code>composer.json</code>文件，在<code>require</code>中添加：</p>
<blockquote>
<p>“dingo/api”:”2.0.0-alpha1”  </p>
</blockquote>
<a id="more"></a>
<p>然后命令行执行：</p>
<blockquote>
<p>composer update</p>
</blockquote>
<p>发布配置文件：</p>
<blockquote>
<p>php artisan vendor:publish –provider=”Dingo\Api\Provider\LaravelServiceProvider”</p>
</blockquote>
<p>修改<code>config/auth.php</code>:</p>
<ul>
<li><p>修改<code>defaults</code>的<code>guards</code>为：</p>
<blockquote>
<p>‘guard’=&gt;’api’  </p>
</blockquote>
</li>
<li><p>在<code>guards</code>中添加：</p>
<pre><code class="php">`api` =&gt; [
  &#39;driver&#39; =&gt; &#39;jwt&#39;,
  &#39;provider&#39; =&gt; &#39;users&#39;,
],</code></pre>
</li>
<li><p>在<code>providers</code>中，修改<code>users</code>为：</p>
<pre><code class="php">&#39;providers&#39; =&gt; [
  &#39;users&#39; =&gt; [
      &#39;driver&#39; =&gt; &#39;eloquent&#39;,
      &#39;model&#39; =&gt; App\ModelName::class,//ModelName为自己定义的模型名
  ],
]</code></pre>
</li>
<li><p>集成jwt和dingo：在<code>app\Provider\AppServiceProvider.php</code>中的<code>boot</code>方法中添加jwt扩展:</p>
<pre><code class="php">public function boot() {
  app(&#39;Dingo\Api\Auth&#39;)-&gt;extend(&#39;jwt&#39;,function($app){
      return new \Dingo\Api\Auth\Provider\JWT($app[&#39;Tymon\JWTAuth\JWTAuth&#39;]);
  });
}</code></pre>
</li>
<li><p>修改<code>config\api.php</code>:</p>
<pre><code class="php">&#39;auth&#39; =&gt; [
  &#39;jwt&#39; =&gt; &#39;Dingo\Api\Auth\Provider\JWT&#39;,
],</code></pre>
</li>
<li><p>在<code>config\app.php</code>中<code>provider</code>添加：</p>
<pre><code class="php">Dingo\Api\Provider\LaravelServiceProvider::class,
Tymon\JWTAuth\Providers\LaravelServiceProvider::class,</code></pre>
</li>
<li><p>配置<code>.env</code>文件</p>
<pre><code class="php">API_PREFIX=api
API_STANDARS_TREE=vnd
API_VERSION=v1
API_DEBUG=true</code></pre>
<blockquote>
<p>关于.env文件的配置，参考(<a href="https://github.com/dingo/api/wiki/Configuration" target="_blank" rel="noopener">https://github.com/dingo/api/wiki/Configuration</a>)  </p>
</blockquote>
</li>
</ul>
<h1 id="使用Dingo"><a href="#使用Dingo" class="headerlink" title="使用Dingo"></a>使用Dingo</h1><h2 id="路由创建Api"><a href="#路由创建Api" class="headerlink" title="路由创建Api"></a>路由创建Api</h2><p><strong>在测试时需要设置Authorization类型为Bearer token</strong>  </p>
<p>修改<code>routes/api.php</code></p>
<pre><code class="php">&lt;?php

$api = app(&quot;Dingo\Api\Routing\Router&quot;);
$api-&gt;version(&#39;v1&#39;,function($api) {
    $api-&gt;group([&quot;namespace&quot; =&gt; &quot;App\Http\Controllers\Api&quot;,&#39;middleware&#39;=&gt;&#39;auth:api&#39;],function($api){
        //此处定义的api需要先经过jwt认证
        //访问链接为yourServerName/api/decode
        //Controller、method为自己定义的关联模型对应的控制器和方法

        $api-&gt;post(&#39;decode&#39;,&#39;Controller@method&#39;);
    });
    $api-&gt;group([&quot;namespace&quot; =&gt; &quot;App\Http\Controllers\Api&quot;],function($api){
        //在这里写的api不需要经过jwt认证
        $api-&gt;post(&#39;login&#39;,&#39;Controller@method&#39;);
    });
});</code></pre>
<h2 id="创建控制器"><a href="#创建控制器" class="headerlink" title="创建控制器"></a>创建控制器</h2><pre><code class="php">&lt;?php

namespace App\Http\Controllers;


use App\Account;
use Tymon\JWTAuth\JWTAuth;
use Illuminate\Http\Request;
use Illuminate\Support\Facades\Auth;
use App\Http\Controllers\Controller;
use Illuminate\Support\Facades\Hash;
use Illuminate\Http\Resources\Json\JsonResource;
use Symfony\Component\HttpFoundation\JsonResponse;
use Symfony\Component\Translation\Tests\Dumper\JsonFileDumperTest;


class AccountController extends BaseController
{
    protected $jwt;
    public function __construct(JWTAuth $jwt)
    {
        $this-&gt;jwt = $jwt;
    }

    public function register(Request $request)
    {
        $account = New Account;
        $account-&gt;email = $request-&gt;input(&#39;email&#39;);
        $account-&gt;password = Hash::make($request-&gt;input(&#39;password&#39;));
        if($account-&gt;save()){
            return &quot;注册成功&quot;;
        }
    }

    public function login(Request $request)
    {
        $this-&gt;validate($request, [
            &#39;email&#39;    =&gt; &#39;required|email|max:255&#39;,
            &#39;password&#39; =&gt; &#39;required&#39;,
        ]);
        try {
            //验证用户是否存在，存在则颁发token，不存在，则不颁发token。
            if (! $token = $this-&gt;jwt-&gt;attempt($request-&gt;only(&#39;email&#39;, &#39;password&#39;))) {

                return response()-&gt;json([&#39;user_not_found&#39;], 404);
            }
        } catch (\Tymon\JWTAuth\Exceptions\TokenExpiredException $e) {
            return response()-&gt;json([&#39;token_expired&#39;], 500);
        } catch (\Tymon\JWTAuth\Exceptions\TokenInvalidException $e) {
            return response()-&gt;json([&#39;token_invalid&#39;], 500);
        } catch (\Tymon\JWTAuth\Exceptions\JWTException $e) {
            return response()-&gt;json([&#39;token_absent&#39; =&gt; $e-&gt;getMessage()], 500);
        }

        return JsonResponse::create([
            &#39;success&#39;=&gt;&#39;200&#39;,
            &#39;msg&#39;=&gt;&#39;ok&#39;,
            &#39;data&#39;=&gt;[
                &#39;user&#39;=&gt;Auth::user(),
                &#39;token&#39;=&gt;$token
            ]
        ]);
    }

    /*测试方法*/
    public function decode(Request $request){
        return response()-&gt;json([&quot;测试成功&quot;],200); 
    }
}</code></pre>
</article><section class="jump-container is-flex is-justify-content-space-between my-6"><!-- em is empty placeholder--><a class="button is-default" href="/2018/12/07/Java%E5%9F%BA%E7%A1%80/" title="Java基础"><i class="iconfont icon-prev mr-2 has-text-grey"></i><span class="has-text-weight-semibold">上一页: Java基础</span></a><a class="button is-default" href="/2018/10/01/laravel%E5%AE%9E%E7%8E%B0%E4%B8%83%E7%89%9B%E4%BA%91%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0/" title="laravel实现七牛云文件上传"><span class="has-text-weight-semibold">下一页: laravel实现七牛云文件上传</span><i class="iconfont icon-next ml-2 has-text-grey"></i></a></section><article class="mt-6 comment-container"><script async repo="xiao-ming9/xiao-ming9.github.io" src="https://utteranc.es/client.js" issue-term="pathname" theme="preferred-color-scheme"></script></article></div></div></main></main><footer class="is-flex is-flex-direction-column is-align-items-center is-flex-shrink-0 is-family-serif"><section class="sns-container"><!-- Github--><!-- Ins--><!-- RSS--><!-- 知乎--><!-- 领英--><!-- 脸书--></section><p><span>Copyright ©</span><span> silverming 2021</span></p><div class="is-flex is-justify-content-center is-flex-wrap-wrap"><p>Powered by Hexo &verbar;&nbsp;</p><p class="is-flex is-justify-content-center"><a title="Hexo theme author" href="//github.com/haojen">Theme by Haojen&nbsp;</a></p><div style="margin-top: 2px"><a class="github-button" title="github-button" href="https://github.com/haojen/hexo-theme-Claudia" target="_blank" rel="noopener" data-color-scheme="no-preference: light; light: light; dark: dark;" data-show-count="true"></a></div></div><div><span><a href="https://beian.miit.gov.cn/" target="_blank">粤ICP备18114217号</a></span></div></footer><script async defer src="https://buttons.github.io/buttons.js"></script><script src="/js/post.js"></script></body></html>