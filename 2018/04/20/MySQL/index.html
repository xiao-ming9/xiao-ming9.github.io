

<!DOCTYPE html>
<html lang="zh-CN" data-default-color-scheme=&#34;auto&#34;>



<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="https://qiniu.xiaoming.net.cn/%E5%8D%9A%E5%AE%A2icon.jpeg">
  <link rel="icon" href="https://qiniu.xiaoming.net.cn/%E5%8D%9A%E5%AE%A2icon.jpeg">
  <meta name="viewport"
        content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
    <meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="description" content="MySQL基本命令MySQL 数据库的一个实例可以同时包含多个数据库（每条命令结束后加分号），不区分大小写

查看当前实例下包含多少个数据库：
12show databases；show CREATE DATABASE 数据库名；#查看创建库的信息
用户需要创建新的数据库：
123create database [IF NOT EXISTS]数据库名；create database 数据库名 ch">
  <meta name="author" content="Silverming">
  <meta name="keywords" content="">
  
  <title>MySQL - Silverming</title>

  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/css/bootstrap.min.css" />


  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/github-markdown-css@4.0.0/github-markdown.min.css" />
  <link  rel="stylesheet" href="/lib/hint/hint.min.css" />

  
    
    
      
      <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@10.4.0/styles/github-gist.min.css" />
    
  

  
    <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.css" />
  



<!-- 主题依赖的图标库，不要自行修改 -->
<link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_ba1fz6golrf.css">

<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_kmeydafke9r.css">

<link  rel="stylesheet" href="/css/main.css" />

<!-- 自定义样式保持在最底部 -->


  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    var CONFIG = {"hostname":"yoursite.com","root":"/","version":"1.8.11","typing":{"enable":true,"typeSpeed":70,"cursorChar":"|","loop":false},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"right","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"copy_btn":true,"image_zoom":{"enable":true,"img_url_replace":["",""]},"toc":{"enable":true,"headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"lazyload":{"enable":false,"loading_img":"/img/loading.gif","onlypost":false,"offset_factor":2},"web_analytics":{"enable":true,"baidu":"54ebb03ad7ad5b762ac8ff7958df6d3f","google":"G-M2RT7SDT3L","gtag":"G-M2RT7SDT3L","tencent":{"sid":null,"cid":null},"woyaola":null,"cnzz":null,"leancloud":{"app_id":"tFHjJkaAYKqH8BIXKnJVurUc-MdYXbMMI","app_key":"1qR5F7XyydYd5YJtIpMJBFmP","server_url":null}},"search_path":"/local-search.xml"};
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
</head>


<body>
  <header style="height: 70vh;">
    <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand"
       href="/">&nbsp;<strong>Silverming</strong>&nbsp;</a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/">
                <i class="iconfont icon-home-fill"></i>
                首页
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/">
                <i class="iconfont icon-archive-fill"></i>
                归档
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/">
                <i class="iconfont icon-tags-fill"></i>
                标签
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/">
                <i class="iconfont icon-user-fill"></i>
                关于
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/links/">
                <i class="iconfont icon-link-fill"></i>
                友链
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" target="_self" data-toggle="modal" data-target="#modalSearch">&nbsp;<i
                class="iconfont icon-search"></i>&nbsp;</a>
          </li>
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" target="_self">&nbsp;<i
                class="iconfont icon-dark" id="color-toggle-icon"></i>&nbsp;</a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

    <div class="banner" id="banner" parallax=true
         style="background: url('https://qiniu.xiaoming.net.cn/%E5%8D%9A%E5%AE%A2%E8%83%8C%E6%99%AF%E5%9B%BE.jpg') no-repeat center center;
           background-size: cover;">
      <div class="full-bg-img">
        <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
          <div class="page-header text-center fade-in-up">
            <span class="h2" id="subtitle" title="MySQL">
              
            </span>

            
              <div class="mt-3">
  
  
    <span class="post-meta">
      <i class="iconfont icon-date-fill" aria-hidden="true"></i>
      <time datetime="2018-04-20 00:00" pubdate>
        2018年4月20日 凌晨
      </time>
    </span>
  
</div>

<div class="mt-1">
  
    
    <span class="post-meta mr-2">
      <i class="iconfont icon-chart"></i>
      12.7k 字
    </span>
  

  
    
    <span class="post-meta mr-2">
      <i class="iconfont icon-clock-fill"></i>
      
      
      155
       分钟
    </span>
  

  
  
    
      <!-- LeanCloud 统计文章PV -->
      <span id="leancloud-page-views-container" class="post-meta" style="display: none">
        <i class="iconfont icon-eye" aria-hidden="true"></i>
        <span id="leancloud-page-views"></span> 次
      </span>
    
  
</div>

            
          </div>

          
        </div>
      </div>
    </div>
  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="d-none d-lg-block col-lg-2"></div>
    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div class="py-5" id="board">
          <article class="post-content mx-auto">
            <!-- SEO header -->
            <h1 style="display: none">MySQL</h1>
            
              <p class="note note-info">
                
                  本文最后更新于：2021年5月14日 晚上
                
              </p>
            
            <div class="markdown-body">
              <h1 id="MySQL基本命令"><a href="#MySQL基本命令" class="headerlink" title="MySQL基本命令"></a>MySQL基本命令</h1><p>MySQL 数据库的一个实例可以同时包含多个数据库（每条命令结束后加分号），不区分大小写</p>
<ol>
<li><p>查看当前实例下包含多少个数据库：</p>
<figure class="highlight sql"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs sql"><span class="hljs-keyword">show</span> <span class="hljs-keyword">databases</span>；<br><span class="hljs-keyword">show</span> <span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">DATABASE</span> 数据库名；<span class="hljs-comment">#查看创建库的信息</span><br></code></pre></div></td></tr></table></figure></li>
<li><p>用户需要创建新的数据库：</p>
<figure class="highlight sql"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs sql"><span class="hljs-keyword">create</span> <span class="hljs-keyword">database</span> [<span class="hljs-keyword">IF</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">EXISTS</span>]数据库名；<br><span class="hljs-keyword">create</span> <span class="hljs-keyword">database</span> 数据库名 <span class="hljs-built_in">character</span> <span class="hljs-keyword">set</span> GBK/UTF<span class="hljs-number">-8</span>/...;<span class="hljs-comment">#指定编码</span><br><span class="hljs-keyword">show</span> <span class="hljs-keyword">variables</span> <span class="hljs-keyword">like</span> <span class="hljs-string">'character%'</span>;<span class="hljs-comment">#查看编码</span><br></code></pre></div></td></tr></table></figure></li>
<li><p>删除指定数据库：</p>
<figure class="highlight n1ql"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs n1ql"><span class="hljs-keyword">drop</span> <span class="hljs-keyword">database</span> 数据库名；<br></code></pre></div></td></tr></table></figure>
<a id="more"></a>
</li>
<li><p>进入数据库：</p>
<figure class="highlight sql"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs sql"><span class="hljs-keyword">use</span> 数据库名；<br><span class="hljs-keyword">select</span> <span class="hljs-keyword">database</span>();<span class="hljs-comment">#查看当前选择的数据库</span><br></code></pre></div></td></tr></table></figure></li>
<li><p>进入数据库后，查询该数据库下包含多少个数据表：</p>
<figure class="highlight sql"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs sql"><span class="hljs-keyword">show</span> <span class="hljs-keyword">tables</span>;<br></code></pre></div></td></tr></table></figure></li>
<li><p>查看指定数据表的表结构（查看该表有多少列，每列的数据类型等信息）：</p>
<figure class="highlight axapta"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs axapta"><span class="hljs-keyword">desc</span> 表名；<br></code></pre></div></td></tr></table></figure></li>
<li><p>MySQL语句注释：使用“#”或者“–”，多行注释使用“/* */”</p>
</li>
</ol>
<h1 id="MySQL数据库存储机制"><a href="#MySQL数据库存储机制" class="headerlink" title="MySQL数据库存储机制"></a>MySQL数据库存储机制</h1><ol>
<li>MySAM：对事务支持不够好</li>
<li>InnoDB：系统默认机制</li>
</ol>
<figure class="highlight ini"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs ini"><span class="hljs-attr">ENGING</span>=MyISAM——强制使用第一种机制<br><span class="hljs-attr">ENGING</span>=InnoDB——强制使用第二种机制<br></code></pre></div></td></tr></table></figure>
<h1 id="SQL语句基础"><a href="#SQL语句基础" class="headerlink" title="SQL语句基础"></a>SQL语句基础</h1><p>SQL 结构化查询语句 </p>
<h2 id="DDL语句：操作数据库对象的语句"><a href="#DDL语句：操作数据库对象的语句" class="headerlink" title="DDL语句：操作数据库对象的语句"></a>DDL语句：操作数据库对象的语句</h2><ul>
<li>包括创建（create）、删除（drop）、修改（alter）数据库对象</li>
<li>最基本的数据库对象是数据表，数据表是存储数据的逻辑单元</li>
<li>常见的数据库对象</li>
</ul>
<table>
<thead>
<tr>
<th align="left">对象名称</th>
<th align="left">对应关键字</th>
<th align="left">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="left">表</td>
<td align="left">table</td>
<td align="left">表以行和列的形式存在：列就是字段，行就是记录</td>
</tr>
<tr>
<td align="left">数据字典</td>
<td align="left"></td>
<td align="left">就是系统表，存放数据库相关信息的表</td>
</tr>
<tr>
<td align="left">约束</td>
<td align="left">constraint</td>
<td align="left">执行数据校验的规则，用于保证数据完整性的规则</td>
</tr>
<tr>
<td align="left">视图</td>
<td align="left">view</td>
<td align="left">一个或者多个数据表数据的逻辑显示。视图并不存储数据</td>
</tr>
<tr>
<td align="left">索引</td>
<td align="left">index</td>
<td align="left">用于提高查询性能，相当于书的目录</td>
</tr>
<tr>
<td align="left">函数</td>
<td align="left">function</td>
<td align="left">用于完成一次特定的计算，具有一个返回值</td>
</tr>
<tr>
<td align="left">存储过程</td>
<td align="left">procedure</td>
<td align="left">用于完成一次完整的业务处理，没有返回值，但可以通过传出参数将多个值传给调用环境</td>
</tr>
<tr>
<td align="left">触发器</td>
<td align="left">trigger</td>
<td align="left">相当于一个事件监听器，当数据库发生特定事件后，触发器触发，完成相应的处理</td>
</tr>
</tbody></table>
<h3 id="创建表的语法"><a href="#创建表的语法" class="headerlink" title="创建表的语法"></a>创建表的语法</h3><ul>
<li>只需指定该表包含多少列，每列的数据类型信息，无需指定多少行，因为数据库的行是动态的，每条用于保存一条用户数据</li>
<li>语法：</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs sql"><span class="hljs-keyword">create</span> <span class="hljs-keyword">table</span> [模式名.]表名<br>(<br>  <span class="hljs-comment">#可以有多个列定义</span><br>  columnName datatype [<span class="hljs-keyword">default</span> expr]，<br>  ...<br>)<br></code></pre></div></td></tr></table></figure>
<ul>
<li>每个列定义之间以英文逗号隔开，<code>最后一个不用</code></li>
<li><code>列定义由列名、列类型和可选默认值组成</code></li>
<li>指定默认值用“default 值”</li>
<li><code>这种建表语句只是创建一个空表，表里没有任何数据</code></li>
<li>MySQL支持的列类型</li>
</ul>
<table>
<thead>
<tr>
<th>列类型</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>tinyint/smallint/mediumint/int(integer)/bigint</td>
<td>1字节/2字节/3字节/4字节/8字节整数，又可分为有无符号两种。这些整数类型区别仅仅是表数范围不同</td>
</tr>
<tr>
<td>float/double</td>
<td>单精度、双精度浮点数</td>
</tr>
<tr>
<td>decimal(dec)</td>
<td>精确小数类型，相当于float double不会产生精度丢失问题,decimal(M,D),指定数M位，其中小数点后D位</td>
</tr>
<tr>
<td>data</td>
<td>日期类型，不能保存时间</td>
</tr>
<tr>
<td>time</td>
<td>时间类型，不能保存日期</td>
</tr>
<tr>
<td>datatime</td>
<td>日期、时间类型</td>
</tr>
<tr>
<td>timestamp</td>
<td>时间戳类型</td>
</tr>
<tr>
<td>year</td>
<td>年类型，仅仅保存时间的年份</td>
</tr>
<tr>
<td>char</td>
<td>定长字符串类型</td>
</tr>
<tr>
<td>varchar</td>
<td>可变长度字符串类型</td>
</tr>
<tr>
<td>binary</td>
<td>定长二进制字符串类型，它以二进制形式保存字符串</td>
</tr>
<tr>
<td>varbinary</td>
<td>可变长度的二进制字符串类型，以二进制形式</td>
</tr>
<tr>
<td>tinyblob/blob/mediumblob/longblob</td>
<td>1字节/2字节/3字节/4字节的二进制大对象，用于存储图片、音乐等二进制数据，分别可存储：255B/64KB/16MB/4GB的大小，区分大小写</td>
</tr>
<tr>
<td>tinytext/text/mediumtext/longtext</td>
<td>1字节/2字节/3字节/4字节文本对象，可用于存储超长长度的字符串，分别可存储255B/64KB/16MB/4GB，不区分大小写</td>
</tr>
<tr>
<td>enmu(‘value1’,’value2’,…)</td>
<td>枚举类型，该列的值只能是enum中多个值的其中一个</td>
</tr>
<tr>
<td>set(‘value1’,’value2’,…)</td>
<td>集合类型，该列的值可以是set后括号中的其中几个</td>
</tr>
<tr>
<td>- 使用子查询建表语句，则可以在建表的同时插入数据</td>
<td></td>
</tr>
</tbody></table>
<figure class="highlight sql"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs sql"><span class="hljs-keyword">create</span> <span class="hljs-keyword">table</span> [模式名.]表名 [<span class="hljs-keyword">colum</span>[,colum...]]<br><span class="hljs-keyword">as</span> subquery;<br></code></pre></div></td></tr></table></figure>
<p>新表中的字段列表必须与子查询中字段列表数量匹配，创建新表时的字段列表可以省略（表示新表的列名与选择结果完全相同）</p>
<h3 id="查看表结构的语法"><a href="#查看表结构的语法" class="headerlink" title="查看表结构的语法"></a>查看表结构的语法</h3><blockquote>
<p><code>describe(desc简写)</code> 表名：显示出一个表</p>
</blockquote>
<blockquote>
<p><code>show create table</code> 表名：显示更详细，包括代码</p>
</blockquote>
<h3 id="修改表结构的语法"><a href="#修改表结构的语法" class="headerlink" title="修改表结构的语法"></a>修改表结构的语法</h3><ul>
<li>修改表结构使用<code>alter table</code>，包括增加列定义、修改列定义、删除列、重命名列等操作<h4 id="增加列定义"><a href="#增加列定义" class="headerlink" title="增加列定义"></a>增加列定义</h4></li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs sql"><span class="hljs-keyword">alter</span> <span class="hljs-keyword">table</span> 表名<br><span class="hljs-keyword">add</span><br>(<br>   <span class="hljs-comment">#可以有多个列定义</span><br>   column_name1 datatype [<span class="hljs-keyword">default</span> expr] [<span class="hljs-keyword">first</span>|<span class="hljs-keyword">after</span> col_name],<br>   ...<br>)<br></code></pre></div></td></tr></table></figure>
<p>如果只新增一列，可以省略圆括号，在add后紧跟一个列定义即可。</p>
<p><code>字符串值是由单引号引起的</code></p>
<h4 id="修改列定义"><a href="#修改列定义" class="headerlink" title="修改列定义"></a>修改列定义</h4><figure class="highlight sql"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs sql"><span class="hljs-keyword">alter</span> <span class="hljs-keyword">table</span> 表名<br><span class="hljs-keyword">modify</span> column_name datatype(修改后的类型) [<span class="hljs-keyword">default</span> expr] [<span class="hljs-keyword">first</span>|<span class="hljs-keyword">after</span> col_name](指定需要将目标修改到指定位置）;<br></code></pre></div></td></tr></table></figure>
<ul>
<li>该修改语句每次只能修改一个列定义</li>
<li>add新增的列名是原表中不存在的，modify修改的是原表中已存在的</li>
<li>first 表示添加在最开始处，after xxx表示添加在xxx之后<h4 id="删除列"><a href="#删除列" class="headerlink" title="删除列"></a>删除列</h4></li>
</ul>
<figure class="highlight pgsql"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs pgsql"><span class="hljs-keyword">alter</span> <span class="hljs-keyword">table</span> 表名<br><span class="hljs-keyword">drop</span> colum_name<br></code></pre></div></td></tr></table></figure>
<h4 id="重命名数据表"><a href="#重命名数据表" class="headerlink" title="重命名数据表"></a>重命名数据表</h4><figure class="highlight pgsql"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs pgsql"><span class="hljs-keyword">alter</span> <span class="hljs-keyword">table</span> 表名<br><span class="hljs-keyword">rename</span> <span class="hljs-keyword">to</span> 新名<br></code></pre></div></td></tr></table></figure>
<h4 id="完全改变列定义-change"><a href="#完全改变列定义-change" class="headerlink" title="完全改变列定义 change"></a>完全改变列定义 <code>change</code></h4><figure class="highlight markdown"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs markdown">alter table 表名<br>change old<span class="hljs-emphasis">_column new_</span>column type [<span class="hljs-string">default expr</span>][<span class="hljs-symbol">first|after col_name</span>]<br></code></pre></div></td></tr></table></figure>
<p>一般只有需要修改列名时才会使用change选项</p>
<h3 id="删除表的语法"><a href="#删除表的语法" class="headerlink" title="删除表的语法"></a>删除表的语法</h3><figure class="highlight gams"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs gams">drop <span class="hljs-keyword">table</span> 表名<br></code></pre></div></td></tr></table></figure>
<ul>
<li>表结构被删除，表对象不再存在；</li>
<li>表里所有数据也被删除；</li>
<li>表里所有相关索引，约束也被删除<h3 id="truncate-表"><a href="#truncate-表" class="headerlink" title="truncate 表"></a>truncate 表</h3>作用：<code>删除表里全部数据和结构，在重新建立一个新表（更彻底，无法找回</code><figure class="highlight maxima"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs maxima"><span class="hljs-built_in">truncate</span> 表名<br></code></pre></div></td></tr></table></figure>
<h2 id="数据库约束"><a href="#数据库约束" class="headerlink" title="数据库约束"></a>数据库约束</h2></li>
<li>约束类型：<blockquote>
<p>NOT NULL：非空约束，指定某列不能为空。</p>
</blockquote>
</li>
</ul>
<blockquote>
<p>UNIQUE：唯一约束，指定某列或者几列组合不能重复。</p>
</blockquote>
<blockquote>
<p>PRIMARY KEY：主键，指定该列的值可以唯一的标识该条记录。</p>
</blockquote>
<blockquote>
<p>POREING KEY：外键，指定该行记录从属于主表中的一条记录，主要用于保证参照完整性。</p>
</blockquote>
<blockquote>
<p>CHECK：检查，指定一个布尔表达式，用于指定对应列的值必需满足该表达式</p>
</blockquote>
<p><code>MySQL不支持CHECK约束，可使用但没卵用</code></p>
<ul>
<li>根据约束对数据列的限制，约束分为如下两类：<blockquote>
<p>单列约束：每个约束只约束一列。</p>
</blockquote>
</li>
</ul>
<blockquote>
<p>多列约束:每个约束可以约束多个数据列。</p>
</blockquote>
<h3 id="NOT-NULL约束"><a href="#NOT-NULL约束" class="headerlink" title="NOT NULL约束"></a>NOT NULL约束</h3><ul>
<li>它只能作为<code>列级约束</code>使用</li>
<li><code>非空约束不能指定名字</code></li>
<li>null值：<blockquote>
<p>所有数据类型的值都可以是null；</p>
</blockquote>
</li>
</ul>
<blockquote>
<p>空字符串不等于null，0也不等于null；</p>
</blockquote>
<blockquote>
<p><code>在数据库中null不等于null</code>；</p>
</blockquote>
<ul>
<li>使用：</li>
</ul>
<ol>
<li>只要在列表定义后添加<code>not null</code>；</li>
</ol>
<figure class="highlight routeros"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs routeros">create table hehe<br>(<br>  #建立了非空约束，这意味着hehe_id不可以为<span class="hljs-literal">null</span><br>  hehe_id int <span class="hljs-keyword">not</span> <span class="hljs-literal">null</span>,<br>  # MySQL的非空约束不能指定名字<br>  hehe_name varchar(255)<span class="hljs-built_in"> default </span><span class="hljs-string">'xyz'</span> <span class="hljs-keyword">not</span> <span class="hljs-literal">null</span>,<br>  #下面列可以为空，默认就是可以为空<br>  hehe_gender varchar(2) <span class="hljs-literal">null</span><br>);<br></code></pre></div></td></tr></table></figure>
<ol start="2">
<li>在使用alter table 修改表时增加或者删除非空约束</li>
</ol>
<figure class="highlight sql"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs sql"><span class="hljs-comment">#增加非空约束</span><br><span class="hljs-keyword">alter</span> <span class="hljs-keyword">table</span> hehe<br><span class="hljs-keyword">modify</span> hehe_gender <span class="hljs-built_in">varchar</span>(<span class="hljs-number">2</span>) <span class="hljs-keyword">not</span> <span class="hljs-literal">null</span><br><span class="hljs-comment">#取消非空约束</span><br><span class="hljs-keyword">modify</span> hehe_name <span class="hljs-built_in">varchar</span>(<span class="hljs-number">2</span>) <span class="hljs-literal">null</span>;<br><span class="hljs-comment">#取消非空约束，并指定默认值</span><br><span class="hljs-keyword">alter</span> <span class="hljs-keyword">table</span> hehe<br><span class="hljs-keyword">modify</span> hehe_name <span class="hljs-built_in">varchar</span>(<span class="hljs-number">255</span>) <span class="hljs-keyword">default</span> <span class="hljs-string">'abc'</span> <span class="hljs-literal">null</span>;<br></code></pre></div></td></tr></table></figure>
<h3 id="UNIQUE约束"><a href="#UNIQUE约束" class="headerlink" title="UNIQUE约束"></a>UNIQUE约束</h3><ul>
<li>唯一约束用于保证指定列或指定列组合不允许出现重复值，<code>但可以出现多个null</code></li>
<li>当某列创建唯一约束时，会为该列相应的创建唯一索引</li>
<li>如果不给唯一约束起名，该唯一约束默认与列名同名</li>
<li>如果需要为多列建组合约束，或者需要<code>为唯一约束指定约束名</code>，`只能用表级约束语法。</li>
<li>使用：</li>
</ul>
<ol>
<li>列级约束语法：在定义后增加<code>unique</code>关键字即可</li>
</ol>
<figure class="highlight sql"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs sql"><span class="hljs-comment">#建表时创建唯一约束，使用列级约束法建立约束</span><br><span class="hljs-keyword">create</span> <span class="hljs-keyword">table</span> unique_test<br>(<br>  <span class="hljs-comment">#建立了非空约束</span><br>  test_id <span class="hljs-built_in">int</span> <span class="hljs-keyword">not</span> <span class="hljs-literal">null</span>,<br>  <span class="hljs-comment">#unique是唯一约束，使用列级约束法建立唯一约束</span><br>  test_name <span class="hljs-built_in">varchar</span>(<span class="hljs-number">255</span>) <span class="hljs-keyword">unique</span><br>);a<br></code></pre></div></td></tr></table></figure>
<ol start="2">
<li>表级约束语法：<code>[constraint 约束名] 约束定义</code></li>
</ol>
<ul>
<li>即可放在create table中，也可放在alter table中使用关键字add来添加约束<figure class="highlight sql"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs sql"><span class="hljs-keyword">create</span> <span class="hljs-keyword">table</span> unique_test2<br>(<br>  test_id <span class="hljs-built_in">int</span> <span class="hljs-keyword">not</span> <span class="hljs-literal">null</span>,<br>  test_name <span class="hljs-built_in">varchar</span>(<span class="hljs-number">255</span>),<br>  test_pass <span class="hljs-built_in">varchar</span>(<span class="hljs-number">255</span>),<br>  <span class="hljs-comment">#使用表级约束法语句建立唯一约束</span><br>  <span class="hljs-keyword">unique</span> (test_name),<br>  <span class="hljs-comment">#使用表级约束法建立唯一约束，并指定约束名</span><br>  <span class="hljs-keyword">constraint</span> test2_uk <span class="hljs-keyword">unique</span> (test_pass)<br>  \<br>  <span class="hljs-comment">#使用表级约束法建立唯一约束，指定两列组合不允许重复</span><br>  <span class="hljs-keyword">constraint</span> test3_uk <span class="hljs-keyword">unique</span>(test_name,test_pass)<br>  \<br>  <span class="hljs-comment">#使用add关键字添加唯一约束</span><br>  <span class="hljs-keyword">add</span> <span class="hljs-keyword">unique</span>(test_name,test_pass),<br>);<br></code></pre></div></td></tr></table></figure></li>
<li>在修改表结构时使用add关键字添加唯一约束</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs sql"><span class="hljs-keyword">alter</span> <span class="hljs-keyword">table</span> unique_test3<br><span class="hljs-keyword">add</span> <span class="hljs-keyword">unique</span>(test_name,test_pass);<br></code></pre></div></td></tr></table></figure>
<p>3.在修改表时使用modify关键字，为单列采用列级约束语法来增加唯一约束</p>
<figure class="highlight sql"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs sql"><span class="hljs-keyword">alter</span> <span class="hljs-keyword">table</span> unique_test3<br><span class="hljs-keyword">modify</span> test_name verchar(<span class="hljs-number">255</span>) <span class="hljs-keyword">unique</span>;<br></code></pre></div></td></tr></table></figure>
<p>5.删除约束：<code>drop index 约束名</code></p>
<figure class="highlight sql"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs sql"><span class="hljs-keyword">alter</span> <span class="hljs-keyword">table</span> unique_test3<br><span class="hljs-keyword">drop</span> <span class="hljs-keyword">index</span> text3_uk;<br></code></pre></div></td></tr></table></figure>
<h3 id="PRIMARY-KEY约束"><a href="#PRIMARY-KEY约束" class="headerlink" title="PRIMARY KEY约束"></a>PRIMARY KEY约束</h3><ul>
<li><p><code>主键约束相当于非空约束和唯一约束</code></p>
</li>
<li><p>主键列的值可用于唯一的标识表中的一条记录</p>
</li>
<li><p><code>每一个表中最多允许有一个主键</code>，主键是表中能唯一确定一行记录的字段或字段组合</p>
</li>
<li><p>不管用户是否为主键约束指定约束名，MySQL总是将所有的主键约束命名为PRIMARY</p>
</li>
<li><p>MySQL在主键约束所在列或列组合上建立对应的唯一索引</p>
</li>
<li><p>使用：<code>primary key</code></p>
<p>1.列级约束法 </p>
</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs sql"><span class="hljs-keyword">create</span> <span class="hljs-keyword">table</span> primary_test<br>(<br>  <span class="hljs-comment">#建立了主键约束</span><br>  test_id <span class="hljs-built_in">int</span> primary <span class="hljs-keyword">key</span>,<br>  test_name <span class="hljs-built_in">varchar</span>(<span class="hljs-number">255</span>)<br>);<br></code></pre></div></td></tr></table></figure>
<p>2.表级约束法:<code>[constraint 约束名]</code> 约束定义</p>
<figure class="highlight sql"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs sql"><span class="hljs-keyword">create</span> <span class="hljs-keyword">table</span> primary_test2<br>(<br>  test_id <span class="hljs-built_in">int</span> <span class="hljs-keyword">not</span> <span class="hljs-literal">null</span>,<br>  test_name <span class="hljs-built_in">varchar</span>(<span class="hljs-number">255</span>),<br>  teat_pass <span class="hljs-built_in">varchar</span>(<span class="hljs-number">255</span>),<br>  <span class="hljs-comment">#指定约束名对MySQL无效</span><br>  <span class="hljs-keyword">constraint</span> test_pk primary <span class="hljs-keyword">key</span> (test_id)<br>  \<br>  <span class="hljs-comment">#建立多列组合的主键约束</span><br>  primary <span class="hljs-keyword">key</span> (test_name,test_pass)<br>);<br></code></pre></div></td></tr></table></figure>
<figure class="highlight sql"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs sql"><span class="hljs-keyword">alter</span> <span class="hljs-keyword">table</span> primary_test3<br><span class="hljs-keyword">modify</span> test_nama <span class="hljs-built_in">varchar</span>(<span class="hljs-number">255</span>) primary <span class="hljs-keyword">key</span>;<br></code></pre></div></td></tr></table></figure>
<p>3.删除指定表的主键约束：<code>drop primary key</code></p>
<figure class="highlight n1ql"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs n1ql">alter table primary_test3<br><span class="hljs-keyword">drop</span> <span class="hljs-keyword">primary</span> <span class="hljs-keyword">key</span>;<br>\<br><span class="hljs-keyword">drop</span> <span class="hljs-keyword">primary</span> <span class="hljs-keyword">key</span> (test_name,test_pass);<br></code></pre></div></td></tr></table></figure>
<ol start="4">
<li>自增长特性：<code>auto_increment</code></li>
</ol>
<ul>
<li>如果某个数据列的类型是整形，而且该列作为主键列，可指定该列具有自增长功能。</li>
<li>该功能通常用于设置逻辑主键列–该列的值没有任何物理意义，仅仅用于表示每行记录</li>
<li>一旦指定了某列具有自增长特性，则向该表插入记录时可不为该列指定值，由数据库系统自动生成<figure class="highlight sql"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs sql"><span class="hljs-keyword">create</span> <span class="hljs-keyword">table</span> primary_test4<br>(<br>  <span class="hljs-comment">#建立主键约束，使用自增长</span><br>  test_id <span class="hljs-built_in">int</span> auto_increment primary <span class="hljs-keyword">key</span>,<br>  test_name <span class="hljs-built_in">varchar</span>(<span class="hljs-number">255</span>),<br>  test_pass <span class="hljs-built_in">varchar</span>(<span class="hljs-number">255</span>)<br>);<br></code></pre></div></td></tr></table></figure>
<h3 id="FOREIGN-KEY约束"><a href="#FOREIGN-KEY约束" class="headerlink" title="FOREIGN KEY约束"></a>FOREIGN KEY约束</h3></li>
<li>外键约束主要用于保证一个或两个数据表之间的参考完整性，外键是构建于一个表的两个字段或者两个表的字段之间的参照关系：<code>子（从）表外键列的值必须在主表被参照列的值范围之内，或者为空。</code></li>
<li>当主表的记录被从表记录参照后，必须先把从表里参照记录的所有记录全部删除后，才可以删除主表的该记录或者删除主表记录时级联删除从表所有参照该记录的从表记录</li>
<li><code>从表外键参照的只能是主表主键列或者唯一键列。同一个表中可以拥有多个外键。</code></li>
<li>对于一对多的关联关系，<code>通常在多的一端增加外键列</code></li>
<li>增加外键列的表被称为从表</li>
<li>使用：<code>references</code></li>
</ul>
<ol>
<li>列级约束语法(MySQL建立的列级约束语法不会生效)</li>
</ol>
<figure class="highlight sql"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs sql"><span class="hljs-comment">#为保证从表参照的主表存在，通常应该先建主表</span><br><span class="hljs-keyword">create</span> <span class="hljs-keyword">table</span> teacher_table<br>(<br>  <span class="hljs-comment">#auto_increment:代表数据库的自动编码策略，通常用作数据表的逻辑主键</span><br>  teacher_id <span class="hljs-built_in">int</span> auto_increment,<br>  teacher_name <span class="hljs-built_in">varchar</span>(<span class="hljs-number">255</span>)，<br>  primary <span class="hljs-keyword">key</span>(teacher_id)<br>)；<br><span class="hljs-keyword">create</span> <span class="hljs-keyword">table</span> student_table<br>(<br>  <span class="hljs-comment">#为本表建立主键约束</span><br>  student_id <span class="hljs-built_in">int</span> auto_increment primary <span class="hljs-keyword">key</span>,<br>  student_name <span class="hljs-built_in">varchar</span>(<span class="hljs-number">255</span>),<br>  <span class="hljs-comment">#指定java_teacher参照到teacher_table的teacher_id列</span><br>  java_teacher <span class="hljs-built_in">int</span> <span class="hljs-keyword">references</span> teacher_table(teacher_id)<br>);<br></code></pre></div></td></tr></table></figure>
<ol start="2">
<li>表级约束语法：<code>foreign key</code><figure class="highlight sql"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs sql"><span class="hljs-comment">#为保证从表参照的主表存在，通常应该先建主表</span><br><span class="hljs-keyword">create</span> <span class="hljs-keyword">table</span> teacher_table1<br>(<br>  <span class="hljs-comment">#auto_increment:代表数据库的自动编码策略，通常用作数据表的逻辑主键</span><br>  teacher_id <span class="hljs-built_in">int</span> auto_increment,<br>  teacher_name <span class="hljs-built_in">varchar</span>(<span class="hljs-number">255</span>)，<br>  primary <span class="hljs-keyword">key</span>(teacher_id)<br>)；<br><span class="hljs-keyword">create</span> <span class="hljs-keyword">table</span> student_table<br>(<br>  <span class="hljs-comment">#为本表建立主键约束</span><br>  student_id <span class="hljs-built_in">int</span> auto_increment primary <span class="hljs-keyword">key</span>,<br>  student_name <span class="hljs-built_in">varchar</span>(<span class="hljs-number">255</span>),<br>  <span class="hljs-comment">#指定java_teacher参照到teacher_table的teacher_id列</span><br> <span class="hljs-keyword">foreign</span> <span class="hljs-keyword">key</span> (java_teacher) <span class="hljs-keyword">references</span> teacher_table1(teacher_id)<br>);<br></code></pre></div></td></tr></table></figure></li>
</ol>
<ul>
<li>使用表级约束语法可以为外键约束指定约束名，如果没有，MySQL会为该键命名为table_name_ibfk //table是从表的表名，而n从1开始的整数</li>
<li>如果需要建立多列组合的外键约束，必须使用表级约束法<figure class="highlight sql"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs sql"><span class="hljs-comment">#为保证从表参照的主表存在，通常应该先建主表</span><br><span class="hljs-keyword">create</span> <span class="hljs-keyword">table</span> teacher_table3<br>(<br>  <span class="hljs-comment">#auto_increment:代表数据库的自动编码策略，通常用作数据表的逻辑主键</span><br>  teacher_pass <span class="hljs-built_in">varchar</span>(<span class="hljs-number">255</span>),<br>  teacher_name <span class="hljs-built_in">varchar</span>(<span class="hljs-number">255</span>)，<br>  primary <span class="hljs-keyword">key</span>(teacher_name,teacher_pass)<br>)；<br><span class="hljs-keyword">create</span> <span class="hljs-keyword">table</span> student_table3<br>(<br>  <span class="hljs-comment">#为本表建立主键约束</span><br>  student_id <span class="hljs-built_in">int</span> auto_increment primary <span class="hljs-keyword">key</span>,<br>  student_name <span class="hljs-built_in">varchar</span>(<span class="hljs-number">255</span>),<br>  java_teacher_name <span class="hljs-built_in">varchar</span>(<span class="hljs-number">255</span>),<br>  java_teacher_pass <span class="hljs-built_in">varchar</span>(<span class="hljs-number">255</span>),<br>  <span class="hljs-comment">#指定两列的联合外键</span><br>  <span class="hljs-keyword">foreign</span> <span class="hljs-keyword">key</span> (java_teacher_name,java_teacher_pass) <span class="hljs-keyword">references</span> teacher_table3(teacher_name,teacher_pass)<br>);<br></code></pre></div></td></tr></table></figure></li>
</ul>
<ol start="3">
<li>显示指定外键约束的名字，可使用<code>constraint</code>来指定名字<figure class="highlight sql"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs sql"><span class="hljs-comment">#为保证从表参照的主表存在，通常应该先建主表</span><br><span class="hljs-keyword">create</span> <span class="hljs-keyword">table</span> teacher_table2<br>(<br>  <span class="hljs-comment">#auto_increment:代表数据库的自动编码策略，通常用作数据表的逻辑主键</span><br>  teacher_id <span class="hljs-built_in">int</span> auto_increment,<br>  teacher_name <span class="hljs-built_in">varchar</span>(<span class="hljs-number">255</span>)，<br>  primary <span class="hljs-keyword">key</span>(teacher_id)<br>)；<br><span class="hljs-keyword">create</span> <span class="hljs-keyword">table</span> student_table2<br>(<br>  <span class="hljs-comment">#为本表建立主键约束</span><br>  student_id <span class="hljs-built_in">int</span> auto_increment primary <span class="hljs-keyword">key</span>,<br>  student_name <span class="hljs-built_in">varchar</span>(<span class="hljs-number">255</span>),<br>  java_teacher <span class="hljs-built_in">int</span>,<br>  <span class="hljs-comment">#指定java_teacher参照到teacher_table的teacher_id列，并指定外键约束名为student_teacher_fk</span><br> <span class="hljs-keyword">constraint</span> student_teacher_fk <span class="hljs-keyword">foreign</span> <span class="hljs-keyword">key</span> (java_teacher) <span class="hljs-keyword">references</span> teacher_table2(teacher_id)<br>);<br></code></pre></div></td></tr></table></figure></li>
<li>删除外键约束：<code>alter table后加 drop foreign key 约束名</code><figure class="highlight sql"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs sql"><span class="hljs-comment">#删除student_table3表上名为student_table3_ibfk_1的外键约束</span><br><span class="hljs-keyword">alter</span> <span class="hljs-keyword">table</span> student_table3<br><span class="hljs-keyword">drop</span> <span class="hljs-keyword">foreign</span> <span class="hljs-keyword">key</span> student_tables3_ibfk_1;<br></code></pre></div></td></tr></table></figure></li>
<li>增加外键约束：<code>add foreign key</code><figure class="highlight sql"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs sql"><span class="hljs-keyword">alter</span> <span class="hljs-keyword">table</span> student_table3<br><span class="hljs-keyword">add</span> <span class="hljs-keyword">foreign</span> <span class="hljs-keyword">key</span>(java_teacher_name,java_teacher_pass) <span class="hljs-keyword">references</span> teacher_table3(teacher_name,teacher_pass);<br></code></pre></div></td></tr></table></figure></li>
<li>自关联：参照自身<figure class="highlight angelscript"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs angelscript">creater table foreign_test<br>(<br>  foreign_id <span class="hljs-built_in">int</span> <span class="hljs-built_in">auto</span>_increment primary key,<br>  foreign_name varchar(<span class="hljs-number">255</span>),<br>  <span class="hljs-built_in">ref</span>er_id <span class="hljs-built_in">int</span>,<br>  foreign key(<span class="hljs-built_in">ref</span>er_id) <span class="hljs-built_in">ref</span>erences foreign_test(foreign_id)<br>)<br></code></pre></div></td></tr></table></figure></li>
<li>删除主表记录：</li>
</ol>
<ul>
<li><code>on delete cascade</code>:删除主表记录时，把参照该主表记录的从表记录全部联级删除</li>
<li><code>on delete set null</code>：删除主表记录时，把参照该主表记录的从表记录的外键设为null</li>
<li>在建立外键约束后添加<h2 id="索引"><a href="#索引" class="headerlink" title="索引"></a>索引</h2></li>
<li>索引是一个数据库对象，从属于数据表</li>
<li>作用：加快对表的查询</li>
<li>索引在数据字典中独立存在，但不能独立存在，<code>必须属于某个表</code></li>
<li>创建索引：<blockquote>
<p>自动：当在表上定义<code>主键约束、唯一约束和外键约束</code>时，系统会为该数据自动创建对应的索引</p>
</blockquote>
</li>
</ul>
<blockquote>
<p>手动：用户可以通过<code>create index</code>语句来创建索引</p>
</blockquote>
<ul>
<li>删除索引：<blockquote>
<p>自动：数据表被删除时，该表上的索引自动被删除</p>
</blockquote>
</li>
</ul>
<blockquote>
<p>手动：通过<code>drop index</code>语句来删除指定数据表上的指定索引</p>
</blockquote>
<ul>
<li>一个表中可以有多个索引列，每个索引都可用于加速该列的查询速度</li>
<li>语法：</li>
</ul>
<ol>
<li>创建索引：</li>
</ol>
<ul>
<li>在创建表时创建索引：<figure class="highlight gams"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs gams">creat <span class="hljs-keyword">table</span> 表名<br>(<br>    字段<span class="hljs-number">1</span>，字段<span class="hljs-number">2.</span>.. <br>    [unique]index [索引别名](列名)；<span class="hljs-comment">//默认与列名相同</span><br>);<br></code></pre></div></td></tr></table></figure>
 加<code>unique</code>限定索引的值必须是唯一的</li>
<li>在已存在的表上创建索引</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs sql"><span class="hljs-keyword">create</span> (<span class="hljs-keyword">unique</span>)<span class="hljs-keyword">index</span> index_name<br><span class="hljs-keyword">on</span> table_name (<span class="hljs-keyword">column</span>[,<span class="hljs-keyword">column</span>]...);<br></code></pre></div></td></tr></table></figure>
<figure class="highlight sql"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs sql"><span class="hljs-comment">#提高employees基于last_name字段的查询速度</span><br><span class="hljs-keyword">create</span> <span class="hljs-keyword">index</span> exm_last_name_idx<br><span class="hljs-keyword">on</span> emoployees (last_name);<br></code></pre></div></td></tr></table></figure>
<figure class="highlight sql"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs sql"><span class="hljs-comment">#同时对多列建立索引</span><br><span class="hljs-keyword">create</span> <span class="hljs-keyword">index</span> emp_last_name_idx2<br><span class="hljs-keyword">on</span> employees(first_name , last_name);<br></code></pre></div></td></tr></table></figure>
<ul>
<li>使用alter table创建索引<figure class="highlight pgsql"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs pgsql"><span class="hljs-keyword">alter</span> <span class="hljs-keyword">table</span> 表名<br><span class="hljs-keyword">add</span> [<span class="hljs-keyword">unique</span>] <span class="hljs-keyword">index</span> [索引名] [列名]；<br></code></pre></div></td></tr></table></figure></li>
</ul>
<ol start="2">
<li>删除索引<figure class="highlight n1ql"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs n1ql"><span class="hljs-keyword">drop</span> <span class="hljs-keyword">index</span> 索引名 <span class="hljs-keyword">on</span> 表名<br></code></pre></div></td></tr></table></figure>
<figure class="highlight sql"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs sql"><span class="hljs-comment">#删除了employees表上的emp_last_name_idx2索引</span><br><span class="hljs-keyword">drop</span> <span class="hljs-keyword">index</span> emp_last_name_idx2<br><span class="hljs-keyword">on</span> employees<br></code></pre></div></td></tr></table></figure>
<h2 id="视图"><a href="#视图" class="headerlink" title="视图"></a>视图</h2></li>
</ol>
<ul>
<li>视图是一个或多个数据表中数据的逻辑显示，<code>并不能存储数据</code></li>
<li>视图只是数据表的逻辑显示，也就是一个<code>查询结果</code></li>
<li>语法：</li>
</ul>
<ol>
<li>创建/修改视图</li>
</ol>
<ul>
<li><code>create or replace</code><figure class="highlight sql"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs sql"><span class="hljs-comment">#如果指定视图名不存在，则创建视图；如果指定视图名已经存在，则使用新视图替换原有视图</span><br><span class="hljs-keyword">create</span> <span class="hljs-keyword">or</span> <span class="hljs-keyword">replace</span> <span class="hljs-keyword">view</span> 视图名<br><span class="hljs-keyword">as</span> <span class="hljs-keyword">select</span><br>subquery<br></code></pre></div></td></tr></table></figure>
<figure class="highlight n1ql"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs n1ql"><span class="hljs-keyword">create</span> <span class="hljs-keyword">or</span> <span class="hljs-built_in">replace</span> <span class="hljs-keyword">view</span> view_test[(a,b)]//创建字段别名<br><span class="hljs-keyword">as</span><br><span class="hljs-keyword">select</span> teacher_name,teacher_pass <span class="hljs-keyword">from</span> teacher_table;<br></code></pre></div></td></tr></table></figure></li>
<li><code>alter view 视图名</code><figure class="highlight pgsql"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs pgsql"><span class="hljs-keyword">alter</span> <span class="hljs-keyword">view</span> 视图名<br><span class="hljs-keyword">as</span> <span class="hljs-keyword">select</span> 语句<br></code></pre></div></td></tr></table></figure>
<blockquote>
<p>使用<code>with check option</code>子句创建的视图不允许修改</p>
</blockquote>
</li>
</ul>
<figure class="highlight smali"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs smali">create<span class="hljs-built_in"> or </span>replace view view_test<br>as<br>select teache_name  from teacher_table<br><span class="hljs-comment">#指定不允许修改该视图数据</span><br>with<span class="hljs-built_in"> check </span>option；<br></code></pre></div></td></tr></table></figure>
<ol start="2">
<li>删除视图：<code>drop view</code> 视图名；</li>
<li>查看视图：</li>
</ol>
<ul>
<li><code>describe(desc) 视图名</code>：查看基本信息</li>
<li><code>show table status like 视图名</code>：查看基本属性（基本都为null）</li>
<li><code>show create view 表名</code>：详细信息，包括建视图语句</li>
</ul>
<ol start="4">
<li>更新视图：DML语句<h2 id="DML语句：操作数据表里的数据"><a href="#DML语句：操作数据表里的数据" class="headerlink" title="DML语句：操作数据表里的数据"></a>DML语句：<code>操作数据表里的数据</code></h2><blockquote>
<p>插入新数据</p>
</blockquote>
</li>
</ol>
<blockquote>
<p>修改已有数据</p>
</blockquote>
<blockquote>
<p>删除不需要的数据</p>
</blockquote>
<ul>
<li>DML语句由<code>insert into、update和delete from</code>三个命令组成</li>
</ul>
<ol>
<li><code>insert into语句</code></li>
</ol>
<ul>
<li>用于向指定数据表中插入记录，每次只能插入一条</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs sql"><span class="hljs-keyword">insert</span> <span class="hljs-keyword">into</span> table_name[(<span class="hljs-keyword">column</span> [,column...])]<br><span class="hljs-keyword">values</span>(<span class="hljs-keyword">value</span> [,value...]); <span class="hljs-comment">#字符串使用单引号</span><br></code></pre></div></td></tr></table></figure>
<blockquote>
<p>表名后用括号列出所有需要插入值的列名，而values后用括号列出对应需要插入的值</p>
</blockquote>
<blockquote>
<p>如果省略表名后面的括号及括号里的列名列表，默认将为所有列插入值，则需要为每一列都指定一个值，也可以为无法确定的值的列分配null</p>
</blockquote>
<blockquote>
<p>只有在数据库中已经成功创建了数据表之后，才可以向数据表中插入记录</p>
</blockquote>
<blockquote>
<p>外键列的值必须是被参照列里已有的值，所以向从表中插入记录之前，通常应该先向主表中插入记录，否则从表记录的外键列只能为null</p>
</blockquote>
<blockquote>
<p>外键约束保证被参照的记录必须存在，但并不保证必须有被参照记录，即<code>外键列可以为null</code></p>
</blockquote>
<figure class="highlight sql"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs sql"><span class="hljs-keyword">insert</span> <span class="hljs-keyword">into</span> teacher_table2(teacher_name)<br><span class="hljs-keyword">values</span>(<span class="hljs-string">'xyz'</span>);<br><br><span class="hljs-keyword">insert</span> <span class="hljs-keyword">into</span> teacher_table2<br><span class="hljs-comment">#使用null代替主键列的值</span><br><span class="hljs-keyword">values</span>(<span class="hljs-literal">null</span>,<span class="hljs-string">'abc'</span>);<br></code></pre></div></td></tr></table></figure>
<ul>
<li>带子查询的插入语句：可以一次插入多条记录<blockquote>
<p>只要求选择出的数据和插入目的表的数据列个数相等、数据类型匹配</p>
</blockquote>
<figure class="highlight sql"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs sql"><span class="hljs-keyword">insert</span> <span class="hljs-keyword">into</span> student_table2(student_name)<br><span class="hljs-comment">#用带子查询的值来插入</span><br><span class="hljs-keyword">select</span> teacher_name <span class="hljs-keyword">from</span> teacher_table2;<br></code></pre></div></td></tr></table></figure></li>
<li>拓展语法：可以一次性插入多条记录，在values后使用多个括号包含多条记录，表示多条记录的多个括号之间以英文逗号（，）隔开<figure class="highlight sql"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs sql"><span class="hljs-keyword">insert</span> <span class="hljs-keyword">into</span> teacher_table2<br><span class="hljs-comment">#同时插入多个值</span><br><span class="hljs-keyword">values</span>(<span class="hljs-literal">null</span>,<span class="hljs-string">"Yeeku"</span>),<br>(<span class="hljs-literal">null</span>,<span class="hljs-string">"Sharfly"</span>);<br></code></pre></div></td></tr></table></figure></li>
</ul>
<ol start="2">
<li><code>update set语句</code></li>
</ol>
<ul>
<li>用于修改数据表的记录，每次可以修改多条记录，通过使用<code>where子句限定修改哪些记录</code></li>
<li>where与if类似，没有where的句子总为true，即该表所有记录都会被修改<figure class="highlight routeros"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs routeros">update table_name<br><span class="hljs-builtin-name">set</span> <span class="hljs-attribute">column1</span>=value1[,<span class="hljs-attribute">column2</span>=value2]<span class="hljs-built_in">..</span>.<br>[where condition];<br></code></pre></div></td></tr></table></figure></li>
<li>update语句还可以一次修改多列，通过<code>set关键字后使用column1=value1，column2=value2...来实现，修改多列的值之间用英文逗号隔开</code><figure class="highlight routeros"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs routeros"><span class="hljs-comment">#把teacher_table2表中所有的teacher_name列的值改为’孙悟空‘</span><br>update teacher_table2<br><span class="hljs-builtin-name">set</span> <span class="hljs-attribute">teacher_name</span>=<span class="hljs-string">'孙悟空'</span>；<br><br><span class="hljs-comment">#通过where条件来指定只修改特定记录</span><br>update teacher_table2<br><span class="hljs-builtin-name">set</span> <span class="hljs-attribute">teacher_name</span>=<span class="hljs-string">'猪八戒'</span><br>where teacher_id&gt;1;<br></code></pre></div></td></tr></table></figure></li>
</ul>
<ol start="3">
<li><code>delete from语句</code></li>
</ol>
<ul>
<li>用于删除指定数据表记录，使用时不需要指定列名，因为总是整行地删除</li>
<li>可使用where</li>
<li>格式语法<figure class="highlight n1ql"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs n1ql"><span class="hljs-keyword">delete</span> <span class="hljs-keyword">from</span> table_name<br>[<span class="hljs-keyword">where</span> condition];<br></code></pre></div></td></tr></table></figure>
<figure class="highlight sql"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs sql"><span class="hljs-comment">#把student_table2表中的记录全部删除</span><br><span class="hljs-keyword">delete</span> <span class="hljs-keyword">from</span> student_table2;<br><br><span class="hljs-comment">#使用where限定只删除指定记录，可以加上limit限制每次删除数量</span><br><span class="hljs-keyword">delete</span> <span class="hljs-keyword">from</span> teacher_table2<br><span class="hljs-keyword">where</span> teache_id &gt;<span class="hljs-number">2</span> <span class="hljs-keyword">limit</span> <span class="hljs-number">1</span>;<br></code></pre></div></td></tr></table></figure></li>
<li>只有先将从表中参照主表记录的所有记录全部删除后，才能删除主表记录<h2 id="单表查询"><a href="#单表查询" class="headerlink" title="单表查询"></a>单表查询</h2></li>
<li><code>select语句</code>：用于从一个或者多个数据表中选出特定的行、列的交集</li>
<li>语法格式：<figure class="highlight cs"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs cs"><span class="hljs-keyword">select</span> coulmu1,column2...<br><span class="hljs-keyword">from</span> 数据源<br>[<span class="hljs-meta">where condition</span>]<br></code></pre></div></td></tr></table></figure>
<blockquote>
<p>数据源可以是表、视图等；如果没有where条件，默认选出所有行；<code>如果想选出所有列，则可使用带星号(*)代表所有列</code>；</p>
</blockquote>
</li>
</ul>
<figure class="highlight n1ql"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs n1ql"><span class="hljs-keyword">select</span> *<br><span class="hljs-keyword">from</span> teacher_table;<br></code></pre></div></td></tr></table></figure>
<ul>
<li>select语句可使用算数运算符（+、-、*、/）<blockquote>
<p>不仅可以在列和常量、变量之间进行运算，<code>也可以在两列之间进行运算</code>。</p>
</blockquote>
</li>
</ul>
<blockquote>
<p>数据列很像一个变量，但其值具有指定的范围，因此能使用变量的地方，基本上都可以使用数据列。</p>
</blockquote>
<figure class="highlight sql"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs sql"><span class="hljs-keyword">select</span> teacher_id +<span class="hljs-number">5</span><br><span class="hljs-keyword">from</span> teacher_table;<br><br><span class="hljs-comment">#查询出teacher_table表中teacher_id*3大于4的记录</span><br><span class="hljs-keyword">select</span> *<br><span class="hljs-keyword">from</span> teacher_table<br><span class="hljs-keyword">where</span> teacher_id*<span class="hljs-number">3</span>&gt;<span class="hljs-number">4</span>;<br><br><span class="hljs-comment"># 数据列实际上可当成一个变量</span><br><span class="hljs-keyword">select</span> <span class="hljs-number">3</span>*<span class="hljs-number">5</span>，,<span class="hljs-number">20</span><br><span class="hljs-keyword">from</span> teacher_table;<br></code></pre></div></td></tr></table></figure>
<ul>
<li>MySQL使用 <code>concat</code> 函数来进行字符串连接运算：<figure class="highlight sql"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs sql"><span class="hljs-comment">-- 选择出teacher_name和'xxx'字符串连接后的结果</span><br><span class="hljs-keyword">select</span> <span class="hljs-keyword">concat</span>(teacher_name,<span class="hljs-string">'xxx'</span>)<br><span class="hljs-keyword">from</span> teacher_table;<br></code></pre></div></td></tr></table></figure>
如果让字符串和 null 进行连接运算，将使整个算数表达式的返回值为 null</li>
<li>可以为数据列或者表达式起一个别名，<code>别名紧跟数据列，中间以空格隔开，或者使用as关键字隔开</code><figure class="highlight sql"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs sql"><span class="hljs-keyword">select</span> teacher_id +<span class="hljs-number">5</span> <span class="hljs-keyword">as</span> MY_ID<br><span class="hljs-keyword">from</span> teacher_table;<br><br><span class="hljs-comment">#可以用双引号实现别名中的特殊字符</span><br><span class="hljs-keyword">select</span> teacher_id + <span class="hljs-number">5</span> <span class="hljs-string">"MY'id"</span><br><span class="hljs-keyword">from</span> teacher_table;<br><br><span class="hljs-comment">#为多列起名</span><br><span class="hljs-keyword">select</span> teacher_id +<span class="hljs-number">5</span> MY_id,teacher_name 老师名<br><span class="hljs-keyword">from</span> teacher_table;<br><br><span class="hljs-comment">#为表起别名</span><br><span class="hljs-keyword">select</span> teacher_id +<span class="hljs-number">5</span> <br><span class="hljs-keyword">from</span> teacher_table t;<br><br><span class="hljs-comment">#运算符在多列之间进行运算</span><br><span class="hljs-keyword">select</span> teacher_id +<span class="hljs-number">5</span> MY_ID,<span class="hljs-keyword">concat</span>(teacher_name,teacher_id) teacher_name<br><span class="hljs-keyword">from</span> teacher_table<br><span class="hljs-keyword">where</span> teacher_id *<span class="hljs-number">2</span>&gt;<span class="hljs-number">3</span>;<br><br><span class="hljs-keyword">select</span> <span class="hljs-number">5</span>+<span class="hljs-number">4</span><br><span class="hljs-keyword">from</span> teacher_table<br><span class="hljs-keyword">where</span> <span class="hljs-number">2</span>&lt;<span class="hljs-number">9</span>;<br></code></pre></div></td></tr></table></figure>
<blockquote>
<p>SQL会把常量当成一列，对于上面最后的语句，有多少条语句该常量就出现多少次</p>
</blockquote>
</li>
</ul>
<blockquote>
<p>select 5+4 from dual;dual没有任何意义，仅仅相当于from后面的占位符</p>
</blockquote>
<ul>
<li><p>select 会默认把所有符合条件的记录全部选出来，即使两行记录完全一样。可以使用 <code>distinct</code> 关键字从查询结果中清除重复行。</p>
<figure class="highlight sql"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs sql"><span class="hljs-keyword">select</span> <span class="hljs-keyword">distinct</span> student_name,java_teacher<br><span class="hljs-keyword">from</span> student_table;<br></code></pre></div></td></tr></table></figure>
<blockquote>
<p> <code>distinct</code> 紧跟 <code>select</code> 关键字，它的作用是去除后面字段组合的重复值，而不管对应记录在数据库里是否重复，例如：(1,’a’,’b’) 和 (2,’a’,’b’) 两条记录在数据库里是不重复的，但如果仅选择后面两列，则 <code>distinct</code> 会认为两条记录重复</p>
</blockquote>
</li>
<li><p>运算符：SQL 中判断两个值是否相等的比较运算符是单等号，赋值运算符是冒号等号(:=)</p>
</li>
<li><p>特殊的比较运算符</p>
</li>
</ul>
<table>
<thead>
<tr>
<th>运算符</th>
<th>含义</th>
</tr>
</thead>
<tbody><tr>
<td>expr1 (not) between expr2 and expr3</td>
<td>expr1的值在两者之间</td>
</tr>
<tr>
<td>expr1 <code>in</code>(expr2,expr3,…)</td>
<td>expr1的值等于后面括号中的任意一个</td>
</tr>
<tr>
<td>like</td>
<td>查询与like后的字符串匹配的字符串</td>
</tr>
<tr>
<td>is (not) null</td>
<td>要求指定值等于null</td>
</tr>
<tr>
<td><figure class="highlight sql"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs sql"><span class="hljs-keyword">select</span> * <span class="hljs-keyword">from</span> student_table<br><span class="hljs-keyword">where</span> student_id <span class="hljs-keyword">between</span> <span class="hljs-number">2</span> <span class="hljs-keyword">and</span> <span class="hljs-number">4</span>;<br><br><span class="hljs-comment">#选出java_teacher&lt;=2，student_id&gt;=2的所有记录</span><br><span class="hljs-keyword">select</span> * <span class="hljs-keyword">from</span> student_table<br>whrer <span class="hljs-number">2</span> <span class="hljs-keyword">between</span> java_teacher <span class="hljs-keyword">and</span> student_id;<br><br><span class="hljs-comment">#选出student_id 为2或4的所有记录</span><br><span class="hljs-keyword">select</span> * <span class="hljs-keyword">from</span> student_table<br><span class="hljs-keyword">where</span> student_id <span class="hljs-keyword">in</span> (<span class="hljs-number">2</span>,<span class="hljs-number">4</span>);<br>/<br>where 2 in (student_id,java_teacher);<br></code></pre></div></td></tr></table></figure></td>
<td></td>
</tr>
<tr>
<td>&gt; like 后面可以加两个通配符：<code>下划线(_):代表一个任意字符；百分号(%):代表任意多个字符。</code></td>
<td></td>
</tr>
</tbody></table>
<figure class="highlight pgsql"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs pgsql"><span class="hljs-keyword">where</span> student_name <span class="hljs-keyword">like</span> <span class="hljs-string">'孙%'</span>；<br><span class="hljs-keyword">where</span> student_name <span class="hljs-keyword">like</span> <span class="hljs-string">'__'</span>；//用两个下划线代表两个字符<br></code></pre></div></td></tr></table></figure>
<blockquote>
<p><code>MySQL使用\作为转义字符</code>；标准SQL语句没有转义字符，而是使用escape关键字显示进行转义</p>
</blockquote>
<figure class="highlight pgsql"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs pgsql">#选出所有名字以下划线开头的学生<br><span class="hljs-keyword">select</span> * <span class="hljs-keyword">from</span> student_table<br><span class="hljs-keyword">where</span> student_name <span class="hljs-keyword">like</span> <span class="hljs-string">'\_%'</span>;<br><br><span class="hljs-keyword">select</span> * <span class="hljs-keyword">from</span> student_table<br><span class="hljs-keyword">where</span> student_name <span class="hljs-keyword">like</span> <span class="hljs-string">'\_%'</span> <span class="hljs-keyword">escape</span> <span class="hljs-string">'\'</span>;<br></code></pre></div></td></tr></table></figure>
<blockquote>
<p>where student_name is null;#选择出student_name为null的所有记录。</p>
</blockquote>
<ul>
<li>逻辑运算符：<code>and、or和not</code><blockquote>
<p>优先级：<code>所有比较运算符&gt;not&gt;and&gt;or</code></p>
</blockquote>
<figure class="highlight pgsql"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs pgsql"><span class="hljs-keyword">where</span> student_name <span class="hljs-keyword">like</span> <span class="hljs-string">'__'</span> <span class="hljs-keyword">and</span>(<span class="hljs-keyword">or</span>) student_id &gt;<span class="hljs-number">3</span>;<br><span class="hljs-keyword">where</span> <span class="hljs-keyword">not</span> student_name <span class="hljs-keyword">like</span> <span class="hljs-string">'\_%'</span>;<br></code></pre></div></td></tr></table></figure></li>
<li>执行查询后的查询顺序默认按照插入顺序排列，使用<code>order by 子句，默认按升序排列</code>；若需要<code>强制降序排列，则需要在列名后使用desc关键字</code><blockquote>
<p>order by column_name1 [desc] , column_name2 …</p>
</blockquote>
</li>
</ul>
<blockquote>
<p>如果按多列排序，每列的asc，desc必须单独设定。如果指定了多个拍序列，只有<code>当第一列中存在多个相同值时，第二个排序列才会起作用</code></p>
</blockquote>
<figure class="highlight sql"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs sql"><span class="hljs-comment">#按java_teacher列降序排序，当java_teacher列的值相同时按student_name列的升序排列</span><br><span class="hljs-keyword">select</span> * <span class="hljs-keyword">from</span> student_table<br><span class="hljs-keyword">order</span> <span class="hljs-keyword">by</span> java_teacher <span class="hljs-keyword">desc</span>， student_name;<br></code></pre></div></td></tr></table></figure>
<h3 id="group-by分组查询"><a href="#group-by分组查询" class="headerlink" title="group by分组查询"></a>group by分组查询</h3><ul>
<li>表达式：<figure class="highlight plain"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs mysql">group by 属性名 [having表达式] [with rollup]<br></code></pre></div></td></tr></table></figure>
</li>
</ul>
<ol>
<li>单独使用，只会列出第一个出现的值<figure class="highlight sql"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs sql"><span class="hljs-comment">-- 只会筛选出第一个出现GradeName1的student的数据</span><br><span class="hljs-keyword">select</span> * <span class="hljs-keyword">from</span> t_student <span class="hljs-keyword">group</span> <span class="hljs-keyword">by</span> gradeName;<br></code></pre></div></td></tr></table></figure>
需要注意，最新的版本的 MySQL 标准<strong>不再允许 <code>SELECT</code> 列表，<code>HAVING</code> 条件语句，或 <code>ORDER BY</code> 语句中出现 <code>GROUP BY</code> 中未列表的可聚合列</strong>。而 MySQL 中有一个状态 <code>ONLY_FULL_GROUP_BY</code> 来标识是否遵从这一标准，默认为开启状态。</li>
</ol>
<p>所以这样的语句是不可以的:</p>
<figure class="highlight sql"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> gender, <br>       last_name <br><span class="hljs-keyword">FROM</span>   employees <br><span class="hljs-keyword">GROUP</span>  <span class="hljs-keyword">BY</span> gender<br></code></pre></div></td></tr></table></figure>

<p>将 <code>last_name</code> 从 SELECT 中移除或将其添加到 GROUP BY 中都可以修复：</p>
<figure class="highlight plain"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs mysql">SELECT gender,<br>FROM   employees <br>GROUP  BY gender <br><br>SELECT gender,<br>last_name<br>FROM employees<br>GROUP BY gender,<br>last_name<br></code></pre></div></td></tr></table></figure>

<p>但这样的修改查询出来就可能就不是想要的结果了。</p>
<p>针对以上情况，可以有三种方式来解决：</p>
<p><strong>关闭 ONLY_FULL_GROUP_BY</strong></p>
<p>可以选择关掉 MySQL 的 <code>ONLY_FULL_GROUP_BY</code> 模式，有两种方式，通过设置 <code>sql_mode</code> 来关闭。</p>
<p>首先查看变更前的 <code>sql_mode</code>：</p>
<figure class="highlight"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs sql">mysql&gt; SELECT @@sql_mode;<br>+-----------------------------------------------------------------------------------------------------------------------+<br>| @@sql_mode                                                                                                            |<br>+-----------------------------------------------------------------------------------------------------------------------+<br>| ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION |<br>+-----------------------------------------------------------------------------------------------------------------------+<br>1 row in set (0.00 sec)<br></code></pre></div></td></tr></table></figure>

<p>通过以下脚本关闭 ：</p>
<figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell">SET SESSION sql_mode=(SELECT REPLACE(@@sql_mode,'ONLY_FULL_GROUP_BY,',''));<br></code></pre></div></td></tr></table></figure>

<p>再次查询 <code>@@sql_mode</code> 返回中应该已经没有该模式了。</p>
<figure class="highlight plain"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs mysql">mysql&gt; SELECT @@sql_mode;<br>+----------------------------------------------------------------------------------------------------+<br>| @@sql_mode                                                                                         |<br>+----------------------------------------------------------------------------------------------------+<br>| STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION |<br>+----------------------------------------------------------------------------------------------------+<br>1 row in set (0.00 sec)<br></code></pre></div></td></tr></table></figure>

<p>第二种是找到 MySQL 配置文件修改并保存。</p>
<p>MySQL 的配置文件名为 <code>my.cnf</code>，可通过以下命令查看你位置：</p>
<figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> mysql --<span class="hljs-built_in">help</span> | grep cnf</span><br>                      order of preference, my.cnf, $MYSQL_TCP_PORT,<br>/etc/my.cnf /etc/mysql/my.cnf /usr/local/etc/my.cnf ~/.my.cnf<br></code></pre></div></td></tr></table></figure>

<p>找到后编辑并保存，重启 MySQL 后生效。</p>
<figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell">[mysqld]<br>-sql_mode=ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION<br>+sql_mode=STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION<br></code></pre></div></td></tr></table></figure>

<p>如果文件中没有 <code>sql_mode</code> 配置项可手动添加上。</p>
<p>因为 <code>ONLY_FULL_GROUP_BY</code> 更加符合 SQL 标准，所以不建议关掉。</p>
<p><strong>ANY_VALUE()</strong></p>
<p>还可以通过 <code>ANY_VALUE()</code> 来改造查询语句以避免报错。</p>
<p>使用 <code>ANY_VALUE()</code> 包裹的值不会被检查，跳过该错误。所以这样是可以的：</p>
<figure class="highlight sql"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> gender, <br>-       last_name<br>+       ANY_VALUE(last_name) <br><span class="hljs-keyword">FROM</span>   employees <br><span class="hljs-keyword">GROUP</span>  <span class="hljs-keyword">BY</span> gender<br></code></pre></div></td></tr></table></figure>

<p><strong>添加列间的依赖</strong></p>
<p>像这个示例中:</p>
<figure class="highlight routeros"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs routeros">SELECT gender, <br>       last_name <br><span class="hljs-keyword">FROM</span>   employees <span class="hljs-built_in"><br>GROUP </span> BY gender<br></code></pre></div></td></tr></table></figure>

<p>假如让 <code>gender</code> 变成不重复的主键，<code>last_name</code> 便与 <code>gender</code> 产生了一种关系，即 <code>gender</code> 可唯一确定 <code>last_name</code>。此时便可进行 <code>GROUP BY</code> 了。因为，<strong>之所以报错是因为在进行聚合的时候有不能确定的列参与了进来</strong>。这也是正确的使用场景。</p>
<ol start="2">
<li>与 <code>group concat()</code> 函数一起使用：会把所有值列出来</li>
</ol>
<figure class="highlight routeros"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs routeros">-- 会把所有属于gradeName的studentName全部组合在一起列出来<br>select gradeName,group concat(studentName) <span class="hljs-keyword">from</span> t_student <span class="hljs-built_in"> group </span>by gradeName;<br></code></pre></div></td></tr></table></figure>
<ol start="3">
<li>与聚合函数一起使用</li>
<li>与 <code>having</code> 一起使用，限制输出结果<figure class="highlight plain"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs mysql">-- 只会输出学生名字多于三个的年级及学生名字<br>select gradeName,group concat(studentName) from t_student  group by gradeName having count(studentName) &gt;3;<br></code></pre></div></td></tr></table></figure></li>
<li>与 <code>with rollup</code> 一起使用，在最后一行增加一个叠加总和<h3 id="limit-分页查询"><a href="#limit-分页查询" class="headerlink" title="limit 分页查询"></a>limit 分页查询</h3><figure class="highlight sql"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs sql"><span class="hljs-keyword">select</span> 字段<span class="hljs-number">1</span>，字段<span class="hljs-number">2</span> ...from 表名 <span class="hljs-keyword">limit</span> 初始位置，记录数<br></code></pre></div></td></tr></table></figure>

</li>
</ol>
<p>第一条记录从 0 开始：</p>
<figure class="highlight sql"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs sql"><span class="hljs-comment">-- 输出从第一条开始的五条记录；</span><br><span class="hljs-keyword">select</span> * <span class="hljs-keyword">from</span> t_student <span class="hljs-keyword">limit</span> <span class="hljs-number">0</span>,<span class="hljs-number">5</span>;<br></code></pre></div></td></tr></table></figure>
<h2 id="数据库函数"><a href="#数据库函数" class="headerlink" title="数据库函数"></a>数据库函数</h2><ul>
<li>可分为单行函数和多行函数<blockquote>
<p>单行函数：对单行输入单独计算，每行得到一个计算结果返回给用户。其参数可以是变量、常量或数据列；可以接收多个参数，但只返回一个值；单行函数可以改变参数的数据类型</p>
</blockquote>
</li>
</ul>
<blockquote>
<p>多行函数：多行输入整体处理，只返回一个值</p>
</blockquote>
<ul>
<li><code>MySQL单行函数的用法</code>：<figure class="highlight sql"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs sql"><span class="hljs-comment">#选出teacher_table表中teacher_name列的字符长度</span><br><span class="hljs-keyword">select</span> <span class="hljs-keyword">char_length</span>(teacher_name)<br><span class="hljs-keyword">from</span> teacher_table;<br><br><span class="hljs-comment">#求绝对值</span><br><span class="hljs-keyword">select</span> <span class="hljs-keyword">abs</span>(x);<br><br><span class="hljs-comment">#求平方根</span><br>sqrt(x);<br><br><span class="hljs-comment">#求余</span><br>mod(x,y);<br><br><span class="hljs-comment">#计算teacher_name列字符长度的sin值</span><br><span class="hljs-keyword">select</span> <span class="hljs-keyword">sin</span>(<span class="hljs-keyword">char_length</span>(teacher_name))<br><span class="hljs-keyword">from</span> teacher_table;<br><br><span class="hljs-comment">#计算1.57的sin值</span><br><span class="hljs-keyword">select</span> <span class="hljs-keyword">sin</span>(<span class="hljs-number">1.57</span>);<br><br><span class="hljs-comment">#为指定日期添加一定时间</span><br><span class="hljs-comment">#在这种语法下interval是关键字，需要一个数值，还需要一个单位</span><br><span class="hljs-keyword">SELECT</span> DATA_ADD(<span class="hljs-string">'2018-04-01'</span>,<span class="hljs-built_in">interval</span> <span class="hljs-number">2</span> MOMTH)；<br><span class="hljs-comment">#简单用法</span><br><span class="hljs-keyword">select</span> ADDDATE(<span class="hljs-string">'2018-04-01'</span>,<span class="hljs-number">3</span>);<br><br><span class="hljs-comment"># 获取当前日期</span><br><span class="hljs-keyword">select</span> <span class="hljs-keyword">CURDATE</span>();<br><br><span class="hljs-comment">#获取当前时间</span><br><span class="hljs-keyword">select</span> <span class="hljs-keyword">curtime</span>();<br><br><span class="hljs-comment">#返回日期d中的月份</span><br><span class="hljs-keyword">select</span> <span class="hljs-keyword">month</span>(d);<br></code></pre></div></td></tr></table></figure>
<h3 id="连接函数"><a href="#连接函数" class="headerlink" title="连接函数"></a>连接函数</h3><blockquote>
<p><code>CONCAT(a,b)</code>:用于把两个字符串连接起来</p>
</blockquote>
<figure class="highlight sql"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">CONCAT</span>(firstname,lastname) <span class="hljs-keyword">from</span> <span class="hljs-keyword">Table</span>;<br></code></pre></div></td></tr></table></figure>
<blockquote>
<p><code>CONCAT_WS</code>(‘(任意的分隔符)’,firstname,lastname):在两者之间显示分隔符</p>
</blockquote>
</li>
</ul>
<h3 id="截断和填充函数"><a href="#截断和填充函数" class="headerlink" title="截断和填充函数"></a>截断和填充函数</h3><ul>
<li><code>RTRIM/LTRIM</code>:从一个字符串的右端或者左端删除空格</li>
<li><code>TRIM</code>:删除想要剔除的字符，使用<code>LEADING TAILING</code>分别表示剔除开头的或末尾的，若没有则默认两边都剔除<figure class="highlight sql"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">TRIM</span>(<span class="hljs-keyword">LEADING</span> <span class="hljs-string">'X'</span> <span class="hljs-keyword">FROM</span> <span class="hljs-string">'XXXneedleXXX'</span>);//显示needleXXX<br><span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">TRIM</span>(TAILING <span class="hljs-string">'X'</span> <span class="hljs-keyword">FROM</span> <span class="hljs-string">'XXXneedleXXX'</span>);//显示XXXneedle<br><span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">TRIM</span>(<span class="hljs-string">'X'</span> <span class="hljs-keyword">FROM</span> <span class="hljs-string">'XXXneedleXXX'</span>);//显示needle<br></code></pre></div></td></tr></table></figure></li>
<li><code>RPAD()/LPAD()</code>:向一个字符串中添加字符<figure class="highlight sql"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> RPAD(<span class="hljs-string">'needle'</span>,<span class="hljs-number">10</span>,<span class="hljs-string">'X'</span>);//添加直到字符串达到10个字符的长度<br></code></pre></div></td></tr></table></figure>
<h3 id="定位和位置函数"><a href="#定位和位置函数" class="headerlink" title="定位和位置函数"></a>定位和位置函数</h3></li>
<li><code>LICATE(&#39;A&#39;,&#39;B&#39;)</code>:返回A中某个字符串在B中第一次出现的位置（从1开始，不从0开始）<h3 id="子字符串函数"><a href="#子字符串函数" class="headerlink" title="子字符串函数"></a>子字符串函数</h3></li>
<li><code>SUBSTRING(&quot;字符串&quot;,2,3)</code>：获取第2个开始的三个字符</li>
<li><code>LEFT/RIGHT(&#39;MySQL&#39;,3)</code>:获取字符串左边或右边的三个字符<h3 id="字符串修改函数"><a href="#字符串修改函数" class="headerlink" title="字符串修改函数"></a>字符串修改函数</h3></li>
<li><code>LCASE/UCASE()</code>:把字符串转化为小写或者大写，参数为列名便是这个列的所有值转化为小写/大写</li>
<li><code>REPEAT(&quot;A&quot;,&quot;B&quot;,&quot;C&quot;)</code>:把A字符串中的B全部转化为C<h3 id="加密函数"><a href="#加密函数" class="headerlink" title="加密函数"></a>加密函数</h3><blockquote>
<p><code>password(str)</code>:一般对用户的密码加密，不可解密</p>
</blockquote>
<figure class="highlight sql"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs sql"><span class="hljs-keyword">insert</span> <span class="hljs-keyword">into</span> 表名 <span class="hljs-keyword">values</span>(值<span class="hljs-number">1</span>，值<span class="hljs-number">2</span>，...,<span class="hljs-keyword">password</span>(<span class="hljs-string">'字符'</span>),...)；<br></code></pre></div></td></tr></table></figure>
<blockquote>
<p><code>sha()</code>：用于对密码加密，不可解密，会把一段文字加密为唯一的40字符编码</p>
</blockquote>
<figure class="highlight sql"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs sql"><span class="hljs-keyword">insert</span> <span class="hljs-keyword">into</span> 表名 <span class="hljs-keyword">values</span> (值<span class="hljs-number">1</span>，值<span class="hljs-number">2</span>，...,<span class="hljs-keyword">sha</span>(<span class="hljs-string">'字符'</span>),...);<br></code></pre></div></td></tr></table></figure>
<blockquote>
<p><code>md5(str)</code>:普通加密，不可解密</p>
</blockquote>
<figure class="highlight sql"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs sql"><span class="hljs-keyword">insert</span> <span class="hljs-keyword">into</span> 表名  <span class="hljs-keyword">values</span> (值<span class="hljs-number">1</span>，值<span class="hljs-number">2</span>，...,<span class="hljs-keyword">password</span>(<span class="hljs-string">'字符'</span>),...)；<br></code></pre></div></td></tr></table></figure>
<blockquote>
<p><code>encode(str,pswd_str)</code>:加密函数，结果是一个二进制数，必须使用blob类型的字段来保存它，<code>可解密</code></p>
</blockquote>
<figure class="highlight sql"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs sql"><span class="hljs-keyword">insert</span> <span class="hljs-keyword">into</span> 表名  <span class="hljs-keyword">values</span> (值<span class="hljs-number">1</span>，值<span class="hljs-number">2</span>，...,<span class="hljs-keyword">encode</span>(<span class="hljs-string">'字符'</span>,<span class="hljs-string">'xx'</span>),...)；//<span class="hljs-string">'xx'</span>为某个解密钥匙标记<br></code></pre></div></td></tr></table></figure>
<blockquote>
<p><code>decode(crypt_str,pswd_str)</code>:解密函数</p>
</blockquote>
</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs sql"><span class="hljs-keyword">select</span> <span class="hljs-keyword">decode</span>(<span class="hljs-string">"被加密数据"</span>，<span class="hljs-string">"与被加密参数对应的钥匙标记"</span>) <span class="hljs-keyword">from</span> 表名；<br></code></pre></div></td></tr></table></figure>
<h3 id="null-处理函数"><a href="#null-处理函数" class="headerlink" title="null 处理函数"></a>null 处理函数</h3><p>MySQL提供如下几个处理null的函数</p>
<p>使用：<code>select 函数名 from 表名</code></p>
<blockquote>
<p>ifnull(expr1,expr2):如果expr1为null，则返回expr2，否则返回expr1</p>
</blockquote>
<blockquote>
<p>nullif(expr1,expr2):如果expr1和expr2相等，则返回null，否则返回expr1</p>
</blockquote>
<p>if(expr1,expr2,expr3):如果expr1为true，不等于0，且不等于null，则返回expr2，否则返会expr3</p>
<blockquote>
<p>isnull(expr1):判断expr1是否为null，如果是则返回true，否则返回false</p>
</blockquote>
<ul>
<li>case函数：流程控制函数<figure class="highlight sql"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs sql"><span class="hljs-keyword">select</span> 列名 ，<span class="hljs-keyword">case</span> 用法 <span class="hljs-keyword">from</span> 表名；<br></code></pre></div></td></tr></table></figure>
</li>
</ul>
<ol>
<li>用法1：用 <code>value</code> 依次与后面的 <code>compare_value1</code> 等相比较，如果 <strong><code>value</code> 与指定的 <code>compare_value</code> 相等</strong>，则返回对应的 <code>result</code>，否则返回 else 的<code>result</code><figure class="highlight sql"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs sql">case value<br>when compare_value1 then result1<br>when compare_value2 then result2<br>...<br>else result<br><span class="hljs-keyword">end</span><br></code></pre></div></td></tr></table></figure></li>
<li>用法2：<code>condition</code> 内容是一个返回 <code>boolean</code> 值的条件表达式<figure class="highlight sql"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs sql">case<br>when condition1 then result1<br>when condition2 then result2<br>...<br>else result<br><span class="hljs-keyword">end</span><br></code></pre></div></td></tr></table></figure>
<h3 id="间隔分析函数"><a href="#间隔分析函数" class="headerlink" title="间隔分析函数"></a>间隔分析函数</h3></li>
</ol>
<p>MySQL提供了三个函数用于排序时显示当前行的序号，分别为 <code>RANK()</code>，<code>DENSE_RANK()</code>和 <code>ROW_NUMBER</code>，其中 <code>RANK()</code> 在遇到重复时，显示并列排名的同时对于下一个序号会递增，而 <code>DENSE_RANK</code> 不会递增。</p>
<p>这几个函数需要结合 <code>over</code> 函数进行使用，<code>over</code>  函数的语法如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs mysql">over（partition by columnname1 order by columnname2）<br></code></pre></div></td></tr></table></figure>

<p><code>columnname1</code> 指定分组排序的字段，<code>columnname2</code> 指定排序字段。</p>
<p>例如：在 <code>employees</code> 表中，有两个部门的记录：<code>department_id</code> ＝10 和 20，以下 sql 语句：</p>
<figure class="highlight plain"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs mysql">select department_id，rank（） over（partition by department_id order by salary) from employees<br></code></pre></div></td></tr></table></figure>

<p>就是指在部门 10 中进行薪水的排名，在部门 20 中进行薪水排名。如果是 <code>partition by org_id</code>，则是在整个公司内进行排名。</p>
<p>函数使用的具体示例如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs mysql">mysql&gt; SELECT<br>         val,<br>         ROW_NUMBER() OVER w AS &apos;row_number&apos;,<br>         RANK()       OVER w AS &apos;rank&apos;,<br>         DENSE_RANK() OVER w AS &apos;dense_rank&apos;<br>       FROM numbers<br>       WINDOW w AS (ORDER BY val);<br>+------+------------+------+------------+<br>| val  | row_number | rank | dense_rank |<br>+------+------------+------+------------+<br>|    1 |          1 |    1 |          1 |<br>|    1 |          2 |    1 |          1 |<br>|    2 |          3 |    3 |          2 |<br>|    3 |          4 |    4 |          3 |<br>|    3 |          5 |    4 |          3 |<br>|    3 |          6 |    4 |          3 |<br>|    4 |          7 |    7 |          4 |<br>|    4 |          8 |    7 |          4 |<br>|    5 |          9 |    9 |          5 |<br>+------+------------+------+------------+<br></code></pre></div></td></tr></table></figure>

<h2 id="分组和组函数"><a href="#分组和组函数" class="headerlink" title="分组和组函数"></a>分组和组函数</h2><ul>
<li>组函数就是多行函数，将一组记录作为整体计算，每组记录返回一个结果</li>
<li>常用组函数：</li>
</ul>
<ol>
<li><p><code>avg([distinct|all]expr)</code>: 计算多行 expr 的平均值，expr 可以是变量、常量或者数据列，但其数据类型必须是数值型，如果使用<code>distinct</code> 表示不计算重复值，<code>all</code> 用与不用一样</p>
</li>
<li><p><code>count({*|[distinct|all]expr})</code>: 计算多行 expr 的总条数，expr 的数据类型可以是任意类型；用（*）表示统计该表内记录的行数</p>
</li>
<li><p><code>max(expr)</code>：计算多行 expr 的最大值，其中 expr 其数据类型可以是任意类型</p>
</li>
<li><p><code>min(expr)</code>：计算多行 expr 的最小值</p>
</li>
<li><p><code>sum([distinct|all]expr)</code>：计算多行 expr 的总和，expr 的数据类型必须是数值型</p>
</li>
</ol>
<figure class="highlight sql"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs sql"><span class="hljs-comment">#计算的结果是20*记录的行数</span><br><span class="hljs-keyword">select</span> <span class="hljs-keyword">sum</span>(<span class="hljs-number">20</span>)<br><span class="hljs-keyword">from</span> student_table;<br><br><span class="hljs-comment">#因为expr的值是34，所以每行的值都相同</span><br><span class="hljs-comment">#使用distinct强制不计算重复值，所以下面计算结果为34</span><br><span class="hljs-keyword">select</span> <span class="hljs-keyword">sum</span>(<span class="hljs-keyword">distinct</span> <span class="hljs-number">34</span>)<br><span class="hljs-keyword">from</span> student_table;<br><br><span class="hljs-comment">#使用count统计记录行数时，null不会被计算在内</span><br><span class="hljs-keyword">select</span> <span class="hljs-keyword">count</span>(student_name)<br><span class="hljs-keyword">from</span> student_table;<br><br><span class="hljs-comment">#对于可能出现null的列，可以用ifnull处理</span><br><span class="hljs-keyword">select</span> <span class="hljs-keyword">count</span> (<span class="hljs-keyword">ifnull</span>(student_name,<span class="hljs-number">0</span>))<br><span class="hljs-keyword">from</span> student_table;<br></code></pre></div></td></tr></table></figure>
<ul>
<li><code>distinct</code> 和 <code>*</code> 不能同时使用</li>
<li><strong>组函数会把所有记录当成一组</strong>，为了对记录进行显示分组，可以在 select 语句后使用<code>group by</code> 子句，<code>group by</code> 子句后通常跟一个或多个列名，表名查询结果根据一列或多列进行分组，<strong>当一列或多列组合的值完全相同时，系统会把这些记录当成一组</strong><figure class="highlight sql"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs sql"><span class="hljs-comment">#count(*)将会对每组得到一个结果</span><br><span class="hljs-keyword">select</span> <span class="hljs-keyword">count</span>(*)<br><span class="hljs-keyword">from</span> student_table<br><span class="hljs-comment">#将java_teacher列值相同的记录当成一组</span><br><span class="hljs-keyword">group</span> <span class="hljs-keyword">by</span> java_teacher;<br></code></pre></div></td></tr></table></figure></li>
<li>如果对多列进行分组，则要求多列的值完全相同时才会被当成一组<figure class="highlight sql"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs sql"><span class="hljs-keyword">select</span> <span class="hljs-keyword">count</span>(*)<br><span class="hljs-keyword">from</span> student_table<br><span class="hljs-comment">#当java_teacher、student_name两列的值完全相同时才会被当成一组</span><br><span class="hljs-keyword">group</span> <span class="hljs-keyword">by</span> java_teacher , student_name;<br></code></pre></div></td></tr></table></figure></li>
<li>对于很多数据库而言，分组计算时，如果查询列表中使用了组函数，或者select语句中使用了 group by 分组子句，则要求<strong>出现在 select 列表中的字段，要么使用组函数包起来，要么必须出现在 group by 子句中</strong>。 </li>
<li>对于MySQL：如果某个数据列既没有出现在group by之后，也没有使用组函数包起来，则MySQL会输出该列的第一条记录的值。</li>
<li>如果需要对分组进行过滤，则应该<strong>使用 <code>having</code> 子句，子句后面有一个条件表达式，只有满足该表达式的分组才会被选出来</strong></li>
<li>where 和 having 的区别：</li>
</ul>
<ol>
<li>不能在 where 子句中过滤组，where 子句仅用于过滤行，过滤组必须使用 having 子句</li>
<li>不能在 where 子句中使用组函数，having 子句才可以使用组函数</li>
</ol>
<figure class="highlight routeros"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs routeros">select *<br><span class="hljs-keyword">from</span> student_table<span class="hljs-built_in"><br>group </span>by java_teacher<br><span class="hljs-comment">#对组进行过滤</span><br>having count(*)&gt;2;<br></code></pre></div></td></tr></table></figure>
<h2 id="多表连接查询"><a href="#多表连接查询" class="headerlink" title="多表连接查询"></a>多表连接查询</h2><ul>
<li>需要选择的数据并不是来自一个表，而是来自多个数据表，这就需要使用多表查询</li>
<li>两种查询规范：</li>
</ul>
<ol>
<li><p>SQL 92规范：</p>
<blockquote>
<p>等值查询</p>
</blockquote>
<blockquote>
<p>非等值查询</p>
</blockquote>
<blockquote>
<p>外连接</p>
</blockquote>
<blockquote>
<p>广义笛卡尔积</p>
</blockquote>
</li>
</ol>
<ul>
<li>语法：<figure class="highlight sql"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs sql"><span class="hljs-keyword">select</span> column1, column2 ...<br><span class="hljs-keyword">from</span> table1,table2 ...<br>[<span class="hljs-keyword">where</span> join_condition]<br></code></pre></div></td></tr></table></figure></li>
<li>多表连接中可能出现两个或多个数据列同名的列名，则需要在这些同名列之前使用表名前缀</li>
<li>等值查询:<code>where中要求两列值相等</code><figure class="highlight sql"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs sql"><span class="hljs-keyword">select</span> s.*,teacher_name<br><span class="hljs-keyword">from</span> student_name s,teacher_table t<br><span class="hljs-keyword">where</span> s.java_teacher = t.teacher_id;<br></code></pre></div></td></tr></table></figure></li>
<li>非等值查询：<code>where中要求两列值不相等</code>，大于或小于</li>
<li>广义笛卡尔积：<code>没有where子句</code>，结果会有n x m条记录</li>
<li>如果要将记录进行过滤，则将过滤条件和连接条件使用and连接起来<figure class="highlight sql"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs sql"><span class="hljs-keyword">select</span> s.* ,teacher_name<br><span class="hljs-comment"># 指定多个数据表，并指定表别名</span><br><span class="hljs-keyword">from</span> student_table s，teacher_table t<br><span class="hljs-comment"># 使用where指定连接条件，并指定student_name 列不能为null</span><br><span class="hljs-keyword">where</span> s.java_teacher=t.teacher_id <span class="hljs-keyword">and</span> student_name <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> <span class="hljs-literal">null</span>;<br></code></pre></div></td></tr></table></figure></li>
<li>MySQL 不支持左外连接和右外连接</li>
<li>自连接：对于自关联的数据表查询<figure class="highlight sql"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs sql"><span class="hljs-comment"># 定义一个自关联的数据表</span><br><span class="hljs-keyword">create</span> <span class="hljs-keyword">table</span> emp_table<br>(<br>   emp_id <span class="hljs-built_in">int</span> auto_increment primary <span class="hljs-keyword">key</span>,<br>   emp_name <span class="hljs-built_in">varchar</span>(<span class="hljs-number">255</span>),<br>   namage_id <span class="hljs-built_in">int</span>,<br>   <span class="hljs-keyword">foreign</span> <span class="hljs-keyword">key</span>(namage_id) <span class="hljs-keyword">reference</span> emp_table(emp_id)<br>);<br><span class="hljs-comment">#向表中插入数据</span><br><span class="hljs-keyword">insert</span> <span class="hljs-keyword">into</span> emp_table<br><span class="hljs-keyword">value</span> (<span class="hljs-literal">null</span>,<span class="hljs-string">'唐僧'</span>,<span class="hljs-literal">null</span>),<br>(<span class="hljs-literal">null</span>,<span class="hljs-string">'孙悟空'</span>，<span class="hljs-literal">null</span>)，<br>(<span class="hljs-literal">null</span>,<span class="hljs-string">'猪八戒'</span>，<span class="hljs-literal">null</span>)，<br>(<span class="hljs-literal">null</span>,<span class="hljs-string">'沙僧'</span>，<span class="hljs-literal">null</span>);<br><br><span class="hljs-comment">#自定义查询</span><br><span class="hljs-keyword">select</span> emp.emp_id,emp.emp_name 员工名，mgr.emp_name 经理名<br><span class="hljs-keyword">from</span> emp_table emp,emp_table mgr<br><span class="hljs-keyword">where</span> emp.manage_id=mgr.emp_id;<br></code></pre></div></td></tr></table></figure></li>
</ul>
<p>2.SQL 99的连接查询：<code>多表连接查询的from后面只有一个表名</code></p>
<ul>
<li>交叉连接（cross join）：效果就是SQL92中的广义笛卡儿积，无需任何连接条件<figure class="highlight sql"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs sql"><span class="hljs-keyword">select</span> s.*,teacher_name<br><span class="hljs-comment">#SQL 99多表连接查询的from后只有一个表名</span><br><span class="hljs-keyword">from</span> student_table s<br><span class="hljs-comment">#cross join 交叉连接，相当于广义笛卡儿积</span><br><span class="hljs-keyword">cross</span> <span class="hljs-keyword">join</span> teacher_table t；<br></code></pre></div></td></tr></table></figure></li>
<li>自然连接(natual join):自然连接表面上看起来无需指定连接条件，但自然连接是有连接条件的，<code>以两个表中的同名列作为连接条件</code>，如果两个表中没有同名列，则自然连接与交叉连接效果完全一样<figure class="highlight n1ql"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs n1ql"><span class="hljs-keyword">select</span> s.*,teacher_name<br>#SQL <span class="hljs-number">99</span>多连接查询的<span class="hljs-keyword">from</span>后只有一个表名<br><span class="hljs-keyword">from</span> student_table s<br>natual <span class="hljs-keyword">join</span> teacher_table t;<br></code></pre></div></td></tr></table></figure></li>
<li>using子句连接：using子句可以指定一列或者多列，用于显式指定两个表中的同名列作为连接条件。<code>假设两个表中有超过一列的同名列，如果使用natual join，则会把所有同名列当成连接条件；如果使用using子句，就可显式指定使用哪些同名列作为连接条件</code><figure class="highlight n1ql"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs n1ql"><span class="hljs-keyword">select</span> s.*,teacher_name<br><span class="hljs-keyword">from</span> student_table s<br>#<span class="hljs-keyword">join</span> 连接另一个表<br><span class="hljs-keyword">join</span> teacher_tale t<br><span class="hljs-keyword">using</span>(某一同名列)；<br></code></pre></div></td></tr></table></figure></li>
<li>on 子句连接：每个on子句只指定一个连接条件<figure class="highlight cs"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs cs"><span class="hljs-keyword">select</span> s.*,teacher_name<br><span class="hljs-keyword">from</span> student_table s<br><span class="hljs-meta">#join连接另一个表</span><br><span class="hljs-keyword">join</span> teacher_table t<br><span class="hljs-meta">#使用on指定连接条件</span><br><span class="hljs-keyword">on</span> s.java_teacher = t.teacher_id;<span class="hljs-comment">//也可以是非等值连接</span><br></code></pre></div></td></tr></table></figure></li>
<li>左、右、全外连接：分别使用<code>left [outer] join、right [outer] join和full [outer] join</code><figure class="highlight sql"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs sql"><span class="hljs-keyword">select</span> s.*,teacher_name<br><span class="hljs-keyword">from</span> student_table s<br><span class="hljs-keyword">right</span>/<span class="hljs-keyword">left</span>/<span class="hljs-keyword">full</span> <span class="hljs-keyword">join</span> teacher_table t<br><span class="hljs-keyword">on</span> s.java_teacher &gt;t.teacher_id;<br></code></pre></div></td></tr></table></figure>
<blockquote>
<p>左连接：会把左边表中所有满足连接条件的记录全部列出</p>
</blockquote>
</li>
</ul>
<blockquote>
<p>右连接：会把右边表中所有满足连接条件的记录全部列出,左边没有的为null</p>
</blockquote>
<blockquote>
<p>全外连接：会把两个表中所有满足连接条件的记录全部列出</p>
</blockquote>
<ul>
<li>内连接：<code>inner join</code>，可以返回结合两个表的数据</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs sql"><span class="hljs-keyword">select</span> mismatch_topic.topic_id,mismatch_category.name<br>    <span class="hljs-keyword">from</span> mismatch_topic<br>    <span class="hljs-keyword">inner</span> <span class="hljs-keyword">join</span> mismatch_category<br>    <span class="hljs-keyword">on</span> (mismatch_topic.category_id = mismatch_category.category_id)<br>    <span class="hljs-keyword">where</span> mismatch_topic.name = <span class="hljs-string">'Horror movies;</span><br></code></pre></div></td></tr></table></figure>
<p>如果要查询内容位于不同的表而列名相同，可以使用 <code>using</code> 代替 <code>on</code></p>
<figure class="highlight sql"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs sql"><span class="hljs-keyword">select</span> mismatch_topic.topic_id,mismatch_category.name<br>    <span class="hljs-keyword">from</span> mismatch_topic<br>    <span class="hljs-keyword">inner</span> <span class="hljs-keyword">join</span> mismatch_category<br>    <span class="hljs-keyword">using</span> (category_id)<br>    <span class="hljs-keyword">where</span> mismatch_topic.name = <span class="hljs-string">'Horror movies;</span><br></code></pre></div></td></tr></table></figure>
<h2 id="子查询：在查询语句中嵌套另一个查询"><a href="#子查询：在查询语句中嵌套另一个查询" class="headerlink" title="子查询：在查询语句中嵌套另一个查询"></a>子查询：在查询语句中嵌套另一个查询</h2><ul>
<li>子查询可以出现在两个位置：<blockquote>
<p>出现在from语句后当成数据表，这种用法被称为行内视图，相当于一个临时视图</p>
</blockquote>
</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs sql"><span class="hljs-keyword">select</span> *<br><span class="hljs-keyword">from</span> (<span class="hljs-keyword">select</span> * <span class="hljs-keyword">from</span> student_table) t <span class="hljs-comment"># 必须给重命名</span><br><span class="hljs-keyword">where</span> t.java_teacher &gt;<span class="hljs-number">1</span>;<br></code></pre></div></td></tr></table></figure>

<blockquote>
<p>出现在where条件后作为过滤条件的值</p>
</blockquote>
<figure class="highlight go"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs go"><span class="hljs-keyword">select</span> *<br>from student_table<br>where java_teacher &gt;<br>#返回单行、单列的子查询可以被标量值使用<br>(<span class="hljs-keyword">select</span> teacher_id <br>from teacher_table<br>  where teacher_name=<span class="hljs-string">'Yeeku'</span>);<br></code></pre></div></td></tr></table></figure>

<ul>
<li>注意点：</li>
</ul>
<ol>
<li>子查询要用括号括起来</li>
<li>把子查询当成数据表时（出现在from之后），可以为该子查询起别名，尤其是<code>作为前缀来限定数据表时，必须给子查询起别名</code></li>
<li>把子查询当成过滤条件时，单行子查询使用单行运算符，多行子查询使用多行运算符</li>
</ol>
<ul>
<li>如果子查询返回多个值，则需要使用in、any、all等关键字</li>
</ul>
<blockquote>
<p>(not)in:把子查询返回的多个值当成一个值列表</p>
</blockquote>
<figure class="highlight cs"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs cs"><span class="hljs-keyword">select</span> *<br><span class="hljs-function"><span class="hljs-keyword">from</span> student_table<br><span class="hljs-keyword">where</span> student_id <span class="hljs-title">in</span><br>(<span class="hljs-params"><span class="hljs-keyword">select</span> teacher_id<br><span class="hljs-keyword">from</span> teacher_table</span>)</span>;<br></code></pre></div></td></tr></table></figure>
<blockquote>
<p>any和all可以与&gt;、&gt;=、&lt;、&lt;=、&lt;&gt;、=等运算符结合使用；</p>
</blockquote>
<blockquote>
<p><code>与any结合使用表示等于、大于等于、小于、小于等于、不等于、等于其中任意一个值；</code></p>
</blockquote>
<blockquote>
<p><code>与all结合使用分别表示等于、大于等于、小于、小于等于、不等于、等于全部值；</code></p>
</blockquote>
<blockquote>
<p>=any的作用与in作用相同</p>
</blockquote>
<figure class="highlight n1ql"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs n1ql"><span class="hljs-keyword">select</span> *<br><span class="hljs-keyword">from</span> student_table<br><span class="hljs-keyword">where</span> student_id =<br><span class="hljs-keyword">any</span> (select_teacher_id<br><span class="hljs-keyword">from</span> teacher_table);<br></code></pre></div></td></tr></table></figure>
<blockquote>
<p>“&lt;any” 只要小于值列表中的最大值即可，”&gt;any”只要大于值列表中的最小值即可，”&lt;all” 要求小于值列表中的最小值，”&gt;all”要求大于值列表中的最大值。</p>
</blockquote>
<figure class="highlight n1ql"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs n1ql"><span class="hljs-keyword">select</span> *<br><span class="hljs-keyword">from</span> student_table<br><span class="hljs-keyword">where</span> student_id &gt;<br><span class="hljs-keyword">all</span>(<span class="hljs-keyword">select</span> teacher_id<br><span class="hljs-keyword">from</span> teacher_table);<br></code></pre></div></td></tr></table></figure>
<blockquote>
<p>子查询可以返回多行、多列，此时where子句应该有对应的数据列，并使用圆括号将多个数据列组合起来</p>
</blockquote>
<figure class="highlight excel"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs excel">select *<br>from student_table<br>where (student_id,student_name)<br>=any(select teacher_id,teacher_name<br>from teacher_table);<br></code></pre></div></td></tr></table></figure>
<ul>
<li>带(not) exists关键字的子查询:若子查询内容不为空，则查询外层表，否则返回空表<blockquote>
<p>select 字段…from 表1 where exists (select 字段…from 表2)；</p>
</blockquote>
</li>
</ul>
<h2 id="集合运算"><a href="#集合运算" class="headerlink" title="集合运算"></a>集合运算</h2><p>select语句查询的结果是一个包含多条数据的结果集，可以进行<code>交（intersect）、并（union）和差（minus）运算</code></p>
<ul>
<li>对两个结果集进行集合运算，这两个结果集必须满足如下条件：<blockquote>
<p>对两个结果集所包含的<code>数据列的数量必须相等</code></p>
</blockquote>
</li>
</ul>
<blockquote>
<p>两个结果集所包含的数据列的<code>数据类型也必须一一对应</code></p>
</blockquote>
<ol>
<li>union运算<blockquote>
<p>select 语句 union select 语句</p>
</blockquote>
</li>
</ol>
<figure class="highlight crystal"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs crystal"><span class="hljs-keyword">select</span> * from teacher_table<br><span class="hljs-class"><span class="hljs-keyword">union</span></span><br><span class="hljs-comment">#这个结果集的数据列必须与前一个结果集的数据列一一对应</span><br><span class="hljs-keyword">select</span> student_id,student_name from student_table;<br></code></pre></div></td></tr></table></figure>
<blockquote>
<p><code>union会自动把重复的内容去掉，若要不去掉重复内容，可使用 union all</code></p>
</blockquote>
<p>2.minus运算</p>
<blockquote>
<p>select 语句 minus select 语句</p>
</blockquote>
<ul>
<li>MySQL并不支持minus运算符，相同运算：<figure class="highlight sql"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs sql"><span class="hljs-keyword">select</span> student_id,student_name <span class="hljs-keyword">from</span> student_table<br><span class="hljs-keyword">where</span> (student_id,student_name)<br><span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> <br>(<span class="hljs-keyword">select</span> teacher_id,teacher_name <span class="hljs-keyword">from</span> teacher_table);<br></code></pre></div></td></tr></table></figure></li>
</ul>
<p>3.intersect运算</p>
<blockquote>
<p>select 语句 intersect select 语句</p>
</blockquote>
<ul>
<li>MySQL并不支持intersect语句，相同运算：<figure class="highlight sql"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs sql"><span class="hljs-keyword">select</span> student_id ,student_name <span class="hljs-keyword">from</span> student_table<br><span class="hljs-keyword">join</span> <br>teacher_table<br><span class="hljs-keyword">on</span> (student_id =teacher_id <span class="hljs-keyword">and</span> student_name=teacher_name);<br></code></pre></div></td></tr></table></figure>
<figure class="highlight sql"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs sql"><span class="hljs-keyword">select</span> student_id,student_name <span class="hljs-keyword">from</span> student_table<br><span class="hljs-keyword">join</span> <br>teacher_table<br><span class="hljs-keyword">on</span> (student_id=teacher_id <span class="hljs-keyword">and</span> student_name=teacher_name)<br><span class="hljs-keyword">where</span> student_id&lt;<span class="hljs-number">4</span> <span class="hljs-keyword">and</span> teacher_name <span class="hljs-keyword">like</span> <span class="hljs-string">'李%'</span>;<br></code></pre></div></td></tr></table></figure>
<h2 id="触发器"><a href="#触发器" class="headerlink" title="触发器"></a>触发器</h2></li>
<li>触发器（trigger）由事件触发某个操作，这些事件包括insert into、updata、delete from语句</li>
<li>创建触发器</li>
</ul>
<ol>
<li>创建只有一个执行语句的触发器<figure class="highlight pgsql"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs pgsql"><span class="hljs-keyword">create</span> <span class="hljs-keyword">trigger</span> 触发器名 <span class="hljs-keyword">before</span>|<span class="hljs-keyword">after</span> 触发事件<br><span class="hljs-keyword">on</span> 表名 <span class="hljs-keyword">for</span> <span class="hljs-keyword">each</span> <span class="hljs-keyword">row</span>  执行语句<br></code></pre></div></td></tr></table></figure>
<figure class="highlight pgsql"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs pgsql"><span class="hljs-keyword">create</span> <span class="hljs-keyword">trigger</span> trigger_name <span class="hljs-keyword">after</span> <span class="hljs-keyword">insert</span><br><span class="hljs-keyword">on</span> t_book <span class="hljs-keyword">for</span> <span class="hljs-keyword">each</span> <span class="hljs-keyword">row</span> <br><span class="hljs-keyword">update</span> t_booktype <span class="hljs-keyword">set</span> bookNum=bookMun+<span class="hljs-number">1</span> <span class="hljs-keyword">where</span> <span class="hljs-built_in">new</span>.bookTypeId = t_booktype.id;<br></code></pre></div></td></tr></table></figure></li>
</ol>
<ul>
<li>过渡变量：<blockquote>
<p>new :<code>只能出现在insert和update出现时</code>，在insert时表示新插入的行数据，在update表示要替换的新数据</p>
</blockquote>
</li>
</ul>
<blockquote>
<p>old:<code>只能出现在delete和update出现时</code>，在delete时表示被删除的数据，在update表示被更改的原来的数据行</p>
</blockquote>
<ul>
<li>before 和after 的区别：<blockquote>
<p>before:在记录操纵之前触发，是先完成触发，在增删改，触发的语句先于监视的增删改；<code>（insert、update）可以对new进行修改</code></p>
</blockquote>
</li>
</ul>
<blockquote>
<p>after:在记录操纵之后触发，是先完成数据的增删改，再触发，触发的语句晚于监视的增删改操作；<code>不能对new进行修改</code></p>
</blockquote>
<blockquote>
<p><code>两者都不能对old进行修改</code></p>
</blockquote>
<ol start="2">
<li>创建有多个执行语句的触发器<figure class="highlight pgsql"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs pgsql"><span class="hljs-keyword">delimiter</span> |<br><span class="hljs-keyword">create</span> <span class="hljs-keyword">trigger</span> 触发器名 <span class="hljs-keyword">before</span>|<span class="hljs-keyword">after</span> 触发事件<br>  <span class="hljs-keyword">on</span> 表名 <span class="hljs-keyword">for</span> <span class="hljs-keyword">each</span> <span class="hljs-keyword">row</span><br>  <span class="hljs-keyword">begin</span><br>       执行语句列表;//每句后面用分号隔开<br>   <span class="hljs-keyword">end</span><br>| <span class="hljs-keyword">delimiter</span> ;<br></code></pre></div></td></tr></table></figure>
<blockquote>
<p>delimiter 重新定义结束符，保证完成全部操作，然后把结束符定义回分号 </p>
</blockquote>
</li>
</ol>
<blockquote>
<p><code>使用delimiter把触发器包括起来</code>，因为MySQL执行语句后面都要加分号</p>
</blockquote>
<figure class="highlight sql"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs sql">delimiter |<br>  <span class="hljs-keyword">create</span> <span class="hljs-keyword">trigger</span> trig_name <span class="hljs-keyword">after</span> <span class="hljs-keyword">delete</span><br>      <span class="hljs-keyword">on</span> t_book <span class="hljs-keyword">for</span> <span class="hljs-keyword">each</span> <span class="hljs-keyword">row</span><br>      <span class="hljs-keyword">begin</span><br>        <span class="hljs-keyword">update</span> t_bookType <span class="hljs-keyword">set</span> bookName=bookName<span class="hljs-number">-1</span> <span class="hljs-keyword">where</span> old.bookTypeId=t_booktype.id;<br>        <span class="hljs-keyword">insert</span> <span class="hljs-keyword">into</span> t_log <span class="hljs-keyword">values</span> (<span class="hljs-literal">null</span>,<span class="hljs-keyword">now</span>(),<span class="hljs-string">'在book表里删除了一条数据'</span>);<br>        <span class="hljs-keyword">delete</span> <span class="hljs-keyword">from</span> t_test <span class="hljs-keyword">where</span> old.bookTypeId=t_test.id;<br>      <span class="hljs-keyword">end</span><br>| delimeter ;<br></code></pre></div></td></tr></table></figure>
<ol start="3">
<li>查看触发器</li>
</ol>
<ul>
<li><code>show triggers</code>：查看所有触发器</li>
</ul>
<ol start="4">
<li>删除触发器<blockquote>
<p>drop trigger 触发器名；</p>
</blockquote>
<h2 id="存储过程和函数"><a href="#存储过程和函数" class="headerlink" title="存储过程和函数"></a>存储过程和函数</h2></li>
</ol>
<ul>
<li>存储过程和函数是在数据库中定义一些SQL语句的集合，然后直接调用这些存储过程和函数来执行已经定义好的SQL语句。</li>
<li>创建存储过程:<code>create procedure</code><figure class="highlight oxygene"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs oxygene"><span class="hljs-keyword">create</span> <span class="hljs-function"><span class="hljs-keyword">procedure</span> 名称<span class="hljs-params">([proc_parameter[,...])</span><br>     [<span class="hljs-title">characteristic</span>...]<span class="hljs-title">routine_body</span></span><br></code></pre></div></td></tr></table></figure>
<blockquote>
<p>proc_premeter 表示存储过程的参数列表；每个参数由3部分组成，分别为<code>输出输入类型、参数名称、参数类型</code></p>
</blockquote>
</li>
</ul>
<blockquote>
<p><code>[in|out|inout]param_name type</code></p>
</blockquote>
<ul>
<li>其中in表示输入参数；out表示输出参数；inout表示既可以输入，也可以输出；<blockquote>
<p>characteristic 参数有多个取值：</p>
</blockquote>
</li>
</ul>
<ol>
<li><p>languange sql:说明routine_body部分由sql语句组成，这也是系统默认语言</p>
</li>
<li><p>[not] deterministic: 指明存储过程的执行结果是否是确定的。deterministic表示结果是确定的，<code>每次执行存储过程，相同输入会得到相同的输出</code>；not deterministic 表示结果是非确定的，<code>相同的输入可能得到不同的输出，默认情况下都是非确定的</code></p>
</li>
<li><p>{contains SQL|NO SQL|reads sql data|modifies SQL data}： 指明子程序使用sql语句的限制，<code>默认使用contains SQL</code></p>
<blockquote>
<p>contain sql:表示子程序包含SQL语句，<code>但不包含读或写数据的语句</code></p>
</blockquote>
</li>
</ol>
<blockquote>
<p>no sql： 表示<code>子程序中不包含SQL语句</code></p>
</blockquote>
<blockquote>
<p>read SQL data：表示<code>子程序中包含读数据的语句</code></p>
</blockquote>
<blockquote>
<p>modifies sql data： 表示<code>子程序中包含写数据的语句</code></p>
</blockquote>
<figure class="highlight pgsql"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs pgsql"><span class="hljs-keyword">delimiter</span> &amp;&amp;<br><span class="hljs-keyword">create</span> <span class="hljs-keyword">procedure</span> 存储过程名( <span class="hljs-keyword">in</span> 变量 <span class="hljs-type">int</span>,<span class="hljs-keyword">out</span> count_num <span class="hljs-type">int</span>)<br>   <span class="hljs-keyword">read</span> <span class="hljs-keyword">sql</span> data<br>   <span class="hljs-keyword">begin</span><br>      <span class="hljs-keyword">select</span> count(*) <span class="hljs-keyword">from</span> 表名 <span class="hljs-keyword">where</span> bookTypeId=变量；<br>    <span class="hljs-keyword">end</span> <br>    &amp;&amp;<br><span class="hljs-keyword">delimiter</span> ；<br></code></pre></div></td></tr></table></figure>
<ul>
<li>创建存储函数<figure class="highlight routeros"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs routeros">create function 函数名([func_parameter[,<span class="hljs-built_in">..</span>]])<br>    return<span class="hljs-built_in"> type<br></span>    [characteristic<span class="hljs-built_in">..</span>] routine_body<br></code></pre></div></td></tr></table></figure>
func_parameter 表示存储函数的参数列表；可以由多个参数组成，<code>每个参数由参数名称和参数类型组成</code>：<blockquote>
<p>参数名称 参数类型</p>
</blockquote>
</li>
</ul>
<p><code>return type指定返回值类型</code></p>
<p>characteristic 参数指定存储过程的特性，该参数的取值与存储过程中的取值是一样的</p>
<p>routine_body参数是SQL代码的内容，可以使用begin…end来标志SQL代码的开始和结束</p>
<figure class="highlight sql"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs sql">delimiter &amp;&amp;<br><span class="hljs-keyword">create</span> <span class="hljs-keyword">function</span> func_book( 变量)<br>  <span class="hljs-keyword">return</span> <span class="hljs-built_in">varchar</span>(<span class="hljs-number">20</span>)<br>  <span class="hljs-keyword">begin</span> <br>    <span class="hljs-keyword">return</span> (<span class="hljs-keyword">select</span> bookName <span class="hljs-keyword">from</span> t_book <span class="hljs-keyword">where</span> <span class="hljs-keyword">id</span>=bookId);<br>  <span class="hljs-keyword">end</span><br>  &amp;&amp;<br>delimiter ;<br></code></pre></div></td></tr></table></figure>

<ul>
<li>调用存储过程和函数</li>
</ul>
<p>1.调用存储过程：</p>
<figure class="highlight gcode"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs gcode"><span class="hljs-keyword">call</span> 存储过程名<span class="hljs-comment">(参数)</span><br></code></pre></div></td></tr></table></figure>
<ol start="2">
<li>调用存储函数：<figure class="highlight stylus"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs stylus"><span class="hljs-function"><span class="hljs-title">fun_name</span><span class="hljs-params">(参数)</span></span><br></code></pre></div></td></tr></table></figure></li>
</ol>
<ul>
<li>查看存储过程和函数</li>
</ul>
<ol>
<li><p>show status 语句查看存储过程和函数的状态( <code>只能查看属性状态</code>)</p>
<blockquote>
<p>show procedure|function status [like 存储过程名|函数名]</p>
</blockquote>
</li>
<li><p>show create语句查看存储过程的函数的定义(<code>能够查到定义</code>)</p>
<blockquote>
<p>show create procedure|function 存储过程名或函数名</p>
</blockquote>
</li>
</ol>
<ul>
<li><p>修改存储过程和函数</p>
<figure class="highlight sql"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs sql"><span class="hljs-keyword">alter</span> prcedure|<span class="hljs-keyword">function</span> 存储过程|函数名(变量)<br>characteristic:<br> ( [contains <span class="hljs-keyword">SQL</span>|<span class="hljs-keyword">no</span> <span class="hljs-keyword">SQL</span>|<span class="hljs-keyword">read</span> <span class="hljs-keyword">SQL</span> <span class="hljs-keyword">data</span>|modifies <span class="hljs-keyword">SQL</span> <span class="hljs-keyword">data</span>|<span class="hljs-keyword">SQL</span> <span class="hljs-keyword">security</span>(definer|invoder])<br> <span class="hljs-keyword">comment</span> <span class="hljs-string">'string'</span>(修改内容)<br></code></pre></div></td></tr></table></figure>
<blockquote>
<p>sql security指明谁有权限来执行，definer表示只有定义者自己才能够执行，invoder表示调用者也可以执行，comment’string’是注释信息</p>
</blockquote>
</li>
<li><p>删除存储过程和函数</p>
<blockquote>
<p>drop procedure|function 存储名或者函数名；</p>
</blockquote>
</li>
<li><p>变量的使用</p>
</li>
</ul>
<ol>
<li>定义变量<blockquote>
<p>declare var_name[,…] type [default value]</p>
</blockquote>
</li>
</ol>
<p>2.为变量赋值</p>
<blockquote>
<p>set var_name = expr[,var_name[,…]]</p>
</blockquote>
<figure class="highlight sql"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs sql"><span class="hljs-keyword">select</span> col_name[,..] <span class="hljs-keyword">into</span> var_name[,...]<br>          <span class="hljs-keyword">from</span> <span class="hljs-keyword">table</span> <span class="hljs-keyword">name</span> <span class="hljs-keyword">where</span> condition<br></code></pre></div></td></tr></table></figure>

<figure class="highlight oxygene"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs oxygene">#定义变量与使用第一种赋值方法<br>delimiter &amp;&amp;<br><span class="hljs-keyword">create</span> <span class="hljs-function"><span class="hljs-keyword">procedure</span> <span class="hljs-title">pro_user</span><span class="hljs-params">()</span><br>      <span class="hljs-title">begin</span><br>         <span class="hljs-title">declare</span> <span class="hljs-title">a</span>,<span class="hljs-title">b</span> <span class="hljs-title">varchar</span><span class="hljs-params">(20)</span>;</span><br>         <span class="hljs-keyword">set</span> a=<span class="hljs-string">'XXXX'</span>,b=<span class="hljs-string">'xxxx'</span>;<br>         insert <span class="hljs-keyword">into</span> t_user values (NULL,a,b)<br>       <span class="hljs-keyword">end</span><br>&amp;&amp;<br>deliiter ;<br><br>#第二种赋值<br>delimiter &amp;&amp;<br><span class="hljs-keyword">create</span> <span class="hljs-function"><span class="hljs-keyword">procedure</span> <span class="hljs-title">pro_user</span><span class="hljs-params">()</span><br>      <span class="hljs-title">begin</span><br>         <span class="hljs-title">declare</span> <span class="hljs-title">a</span>,<span class="hljs-title">b</span> <span class="hljs-title">varchar</span><span class="hljs-params">(20)</span>;</span><br>         <span class="hljs-keyword">select</span> userName，password <span class="hljs-keyword">into</span> a,b <span class="hljs-keyword">from</span> t_user2 <span class="hljs-keyword">where</span> id=<span class="hljs-number">2</span>;<br>         insert <span class="hljs-keyword">into</span> t_user values (NULL,a,b)<br>       <span class="hljs-keyword">end</span><br>&amp;&amp;<br>deliiter ;<br></code></pre></div></td></tr></table></figure>
<ul>
<li>游标的使用<blockquote>
<p>查询语句可能查出多条记录，在存储过程和函数中必须<code>使用游标来逐条读取查询结果集中的记录</code>。游标的使用包括声明游标、打开游标、使用游标和关闭游标。<code>游标必须声明在处理程序之前，并且声明在变量和条件之后。</code></p>
</blockquote>
</li>
</ul>
<ol>
<li><p>声明游标</p>
<blockquote>
<p>delare cursor_name cursor for select_statement(对某个查询语句的游标）；</p>
</blockquote>
</li>
<li><p>打开游标</p>
<blockquote>
<p>open cursor_name;</p>
</blockquote>
</li>
<li><p>使用游标</p>
<blockquote>
<p>fetch cursor_name into var_name[,var_name…]</p>
</blockquote>
</li>
<li><p>关闭游标</p>
<blockquote>
<p>close cuesor_name;</p>
</blockquote>
</li>
</ol>
<figure class="highlight pgsql"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs pgsql"><span class="hljs-keyword">delimiter</span> &amp;&amp;<br><span class="hljs-keyword">create</span> <span class="hljs-keyword">procedure</span> pro_user()<br>      <span class="hljs-keyword">begin</span><br>         <span class="hljs-keyword">declare</span> a,b <span class="hljs-type">varchar</span>(<span class="hljs-number">20</span>);<br>         <span class="hljs-keyword">declare</span> 游标名 <span class="hljs-keyword">cursor</span> <span class="hljs-keyword">for</span> <span class="hljs-keyword">select</span> userName,<span class="hljs-keyword">password</span> <span class="hljs-keyword">from</span> t_user;<br>         <span class="hljs-keyword">open</span> 游标名；<br>         <span class="hljs-keyword">fetch</span> 游标名 <span class="hljs-keyword">into</span> a,b;<br>         <span class="hljs-keyword">insert</span> <span class="hljs-keyword">into</span> t_user <span class="hljs-keyword">values</span> (<span class="hljs-keyword">NULL</span>,a,b);<br>         <span class="hljs-keyword">close</span> 游标名；<br>       <span class="hljs-keyword">end</span><br>&amp;&amp;<br>deliiter ;<br></code></pre></div></td></tr></table></figure>
<ul>
<li>流程控制的使用<blockquote>
<p>流程控制语句包括if、case、loop、leave、iterate、repeat和while语句</p>
</blockquote>
</li>
</ul>
<ol>
<li>if语句<figure class="highlight gauss"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs gauss"><span class="hljs-keyword">if</span> search_condition then statement_list<br>   [<span class="hljs-keyword">elseif</span> search_condition then statement_list]...<br>   [<span class="hljs-keyword">else</span> statement_list]<br><span class="hljs-keyword">end</span> <span class="hljs-keyword">if</span>;<br></code></pre></div></td></tr></table></figure>
<figure class="highlight oxygene"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs oxygene">delimiter &amp;&amp;<br><span class="hljs-keyword">create</span> <span class="hljs-function"><span class="hljs-keyword">procedure</span> <span class="hljs-title">pro_user</span><span class="hljs-params">(<span class="hljs-keyword">in</span> bookId int)</span><br>      <span class="hljs-title">begin</span><br>         <span class="hljs-title">select</span> <span class="hljs-title">count</span><span class="hljs-params">(*)</span> <span class="hljs-title">into</span> @<span class="hljs-title">num</span> <span class="hljs-title">from</span> <span class="hljs-title">t_user</span> <span class="hljs-title">whrer</span> <span class="hljs-title">id</span>=<span class="hljs-title">bookId</span>;</span><br>         <span class="hljs-keyword">if</span> @num&gt;<span class="hljs-number">0</span> <span class="hljs-keyword">then</span> updata t_user <span class="hljs-keyword">set</span> userName=<span class="hljs-string">'xxxx'</span> <span class="hljs-keyword">where</span> id=bookId;<br>         <span class="hljs-keyword">else</span><br>            insert <span class="hljs-keyword">into</span> t_user values (NULL,<span class="hljs-string">'xxxx'</span>,<span class="hljs-string">'xxxxx'</span>);<br>        <span class="hljs-keyword">end</span> <span class="hljs-keyword">if</span>;<br>       <span class="hljs-keyword">end</span><br>&amp;&amp;<br>deliiter ;<br></code></pre></div></td></tr></table></figure></li>
<li>case 语句<figure class="highlight ceylon"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs ceylon"><span class="hljs-keyword">case</span> <span class="hljs-keyword">case</span><span class="hljs-number">_</span><span class="hljs-keyword">value</span><br>   when when<span class="hljs-number">_</span><span class="hljs-keyword">value</span> <span class="hljs-keyword">then</span> statement<span class="hljs-number">_</span>list<br>   [when when<span class="hljs-number">_</span><span class="hljs-keyword">value</span> <span class="hljs-keyword">then</span> statement<span class="hljs-number">_</span>list]...<br>   [<span class="hljs-keyword">else</span> ststement<span class="hljs-number">_</span>list]<br>end <span class="hljs-keyword">case</span>;<br></code></pre></div></td></tr></table></figure>
<figure class="highlight sql"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs sql">delimiter &amp;&amp;<br><span class="hljs-keyword">create</span> <span class="hljs-keyword">procedure</span> pro_user(<span class="hljs-keyword">in</span> bookId <span class="hljs-built_in">int</span>)<br>      <span class="hljs-keyword">begin</span><br>         <span class="hljs-keyword">select</span> <span class="hljs-keyword">count</span>(*) <span class="hljs-keyword">into</span> @<span class="hljs-keyword">num</span> <span class="hljs-keyword">from</span> t_user whrer <span class="hljs-keyword">id</span>=bookId;<br>         case @num<br>           when 1 then <span class="hljs-keyword">update</span> t_user <span class="hljs-keyword">set</span> user_name=<span class="hljs-string">'xxx'</span> <span class="hljs-keyword">where</span> <span class="hljs-keyword">id</span>=bookId;<br>           when 2 then <span class="hljs-keyword">insert</span> <span class="hljs-keyword">into</span> t_user <span class="hljs-keyword">values</span> (<span class="hljs-literal">NULL</span>,<span class="hljs-string">'xxx'</span>,<span class="hljs-string">'xxxx'</span>);<br>           else <span class="hljs-keyword">insert</span> <span class="hljs-keyword">into</span> t_user <span class="hljs-keyword">values</span>(<span class="hljs-literal">NULL</span>,<span class="hljs-string">'xxxx'</span>,<span class="hljs-string">'xxxx'</span>);<br>         <span class="hljs-keyword">end</span> <span class="hljs-keyword">case</span>;<br>       <span class="hljs-keyword">end</span><br>&amp;&amp;<br>deliiter ;<br></code></pre></div></td></tr></table></figure></li>
<li>loop,leave语句<blockquote>
<p>loop 语句可以使某些特定的语句重复执行，实现一个简单的循环，但是<code>loop语句本身没有停止循环的语句，必须遇到leave语句等才能停止循环</code></p>
</blockquote>
<figure class="highlight ada"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs ada">[begin_label:]<span class="hljs-keyword">loop</span><br>       statement_list<br><span class="hljs-keyword">end</span> <span class="hljs-keyword">loop</span> [end_label]<br></code></pre></div></td></tr></table></figure>
<blockquote>
<p>leave语句主要用于跳出循环：<code>leave label</code></p>
</blockquote>
</li>
</ol>
<figure class="highlight routeros"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs routeros">delimiter &amp;&amp;<br>create procedure pro_user(<span class="hljs-keyword">in</span> bookId int)<br>      begin<br>         aaa: loop<br>           <span class="hljs-builtin-name">set</span> <span class="hljs-attribute">totalNum</span>=totalNum-1;<br>           <span class="hljs-keyword">if</span> <span class="hljs-attribute">totalNum</span>=0 then leave<span class="hljs-built_in"> aaa;<br></span>           <span class="hljs-keyword">else</span> insert into t_user values(totalNum,<span class="hljs-string">'xxxx'</span>,<span class="hljs-string">'xxxxx'</span>);<br>           end <span class="hljs-keyword">if</span>;<br>         end loop<span class="hljs-built_in"> aaa;<br></span>       end<br>&amp;&amp;<br>deliiter ;<br></code></pre></div></td></tr></table></figure>
<ol start="4">
<li>iterate语句<blockquote>
<p>iterate 语句也是用来跳出循环的，但是iterate语句<code>跳出本次循环，然后进行下次循环</code>:<code>iterate label</code></p>
</blockquote>
<figure class="highlight routeros"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs routeros">delimiter &amp;&amp;<br>create procedure pro_user(<span class="hljs-keyword">in</span> bookId int)<br>      begin<br>         aaa: loop<br>           <span class="hljs-builtin-name">set</span> <span class="hljs-attribute">totalNum</span>=totalNum-1;<br>           <span class="hljs-keyword">if</span> <span class="hljs-attribute">totalNum</span>=0 then leave<span class="hljs-built_in"> aaa;<br></span>           elseif <span class="hljs-attribute">totalNum</span>=3 then iterate<span class="hljs-built_in"> aaa;<br></span>           end <span class="hljs-keyword">if</span>;<br>           insert into t_uesr values(totalNum,<span class="hljs-string">'xxx'</span>,<span class="hljs-string">'xxxxx'</span>);<br>         end loop<span class="hljs-built_in"> aaa;<br></span>       end<br>&amp;&amp;<br>deliiter ;<br></code></pre></div></td></tr></table></figure></li>
<li>repeat语句<blockquote>
<p>repeat语句是有条件的循环语句，当满足特定条件时，就会跳出循环语句</p>
</blockquote>
<figure class="highlight applescript"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs applescript">[begin_label:]<span class="hljs-keyword">repeat</span><br>       statement_list<br>       <span class="hljs-keyword">until</span> search_condition<br><span class="hljs-keyword">end</span> <span class="hljs-keyword">repeat</span>[end_list]<br></code></pre></div></td></tr></table></figure>
<figure class="highlight oxygene"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs oxygene">delimiter &amp;&amp;<br><span class="hljs-keyword">create</span> <span class="hljs-function"><span class="hljs-keyword">procedure</span> <span class="hljs-title">pro_user</span><span class="hljs-params">(<span class="hljs-keyword">in</span> bookId int)</span><br>      <span class="hljs-title">begin</span><br>        <span class="hljs-title">repeat</span> <br>            <span class="hljs-title">set</span> <span class="hljs-title">totalNum</span>=<span class="hljs-title">totalNum</span>-1;</span><br>            insert <span class="hljs-keyword">into</span> t_user values (totalNum,<span class="hljs-string">'xxxx'</span>,<span class="hljs-string">'xxxxx'</span>);<br>            <span class="hljs-keyword">until</span> totalNum=<span class="hljs-number">1</span>;<br>        <span class="hljs-keyword">end</span> <span class="hljs-keyword">repeat</span>;<br>       <span class="hljs-keyword">end</span><br>&amp;&amp;<br>deliiter ;<br></code></pre></div></td></tr></table></figure></li>
<li>while语句<figure class="highlight gauss"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs gauss">[begin_label:]<span class="hljs-keyword">while</span> search_condition <span class="hljs-keyword">do</span>(别忘了)<br>     statement_list<br><span class="hljs-keyword">end</span> <span class="hljs-keyword">while</span>[end_label]<br></code></pre></div></td></tr></table></figure>
<figure class="highlight oxygene"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs oxygene">delimiter &amp;&amp;<br><span class="hljs-keyword">create</span> <span class="hljs-function"><span class="hljs-keyword">procedure</span> <span class="hljs-title">pro_user</span><span class="hljs-params">(<span class="hljs-keyword">in</span> bookId int)</span><br>      <span class="hljs-title">begin</span><br>        <span class="hljs-title">while</span> <span class="hljs-title">totalNum</span> &gt;0 <span class="hljs-title">do</span><br>            <span class="hljs-title">insert</span> <span class="hljs-title">into</span> <span class="hljs-title">t_user</span> <span class="hljs-title">values</span> <span class="hljs-params">(totalNum,<span class="hljs-string">'xxxx'</span>,<span class="hljs-string">'xxxxx'</span>)</span>;</span><br>            <span class="hljs-keyword">set</span> totalNum=totalNum-<span class="hljs-number">1</span>；<br>        <span class="hljs-keyword">end</span> <span class="hljs-keyword">while</span>;<br>       <span class="hljs-keyword">end</span><br>&amp;&amp;<br>deliiter ;<br></code></pre></div></td></tr></table></figure>
<h1 id="事务"><a href="#事务" class="headerlink" title="事务"></a>事务</h1>事务表示进行一系列操作，在失败的情况下能够退回原来的状态，成功时则继续往下进行</li>
</ol>
<ul>
<li>使用<code>BEGIN</code>表示开始一个事务</li>
<li><code>COMMIT</code>:出现在事务中的最后，只有在所有的查询成功地执行之后才执行此命令</li>
<li><code>ROLLLBACK</code>:当事务中的系列查询的一个或者多个失败时将使用这个命令，并且把相关的表恢复到事务之前的状态（在每个执行语句后面都加）<figure class="highlight sql"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs sql"><span class="hljs-keyword">BEGIN</span>;<br>数据库操作语句;<br><span class="hljs-keyword">ROLLBACK</span>;<br>...<br><br><span class="hljs-keyword">COMMIT</span>;<br></code></pre></div></td></tr></table></figure>

</li>
</ul>
<h1 id="MySQL数据库导出和导入"><a href="#MySQL数据库导出和导入" class="headerlink" title="MySQL数据库导出和导入"></a>MySQL数据库导出和导入</h1><p>导出：</p>
<figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell">mysqldump -u root -p 数据库名&gt; 导出的文件名及路径<br></code></pre></div></td></tr></table></figure>

<p>导入：（先创建数据库）</p>
<figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell"><span class="hljs-meta">mysql&gt;</span><span class="bash"><span class="hljs-built_in">source</span> 文件</span><br></code></pre></div></td></tr></table></figure>

<h1 id="MySQL创建用户和授权"><a href="#MySQL创建用户和授权" class="headerlink" title="MySQL创建用户和授权"></a>MySQL创建用户和授权</h1><p>创建：</p>
<figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell">CREATE USER '用户名' IDENTIFIED BY '密码';<br></code></pre></div></td></tr></table></figure>

<p>授权：</p>
<figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell">GRANT ALL/SELECT/UPDATE/DELETE/UPDATE ON 数据库名.指定表（或*） TO '用户名';<br></code></pre></div></td></tr></table></figure>

<p>撤销权限：</p>
<figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell">REVOKE ALL/... ON 数据库名 FROM '用户名'@'localhost';<br></code></pre></div></td></tr></table></figure>

<p>删除用户：</p>
<figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell">DROP USER '用户名';<br></code></pre></div></td></tr></table></figure>


            </div>
            <hr>
            <div>
              <div class="post-metas mb-3">
                
                
                  <div class="post-meta">
                    <i class="iconfont icon-tags"></i>
                    
                      <a class="hover-with-bg" href="/tags/mysql/">mysql</a>
                    
                  </div>
                
              </div>
              
                <p class="note note-warning">
                  
                    本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-sa/4.0/deed.zh" target="_blank" rel="nofollow noopener noopener">CC BY-SA 4.0 协议</a> ，转载请注明出处！
                  
                </p>
              
              
                <div class="post-prevnext">
                  <article class="post-prev col-6">
                    
                    
                      <a href="/2018/04/21/php/">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">php</span>
                        <span class="visible-mobile">上一篇</span>
                      </a>
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/2018/04/18/HTML%20CSS/">
                        <span class="hidden-mobile">HTML CSS</span>
                        <span class="visible-mobile">下一篇</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
              <!-- Comments -->
              <article class="comments" id="comments">
                
                  
                
                
  <script type="text/javascript">
    Fluid.utils.loadComments('#comments', function() {
      var light = 'github-light';
      var dark = 'github-dark';
      var schema = document.documentElement.getAttribute('data-user-color-scheme');
      if (schema === 'dark') {
        schema = dark;
      } else {
        schema = light;
      }
      window.UtterancesThemeLight = light;
      window.UtterancesThemeDark = dark;
      var s = document.createElement('script');
      s.setAttribute('src', 'https://utteranc.es/client.js');
      s.setAttribute('repo', 'xiao-ming9/xiao-ming9.github.io');
      s.setAttribute('issue-term', 'pathname');
      
      s.setAttribute('label', 'utterances');
      
      s.setAttribute('theme', schema);
      s.setAttribute('crossorigin', 'anonymous');
      document.getElementById('comments').appendChild(s);
    })
  </script>
  <noscript>Please enable JavaScript to view the comments</noscript>


              </article>
            
          </article>
        </div>
      </div>
    </div>
    
      <div class="d-none d-lg-block col-lg-2 toc-container" id="toc-ctn">
        <div id="toc">
  <p class="toc-header"><i class="iconfont icon-list"></i>&nbsp;目录</p>
  <div class="toc-body" id="toc-body"></div>
</div>

      </div>
    
  </div>
</div>

<!-- Custom -->


    

    
      <a id="scroll-top-button" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">搜索</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v"
                 for="local-search-input">关键词</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>
    

    
  </main>

  <footer class="text-center mt-5 py-3">
  <div class="footer-content">
     <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a> 
  </div>
  
  <div class="statistics">
    
    

    
      
        <!-- LeanCloud 统计PV -->
        <span id="leancloud-site-pv-container" style="display: none">
            总访问量 
            <span id="leancloud-site-pv"></span>
             次
          </span>
      
      
        <!-- LeanCloud 统计UV -->
        <span id="leancloud-site-uv-container" style="display: none">
            总访客数 
            <span id="leancloud-site-uv"></span>
             人
          </span>
      

    
  </div>


  
  <!-- 备案信息 -->
  <div class="beian">
    <span>
      <a href="http://beian.miit.gov.cn/" target="_blank" rel="nofollow noopener">
        粤ICP备18114217号
      </a>
    </span>
    
      
        <span>
          <a
            href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=粤ICP备18114217号-1"
            rel="nofollow noopener"
            class="beian-police"
            target="_blank"
          >
            
              <span style="visibility: hidden; width: 0">|</span>
              <img src="/img/police_beian.png" alt="police-icon"/>
            
            <span>粤ICP备18114217号-1</span>
          </a>
        </span>
      
    
  </div>


  
</footer>


  <!-- SCRIPTS -->
  
  <script  src="https://cdn.jsdelivr.net/npm/nprogress@0.2.0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/nprogress@0.2.0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.min.js" ></script>
<script  src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/js/bootstrap.min.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>

<!-- Plugins -->




  



  <script  src="https://cdn.jsdelivr.net/npm/tocbot@4.12.0/dist/tocbot.min.js" ></script>



  <script  src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.js" ></script>



  <script  src="https://cdn.jsdelivr.net/npm/anchor-js@4.3.0/anchor.min.js" ></script>



  <script defer src="https://cdn.jsdelivr.net/npm/clipboard@2.0.6/dist/clipboard.min.js" ></script>



  <script  src="/js/local-search.js" ></script>




  <script defer src="/js/leancloud.js" ></script>



  <script  src="https://cdn.jsdelivr.net/npm/typed.js@2.0.11/lib/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var title = document.getElementById('subtitle').title;
      
      typing(title)
      
    })(window, document);
  </script>












  
    <!-- Baidu Analytics -->
    <script defer>
      var _hmt = _hmt || [];
      (function () {
        var hm = document.createElement("script");
        hm.src = "https://hm.baidu.com/hm.js?54ebb03ad7ad5b762ac8ff7958df6d3f";
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(hm, s);
      })();
    </script>
  

  
    <!-- Google Analytics -->
    <script defer>
      window.ga = window.ga || function () { (ga.q = ga.q || []).push(arguments) };
      ga.l = +new Date;
      ga('create', 'G-M2RT7SDT3L', 'auto');
      ga('send', 'pageview');
    </script>
    <script async src='https://www.google-analytics.com/analytics.js'></script>
  

  
    <!-- Google gtag.js -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-M2RT7SDT3L"></script>
    <script defer>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-M2RT7SDT3L');
    </script>
  

  

  

  





<!-- 主题的启动项 保持在最底部 -->
<script  src="/js/boot.js" ></script>


</body>
</html>
